# 12.2 å¤šæ™ºèƒ½ä½“å·¥ä½œæµå¤æ‚æ¡ˆä¾‹

åœ¨ä¸Šä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬äº†è§£äº†å¤šæ™ºèƒ½ä½“ç³»ç»Ÿçš„åŸºæœ¬æ¦‚å¿µã€‚æœ¬èŠ‚å°†æ·±å…¥æŽ¢è®¨ **Supervisor æ¨¡å¼**çš„é«˜çº§ç”¨æ³•ï¼Œé€šè¿‡ä¸€ä¸ª**å†…å®¹åˆ›ä½œå›¢é˜Ÿ**çš„å®Œæ•´æ¡ˆä¾‹ï¼Œå±•ç¤ºå¦‚ä½•æž„å»ºä¼ä¸šçº§çš„å¤šæ™ºèƒ½ä½“åä½œç³»ç»Ÿã€‚

---

## ä¸ºä»€ä¹ˆéœ€è¦å¤æ‚çš„å¤šæ™ºèƒ½ä½“æž¶æž„ï¼Ÿ

å½“ä½ çš„ AI åº”ç”¨åœºæ™¯å˜å¾—å¤æ‚æ—¶ï¼Œç®€å•çš„å• Agent æ–¹æ¡ˆå¾€å¾€åŠ›ä¸ä»Žå¿ƒï¼š

| æŒ‘æˆ˜ | è¡¨çŽ° | è§£å†³æ€è·¯ |
|------|------|----------|
| **å†³ç­–å¤æ‚åº¦é«˜** | éœ€è¦ç»¼åˆåˆ¤æ–­ã€æƒè¡¡åˆ©å¼Š | ä¸“ä¸š Agent å„å¸å…¶èŒï¼ŒååŒå†³ç­– |
| **è§„åˆ™ç»´æŠ¤å›°éš¾** | è§„åˆ™å¤šä¸”æ˜“å†²çªã€æ›´æ–°æˆæœ¬é«˜ | åˆ†è§£åˆ°ä¸åŒ Agentï¼Œé™ä½Žè€¦åˆ |
| **ä¾èµ–éžç»“æž„åŒ–æ•°æ®** | éœ€è¦ç†è§£æ–‡æ¡£ã€å¯¹è¯ç­‰ | ä¸“é—¨çš„ä¿¡æ¯æå–ä¸Žå¤„ç† Agent |

**æ ¸å¿ƒæ´žå¯Ÿ**ï¼šå¤æ‚ä»»åŠ¡çš„å…³é”®ä¸åœ¨äºŽå•ä¸ªæ¨¡åž‹æœ‰å¤šå¼ºå¤§ï¼Œè€Œåœ¨äºŽå¦‚ä½•è®©å¤šä¸ªä¸“ä¸š Agent é«˜æ•ˆåä½œã€‚

---

## Supervisor æ¨¡å¼æ ¸å¿ƒæœºåˆ¶

Supervisor æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³æ˜¯**ä¸­å¤®è°ƒåº¦**â€”â€”ç”±ä¸€ä¸ª"æ€»æŒ‡æŒ¥"æ¥åè°ƒå„ä¸ªä¸“ä¸š Agent çš„å·¥ä½œã€‚

### è¿ä½œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ç”¨æˆ·è¯·æ±‚                             â”‚
â”‚                         â†“                                â”‚
â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚                   â”‚Supervisorâ”‚ â† åˆ†æžæ„å›¾ã€åˆ†é…ä»»åŠ¡        â”‚
â”‚                   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                            â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚          â†“             â†“             â†“                   â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚    â”‚ Agent A â”‚   â”‚ Agent B â”‚   â”‚ Agent C â”‚              â”‚
â”‚    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜              â”‚
â”‚          â†“             â†“             â†“                   â”‚
â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚                   â”‚Supervisorâ”‚ â† æ±‡æ€»ç»“æžœã€åé¦ˆç”¨æˆ·        â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¸Ž Swarm æ¨¡å¼çš„æ ¸å¿ƒå·®å¼‚

| ç‰¹æ€§ | Supervisor æ¨¡å¼ | Swarm æ¨¡å¼ |
|------|----------------|-----------|
| **æŽ§åˆ¶æ–¹å¼** | é›†ä¸­å¼ï¼ŒSupervisor ç»Ÿç­¹ | åŽ»ä¸­å¿ƒåŒ–ï¼ŒAgent è‡ªä¸»äº¤æŽ¥ |
| **ç”¨æˆ·äº¤äº’** | ä¸»è¦é€šè¿‡ Supervisor | å¯ä¸Žä»»æ„ Agent ç›´æŽ¥äº¤äº’ |
| **æ‰§è¡Œæµç¨‹** | ä»»åŠ¡å®ŒæˆåŽè¿”å›ž Supervisor | Agent ä¹‹é—´ç›´æŽ¥ä¼ é€’æŽ§åˆ¶æƒ |
| **èµ·å§‹èŠ‚ç‚¹** | å›ºå®šä¸º Supervisor | å¯é…ç½®é»˜è®¤ Agent |
| **é€šä¿¡è·¯å¾„** | å¿…ç» Supervisor | Agent ç‚¹å¯¹ç‚¹é€šä¿¡ |
| **æœ€ä½³åœºæ™¯** | æµç¨‹æ˜Žç¡®ã€éœ€è¦ç›‘æŽ§ | çµæ´»å¯¹è¯ã€ä¸“å®¶è½®æ¢ |

---

## å®Œæ•´å®žçŽ°ï¼šå†…å®¹åˆ›ä½œå›¢é˜Ÿ

ä¸‹é¢æˆ‘ä»¬æž„å»ºä¸€ä¸ª**æ™ºèƒ½å†…å®¹åˆ›ä½œç³»ç»Ÿ**ï¼ŒåŒ…å«ï¼š
- **è°ƒç ”ä¸“å‘˜**ï¼šè´Ÿè´£æœç´¢èµ„æ–™ã€æ”¶é›†ä¿¡æ¯
- **æ•°æ®åˆ†æžå¸ˆ**ï¼šè´Ÿè´£æ•°æ®è®¡ç®—å’Œç»Ÿè®¡åˆ†æž
- **æ€»ç¼–è¾‘**ï¼ˆSupervisorï¼‰ï¼šåè°ƒå›¢é˜Ÿã€æ•´åˆè¾“å‡º

### çŽ¯å¢ƒå‡†å¤‡

```bash
pip install langgraph-supervisor langchain-openai langchain-community
```

```python
import os
from langchain_openai import ChatOpenAI
from langgraph.prebuilt import create_react_agent
from langgraph_supervisor import create_supervisor
from langchain_community.tools.tavily_search import TavilySearchResults

# é…ç½® LLM
llm = ChatOpenAI(
    model="gpt-4o",
    api_key=os.getenv("OPENAI_API_KEY")
)
```

### å®šä¹‰å·¥å…·é›†

```python
# æ•°æ®åˆ†æžå·¥å…·
def calculate_sum(numbers: list[float]) -> float:
    """å¯¹ä¸€ç»„æ•°å­—æ±‚å’Œ"""
    return sum(numbers)

def calculate_average(numbers: list[float]) -> float:
    """è®¡ç®—å¹³å‡å€¼"""
    return sum(numbers) / len(numbers) if numbers else 0

def calculate_percentage(part: float, total: float) -> float:
    """è®¡ç®—ç™¾åˆ†æ¯”"""
    return (part / total * 100) if total != 0 else 0

# æœç´¢å·¥å…·
search_tool = TavilySearchResults(
    max_results=3,
    tavily_api_key=os.getenv("TAVILY_API_KEY")
)
```

### åˆ›å»ºä¸“ä¸š Agent

```python
# è°ƒç ”ä¸“å‘˜ Agent
researcher = create_react_agent(
    model=llm,
    tools=[search_tool],
    name="research_specialist",
    prompt="""ä½ æ˜¯ä¸€åä¸“ä¸šçš„ä¿¡æ¯è°ƒç ”å‘˜ã€‚

èŒè´£èŒƒå›´ï¼š
- æ‰§è¡Œç½‘ç»œæœç´¢ï¼Œæ”¶é›†ç›¸å…³èµ„æ–™
- æ•´ç†å¹¶æç‚¼å…³é”®ä¿¡æ¯
- ä¸è¦è¿›è¡Œä»»ä½•æ•°å­¦è®¡ç®—

å·¥ä½œè§„èŒƒï¼š
- å®Œæˆè°ƒç ”åŽï¼Œå°†ç»“æžœç›´æŽ¥æ±‡æŠ¥ç»™æ€»ç¼–è¾‘
- åªè¿”å›žè°ƒç ”ç»“æžœï¼Œä¸è¦æ·»åŠ æ— å…³å†…å®¹"""
)

# æ•°æ®åˆ†æžå¸ˆ Agent
analyst = create_react_agent(
    model=llm,
    tools=[calculate_sum, calculate_average, calculate_percentage],
    name="data_analyst",
    prompt="""ä½ æ˜¯ä¸€åä¸“ä¸šçš„æ•°æ®åˆ†æžå¸ˆã€‚

èŒè´£èŒƒå›´ï¼š
- æ‰§è¡Œæ•°å­¦è®¡ç®—å’Œç»Ÿè®¡åˆ†æž
- å¤„ç†æ•°å€¼åž‹æ•°æ®
- ä¸è¦è¿›è¡Œç½‘ç»œæœç´¢

å·¥ä½œè§„èŒƒï¼š
- å®Œæˆåˆ†æžåŽï¼Œå°†ç»“æžœç›´æŽ¥æ±‡æŠ¥ç»™æ€»ç¼–è¾‘
- åªè¿”å›žè®¡ç®—ç»“æžœå’Œåˆ†æžç»“è®º"""
)
```

### åˆ›å»º Supervisor

```python
# æ€»ç¼–è¾‘ï¼ˆSupervisorï¼‰
editor_in_chief = create_supervisor(
    model=llm,
    agents=[researcher, analyst],
    prompt="""ä½ æ˜¯å†…å®¹åˆ›ä½œå›¢é˜Ÿçš„æ€»ç¼–è¾‘ï¼Œè´Ÿè´£åè°ƒä»¥ä¸‹æˆå‘˜ï¼š
- research_specialistï¼šè´Ÿè´£ä¿¡æ¯æœç´¢å’Œèµ„æ–™æ”¶é›†
- data_analystï¼šè´Ÿè´£æ•°æ®è®¡ç®—å’Œç»Ÿè®¡åˆ†æž

å·¥ä½œåŽŸåˆ™ï¼š
1. åˆ†æžç”¨æˆ·è¯·æ±‚ï¼Œåˆ¤æ–­éœ€è¦è°ƒç”¨å“ªä¸ªä¸“å®¶
2. ä¸€æ¬¡åªåˆ†é…ä»»åŠ¡ç»™ä¸€ä¸ªä¸“å®¶ï¼Œé¿å…å¹¶è¡Œè°ƒç”¨
3. è‡ªå·±ä¸æ‰§è¡Œå…·ä½“ä»»åŠ¡ï¼Œåªè´Ÿè´£åè°ƒå’Œæ±‡æ€»
4. å¤æ‚è¯·æ±‚å¯èƒ½éœ€è¦å¤šè½®åè°ƒï¼ˆå…ˆè°ƒç ”ã€å†åˆ†æžï¼‰""",
    add_handoff_back_messages=True,
    output_mode="full_history"
).compile()
```

### æµ‹è¯•è¿è¡Œ

```python
def run_creative_task(query: str):
    """æ‰§è¡Œåˆ›ä½œä»»åŠ¡"""
    print(f"ðŸ“ ä»»åŠ¡: {query}")
    print("-" * 60)

    for chunk in editor_in_chief.stream(
        {"messages": [{"role": "user", "content": query}]},
        subgraphs=False
    ):
        for node_name, node_data in chunk.items():
            if "messages" in node_data:
                last_msg = node_data["messages"][-1]
                print(f"[{node_name}] {last_msg.content[:200]}...")

    print("=" * 60)

# ç¤ºä¾‹ï¼šç»¼åˆæ€§è¯·æ±‚
run_creative_task(
    "å¸®æˆ‘è°ƒç ”ä¸€ä¸‹2024å¹´ä¸­å›½æ–°èƒ½æºæ±½è½¦å¸‚åœºçš„é”€é‡æ•°æ®ï¼Œ"
    "ç„¶åŽè®¡ç®—å‰ä¸‰å¤§å“ç‰Œçš„å¸‚åœºä»½é¢å æ¯”"
)
```

**æ‰§è¡Œæµç¨‹**ï¼š
1. æ€»ç¼–è¾‘æŽ¥æ”¶è¯·æ±‚ï¼Œåˆ¤æ–­éœ€è¦å…ˆè°ƒç ”
2. åˆ†é…ç»™ research_specialist æœç´¢å¸‚åœºæ•°æ®
3. è°ƒç ”å®ŒæˆåŽï¼Œä»»åŠ¡è¿”å›žæ€»ç¼–è¾‘
4. æ€»ç¼–è¾‘å°†æ•°æ®åˆ†é…ç»™ data_analyst è®¡ç®—ä»½é¢
5. åˆ†æžå®ŒæˆåŽï¼Œæ€»ç¼–è¾‘æ±‡æ€»å¹¶å›žå¤ç”¨æˆ·

---

## æ¶ˆæ¯åŽ†å²ç®¡ç†ç­–ç•¥

åœ¨å¤š Agent åä½œä¸­ï¼Œå¦‚ä½•ç®¡ç†å¯¹è¯åŽ†å²è‡³å…³é‡è¦ã€‚LangGraph æä¾›äº†ä¸¤ç§ç­–ç•¥ï¼š

### å®Œæ•´åŽ†å²æ¨¡å¼

ä¿ç•™ Agent æ‰§è¡Œè¿‡ç¨‹ä¸­çš„æ‰€æœ‰æ¶ˆæ¯ï¼Œé€‚åˆéœ€è¦è¿½æº¯å’Œè°ƒè¯•çš„åœºæ™¯ï¼š

```python
supervisor = create_supervisor(
    agents=[researcher, analyst],
    output_mode="full_history"  # ä¿ç•™å®Œæ•´å¯¹è¯åŽ†å²
)
```

**æ¶ˆæ¯æµç¤ºä¾‹**ï¼š
```
Human â†’ Supervisor â†’ [Tool: transfer_to_researcher] â†’ Researcher
â†’ [æœç´¢è¿‡ç¨‹...] â†’ [Tool: transfer_back] â†’ Supervisor
â†’ [Tool: transfer_to_analyst] â†’ Analyst â†’ [è®¡ç®—è¿‡ç¨‹...]
â†’ [Tool: transfer_back] â†’ Supervisor â†’ æœ€ç»ˆå›žå¤
```

### ç²¾ç®€ç»“æžœæ¨¡å¼

åªä¿ç•™æ¯ä¸ª Agent çš„æœ€ç»ˆè¾“å‡ºï¼Œé€‚åˆéœ€è¦ç®€æ´ä¸Šä¸‹æ–‡çš„åœºæ™¯ï¼š

```python
supervisor = create_supervisor(
    agents=[researcher, analyst],
    output_mode="last_message"  # åªä¿ç•™æœ€åŽä¸€æ¡æ¶ˆæ¯
)
```

**æ¶ˆæ¯æµç¤ºä¾‹**ï¼š
```
Human â†’ Supervisor â†’ Researcheræœ€ç»ˆç»“æžœ â†’ Analystæœ€ç»ˆç»“æžœ â†’ æœ€ç»ˆå›žå¤
```

### å¦‚ä½•é€‰æ‹©ï¼Ÿ

| åœºæ™¯ | æŽ¨èæ¨¡å¼ | ç†ç”± |
|------|----------|------|
| å¼€å‘è°ƒè¯•é˜¶æ®µ | `full_history` | ä¾¿äºŽè¿½è¸ªé—®é¢˜ |
| ä¸Šä¸‹æ–‡æ•æ„Ÿä»»åŠ¡ | `full_history` | Agent éœ€è¦äº†è§£å‰åºå·¥ä½œ |
| ç®€å•ç‹¬ç«‹ä»»åŠ¡ | `last_message` | å‡å°‘ token æ¶ˆè€— |
| é•¿å¯¹è¯åœºæ™¯ | `last_message` | é¿å…ä¸Šä¸‹æ–‡æº¢å‡º |

---

## å¤šå±‚çº§æž¶æž„è®¾è®¡

å½“ç³»ç»Ÿè§„æ¨¡æ‰©å¤§æ—¶ï¼Œå¯ä»¥æž„å»º**å±‚çº§å¼**çš„ Supervisor ç»“æž„ï¼š

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  æ€»ç¼–è¾‘ï¼ˆé¡¶å±‚ï¼‰ â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â†“             â†“             â†“
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ è°ƒç ”ç»„é•¿  â”‚  â”‚ åˆ†æžç»„é•¿  â”‚  â”‚ åˆ›ä½œç»„é•¿  â”‚
      â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
            â”‚              â”‚              â”‚
      â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
      â”‚ æœç´¢ä¸“å‘˜  â”‚  â”‚ ç»Ÿè®¡ä¸“å‘˜  â”‚  â”‚ æ–‡æ¡ˆä¸“å‘˜  â”‚
      â”‚ æ•´ç†ä¸“å‘˜  â”‚  â”‚ å¯è§†åŒ–ä¸“å‘˜â”‚  â”‚ æ ¡å¯¹ä¸“å‘˜  â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å®žçŽ°å¤šå±‚çº§ Supervisor

```python
# ç¬¬ä¸€å±‚ï¼šåˆ›å»ºå„ç»„çš„ Supervisor
research_team = create_supervisor(
    [search_agent, organize_agent],
    model=llm,
    supervisor_name="research_lead"
).compile(name="research_team")

analysis_team = create_supervisor(
    [stats_agent, viz_agent],
    model=llm,
    supervisor_name="analysis_lead"
).compile(name="analysis_team")

# ç¬¬äºŒå±‚ï¼šé¡¶å±‚ Supervisor ç®¡ç†å„ç»„
top_supervisor = create_supervisor(
    [research_team, analysis_team],
    model=llm,
    supervisor_name="editor_in_chief"
).compile(name="content_team")
```

**ä¼˜åŠ¿**ï¼š
- âœ… èŒè´£æ¸…æ™°ï¼Œæ˜“äºŽç»´æŠ¤
- âœ… å¯ç‹¬ç«‹æ‰©å±•å„å›¢é˜Ÿ
- âœ… æ”¯æŒæ›´å¤æ‚çš„åä½œæµç¨‹

---

## è‡ªå®šä¹‰ä»»åŠ¡äº¤æŽ¥æœºåˆ¶

é»˜è®¤çš„ handoff å·¥å…·å¯èƒ½æ— æ³•æ»¡è¶³ç‰¹å®šéœ€æ±‚ï¼Œä½ å¯ä»¥åˆ›å»ºè‡ªå®šä¹‰ç‰ˆæœ¬ï¼š

### åŸºç¡€è‡ªå®šä¹‰

```python
from langgraph_supervisor import create_handoff_tool

# è‡ªå®šä¹‰å·¥å…·åç§°å’Œæè¿°
custom_tools = [
    create_handoff_tool(
        agent_name="research_specialist",
        name="assign_research_task",
        description="å°†è°ƒç ”ç±»ä»»åŠ¡åˆ†é…ç»™è°ƒç ”ä¸“å‘˜ï¼ŒåŒ…æ‹¬ä¿¡æ¯æœç´¢ã€èµ„æ–™æ•´ç†ç­‰"
    ),
    create_handoff_tool(
        agent_name="data_analyst",
        name="assign_analysis_task",
        description="å°†æ•°æ®åˆ†æžä»»åŠ¡åˆ†é…ç»™åˆ†æžå¸ˆï¼ŒåŒ…æ‹¬è®¡ç®—ã€ç»Ÿè®¡ã€å¯¹æ¯”ç­‰"
    )
]

supervisor = create_supervisor(
    [researcher, analyst],
    model=llm,
    tools=custom_tools  # ä½¿ç”¨è‡ªå®šä¹‰å·¥å…·
)
```

### é«˜çº§è‡ªå®šä¹‰ï¼šå¸¦å‚æ•°çš„äº¤æŽ¥

```python
from typing import Annotated
from langchain_core.tools import tool, InjectedToolCallId
from langgraph.prebuilt import InjectedState
from langgraph.types import Command
from langgraph.graph import MessagesState

def create_task_handoff(agent_name: str, description: str):
    """åˆ›å»ºå¸¦ä»»åŠ¡æè¿°çš„äº¤æŽ¥å·¥å…·"""

    @tool(f"delegate_to_{agent_name}", description=description)
    def handoff_with_context(
        task_description: str,  # LLM å¡«å†™çš„ä»»åŠ¡æè¿°
        priority: str = "normal",  # ä»»åŠ¡ä¼˜å…ˆçº§
        state: Annotated[MessagesState, InjectedState] = None,
        tool_call_id: Annotated[str, InjectedToolCallId] = None
    ) -> Command:
        """
        å°†ä»»åŠ¡äº¤æŽ¥ç»™æŒ‡å®š Agentã€‚

        Args:
            task_description: å…·ä½“ä»»åŠ¡è¯´æ˜Ž
            priority: ä»»åŠ¡ä¼˜å…ˆçº§ (high/normal/low)
        """
        # æž„å»ºäº¤æŽ¥æ¶ˆæ¯
        handoff_msg = {
            "role": "tool",
            "content": f"ä»»åŠ¡å·²åˆ†é…ç»™ {agent_name}\n"
                      f"ä»»åŠ¡è¯´æ˜Ž: {task_description}\n"
                      f"ä¼˜å…ˆçº§: {priority}",
            "name": f"delegate_to_{agent_name}",
            "tool_call_id": tool_call_id
        }

        return Command(
            goto=agent_name,
            update={
                **state,
                "messages": state["messages"] + [handoff_msg],
                "current_task": task_description,
                "task_priority": priority
            },
            graph=Command.PARENT
        )

    return handoff_with_context
```

### æŽ§åˆ¶äº¤æŽ¥æ¶ˆæ¯æ˜¾ç¤º

```python
# ä¸æ˜¾ç¤ºäº¤æŽ¥è¿‡ç¨‹çš„ç³»ç»Ÿæ¶ˆæ¯
supervisor = create_supervisor(
    [researcher, analyst],
    model=llm,
    add_handoff_messages=False  # éšè—äº¤æŽ¥æ¶ˆæ¯
)

# è‡ªå®šä¹‰äº¤æŽ¥å·¥å…·å‰ç¼€
supervisor = create_supervisor(
    [researcher, analyst],
    model=llm,
    handoff_tool_prefix="assign_to"  # å·¥å…·åå˜ä¸º assign_to_xxx
)
```

---

## æ¶ˆæ¯è½¬å‘ä¼˜åŒ–

æœ‰æ—¶ Supervisor ä¸éœ€è¦å¯¹ Agent çš„å›žå¤åšé¢å¤–å¤„ç†ï¼Œå¯ä»¥ç›´æŽ¥è½¬å‘ç»™ç”¨æˆ·ï¼š

```python
from langgraph_supervisor.handoff import create_forward_message_tool

# åˆ›å»ºè½¬å‘å·¥å…·
forward_tool = create_forward_message_tool("editor_in_chief")

supervisor = create_supervisor(
    [researcher, analyst],
    model=llm,
    tools=[forward_tool]  # æ·»åŠ è½¬å‘èƒ½åŠ›
)
```

**ä½¿ç”¨åœºæ™¯**ï¼š
- Agent è¾“å‡ºå·²ç»è¶³å¤Ÿå®Œæ•´ï¼Œæ— éœ€ Supervisor æ¶¦è‰²
- å‡å°‘ Supervisor çš„é¢å¤–å¤„ç†ï¼Œé™ä½Žå»¶è¿Ÿ
- é¿å…ä¿¡æ¯åœ¨è½¬è¿°è¿‡ç¨‹ä¸­å¤±çœŸ

---

## Swarm æ¨¡å¼å¯¹æ¯”å®žçŽ°

ä¸ºäº†ç†è§£ Supervisor ä¸Ž Swarm çš„åŒºåˆ«ï¼Œæˆ‘ä»¬ç”¨ Swarm æ¨¡å¼å®žçŽ°åŒæ ·çš„ç³»ç»Ÿï¼š

```python
from langgraph_swarm import create_swarm, create_handoff_tool

# Swarm æ¨¡å¼ä¸‹ï¼Œæ¯ä¸ª Agent éœ€è¦æŒæœ‰äº¤æŽ¥å·¥å…·
handoff_to_analyst = create_handoff_tool(
    agent_name="data_analyst",
    description="å½“éœ€è¦æ•°æ®è®¡ç®—æ—¶ï¼Œè½¬äº¤ç»™æ•°æ®åˆ†æžå¸ˆ"
)

handoff_to_researcher = create_handoff_tool(
    agent_name="research_specialist",
    description="å½“éœ€è¦æœç´¢èµ„æ–™æ—¶ï¼Œè½¬äº¤ç»™è°ƒç ”ä¸“å‘˜"
)

# é‡æ–°åˆ›å»ºå¸¦æœ‰äº¤æŽ¥èƒ½åŠ›çš„ Agent
researcher_swarm = create_react_agent(
    model=llm,
    tools=[search_tool, handoff_to_analyst],  # å¯ä»¥è½¬äº¤ç»™åˆ†æžå¸ˆ
    name="research_specialist",
    prompt="ä½ æ˜¯è°ƒç ”ä¸“å‘˜ã€‚å®Œæˆè°ƒç ”åŽï¼Œå¦‚éœ€æ•°æ®åˆ†æžï¼Œè½¬äº¤ç»™åˆ†æžå¸ˆã€‚"
)

analyst_swarm = create_react_agent(
    model=llm,
    tools=[calculate_sum, calculate_average, handoff_to_researcher],
    name="data_analyst",
    prompt="ä½ æ˜¯æ•°æ®åˆ†æžå¸ˆã€‚å¦‚éœ€è¡¥å……èµ„æ–™ï¼Œè½¬äº¤ç»™è°ƒç ”ä¸“å‘˜ã€‚"
)

# åˆ›å»º Swarm
swarm_team = create_swarm(
    agents=[researcher_swarm, analyst_swarm],
    default_active_agent="research_specialist"  # é»˜è®¤ä»Žè°ƒç ”å¼€å§‹
).compile()
```

### å¯¹æ¯”æ€»ç»“

| ç»´åº¦ | Supervisor å®žçŽ° | Swarm å®žçŽ° |
|------|----------------|-----------|
| ä»£ç å¤æ‚åº¦ | è¾ƒç®€å•ï¼Œé›†ä¸­é…ç½® | éœ€è¦ä¸ºæ¯ä¸ª Agent é…ç½®äº¤æŽ¥å·¥å…· |
| æµç¨‹å¯æŽ§æ€§ | é«˜ï¼ŒSupervisor æŠŠå…³ | ä½Žï¼ŒAgent è‡ªä¸»å†³ç­– |
| è°ƒè¯•éš¾åº¦ | ä½Žï¼Œæœ‰æ˜Žç¡®çš„ä¸­å¿ƒèŠ‚ç‚¹ | é«˜ï¼Œéœ€è¦è¿½è¸ª Agent åˆ‡æ¢é“¾ |
| çµæ´»æ€§ | ä¸­ç­‰ | é«˜ï¼Œæ”¯æŒä»»æ„ Agent é—´åä½œ |
| é€‚ç”¨åœºæ™¯ | æµç¨‹é©±åŠ¨çš„ä»»åŠ¡ | å¯¹è¯é©±åŠ¨çš„äº¤äº’ |

---

## Agent æ‰§è¡ŒæŽ§åˆ¶

### è°ƒç”¨æ¨¡å¼

```python
# åŒæ­¥è°ƒç”¨ - ç­‰å¾…å®Œæˆ
result = supervisor.invoke(
    {"messages": [{"role": "user", "content": "æŸ¥è¯¢ä»Šå¹´é”€å”®æ•°æ®"}]}
)

# å¼‚æ­¥è°ƒç”¨ - éžé˜»å¡ž
result = await supervisor.ainvoke(
    {"messages": [{"role": "user", "content": "æŸ¥è¯¢ä»Šå¹´é”€å”®æ•°æ®"}]}
)

# æµå¼è¾“å‡º - å®žæ—¶åé¦ˆ
for chunk in supervisor.stream(
    {"messages": [{"role": "user", "content": "æŸ¥è¯¢ä»Šå¹´é”€å”®æ•°æ®"}]},
    stream_mode="updates"
):
    print(chunk)
```

### è¿­ä»£æ¬¡æ•°é™åˆ¶

é˜²æ­¢ Agent é™·å…¥æ— é™å¾ªçŽ¯ï¼š

```python
from langgraph.errors import GraphRecursionError

max_rounds = 5
recursion_limit = 2 * max_rounds + 1

try:
    result = supervisor.invoke(
        {"messages": [{"role": "user", "content": query}]},
        {"recursion_limit": recursion_limit}
    )
except GraphRecursionError:
    print("âš ï¸ è¾¾åˆ°æœ€å¤§è¿­ä»£æ¬¡æ•°ï¼Œè¯·ç®€åŒ–ä»»åŠ¡æˆ–æ£€æŸ¥ Agent é…ç½®")
```

---

## å®žæˆ˜å»ºè®®

### 1. Agent å‘½åä¸Žæè¿°

```python
# âŒ æ¨¡ç³Šçš„æè¿°
@tool("helper", description="å¸®åŠ©å¤„ç†äº‹æƒ…")
def bad_agent(): ...

# âœ… æ¸…æ™°çš„æè¿°
@tool(
    "market_researcher",
    description="ä¸“é—¨è´Ÿè´£å¸‚åœºè°ƒç ”ï¼ŒåŒ…æ‹¬ï¼šç«žå“åˆ†æžã€è¡Œä¸šè¶‹åŠ¿ã€ç”¨æˆ·ç”»åƒã€‚"
                "é€‚ç”¨äºŽéœ€è¦å¤–éƒ¨å¸‚åœºä¿¡æ¯çš„è¯·æ±‚ã€‚"
)
def good_agent(): ...
```

### 2. æ¸è¿›å¼å¤æ‚åº¦

| é˜¶æ®µ | å»ºè®®æ–¹æ¡ˆ |
|------|----------|
| éªŒè¯æƒ³æ³• | å• Agent + å°‘é‡å·¥å…· |
| åˆæ­¥ç”Ÿäº§ | Supervisor + 2-3 ä¸“ä¸š Agent |
| è§„æ¨¡åŒ– | å±‚çº§å¼å¤šæ™ºèƒ½ä½“æž¶æž„ |

### 3. å¸¸è§é—®é¢˜æŽ’æŸ¥

| é—®é¢˜ | å¯èƒ½åŽŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|----------|----------|
| Supervisor ä¸è°ƒç”¨ Agent | å·¥å…·æè¿°ä¸æ¸…æ™° | ä¼˜åŒ– Agent å·¥å…·çš„ description |
| Agent æ‰§è¡Œé”™è¯¯ä»»åŠ¡ | èŒè´£è¾¹ç•Œæ¨¡ç³Š | æ˜Žç¡®æ¯ä¸ª Agent çš„ prompt |
| æ— é™å¾ªçŽ¯ | ç¼ºå°‘ç»ˆæ­¢æ¡ä»¶ | è®¾ç½® recursion_limit |
| ä¸Šä¸‹æ–‡ä¸¢å¤± | ä½¿ç”¨äº† last_message æ¨¡å¼ | æ”¹ç”¨ full_history æ¨¡å¼ |

---

## å°ç»“

æœ¬èŠ‚æˆ‘ä»¬æ·±å…¥å­¦ä¹ äº† Supervisor æ¨¡å¼çš„é«˜çº§ç”¨æ³•ï¼š

- âœ… **æ ¸å¿ƒæœºåˆ¶**ï¼šä¸­å¤®è°ƒåº¦ã€ä¸“ä¸šåˆ†å·¥
- âœ… **æ¶ˆæ¯ç®¡ç†**ï¼šå®Œæ•´åŽ†å² vs ç²¾ç®€ç»“æžœ
- âœ… **å±‚çº§æž¶æž„**ï¼šæ”¯æŒå¤§è§„æ¨¡å›¢é˜Ÿåä½œ
- âœ… **è‡ªå®šä¹‰äº¤æŽ¥**ï¼šçµæ´»æŽ§åˆ¶ä»»åŠ¡æµè½¬
- âœ… **æ¨¡å¼å¯¹æ¯”**ï¼šSupervisor vs Swarm çš„é€‚ç”¨åœºæ™¯

**æ ¸å¿ƒè¦ç‚¹**ï¼šå¤šæ™ºèƒ½ä½“ç³»ç»Ÿçš„å…³é”®åœ¨äºŽ**èŒè´£æ¸…æ™°**å’Œ**åä½œé¡ºç•…**ã€‚Supervisor æ¨¡å¼æä¾›äº†ä¸€ç§ç»“æž„åŒ–çš„æ–¹å¼æ¥ç»„ç»‡ Agent å›¢é˜Ÿï¼Œç‰¹åˆ«é€‚åˆæµç¨‹æ˜Žç¡®ã€éœ€è¦ç›‘æŽ§çš„ä¸šåŠ¡åœºæ™¯ã€‚

---

> **ä¸‹ä¸€èŠ‚é¢„å‘Š**ï¼šæˆ‘ä»¬å°†æŽ¢è®¨ Agentic RAGâ€”â€”å¦‚ä½•è®© Agent æ›´æ™ºèƒ½åœ°æ£€ç´¢å’Œåˆ©ç”¨çŸ¥è¯†åº“ã€‚
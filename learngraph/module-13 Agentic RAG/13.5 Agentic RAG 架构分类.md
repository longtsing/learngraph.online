# Agentic RAG 架构分类

> 从单智能体到复杂层级系统：七种核心架构详解

---

## 架构概览

Agentic RAG 系统根据复杂度和适用场景，可分为七种主要架构类型：

| 架构类型 | 复杂度 | 核心特征 | 适用场景 |
|----------|--------|----------|----------|
| 单智能体路由 | 低 | 集中决策 | 简单多源检索 |
| 多智能体系统 | 中 | 专业分工 | 高并发复杂查询 |
| 层级系统 | 高 | 多级监督 | 企业级应用 |
| 纠正式 RAG | 中 | 自我纠错 | 高准确性需求 |
| 自适应 RAG | 中 | 动态策略 | 混合复杂度查询 |
| 图增强 RAG | 高 | 关系推理 | 知识图谱场景 |
| 文档工作流 | 高 | 端到端自动化 | 企业文档处理 |

---

## 一、单智能体路由架构（Single-Agent Router）

单智能体路由是最简洁的 Agentic RAG 架构，由**一个统一的智能体**管理所有检索、路由和信息整合任务。

![单智能体 RAG](./images/single_agentic_RAG.png)
*图 1：单智能体 Agentic RAG 架构*

### 工作流程

```
用户查询
    │
    ↓
┌─────────────────────────────────────┐
│         协调智能体（Router）          │
│   分析查询 → 选择数据源 → 协调检索     │
└─────────────────────────────────────┘
    │
    ├─→ 向量数据库（语义检索）
    │
    ├─→ SQL 数据库（结构化查询）
    │
    ├─→ Web 搜索（实时信息）
    │
    └─→ 推荐系统（个性化内容）
    │
    ↓
LLM 整合生成 → 最终响应
```

### 核心优势

- **集中简化**：单一智能体处理所有任务，降低系统复杂度
- **动态路由**：实时评估查询，选择最优数据源
- **灵活适配**：支持多种工具类型
- **低开销**：计算资源需求较少

### 局限性

- 当工具数量过多时，选择效率下降
- 无法并行处理复杂多领域查询
- 单点故障风险

### 适用场景

- 工具/数据源数量有限（<10个）
- 查询类型相对明确
- 对响应延迟敏感的应用

---

## 二、多智能体系统（Multi-Agent System）

多智能体架构将职责**分配给多个专业化智能体**，每个智能体专注于特定数据源或任务类型。

![多智能体 RAG](./images/multiagent_agentic_rag.png)
*图 2：多智能体 Agentic RAG 架构*

### 工作流程

```
用户查询
    │
    ↓
┌─────────────────────────────────────┐
│         主协调智能体                  │
│      接收查询 → 任务分配              │
└─────────────────────────────────────┘
    │
    ├─────────────────────────────────┤
    │           并行处理               │
    │                                 │
    │  ┌─────────┐  ┌─────────┐      │
    │  │SQL 专家  │  │语义检索  │      │
    │  │智能体   │  │智能体   │      │
    │  └─────────┘  └─────────┘      │
    │                                 │
    │  ┌─────────┐  ┌─────────┐      │
    │  │Web 搜索 │  │推荐系统 │      │
    │  │智能体   │  │智能体   │      │
    │  └─────────┘  └─────────┘      │
    │                                 │
    ├─────────────────────────────────┤
    │
    ↓
结果聚合 → LLM 整合 → 最终响应
```

### 核心优势

- **模块化**：智能体可独立添加、删除、升级
- **并行处理**：多智能体同时工作，提升吞吐量
- **专业优化**：每个智能体针对特定任务优化
- **容错性**：单个智能体失败不影响整体

### 设计挑战

- **协调复杂**：需要有效的通信和同步机制
- **计算开销**：多智能体运行增加资源消耗
- **数据整合**：来自不同源的信息需要高效整合

### 适用场景

- 大规模数据源（10+）
- 高并发查询需求
- 需要专业化处理的多领域应用

---

## 三、层级架构（Hierarchical System）

层级架构通过**多层智能体结构**实现战略决策和资源分配，高层智能体监督低层智能体。

![层级 RAG](./images/hierarchical_agentic_rag.png)
*图 3：层级 Agentic RAG 架构*

### 架构设计

```
                    ┌─────────────────┐
                    │  顶层智能体      │
                    │ (战略决策层)     │
                    └────────┬────────┘
                             │
              ┌──────────────┼──────────────┐
              ↓              ↓              ↓
        ┌──────────┐  ┌──────────┐  ┌──────────┐
        │中层智能体 │  │中层智能体 │  │中层智能体 │
        │(领域协调) │  │(领域协调) │  │(领域协调) │
        └─────┬────┘  └─────┬────┘  └─────┬────┘
              │              │              │
         ┌────┴────┐    ┌────┴────┐    ┌────┴────┐
         ↓         ↓    ↓         ↓    ↓         ↓
      ┌─────┐  ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐
      │执行者│  │执行者│ │执行者│ │执行者│ │执行者│ │执行者│
      └─────┘  └─────┘ └─────┘ └─────┘ └─────┘ └─────┘
```

### 层级职责

| 层级 | 职责 | 能力 |
|------|------|------|
| **顶层** | 战略决策 | 任务评估、资源优先级、数据源排序 |
| **中层** | 领域协调 | 子任务分配、领域内优化 |
| **底层** | 任务执行 | 具体检索、数据处理 |

### 核心优势

- **战略优先级**：顶层智能体根据可靠性和相关性排序数据源
- **可扩展性**：通过分布式处理应对复杂多面查询
- **决策增强**：多层监督提升准确性和连贯性

### 适用场景

- 企业级知识管理系统
- 多部门协作场景
- 需要审批流程的敏感应用

---

## 四、纠正式 RAG（Corrective RAG / CRAG）

纠正式 RAG 引入**自我纠错机制**，动态评估检索结果的相关性，并在不足时触发纠正措施。

![纠正式 RAG](./images/agentic_corrective_rag.png)
*图 4：纠正式 Agentic RAG 架构*

### 核心机制

```
用户查询
    │
    ↓
初始检索 → 相关性评估
              │
         ┌────┴────┐
         ↓         ↓
      相关       不相关
         │         │
         ↓         ↓
     直接使用    触发纠正
                   │
              ┌────┴────┐
              ↓         ↓
          查询重写   外部检索
              │         │
              └────┬────┘
                   ↓
              重新检索
                   │
                   ↓
              再次评估...
```

### 五大专业智能体

| 智能体 | 功能 |
|--------|------|
| **上下文检索** | 从知识库获取初始文档 |
| **相关性评估** | 评估文档与查询的匹配度 |
| **查询重写** | 优化查询以提高检索精度 |
| **外部知识检索** | 当内部知识不足时访问外部资源 |
| **响应合成** | 整合信息生成最终响应 |

### 核心优势

- **迭代纠正**：动态识别不相关结果并修正
- **动态适应**：实时整合外部信息（Web 搜索）
- **事实保证**：最小化幻觉和错误信息风险

### 适用场景

- 对准确性要求极高的应用（医疗、法律）
- 知识库可能不完整的场景
- 需要实时信息补充的应用

---

## 五、自适应 RAG（Adaptive RAG）

自适应 RAG 根据查询复杂度**动态选择处理策略**，实现资源的最优分配。

![自适应 RAG](./images/adaptive_rag_agent.png)
*图 5：自适应 Agentic RAG 架构*

### 核心原理

```
用户查询
    │
    ↓
┌─────────────────────────────────────┐
│         复杂度分类器                  │
│  (小模型，低成本，快速判断)           │
└─────────────────────────────────────┘
    │
    ├─→ 简单查询 → 无检索，直接生成
    │
    ├─→ 中等查询 → 单次检索 + 生成
    │
    └─→ 复杂查询 → 多步迭代检索 + 推理
```

### 三级处理策略

| 复杂度 | 策略 | 资源消耗 |
|--------|------|----------|
| **简单** | 直接使用 LLM 内置知识 | 最低 |
| **中等** | 单次检索增强 | 中等 |
| **复杂** | 多步迭代推理 | 最高 |

### 分类器设计

分类器通常使用**小型语言模型**，基于标注数据训练：

```python
class ComplexityClassifier:
    def __init__(self):
        self.model = load_small_model()  # 如 DistilBERT

    def classify(self, query):
        features = self.extract_features(query)
        # 特征包括：查询长度、实体数量、关系复杂度等
        return self.model.predict(features)
        # 返回：'simple', 'moderate', 'complex'
```

### 核心优势

- **资源效率**：简单查询快速处理，复杂查询深入分析
- **成本优化**：避免不必要的检索操作
- **响应优化**：简单问题快速响应，复杂问题充分推理

### 适用场景

- 查询复杂度差异大的应用
- 成本敏感的生产环境
- 需要平衡速度与质量的系统

---

## 六、图增强 RAG（Graph-Based RAG）

图增强 RAG 将**知识图谱**与文档检索结合，增强关系推理和多跳问答能力。

### Agent-G 框架

![Agent-G](./images/agent_g.png)
*图 6：Agent-G 框架架构*

Agent-G 整合图知识库和非结构化文档检索：

```
用户查询
    │
    ├─→ 图检索器 → 实体关系
    │
    └─→ 文档检索器 → 上下文信息
    │
    ↓
┌─────────────────────────────────────┐
│           批评模块                   │
│   验证数据相关性和质量               │
│   低置信度 → 触发重新检索            │
└─────────────────────────────────────┘
    │
    ↓
LLM 整合 → 最终响应
```

### GeAR 框架

![GeAR](./images/gear_overview.png)
*图 7：GeAR 框架概览*

GeAR 通过**图扩展**增强传统检索：

- **图扩展模块**：将图结构数据整合到检索过程
- **智能体检索**：自主选择和组合检索策略
- **多跳支持**：处理需要跨多个信息节点的复杂查询

### 核心优势

- **增强推理**：结合结构化关系与上下文信息
- **动态适应**：根据查询需求调整检索策略
- **高准确性**：通过批评模块验证数据质量

### 适用场景

- 知识图谱应用
- 需要实体关系推理的问答
- 科研文献分析（引用关系、作者网络）

---

## 七、Agentic 文档工作流（ADW）

Agentic 文档工作流将传统 RAG 扩展为**端到端文档处理自动化**，实现从文档解析到结构化输出的完整流程。

![文档工作流](./images/agentic_doc_workflow.png)
*图 8：Agentic 文档工作流*

### 工作流程

```
原始文档
    │
    ↓
┌─────────────────────────────────────┐
│           文档解析                   │
│   提取字段、识别结构                 │
└─────────────────────────────────────┘
    │
    ↓
┌─────────────────────────────────────┐
│           状态维护                   │
│   跨处理阶段跟踪文档上下文           │
└─────────────────────────────────────┘
    │
    ↓
┌─────────────────────────────────────┐
│           知识检索                   │
│   访问外部知识库和领域规则           │
└─────────────────────────────────────┘
    │
    ↓
┌─────────────────────────────────────┐
│           智能编排                   │
│   应用业务规则、多跳推理             │
└─────────────────────────────────────┘
    │
    ↓
结构化输出（报告、决策、操作建议）
```

### 核心特征

| 特征 | 说明 |
|------|------|
| **状态维护** | 跨处理阶段保持文档上下文一致性 |
| **多步编排** | 协调多组件完成复杂工作流 |
| **领域智能** | 应用特定业务规则和合规要求 |
| **可扩展性** | 支持大规模文档处理 |

### 典型应用：发票处理

```
发票文档
    │
    ↓
解析：提取供应商、金额、日期、项目明细
    │
    ↓
检索：获取供应商合同、折扣条款
    │
    ↓
推理：应用折扣规则、合规检查
    │
    ↓
输出：付款建议、预算影响分析
```

### 适用场景

- 企业文档自动化处理
- 合同审查和管理
- 财务报表分析
- 合规文档审核

---

## 架构选择决策树

```
                    你的应用需求是什么？
                           │
              ┌────────────┼────────────┐
              ↓            ↓            ↓
          简单问答     复杂推理      文档处理
              │            │            │
              ↓            ↓            ↓
         单智能体      多数据源？    端到端自动化
              │            │            │
              │       ┌────┴────┐       │
              │       ↓         ↓       │
              │   需要纠错？  知识图谱？   │
              │       │         │       │
              │       ↓         ↓       │
              │   纠正式RAG  图增强RAG   │
              │                         │
              └────────────┬────────────┘
                           │
                     需要层级控制？
                           │
                    ┌──────┴──────┐
                    ↓             ↓
               层级架构      多智能体
```

---

## 思考题

1. 如何决定使用单智能体还是多智能体架构？关键考量因素是什么？
2. 纠正式 RAG 和自适应 RAG 可以结合使用吗？如何设计？
3. 在实现层级架构时，如何避免信息传递过程中的损失？

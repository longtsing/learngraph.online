# 1.6 LangGraph æœ¯è¯­æ±‡æ€»

> **ä½¿ç”¨è¯´æ˜**
> æœ¬æœ¯è¯­è¡¨æŒ‰ LangGraph æ ¸å¿ƒæ¨¡å—åˆ†ç±»,æä¾›æŠ€æœ¯å®šä¹‰ã€LangGraph åº”ç”¨åœºæ™¯å’Œé€šä¿—æ˜“æ‡‚çš„è§£é‡Šã€‚å»ºè®®é…åˆå®é™…ä»£ç ç¤ºä¾‹å­¦ä¹ ã€‚

---

## 1ï¸âƒ£ æ ¸å¿ƒæ¶æ„(Core Architecture)

| æœ¯è¯­ | æŠ€æœ¯å®šä¹‰ | LangGraph åº”ç”¨ | é€šä¿—è§£é‡Š | é‡è¦ç¨‹åº¦ |
|------|---------|---------------|---------|---------|
| **StateGraph** | æœ‰å‘çŠ¶æ€å›¾,ç®¡ç†çŠ¶æ€è½¬æ¢å’ŒèŠ‚ç‚¹æ‰§è¡Œ | LangGraph æ ¸å¿ƒç±»,å®šä¹‰ Agent å·¥ä½œæµ | å°±åƒä¸€å¼ æµç¨‹å›¾,æ¯ä¸ªæ–¹æ¡†æ˜¯ä¸€ä¸ªå¤„ç†æ­¥éª¤,ç®­å¤´è¡¨ç¤ºæµè½¬æ–¹å‘ | â­â­â­â­â­ |
| **Node(èŠ‚ç‚¹)** | å›¾ä¸­çš„è®¡ç®—å•å…ƒ,æ¥æ”¶çŠ¶æ€å¹¶è¿”å›æ›´æ–° | å‡½æ•°ç­¾å:`def node(state: State) -> State` | å·¥ä½œæµä¸­çš„ä¸€ä¸ªå…·ä½“æ“ä½œ,æ¯”å¦‚"è°ƒç”¨ AI"ã€"æŸ¥è¯¢æ•°æ®åº“" | â­â­â­â­â­ |
| **Edge(è¾¹)** | è¿æ¥èŠ‚ç‚¹çš„æœ‰å‘è¿æ¥,å®šä¹‰æ‰§è¡Œé¡ºåº | `add_edge("node_a", "node_b")` | æµç¨‹å›¾çš„ç®­å¤´,å‘Šè¯‰ç¨‹åº"å®Œæˆè¿™æ­¥åå»å“ªé‡Œ" | â­â­â­â­â­ |
| **Conditional Edge** | æ ¹æ®çŠ¶æ€åŠ¨æ€é€‰æ‹©ä¸‹ä¸€èŠ‚ç‚¹çš„è¾¹ | `add_conditional_edges(node, routing_func)` | åˆ†å‰è·¯å£,æ ¹æ®æ¡ä»¶å†³å®šèµ°å“ªæ¡è·¯(å¦‚:æˆåŠŸâ†’ç»§ç»­,å¤±è´¥â†’é‡è¯•) | â­â­â­â­â­ |
| **START / END** | å›¾çš„å…¥å£å’Œå‡ºå£ç‰¹æ®ŠèŠ‚ç‚¹ | `add_edge(START, "first_node")` | æµç¨‹çš„èµ·ç‚¹å’Œç»ˆç‚¹,å°±åƒç¨‹åºçš„ main å‡½æ•°å’Œ return | â­â­â­â­â­ |
| **Cycle(å¾ªç¯)** | å›¾ä¸­å­˜åœ¨çš„å›è·¯,æ”¯æŒè¿­ä»£æ‰§è¡Œ | Agent å¯ä»¥åå¤è°ƒç”¨å·¥å…·ç›´åˆ°å®Œæˆä»»åŠ¡ | å…è®¸æµç¨‹"å›å¤´å†æ¥",æ¯”å¦‚ AI å¤šè½®å¯¹è¯æˆ–é‡è¯•æœºåˆ¶ | â­â­â­â­â­ |
| **Compiled Graph** | ç¼–è¯‘åçš„å¯æ‰§è¡Œå›¾å¯¹è±¡ | `graph.compile(checkpointer=memory)` | æŠŠæµç¨‹å›¾"æ‰“åŒ…"æˆå¯è¿è¡Œçš„ç¨‹åº | â­â­â­â­â­ |

---

## 2ï¸âƒ£ çŠ¶æ€ç®¡ç†(State Management)

| æœ¯è¯­ | æŠ€æœ¯å®šä¹‰ | LangGraph åº”ç”¨ | é€šä¿—è§£é‡Š | é‡è¦ç¨‹åº¦ |
|------|---------|---------------|---------|---------|
| **State** | åœ¨èŠ‚ç‚¹é—´ä¼ é€’çš„æ•°æ®å­—å…¸ | å­˜å‚¨æ¶ˆæ¯å†å²ã€ä¸Šä¸‹æ–‡ã€å·¥å…·è°ƒç”¨ç»“æœç­‰ | ç¨‹åºçš„"è®°å¿†",è®°å½•æ‰€æœ‰å‘ç”Ÿè¿‡çš„äº‹æƒ… | â­â­â­â­â­ |
| **State Schema** | TypedDict å®šä¹‰çš„çŠ¶æ€ç»“æ„ | `class AgentState(TypedDict): messages: list` | çŠ¶æ€çš„"æ•°æ®æ ¼å¼è¯´æ˜ä¹¦",å®šä¹‰æœ‰å“ªäº›å­—æ®µ | â­â­â­â­â­ |
| **Reducer** | çŠ¶æ€å­—æ®µçš„åˆå¹¶ç­–ç•¥å‡½æ•° | `Annotated[list, operator.add]` | å®šä¹‰å¦‚ä½•åˆå¹¶æ¥è‡ªå¤šä¸ªèŠ‚ç‚¹çš„æ•°æ®(åŠ æ³•ã€è¦†ç›–ç­‰) | â­â­â­â­â­ |
| **MessagesState** | å†…ç½®çš„æ¶ˆæ¯ç®¡ç†çŠ¶æ€ç±» | è‡ªå¸¦ `add_messages` reducer | ä¸“é—¨ç®¡ç†å¯¹è¯å†å²çš„çŠ¶æ€,è‡ªåŠ¨å¤„ç†æ¶ˆæ¯è¿½åŠ  | â­â­â­â­â­ |
| **add_messages** | æ¶ˆæ¯åˆ—è¡¨çš„æ™ºèƒ½ reducer | æ”¯æŒæ¶ˆæ¯å»é‡ã€è¦†ç›–ã€åˆ é™¤ | èªæ˜åœ°è¿½åŠ æ¶ˆæ¯,é¿å…é‡å¤,æ”¯æŒæ›´æ–°å’Œåˆ é™¤ | â­â­â­â­â­ |
| **RemoveMessage** | æ ‡è®°è¦åˆ é™¤çš„æ¶ˆæ¯ | `return {"messages": [RemoveMessage(id=msg_id)]}` | ä»å¯¹è¯å†å²ä¸­"æ“¦é™¤"æŸæ¡æ¶ˆæ¯ | â­â­â­â­ |
| **Annotated** | Python ç±»å‹æ³¨è§£,é™„åŠ å…ƒæ•°æ® | `Annotated[list, operator.add]` å®šä¹‰ reducer | ç»™ç±»å‹åŠ "æ ‡ç­¾",å‘Šè¯‰ç³»ç»Ÿè¿™ä¸ªå­—æ®µçš„ç‰¹æ®Šå¤„ç†è§„åˆ™ | â­â­â­â­ |
| **Multiple Schemas** | ä¸åŒèŠ‚ç‚¹ä½¿ç”¨ä¸åŒçŠ¶æ€ç»“æ„ | å…¨å±€çŠ¶æ€ + èŠ‚ç‚¹ç§æœ‰çŠ¶æ€ | ä¸åŒéƒ¨é—¨æœ‰ä¸åŒè¡¨æ ¼,ä½†å…±äº«éƒ¨åˆ†å…³é”®ä¿¡æ¯ | â­â­â­â­ |
| **Private State** | ä»…åœ¨ç‰¹å®šèŠ‚ç‚¹å¯è§çš„çŠ¶æ€å­—æ®µ | å­å›¾å†…éƒ¨çŠ¶æ€,ä¸æš´éœ²ç»™å¤–éƒ¨ | "ç§æˆ¿é’±",åªæœ‰ç‰¹å®šéƒ¨åˆ†èƒ½çœ‹åˆ°å’Œä½¿ç”¨ | â­â­â­ |

---

## 3ï¸âƒ£ æ¶ˆæ¯ç³»ç»Ÿ(Message System)

| æœ¯è¯­ | æŠ€æœ¯å®šä¹‰ | LangGraph åº”ç”¨ | é€šä¿—è§£é‡Š | é‡è¦ç¨‹åº¦ |
|------|---------|---------------|---------|---------|
| **HumanMessage** | ç”¨æˆ·è¾“å…¥çš„æ¶ˆæ¯ç±»å‹ | `messages.append(HumanMessage(content="ä½ å¥½"))` | ç”¨æˆ·è¯´çš„è¯ | â­â­â­â­â­ |
| **AIMessage** | AI æ¨¡å‹è¿”å›çš„æ¶ˆæ¯ç±»å‹ | åŒ…å« LLM å›å¤å’Œ `tool_calls` | AI çš„å›ç­” | â­â­â­â­â­ |
| **SystemMessage** | ç³»ç»ŸæŒ‡ä»¤æ¶ˆæ¯ | å®šä¹‰ AI è§’è‰²å’Œè¡Œä¸ºè§„åˆ™ | ç»™ AI çš„"ä½¿ç”¨è¯´æ˜ä¹¦",å‘Šè¯‰å®ƒè¯¥æ€ä¹ˆåš | â­â­â­â­â­ |
| **ToolMessage** | å·¥å…·æ‰§è¡Œç»“æœæ¶ˆæ¯ | è¿”å›å·¥å…·è°ƒç”¨çš„è¾“å‡º | å·¥å…·(å‡½æ•°)è¿”å›çš„ç»“æœ | â­â­â­â­â­ |
| **tool_calls** | AI è¯·æ±‚è°ƒç”¨çš„å·¥å…·åˆ—è¡¨ | `[{"name": "search", "args": {"query": "å¤©æ°”"}}]` | AI è¯´"æˆ‘éœ€è¦è°ƒç”¨è¿™ä¸ªå·¥å…·æ¥å¸®æˆ‘" | â­â­â­â­â­ |
| **tool_call_id** | å·¥å…·è°ƒç”¨çš„å”¯ä¸€æ ‡è¯†ç¬¦ | å…³è” AIMessage å’Œ ToolMessage | ç»™æ¯æ¬¡å·¥å…·è°ƒç”¨ä¸€ä¸ª"èº«ä»½è¯å·" | â­â­â­â­ |
| **trim_messages** | æŒ‰ç­–ç•¥è£å‰ªæ¶ˆæ¯å†å² | ä¿ç•™æœ€è¿‘ N æ¡æˆ–æœ€è¿‘ K tokens | åˆ é™¤è€æ—§æ¶ˆæ¯,èŠ‚çœ token æˆæœ¬ | â­â­â­â­ |
| **filter_messages** | æŒ‰æ¡ä»¶è¿‡æ»¤æ¶ˆæ¯ | ç§»é™¤ç‰¹å®šç±»å‹æˆ–æ»¡è¶³æ¡ä»¶çš„æ¶ˆæ¯ | ç­›é€‰å‡ºéœ€è¦çš„æ¶ˆæ¯,è¿‡æ»¤æ‰ä¸è¦çš„ | â­â­â­â­ |
| **merge_message_runs** | åˆå¹¶è¿ç»­åŒè§’è‰²æ¶ˆæ¯ | å°†å¤šæ¡ AIMessage åˆå¹¶ä¸ºä¸€æ¡ | æŠŠè¿ç»­çš„åŒä¸€ä¸ªäººè¯´çš„è¯åˆå¹¶æˆä¸€æ®µ | â­â­â­ |

---

## 4ï¸âƒ£ å·¥å…·ç³»ç»Ÿ(Tool System)

| æœ¯è¯­ | æŠ€æœ¯å®šä¹‰ | LangGraph åº”ç”¨ | é€šä¿—è§£é‡Š | é‡è¦ç¨‹åº¦ |
|------|---------|---------------|---------|---------|
| **Tool** | å¯è¢« AI è°ƒç”¨çš„ Python å‡½æ•° | `@tool` è£…é¥°å™¨å®šä¹‰å·¥å…· | AI çš„"å·¥å…·ç®±",é‡Œé¢æ˜¯å„ç§èƒ½åŠ›(æœç´¢ã€è®¡ç®—ç­‰) | â­â­â­â­â­ |
| **bind_tools()** | å°†å·¥å…·ç»‘å®šåˆ° LLM | `llm.bind_tools([search_tool, calculator])` | å‘Šè¯‰ AI"ä½ å¯ä»¥ç”¨è¿™äº›å·¥å…·" | â­â­â­â­â­ |
| **ToolNode** | è‡ªåŠ¨æ‰§è¡Œå·¥å…·è°ƒç”¨çš„èŠ‚ç‚¹ | `tools_node = ToolNode([search, calculator])` | ä¸“é—¨è´Ÿè´£æ‰§è¡Œå·¥å…·çš„èŠ‚ç‚¹,AI è¯´"ç”¨å·¥å…·"å®ƒå°±æ‰§è¡Œ | â­â­â­â­â­ |
| **tools_condition** | åˆ¤æ–­æ˜¯å¦éœ€è¦è°ƒç”¨å·¥å…·çš„è·¯ç”±å‡½æ•° | æ£€æŸ¥ `tool_calls` æ˜¯å¦ä¸ºç©º | æ£€æŸ¥ AI æ˜¯å¦æƒ³ç”¨å·¥å…·,å†³å®šä¸‹ä¸€æ­¥ | â­â­â­â­â­ |
| **parallel_tool_calls** | å¹¶è¡Œæ‰§è¡Œå¤šä¸ªå·¥å…·è°ƒç”¨ | AI åŒæ—¶è°ƒç”¨å¤šä¸ªå·¥å…·æå‡æ•ˆç‡ | åŒæ—¶åšå¤šä»¶äº‹,è€Œä¸æ˜¯æ’é˜Ÿä¸€ä¸ªä¸ªæ¥ | â­â­â­â­ |
| **Docstring** | å‡½æ•°æ–‡æ¡£å­—ç¬¦ä¸² | LLM é€šè¿‡ docstring ç†è§£å·¥å…·ç”¨é€” | å·¥å…·çš„"è¯´æ˜ä¹¦",å‘Šè¯‰ AI è¿™ä¸ªå·¥å…·æ˜¯å¹²ä»€ä¹ˆçš„ | â­â­â­â­ |

---

## 5ï¸âƒ£ è®°å¿†ä¸æŒä¹…åŒ–(Memory & Persistence)

| æœ¯è¯­ | æŠ€æœ¯å®šä¹‰ | LangGraph åº”ç”¨ | é€šä¿—è§£é‡Š | é‡è¦ç¨‹åº¦ |
|------|---------|---------------|---------|---------|
| **Checkpointer** | çŠ¶æ€æŒä¹…åŒ–æ¥å£ | ä¿å­˜å’Œæ¢å¤å›¾æ‰§è¡ŒçŠ¶æ€ | ç¨‹åºçš„"å­˜æ¡£ç‚¹",å¯ä»¥éšæ—¶æš‚åœå’Œç»§ç»­ | â­â­â­â­â­ |
| **MemorySaver** | å†…å­˜ç‰ˆ Checkpointer | çŠ¶æ€å­˜åœ¨å†…å­˜,è¿›ç¨‹ç»“æŸåæ¶ˆå¤± | æŠŠçŠ¶æ€è®°åœ¨"è‰ç¨¿çº¸"ä¸Š,å…³æœºå°±æ²¡äº† | â­â­â­â­â­ |
| **SqliteSaver** | SQLite æ•°æ®åº“æŒä¹…åŒ– | çŠ¶æ€æŒä¹…åŒ–åˆ°æœ¬åœ°æ•°æ®åº“ | æŠŠçŠ¶æ€è®°åœ¨"æ—¥è®°æœ¬"é‡Œ,æ°¸ä¹…ä¿å­˜ | â­â­â­â­â­ |
| **PostgresSaver** | PostgreSQL æŒä¹…åŒ–(ç”Ÿäº§çº§) | ä¼ä¸šçº§å¤šç”¨æˆ·çŠ¶æ€ç®¡ç† | æŠŠçŠ¶æ€è®°åœ¨"é“¶è¡Œä¿é™©ç®±"é‡Œ,å®‰å…¨å¯é  | â­â­â­â­â­ |
| **Thread** | å¯¹è¯ä¼šè¯/çº¿ç¨‹ | é€šè¿‡ `thread_id` åŒºåˆ†ä¸åŒç”¨æˆ·ä¼šè¯ | æ¯ä¸ªç”¨æˆ·æœ‰è‡ªå·±çš„"å¯¹è¯æˆ¿é—´" | â­â­â­â­â­ |
| **thread_id** | çº¿ç¨‹çš„å”¯ä¸€æ ‡è¯†ç¬¦ | `config = {"configurable": {"thread_id": "user_123"}}` | å¯¹è¯æˆ¿é—´çš„"é—¨ç‰Œå·" | â­â­â­â­â­ |
| **Checkpoint** | æŸä¸ªæ—¶åˆ»çš„çŠ¶æ€å¿«ç…§ | åŒ…å«å®Œæ•´çŠ¶æ€å’Œå…ƒæ•°æ® | æ¸¸æˆçš„"å­˜æ¡£",è®°å½•æŸä¸ªæ—¶åˆ»çš„æ‰€æœ‰ä¿¡æ¯ | â­â­â­â­â­ |
| **checkpoint_id** | æ£€æŸ¥ç‚¹çš„å”¯ä¸€æ ‡è¯†ç¬¦ | ç”¨äº Time Travel å®šä½ç‰¹å®šå¿«ç…§ | å­˜æ¡£çš„"æ—¶é—´æˆ³",ç”¨æ¥æ‰¾åˆ°ç‰¹å®šç‰ˆæœ¬ | â­â­â­â­ |
| **Store** | é•¿æœŸè®°å¿†å­˜å‚¨ç³»ç»Ÿ | è·¨ä¼šè¯æŒä¹…åŒ–ä¿¡æ¯(ç”¨æˆ·åå¥½ã€çŸ¥è¯†) | AI çš„"é•¿æœŸè®°å¿†",è®°ä½è·¨å¤šæ¬¡å¯¹è¯çš„ä¿¡æ¯ | â­â­â­â­â­ |
| **InMemoryStore** | å†…å­˜ç‰ˆ Store | å¿«é€Ÿä½†éæŒä¹…åŒ– | æŠŠé•¿æœŸè®°å¿†è®°åœ¨"ä¾¿ç­¾"ä¸Š | â­â­â­â­ |
| **Namespace** | Store çš„å‘½åç©ºé—´ | ç»„ç»‡å’Œéš”ç¦»ä¸åŒç±»å‹çš„è®°å¿† | ç»™è®°å¿†åˆ†ç±»,æ¯”å¦‚"ç”¨æˆ·ä¿¡æ¯"ã€"äº§å“çŸ¥è¯†"ç­‰ | â­â­â­â­ |

---

## 6ï¸âƒ£ äººæœºååŒ(Human-in-the-Loop)

| æœ¯è¯­ | æŠ€æœ¯å®šä¹‰ | LangGraph åº”ç”¨ | é€šä¿—è§£é‡Š | é‡è¦ç¨‹åº¦ |
|------|---------|---------------|---------|---------|
| **Breakpoint** | ç¨‹åºæ‰§è¡Œçš„æš‚åœç‚¹ | `interrupt_before=["node_name"]` | åœ¨ç‰¹å®šèŠ‚ç‚¹å‰"æŒ‰ä¸‹æš‚åœé”®" | â­â­â­â­â­ |
| **interrupt()** | ä¸»åŠ¨ä¸­æ–­æ‰§è¡Œ | åœ¨èŠ‚ç‚¹å†…è°ƒç”¨ `interrupt()` è¯·æ±‚äººå·¥ä»‹å…¥ | è®©ç¨‹åºä¸»åŠ¨"ä¸¾æ‰‹"è¯´"æˆ‘éœ€è¦å¸®åŠ©" | â­â­â­â­â­ |
| **NodeInterrupt** | å¸¦æ•°æ®çš„ä¸­æ–­å¼‚å¸¸ | ä¼ é€’éœ€è¦äººç±»å®¡æ ¸çš„ä¿¡æ¯ | ä¸­æ–­æ—¶é™„å¸¦ä¸€å¼ "é—®å·"ç»™äººç±» | â­â­â­â­ |
| **update_state()** | ç¼–è¾‘å›¾çš„å½“å‰çŠ¶æ€ | äººå·¥ä¿®æ”¹çŠ¶æ€åæ¢å¤æ‰§è¡Œ | äººç±»"ç¼–è¾‘"ç¨‹åºçš„è®°å¿†,ç„¶åç»§ç»­è¿è¡Œ | â­â­â­â­â­ |
| **get_state()** | è·å–å½“å‰çŠ¶æ€å¿«ç…§ | æŸ¥çœ‹ä¸­æ–­æ—¶çš„å®Œæ•´çŠ¶æ€ | æŸ¥çœ‹ç¨‹åºå½“å‰çš„æ‰€æœ‰ä¿¡æ¯ | â­â­â­â­â­ |
| **get_state_history()** | è·å–å†å²çŠ¶æ€åˆ—è¡¨ | æŸ¥çœ‹å›¾æ‰§è¡Œçš„æ‰€æœ‰å†å²å¿«ç…§ | ç¿»çœ‹ç¨‹åºçš„"å†å²è®°å½•" | â­â­â­â­ |
| **Time Travel** | å›åˆ°å†å²çŠ¶æ€å¹¶åˆ†å‰æ‰§è¡Œ | ä»è¿‡å»æŸä¸ªç‚¹é‡æ–°å¼€å§‹ | æ¸¸æˆçš„"è¯»æ¡£"åŠŸèƒ½,å›åˆ°è¿‡å»é‡æ–°ç© | â­â­â­â­ |
| **Command** | æ§åˆ¶å›¾æ‰§è¡Œçš„æŒ‡ä»¤å¯¹è±¡ | `Command(resume="value", goto="node")` | ç»™ç¨‹åºå‘"æŒ‡ä»¤":ç»§ç»­ã€è·³è½¬ã€å›é€€ç­‰ | â­â­â­â­ |

---

## 7ï¸âƒ£ æ‰§è¡Œæ¨¡å¼(Execution Modes)

| æœ¯è¯­ | æŠ€æœ¯å®šä¹‰ | LangGraph åº”ç”¨ | é€šä¿—è§£é‡Š | é‡è¦ç¨‹åº¦ |
|------|---------|---------------|---------|---------|
| **invoke()** | åŒæ­¥æ‰§è¡Œæ•´ä¸ªå›¾ | `result = graph.invoke(input, config)` | "ä¸€æ¬¡æ€§è¿è¡Œåˆ°åº•",ç­‰ç»“æœå‡ºæ¥å†ç»§ç»­ | â­â­â­â­â­ |
| **stream()** | æµå¼è¿”å›æ¯ä¸ªèŠ‚ç‚¹ç»“æœ | `for chunk in graph.stream(input): ...` | è¾¹è¿è¡Œè¾¹è¾“å‡º,å®æ—¶çœ‹åˆ°è¿›åº¦ | â­â­â­â­â­ |
| **astream()** | å¼‚æ­¥æµå¼æ‰§è¡Œ | `async for chunk in graph.astream(input): ...` | å¼‚æ­¥ç‰ˆæµå¼,ä¸é˜»å¡å…¶ä»–ä»»åŠ¡ | â­â­â­â­ |
| **stream_mode** | æµå¼è¾“å‡ºçš„ç²’åº¦ | `values`(å®Œæ•´çŠ¶æ€)/`updates`(å¢é‡)/`messages`(ä»…æ¶ˆæ¯) | æ§åˆ¶è¾“å‡ºä»€ä¹ˆå†…å®¹:å…¨éƒ¨ã€å˜åŒ–ã€è¿˜æ˜¯æ¶ˆæ¯ | â­â­â­â­ |
| **astream_events()** | äº‹ä»¶çº§å¼‚æ­¥æµ | æœ€ç»†ç²’åº¦çš„æµå¼,åŒ…å« token çº§è¾“å‡º | çœ‹åˆ°æœ€ç»†èŠ‚çš„è¿‡ç¨‹,åŒ…æ‹¬ AI é€å­—è¾“å‡º | â­â­â­â­ |
| **Streaming** | å®æ—¶è¾“å‡ºæ‰§è¡Œè¿‡ç¨‹ | é€‚ç”¨äºèŠå¤©åº”ç”¨çš„ç”¨æˆ·ä½“éªŒ | è®©ç”¨æˆ·ç«‹å³çœ‹åˆ°åé¦ˆ,è€Œä¸æ˜¯ç­‰å¾ˆä¹… | â­â­â­â­â­ |

---

## 8ï¸âƒ£ é«˜çº§æ¨¡å¼(Advanced Patterns)

| æœ¯è¯­ | æŠ€æœ¯å®šä¹‰ | LangGraph åº”ç”¨ | é€šä¿—è§£é‡Š | é‡è¦ç¨‹åº¦ |
|------|---------|---------------|---------|---------|
| **Subgraph** | åµŒå¥—åœ¨ä¸»å›¾ä¸­çš„å­å›¾ | æ¨¡å—åŒ–å¤ç”¨å·¥ä½œæµ | å¤§æµç¨‹é‡ŒåŒ…å«å°æµç¨‹,åƒå‡½æ•°è°ƒç”¨ | â­â­â­â­â­ |
| **Send API** | åŠ¨æ€å‘é€æ¶ˆæ¯åˆ°èŠ‚ç‚¹ | `Send("node_name", state)` | è¿è¡Œæ—¶åŠ¨æ€å†³å®šè¦æ‰§è¡Œå“ªäº›èŠ‚ç‚¹ | â­â­â­â­â­ |
| **Map-Reduce** | å¹¶è¡Œå¤„ç†åèšåˆç»“æœ | Map(åˆ†å‘)â†’ Reduce(æ±‡æ€») | æŠŠä»»åŠ¡æ‹†åˆ†ç»™å¤šä¸ª"å·¥äºº",æœ€åæ±‡æ€»ç»“æœ | â­â­â­â­â­ |
| **Parallelization** | åŒä¸€æ­¥å†…å¹¶è¡Œæ‰§è¡Œå¤šä¸ªèŠ‚ç‚¹ | Fan-out + Fan-in æ¨¡å¼ | åŒæ—¶åšå¤šä»¶äº‹,æå‡æ•ˆç‡ | â­â­â­â­â­ |
| **Fan-out** | ä¸€ä¸ªèŠ‚ç‚¹åˆ†å‘åˆ°å¤šä¸ªèŠ‚ç‚¹ | ä»»åŠ¡æ‹†åˆ†é˜¶æ®µ | ä¸€ä¸ªä»»åŠ¡å˜æˆå¤šä¸ªå­ä»»åŠ¡ | â­â­â­â­ |
| **Fan-in** | å¤šä¸ªèŠ‚ç‚¹æ±‡æ€»åˆ°ä¸€ä¸ªèŠ‚ç‚¹ | ä½¿ç”¨ Reducer èšåˆç»“æœ | æŠŠå¤šä¸ªç»“æœåˆå¹¶æˆä¸€ä¸ª | â­â­â­â­ |
| **ReAct** | Reasoning + Acting å¾ªç¯æ¨¡å¼ | AI æ€è€ƒâ†’è¡ŒåŠ¨â†’è§‚å¯Ÿâ†’å†æ€è€ƒ | AI åƒäººä¸€æ ·"è¾¹æƒ³è¾¹åš" | â­â­â­â­â­ |
| **Agent** | è‡ªä¸»å†³ç­–å¹¶ä½¿ç”¨å·¥å…·çš„ç³»ç»Ÿ | åŸºäº ReAct å®ç°,å¾ªç¯è°ƒç”¨ LLM + Tools | èƒ½è‡ªå·±åšå†³å®šã€ç”¨å·¥å…·è§£å†³é—®é¢˜çš„ AI | â­â­â­â­â­ |
| **Multi-Agent** | å¤šä¸ª Agent åä½œ | Supervisor æ¨¡å¼ / Hierarchical æ¨¡å¼ | å¤šä¸ª AI åˆ†å·¥åˆä½œå®Œæˆå¤æ‚ä»»åŠ¡ | â­â­â­â­â­ |
| **Supervisor Pattern** | ä¸»ç®¡ Agent åè°ƒå¤šä¸ªå·¥ä½œ Agent | ä¸»ç®¡åˆ†é…ä»»åŠ¡,å·¥ä½œè€…æ‰§è¡Œ | ä¸€ä¸ª"ç»ç†"AI ç®¡ç†å¤šä¸ª"å‘˜å·¥"AI | â­â­â­â­ |

---

## 9ï¸âƒ£ è®°å¿†æ¶æ„(Memory Architecture)

| æœ¯è¯­ | æŠ€æœ¯å®šä¹‰ | LangGraph åº”ç”¨ | é€šä¿—è§£é‡Š | é‡è¦ç¨‹åº¦ |
|------|---------|---------------|---------|---------|
| **Semantic Memory** | è¯­ä¹‰è®°å¿†/çŸ¥è¯†è®°å¿† | å­˜å‚¨äº‹å®å’Œæ¦‚å¿µ(ç”¨æˆ·åå¥½ã€äº§å“çŸ¥è¯†) | AI çš„"çŸ¥è¯†åº“",è®°ä½å„ç§äº‹å® | â­â­â­â­â­ |
| **Episodic Memory** | æƒ…èŠ‚è®°å¿†/äº‹ä»¶è®°å¿† | å­˜å‚¨å†å²å¯¹è¯å’Œäº‹ä»¶ | AI çš„"æ—¥è®°",è®°ä½å‘ç”Ÿè¿‡ä»€ä¹ˆ | â­â­â­â­ |
| **Procedural Memory** | ç¨‹åºæ€§è®°å¿† | å­˜å‚¨æŠ€èƒ½å’Œæµç¨‹(å¦‚ä½•æ‰§è¡Œä»»åŠ¡) | AI çš„"æŠ€èƒ½",è®°ä½æ€ä¹ˆåšäº‹ | â­â­â­â­ |
| **Profile Schema** | ç”¨æˆ·ç”»åƒæ¨¡å¼ | å•æ¡è®°å½•æŒç»­æ›´æ–°(å¦‚ç”¨æˆ·èµ„æ–™) | ä¸€ä¸ªäººåªæœ‰ä¸€å¼ "æ¡£æ¡ˆå¡",ä¸æ–­æ›´æ–° | â­â­â­â­â­ |
| **Collection Schema** | é›†åˆæ¨¡å¼ | å¤šæ¡è®°å½•ç´¯ç§¯(å¦‚ç¬”è®°ã€äº‹ä»¶) | ä¸€ä¸ªäººæœ‰å¤šæ¡"æ—¥è®°",ä¸æ–­æ·»åŠ  | â­â­â­â­â­ |
| **Trustcall** | ç»“æ„åŒ–è¾“å‡º + è‡ªæˆ‘ä¿®æ­£ | ç”¨äºæ›´æ–° Memory Schema | AI æŒ‰æ ¼å¼è¾“å‡º,è¿˜èƒ½è‡ªå·±æ£€æŸ¥ä¿®æ­£ | â­â­â­â­ |
| **JSON Patch** | å¢é‡æ›´æ–° JSON çš„æ ‡å‡† | Profile æ¨¡å¼çš„å¢é‡æ›´æ–°æœºåˆ¶ | åªæ”¹å˜åŒ–çš„éƒ¨åˆ†,ä¸é‡å†™æ•´ä¸ªæ–‡æ¡£ | â­â­â­â­ |
| **put()** | å­˜å‚¨è®°å¿†çš„æ–¹æ³• | `store.put(namespace, key, value)` | å¾€è®°å¿†åº“"å­˜å…¥"ä¸€æ¡è®°å¿† | â­â­â­â­â­ |
| **get()** | è¯»å–è®°å¿†çš„æ–¹æ³• | `store.get(namespace, key)` | ä»è®°å¿†åº“"è¯»å–"ä¸€æ¡è®°å¿† | â­â­â­â­â­ |
| **search()** | æœç´¢è®°å¿†çš„æ–¹æ³• | `store.search(namespace, filter=...)` | åœ¨è®°å¿†åº“é‡Œ"æŸ¥æ‰¾"ç¬¦åˆæ¡ä»¶çš„è®°å¿† | â­â­â­â­â­ |

---

## ğŸ”Ÿ ç”Ÿäº§éƒ¨ç½²(Production Deployment)

| æœ¯è¯­ | æŠ€æœ¯å®šä¹‰ | LangGraph åº”ç”¨ | é€šä¿—è§£é‡Š | é‡è¦ç¨‹åº¦ |
|------|---------|---------------|---------|---------|
| **LangGraph Platform** | å®˜æ–¹æ‰˜ç®¡å¹³å° | éƒ¨ç½²ã€ç®¡ç†ã€ç›‘æ§ LangGraph åº”ç”¨ | LangGraph çš„"äº‘æœåŠ¡å™¨" | â­â­â­â­â­ |
| **LangGraph Cloud** | æ‰˜ç®¡ç‰ˆ LangGraph æœåŠ¡ | æ— éœ€è‡ªå·±ç®¡æœåŠ¡å™¨ | "å…¨æ‰˜ç®¡"æœåŠ¡,å¼€ç®±å³ç”¨ | â­â­â­â­â­ |
| **LangGraph Studio** | å¯è§†åŒ–å¼€å‘å’Œè°ƒè¯•å·¥å…· | å›¾å½¢åŒ–æŸ¥çœ‹å’Œè°ƒè¯• Agent | Agent çš„"å¼€å‘è€…å·¥å…·" | â­â­â­â­â­ |
| **LangGraph CLI** | å‘½ä»¤è¡Œå·¥å…· | `langgraph dev` / `langgraph build` | æœ¬åœ°å¼€å‘å’Œæ„å»ºçš„å‘½ä»¤è¡Œ | â­â­â­â­ |
| **langgraph.json** | é¡¹ç›®é…ç½®æ–‡ä»¶ | å®šä¹‰å›¾ã€ä¾èµ–ã€ç¯å¢ƒå˜é‡ | é¡¹ç›®çš„"é…ç½®æ¸…å•" | â­â­â­â­â­ |
| **Assistant** | å¯é…ç½®çš„ Agent å®ä¾‹ | åŒä¸€å›¾çš„ä¸åŒé…ç½®ç‰ˆæœ¬ | åŒä¸€ä¸ª AI çš„ä¸åŒ"äººè®¾"ç‰ˆæœ¬ | â­â­â­â­â­ |
| **assistant_id** | Assistant çš„å”¯ä¸€æ ‡è¯† | åŒºåˆ†ä¸åŒçš„ Agent é…ç½® | Assistant çš„"èº«ä»½è¯å·" | â­â­â­â­ |
| **Run** | ä¸€æ¬¡å®Œæ•´çš„å›¾æ‰§è¡Œ | ä»è¾“å…¥åˆ°è¾“å‡ºçš„å®Œæ•´è¿‡ç¨‹ | ä¸€æ¬¡å®Œæ•´çš„"è¿è¡Œä»»åŠ¡" | â­â­â­â­â­ |
| **Double Texting** | ç”¨æˆ·å¿«é€Ÿè¿ç»­å‘æ¶ˆæ¯ | å¹¶å‘æ‰§è¡Œå†²çªå¤„ç† | ç”¨æˆ·è¿ç»­ç‚¹"å‘é€"æŒ‰é’®çš„å¤„ç†ç­–ç•¥ | â­â­â­â­ |
| **Reject** | æ‹’ç»æ–°è¯·æ±‚ç­–ç•¥ | è¿”å› 409 é”™è¯¯ | "æˆ‘æ­£å¿™ç€,ç¨åå†æ¥" | â­â­â­â­ |
| **Enqueue** | æ’é˜Ÿç­–ç•¥ | æ–°è¯·æ±‚è¿›å…¥é˜Ÿåˆ— | "è¯·æ’é˜Ÿ,ä¸€ä¸ªä¸ªæ¥" | â­â­â­â­ |
| **Interrupt** | ä¸­æ–­å½“å‰æ‰§è¡Œç­–ç•¥ | ä¸­æ–­æ—§ä»»åŠ¡,æ‰§è¡Œæ–°ä»»åŠ¡ | "åœä¸‹æ‰‹å¤´çš„,åšæ–°çš„" | â­â­â­â­ |
| **Rollback** | å›æ»šç­–ç•¥ | æ’¤é”€æœªå®Œæˆçš„æ‰§è¡Œ | "æ’¤é”€åˆšæ‰çš„,é‡æ–°æ¥" | â­â­â­â­ |
| **LangGraph SDK** | å®¢æˆ·ç«¯åº“ | Python/JS è°ƒç”¨è¿œç¨‹å›¾ | è¿æ¥ LangGraph æœåŠ¡çš„"å®¢æˆ·ç«¯" | â­â­â­â­â­ |
| **Remote Graph** | è¿œç¨‹éƒ¨ç½²çš„å›¾ | é€šè¿‡ API è°ƒç”¨ | è¿è¡Œåœ¨æœåŠ¡å™¨ä¸Šçš„ Agent | â­â­â­â­â­ |

---

## 1ï¸âƒ£1ï¸âƒ£ Python æŠ€æœ¯åŸºç¡€

| æœ¯è¯­ | æŠ€æœ¯å®šä¹‰ | LangGraph åº”ç”¨ | é€šä¿—è§£é‡Š | é‡è¦ç¨‹åº¦ |
|------|---------|---------------|---------|---------|
| **TypedDict** | å¸¦ç±»å‹æ³¨è§£çš„å­—å…¸ | å®šä¹‰ State Schema | ç»™å­—å…¸åŠ "ç±»å‹æ ‡ç­¾",å¢å¼ºç±»å‹æ£€æŸ¥ | â­â­â­â­â­ |
| **Annotated** | é™„åŠ å…ƒæ•°æ®çš„ç±»å‹æ³¨è§£ | å®šä¹‰ Reducer | ç»™ç±»å‹åŠ "é¢å¤–ä¿¡æ¯" | â­â­â­â­ |
| **Literal** | å­—é¢é‡ç±»å‹ | é™å®šå­—æ®µä¸ºç‰¹å®šå€¼ | åªèƒ½æ˜¯è¿™å‡ ä¸ªå€¼,åˆ«çš„ä¸è¡Œ | â­â­â­â­ |
| **Optional** | å¯é€‰ç±»å‹(å¯ä¸º None) | `Optional[str]` | è¿™ä¸ªå€¼å¯èƒ½ä¸å­˜åœ¨ | â­â­â­â­ |
| **Pydantic** | æ•°æ®éªŒè¯åº“ | å®šä¹‰å¤æ‚ Schema å’ŒéªŒè¯è§„åˆ™ | æ•°æ®çš„"æ ¼å¼æ£€æŸ¥å™¨" | â­â­â­â­â­ |
| **async/await** | å¼‚æ­¥ç¼–ç¨‹å…³é”®å­— | å¼‚æ­¥æ‰§è¡Œå›¾å’Œå·¥å…· | "å¼‚æ­¥"ç¼–ç¨‹,ä¸é˜»å¡ç­‰å¾… | â­â­â­â­ |
| **Callable** | å¯è°ƒç”¨å¯¹è±¡ç±»å‹ | å®šä¹‰èŠ‚ç‚¹å’Œå·¥å…·ç­¾å | è¡¨ç¤º"è¿™æ˜¯ä¸ªå‡½æ•°æˆ–æ–¹æ³•" | â­â­â­â­ |
| **Dataclass** | æ•°æ®ç±»è£…é¥°å™¨ | ç®€åŒ–çŠ¶æ€ç±»å®šä¹‰ | å¿«é€Ÿåˆ›å»ºæ•°æ®ç»“æ„ | â­â­â­â­ |

---

## ğŸ’¡ ä½¿ç”¨å»ºè®®

1. **åˆå­¦è€…ä¼˜å…ˆçº§**:å…ˆæŒæ¡ â­â­â­â­â­(5æ˜Ÿ)æœ¯è¯­
2. **æŒ‰æ¨¡å—å­¦ä¹ **:è·Ÿéšè¯¾ç¨‹é¡ºåº,é€ä¸ªæ¨¡å—æŒæ¡æœ¯è¯­
3. **ç»“åˆä»£ç **:æ¯ä¸ªæœ¯è¯­éƒ½åº”é…åˆå®é™…ä»£ç ç¤ºä¾‹ç†è§£
4. **å¯¹æ¯”å­¦ä¹ **:æ³¨æ„"æŠ€æœ¯å®šä¹‰"ã€"LangGraph åº”ç”¨"å’Œ"é€šä¿—è§£é‡Š"çš„å·®å¼‚
5. **æŸ¥é˜…å‚è€ƒ**:é‡åˆ°æœ¯è¯­æ—¶å›åˆ°æœ¬æ±‡æ€»å¿«é€ŸæŸ¥æ‰¾

---

**æœ¯è¯­æ€»æ•°**:çº¦ 120+ ä¸ªæ ¸å¿ƒæœ¯è¯­
**è¦†ç›–èŒƒå›´**:ä»åŸºç¡€æ¶æ„åˆ°ç”Ÿäº§éƒ¨ç½²çš„å®Œæ•´ä½“ç³»
**æ›´æ–°æ—¥æœŸ**:2025-01-13

---

# ğŸ“˜ LangGraph æ ¸å¿ƒæ¦‚å¿µè¯¦ç»†è§£è¯»

> æœ¬èŠ‚æä¾›æ‰€æœ‰é‡è¦æœ¯è¯­çš„æ·±åº¦è§£æ,æ¯ä¸ªæ¦‚å¿µéƒ½é…æœ‰ç®€å•ç¤ºä¾‹è¯´æ˜ã€‚

---

## ğŸ”µ 1. StateGraph (çŠ¶æ€å›¾)

### å­—é¢æ„æ€
**State + Graph** = "çŠ¶æ€å›¾"

State:çŠ¶æ€ã€æ•°æ®
Graph:å›¾ç»“æ„(èŠ‚ç‚¹+è¾¹)

### ä¸ºä»€ä¹ˆå« StateGraph?
å› ä¸ºè¿™æ˜¯ä¸€ä¸ª**ä»¥çŠ¶æ€ä¸ºæ ¸å¿ƒçš„å›¾ç»“æ„**:
- çŠ¶æ€åœ¨èŠ‚ç‚¹é—´æµè½¬
- æ¯ä¸ªèŠ‚ç‚¹å¯ä»¥ä¿®æ”¹çŠ¶æ€
- é€šè¿‡è¾¹æ¥æ§åˆ¶çŠ¶æ€çš„æµè½¬è·¯å¾„

### åœ¨ LangGraph é‡Œçš„ä½œç”¨
StateGraph æ˜¯æ„å»ºæ‰€æœ‰å·¥ä½œæµçš„åŸºç¡€ç±»,å®ƒ:
1. å®šä¹‰çŠ¶æ€çš„ç»“æ„(State Schema)
2. æ·»åŠ å¤„ç†èŠ‚ç‚¹(Nodes)
3. å®šä¹‰æµè½¬è·¯å¾„(Edges)
4. ç¼–è¯‘æˆå¯æ‰§è¡Œçš„åº”ç”¨

### ç®€å•ç¤ºä¾‹

```python
from langgraph.graph import StateGraph
from typing import TypedDict

# 1. å®šä¹‰çŠ¶æ€ç»“æ„
class MyState(TypedDict):
    message: str
    count: int

# 2. åˆ›å»ºçŠ¶æ€å›¾
graph = StateGraph(MyState)

# 3. æ·»åŠ èŠ‚ç‚¹
def process(state):
    return {"count": state["count"] + 1}

graph.add_node("process", process)

# 4. æ·»åŠ è¾¹
graph.add_edge(START, "process")
graph.add_edge("process", END)

# 5. ç¼–è¯‘
app = graph.compile()
```

ğŸ‘ **æ€»ç»“**:StateGraph = "ç”¨å›¾ç»“æ„ç®¡ç†çŠ¶æ€æµè½¬çš„å®¹å™¨"

---

## ğŸ”µ 2. Node (èŠ‚ç‚¹)

### å­—é¢æ„æ€
**Node** = "èŠ‚ç‚¹"

åœ¨å›¾è®ºä¸­,èŠ‚ç‚¹æ˜¯å›¾çš„åŸºæœ¬ç»„æˆå•å…ƒã€‚

### ä¸ºä»€ä¹ˆå« Node?
å› ä¸ºåœ¨å›¾ç»“æ„ä¸­:
- Node æ˜¯**å¤„ç†å•å…ƒ**
- é€šè¿‡ Edge(è¾¹)è¿æ¥
- æ¯ä¸ª Node æ¥æ”¶çŠ¶æ€ã€å¤„ç†ã€è¿”å›æ›´æ–°

### åœ¨ LangGraph é‡Œçš„ä½œç”¨
Node æ˜¯å›¾ä¸­çš„**å‡½æ•°/å¤„ç†å•å…ƒ**:
1. æ¥æ”¶å½“å‰çŠ¶æ€
2. æ‰§è¡Œç‰¹å®šé€»è¾‘(è°ƒç”¨ AIã€æŸ¥è¯¢æ•°æ®åº“ç­‰)
3. è¿”å›çŠ¶æ€æ›´æ–°

### ç®€å•ç¤ºä¾‹

```python
# èŠ‚ç‚¹å°±æ˜¯ä¸€ä¸ªå‡½æ•°
def my_node(state: MyState) -> dict:
    """
    èŠ‚ç‚¹å‡½æ•°çš„æ ‡å‡†æ ¼å¼:
    - è¾“å…¥: å®Œæ•´çš„ state
    - è¾“å‡º: è¦æ›´æ–°çš„å­—æ®µ(éƒ¨åˆ†æ›´æ–°)
    """
    new_message = f"å¤„ç†: {state['message']}"
    return {"message": new_message}

# æ·»åŠ åˆ°å›¾ä¸­
graph.add_node("my_node", my_node)
```

ğŸ‘ **æ€»ç»“**:Node = "æ¥æ”¶çŠ¶æ€ã€æ‰§è¡Œé€»è¾‘ã€è¿”å›æ›´æ–°çš„å‡½æ•°"

---

## ğŸ”µ 3. Edge (è¾¹)

### å­—é¢æ„æ€
**Edge** = "è¾¹"

åœ¨å›¾è®ºä¸­,è¾¹è¿æ¥ä¸¤ä¸ªèŠ‚ç‚¹ã€‚

### ä¸ºä»€ä¹ˆå« Edge?
å› ä¸ºå®ƒå®šä¹‰äº†:
- èŠ‚ç‚¹ä¹‹é—´çš„**è¿æ¥**
- æ‰§è¡Œçš„**é¡ºåº**
- çŠ¶æ€çš„**æµè½¬è·¯å¾„**

### åœ¨ LangGraph é‡Œçš„ä½œç”¨
Edge æ§åˆ¶æ‰§è¡Œæµç¨‹:
1. æ™®é€šè¾¹:ä» A ç›´æ¥åˆ° B
2. æ¡ä»¶è¾¹:æ ¹æ®çŠ¶æ€å†³å®šå»å“ªé‡Œ

### ç®€å•ç¤ºä¾‹

```python
# æ™®é€šè¾¹:å›ºå®šè·¯å¾„
graph.add_edge("node_a", "node_b")  # a â†’ b

# æ¡ä»¶è¾¹:åŠ¨æ€è·¯ç”±
def router(state):
    if state["count"] > 10:
        return "end"
    return "continue"

graph.add_conditional_edges(
    "node_a",      # ä»å“ªä¸ªèŠ‚ç‚¹
    router,        # è·¯ç”±å‡½æ•°
    {
        "end": END,
        "continue": "node_b"
    }
)
```

ğŸ‘ **æ€»ç»“**:Edge = "å®šä¹‰èŠ‚ç‚¹é—´æµè½¬è·¯å¾„çš„ç®­å¤´"

---

## ğŸ”µ 4. State (çŠ¶æ€)

### å­—é¢æ„æ€
**State** = "çŠ¶æ€"

çŠ¶æ€æ˜¯ç¨‹åºåœ¨æŸä¸ªæ—¶åˆ»çš„æ•°æ®å¿«ç…§ã€‚

### ä¸ºä»€ä¹ˆå« State?
å› ä¸ºå®ƒ:
- è®°å½•å½“å‰çš„**æ‰€æœ‰ä¿¡æ¯**
- åœ¨èŠ‚ç‚¹é—´**ä¼ é€’å’Œæ›´æ–°**
- å°±åƒç¨‹åºçš„"è®°å¿†"

### åœ¨ LangGraph é‡Œçš„ä½œç”¨
State æ˜¯:
1. æ•°æ®çš„å®¹å™¨(å­—å…¸)
2. èŠ‚ç‚¹é—´é€šä¿¡çš„åª’ä»‹
3. ç¨‹åºæ‰§è¡Œçš„"è®°å¿†"

### ç®€å•ç¤ºä¾‹

```python
from typing import TypedDict, Annotated
import operator

class MyState(TypedDict):
    # ç®€å•å­—æ®µ:ç›´æ¥è¦†ç›–
    current_step: str

    # å¸¦ reducer çš„å­—æ®µ:ç´¯åŠ 
    count: Annotated[int, operator.add]

    # æ¶ˆæ¯åˆ—è¡¨:æ™ºèƒ½åˆå¹¶
    messages: Annotated[list, add_messages]

# èŠ‚ç‚¹è¿”å›çŠ¶æ€æ›´æ–°
def node1(state):
    return {
        "current_step": "step1",
        "count": 1  # å¦‚æœä¹‹å‰æ˜¯ 5,ä¼šå˜æˆ 6(å› ä¸º operator.add)
    }
```

ğŸ‘ **æ€»ç»“**:State = "åœ¨èŠ‚ç‚¹é—´æµè½¬çš„æ•°æ®å­—å…¸"

---

## ğŸ”µ 5. Annotated (å¸¦æ³¨è§£çš„)

### å­—é¢æ„æ€
**Annotated** = "å¸¦æ³¨è§£çš„ã€è¢«æ ‡æ³¨çš„"

æ¥è‡ª Python çš„ `typing.Annotated`ã€‚

### ä¸ºä»€ä¹ˆå« Annotated?
å› ä¸º:
```python
Annotated[T, metadata]
```
- `T`:åŸæœ¬çš„ç±»å‹(å¦‚ `list`, `int`)
- `metadata`:é™„åŠ çš„"æ³¨è§£/å…ƒæ•°æ®"

å­—é¢ç†è§£:**åœ¨ç±»å‹ä¸ŠåŠ ä¸€å±‚æ ‡ç­¾/è¯´æ˜**

### åœ¨ LangGraph é‡Œçš„ä½œç”¨
Annotated ç”¨äºç»™çŠ¶æ€å­—æ®µæ·»åŠ  **Reducer(åˆå¹¶ç­–ç•¥)**:

```python
from typing import Annotated
import operator

class State(TypedDict):
    # ä¸å¸¦æ³¨è§£:ç›´æ¥è¦†ç›–
    name: str

    # å¸¦æ³¨è§£:ä½¿ç”¨ operator.add ç´¯åŠ 
    count: Annotated[int, operator.add]

    # å¸¦æ³¨è§£:ä½¿ç”¨ add_messages æ™ºèƒ½åˆå¹¶
    messages: Annotated[list, add_messages]
```

### ç®€å•ç¤ºä¾‹

```python
# ç¤ºä¾‹ 1:æ•°å­—ç´¯åŠ 
class State(TypedDict):
    score: Annotated[int, operator.add]

# èŠ‚ç‚¹ 1 è¿”å›
return {"score": 10}  # state["score"] = 10

# èŠ‚ç‚¹ 2 è¿”å›
return {"score": 5}   # state["score"] = 15 (ç´¯åŠ !)

# ç¤ºä¾‹ 2:æ¶ˆæ¯åˆå¹¶
class State(TypedDict):
    messages: Annotated[list, add_messages]

# èŠ‚ç‚¹ 1 è¿”å›
return {"messages": [HumanMessage(content="ä½ å¥½")]}

# èŠ‚ç‚¹ 2 è¿”å›
return {"messages": [AIMessage(content="ä½ å¥½å‘€")]}

# æœ€ç»ˆ state["messages"] = [HumanMessage(...), AIMessage(...)]
```

ğŸ‘ **æ€»ç»“**:Annotated = "ç»™ç±»å‹åŠ æ ‡ç­¾,å‘Šè¯‰æ¡†æ¶å¦‚ä½•åˆå¹¶è¿™ä¸ªå­—æ®µ"

---

## ğŸ”µ 6. Reducer (å½’çº¦å™¨/åˆå¹¶å™¨)

### å­—é¢æ„æ€
**Reducer** = "å‡å°‘è€…ã€å½’çº¦å™¨"

æ¥è‡ªå‡½æ•°å¼ç¼–ç¨‹,å°†å¤šä¸ªå€¼"å½’çº¦"æˆä¸€ä¸ªå€¼ã€‚

### ä¸ºä»€ä¹ˆå« Reducer?
å› ä¸ºå®ƒå®šä¹‰äº†**å¦‚ä½•åˆå¹¶å¤šä¸ªå€¼**:
- å¤šä¸ªèŠ‚ç‚¹å¯èƒ½åŒæ—¶æ›´æ–°åŒä¸€å­—æ®µ
- Reducer å†³å®šæœ€ç»ˆçš„å€¼æ˜¯ä»€ä¹ˆ

### åœ¨ LangGraph é‡Œçš„ä½œç”¨
Reducer æ§åˆ¶çŠ¶æ€å­—æ®µçš„æ›´æ–°ç­–ç•¥:
1. `operator.add`:ç´¯åŠ (æ•°å­—ã€åˆ—è¡¨)
2. `add_messages`:æ™ºèƒ½åˆå¹¶æ¶ˆæ¯
3. è‡ªå®šä¹‰å‡½æ•°:ä»»æ„åˆå¹¶é€»è¾‘

### ç®€å•ç¤ºä¾‹

```python
import operator

# å†…ç½® reducer
count: Annotated[int, operator.add]  # ç´¯åŠ 

# è‡ªå®šä¹‰ reducer
def merge_dicts(left, right):
    """åˆå¹¶ä¸¤ä¸ªå­—å…¸"""
    return {**left, **right}

data: Annotated[dict, merge_dicts]

# ä½¿ç”¨ç¤ºä¾‹
class State(TypedDict):
    score: Annotated[int, operator.add]

# èŠ‚ç‚¹ A è¿”å›
{"score": 10}

# èŠ‚ç‚¹ B è¿”å›
{"score": 5}

# åˆå¹¶å:state["score"] = 15
```

ğŸ‘ **æ€»ç»“**:Reducer = "å®šä¹‰å¦‚ä½•åˆå¹¶å¤šä¸ªæ›´æ–°çš„å‡½æ•°"

---

## ğŸ”µ 7. Checkpointer (æ£€æŸ¥ç‚¹ä¿å­˜å™¨)

### å­—é¢æ„æ€
**Checkpoint + er** = "æ£€æŸ¥ç‚¹ + æ‰§è¡Œè€…"

Checkpoint:æ£€æŸ¥ç‚¹ã€å­˜æ¡£ç‚¹

### ä¸ºä»€ä¹ˆå« Checkpointer?
å› ä¸ºå®ƒ:
- åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¿å­˜"æ£€æŸ¥ç‚¹"
- å¯ä»¥éšæ—¶æ¢å¤åˆ°æŸä¸ªæ£€æŸ¥ç‚¹
- å°±åƒæ¸¸æˆçš„"å­˜æ¡£ç³»ç»Ÿ"

### åœ¨ LangGraph é‡Œçš„ä½œç”¨
Checkpointer æä¾›:
1. **æŒä¹…åŒ–**:ä¿å­˜çŠ¶æ€åˆ°ç£ç›˜/æ•°æ®åº“
2. **æ¢å¤**:ä»ä¸Šæ¬¡ä¸­æ–­å¤„ç»§ç»­
3. **Time Travel**:å›åˆ°å†å²çŠ¶æ€

### ç®€å•ç¤ºä¾‹

```python
from langgraph.checkpoint.memory import MemorySaver
from langgraph.checkpoint.sqlite import SqliteSaver

# å†…å­˜ç‰ˆ(å¼€å‘ç”¨)
memory = MemorySaver()

# æŒä¹…åŒ–ç‰ˆ(ç”Ÿäº§ç”¨)
db = SqliteSaver.from_conn_string("checkpoints.db")

# ç¼–è¯‘æ—¶æŒ‡å®š
app = graph.compile(checkpointer=memory)

# ä½¿ç”¨ thread_id åŒºåˆ†ä¸åŒä¼šè¯
config = {"configurable": {"thread_id": "user_123"}}

# ç¬¬ä¸€æ¬¡è°ƒç”¨
app.invoke({"messages": [...]}, config)

# ç¬¬äºŒæ¬¡è°ƒç”¨(ä¼šè®°ä½ä¸Šæ¬¡çš„çŠ¶æ€)
app.invoke({"messages": [...]}, config)
```

ğŸ‘ **æ€»ç»“**:Checkpointer = "ä¿å­˜å’Œæ¢å¤æ‰§è¡ŒçŠ¶æ€çš„å­˜æ¡£ç³»ç»Ÿ"

---

## ğŸ”µ 8. Thread (çº¿ç¨‹/ä¼šè¯)

### å­—é¢æ„æ€
**Thread** = "çº¿ç¨‹ã€ä¼šè¯"

åœ¨è¿™é‡Œä¸æ˜¯æ“ä½œç³»ç»Ÿçš„çº¿ç¨‹,è€Œæ˜¯"å¯¹è¯çº¿ç¨‹"ã€‚

### ä¸ºä»€ä¹ˆå« Thread?
å› ä¸º:
- æ¯ä¸ªç”¨æˆ·æœ‰ç‹¬ç«‹çš„"å¯¹è¯çº¿ç¨‹"
- é€šè¿‡ `thread_id` åŒºåˆ†
- å°±åƒè®ºå›çš„"å¸–å­"

### åœ¨ LangGraph é‡Œçš„ä½œç”¨
Thread ç”¨äº:
1. éš”ç¦»ä¸åŒç”¨æˆ·çš„çŠ¶æ€
2. ä¿å­˜ç‹¬ç«‹çš„å¯¹è¯å†å²
3. æ”¯æŒå¤šç”¨æˆ·å¹¶å‘

### ç®€å•ç¤ºä¾‹

```python
# ç”¨æˆ· A çš„å¯¹è¯
config_a = {"configurable": {"thread_id": "user_alice"}}
app.invoke({"messages": [("user", "ä½ å¥½")]}, config_a)

# ç”¨æˆ· B çš„å¯¹è¯
config_b = {"configurable": {"thread_id": "user_bob"}}
app.invoke({"messages": [("user", "å—¨")]}, config_b)

# ä¸¤ä¸ªç”¨æˆ·çš„çŠ¶æ€å®Œå…¨ç‹¬ç«‹!
```

ğŸ‘ **æ€»ç»“**:Thread = "æ¯ä¸ªç”¨æˆ·ç‹¬ç«‹çš„å¯¹è¯æˆ¿é—´"

---

## ğŸ”µ 9. Breakpoint (æ–­ç‚¹)

### å­—é¢æ„æ€
**Break + Point** = "ä¸­æ–­ç‚¹"

ç¨‹åºè°ƒè¯•ä¸­çš„æ–­ç‚¹ã€‚

### ä¸ºä»€ä¹ˆå« Breakpoint?
å› ä¸º:
- ç¨‹åºæ‰§è¡Œåˆ°è¿™é‡Œä¼š**æš‚åœ**
- ç­‰å¾…äººå·¥**ä»‹å…¥**
- ç„¶åå¯ä»¥**ç»§ç»­**

### åœ¨ LangGraph é‡Œçš„ä½œç”¨
Breakpoint å®ç°äººæœºåä½œ:
1. åœ¨å…³é”®èŠ‚ç‚¹å‰æš‚åœ
2. è®©äººç±»å®¡æ ¸/ä¿®æ”¹
3. ç„¶åç»§ç»­æ‰§è¡Œ

### ç®€å•ç¤ºä¾‹

```python
# ç¼–è¯‘æ—¶è®¾ç½®æ–­ç‚¹
app = graph.compile(
    checkpointer=memory,
    interrupt_before=["human_review"]  # åœ¨è¿™ä¸ªèŠ‚ç‚¹å‰æš‚åœ
)

# æ‰§è¡Œ
app.invoke(input, config)

# æ­¤æ—¶ç¨‹åºæš‚åœ,å¯ä»¥:
state = app.get_state(config)
print(state.values)  # æŸ¥çœ‹å½“å‰çŠ¶æ€

# ä¿®æ”¹çŠ¶æ€
app.update_state(config, {"approved": True})

# ç»§ç»­æ‰§è¡Œ
app.invoke(None, config)
```

ğŸ‘ **æ€»ç»“**:Breakpoint = "è®©ç¨‹åºæš‚åœ,ç­‰å¾…äººå·¥ä»‹å…¥çš„ç‚¹"

---

## ğŸ”µ 10. Tool (å·¥å…·)

### å­—é¢æ„æ€
**Tool** = "å·¥å…·"

å°±æ˜¯å­—é¢æ„æ€çš„"å·¥å…·"ã€‚

### ä¸ºä»€ä¹ˆå« Tool?
å› ä¸º:
- AI å¯ä»¥"ä½¿ç”¨"è¿™äº›å·¥å…·
- å°±åƒäººä½¿ç”¨é”¤å­ã€æ‰³æ‰‹
- Tool æ˜¯ AI çš„"èƒ½åŠ›æ‰©å±•"

### åœ¨ LangGraph é‡Œçš„ä½œç”¨
Tool è®© AI èƒ½å¤Ÿ:
1. æœç´¢ä¿¡æ¯
2. æ‰§è¡Œè®¡ç®—
3. è°ƒç”¨ API
4. æŸ¥è¯¢æ•°æ®åº“

### ç®€å•ç¤ºä¾‹

```python
from langchain_core.tools import tool

@tool
def search(query: str) -> str:
    """
    æœç´¢äº’è”ç½‘ä¿¡æ¯

    Args:
        query: æœç´¢å…³é”®è¯
    """
    # å®é™…çš„æœç´¢é€»è¾‘
    return f"å…³äº {query} çš„ç»“æœ..."

# ç»‘å®šåˆ° LLM
tools = [search]
llm_with_tools = llm.bind_tools(tools)

# AI å¯ä»¥å†³å®šæ˜¯å¦è°ƒç”¨å·¥å…·
response = llm_with_tools.invoke([
    ("user", "æœç´¢ LangGraph æ•™ç¨‹")
])

# response å¯èƒ½åŒ…å« tool_calls
if response.tool_calls:
    print("AI æƒ³è°ƒç”¨å·¥å…·:", response.tool_calls)
```

ğŸ‘ **æ€»ç»“**:Tool = "AI å¯ä»¥è°ƒç”¨çš„å‡½æ•°/èƒ½åŠ›"

---

## ğŸ”µ 11. ReAct (æ¨ç†+è¡ŒåŠ¨)

### å­—é¢æ„æ€
**Re**asoning + **Act**ing = "æ¨ç† + è¡ŒåŠ¨"

### ä¸ºä»€ä¹ˆå« ReAct?
å› ä¸ºè¿™æ˜¯ä¸€ä¸ªå¾ªç¯æ¨¡å¼:
1. **Re**ason(æ¨ç†):AI æ€è€ƒè¯¥åšä»€ä¹ˆ
2. **Act**(è¡ŒåŠ¨):AI è°ƒç”¨å·¥å…·æ‰§è¡Œ
3. **Observe**(è§‚å¯Ÿ):æŸ¥çœ‹å·¥å…·ç»“æœ
4. é‡å¤ 1-3 ç›´åˆ°å®Œæˆä»»åŠ¡

### åœ¨ LangGraph é‡Œçš„ä½œç”¨
ReAct æ˜¯ Agent çš„æ ¸å¿ƒæ¨¡å¼:
```
ç”¨æˆ·æé—® â†’ AI æ€è€ƒ â†’ è°ƒç”¨å·¥å…· â†’ è§‚å¯Ÿç»“æœ â†’ å†æ€è€ƒ â†’ ...
```

### ç®€å•ç¤ºä¾‹

```python
from langgraph.prebuilt import create_react_agent

# ä¸€è¡Œä»£ç åˆ›å»º ReAct Agent
agent = create_react_agent(llm, tools=[search, calculator])

# æ‰§è¡Œ
agent.invoke({
    "messages": [("user", "åŒ—äº¬ä»Šå¤©å¤©æ°”å¦‚ä½•?")]
})

# å†…éƒ¨æµç¨‹:
# 1. AI: "æˆ‘éœ€è¦æœç´¢åŒ—äº¬å¤©æ°”" â†’ tool_calls: [search("åŒ—äº¬å¤©æ°”")]
# 2. å·¥å…·æ‰§è¡Œ: "æ™´å¤©,25åº¦"
# 3. AI è§‚å¯Ÿç»“æœ: "å¥½çš„,æˆ‘çŸ¥é“äº†"
# 4. AI å›å¤ç”¨æˆ·: "åŒ—äº¬ä»Šå¤©æ™´å¤©,25åº¦"
```

ğŸ‘ **æ€»ç»“**:ReAct = "AI è¾¹æ€è€ƒè¾¹è¡ŒåŠ¨çš„å¾ªç¯æ¨¡å¼"

---

## ğŸ”µ 12. MessagesState (æ¶ˆæ¯çŠ¶æ€)

### å­—é¢æ„æ€
**Messages + State** = "æ¶ˆæ¯ + çŠ¶æ€"

### ä¸ºä»€ä¹ˆå« MessagesState?
å› ä¸ºè¿™æ˜¯ä¸“é—¨ç®¡ç†**æ¶ˆæ¯åˆ—è¡¨**çš„çŠ¶æ€ç±»:
- å†…ç½® `messages` å­—æ®µ
- è‡ªå¸¦ `add_messages` reducer
- ç®€åŒ–å¯¹è¯ç®¡ç†

### åœ¨ LangGraph é‡Œçš„ä½œç”¨
MessagesState æ˜¯æœ€å¸¸ç”¨çš„çŠ¶æ€ç±»:
```python
from langgraph.graph import MessagesState

# ç­‰ä»·äº:
class MessagesState(TypedDict):
    messages: Annotated[list, add_messages]
```

### ç®€å•ç¤ºä¾‹

```python
from langgraph.graph import StateGraph, MessagesState

# ç›´æ¥ä½¿ç”¨ MessagesState
graph = StateGraph(MessagesState)

def chatbot(state):
    # state["messages"] æ˜¯æ¶ˆæ¯åˆ—è¡¨
    response = llm.invoke(state["messages"])
    return {"messages": [response]}

graph.add_node("chatbot", chatbot)
```

ğŸ‘ **æ€»ç»“**:MessagesState = "å†…ç½®æ¶ˆæ¯ç®¡ç†çš„çŠ¶æ€ç±»"

---

## ğŸ”µ 13. ToolNode (å·¥å…·èŠ‚ç‚¹)

### å­—é¢æ„æ€
**Tool + Node** = "å·¥å…· + èŠ‚ç‚¹"

### ä¸ºä»€ä¹ˆå« ToolNode?
å› ä¸ºè¿™æ˜¯ä¸“é—¨**æ‰§è¡Œå·¥å…·è°ƒç”¨**çš„èŠ‚ç‚¹:
- è‡ªåŠ¨è¯»å– `tool_calls`
- æ‰§è¡Œå¯¹åº”å·¥å…·
- è¿”å› `ToolMessage`

### åœ¨ LangGraph é‡Œçš„ä½œç”¨
ToolNode ç®€åŒ–å·¥å…·æ‰§è¡Œ:

### ç®€å•ç¤ºä¾‹

```python
from langgraph.prebuilt import ToolNode

tools = [search, calculator]

# åˆ›å»ºå·¥å…·èŠ‚ç‚¹
tool_node = ToolNode(tools)

# æ·»åŠ åˆ°å›¾
graph.add_node("tools", tool_node)

# AI è°ƒç”¨å·¥å…·åè‡ªåŠ¨æ‰§è¡Œ
# input: AIMessage(tool_calls=[...])
# output: ToolMessage(content="ç»“æœ")
```

ğŸ‘ **æ€»ç»“**:ToolNode = "è‡ªåŠ¨æ‰§è¡Œå·¥å…·è°ƒç”¨çš„èŠ‚ç‚¹"

---

## ğŸ”µ 14. Subgraph (å­å›¾)

### å­—é¢æ„æ€
**Sub + Graph** = "å­ + å›¾"

### ä¸ºä»€ä¹ˆå« Subgraph?
å› ä¸º:
- å¤§å›¾é‡ŒåµŒå¥—å°å›¾
- å°±åƒå‡½æ•°è°ƒç”¨
- å®ç°æ¨¡å—åŒ–å¤ç”¨

### åœ¨ LangGraph é‡Œçš„ä½œç”¨
Subgraph ç”¨äº:
1. å°è£…å¤æ‚é€»è¾‘
2. æ¨¡å—åŒ–è®¾è®¡
3. å¤ç”¨å·¥ä½œæµ

### ç®€å•ç¤ºä¾‹

```python
# å®šä¹‰å­å›¾
sub_graph = StateGraph(SubState)
sub_graph.add_node("step1", ...)
sub_graph.add_node("step2", ...)
sub_app = sub_graph.compile()

# åµŒå…¥ä¸»å›¾
main_graph = StateGraph(MainState)
main_graph.add_node("subprocess", sub_app)  # å­å›¾ä½œä¸ºèŠ‚ç‚¹
main_graph.add_edge("start", "subprocess")
```

ğŸ‘ **æ€»ç»“**:Subgraph = "å¯åµŒå¥—çš„å­å·¥ä½œæµ"

---

## ğŸ”µ 15. Stream (æµå¼è¾“å‡º)

### å­—é¢æ„æ€
**Stream** = "æµã€æµå¼"

å°±åƒæ°´æµä¸€æ ·è¿ç»­è¾“å‡ºã€‚

### ä¸ºä»€ä¹ˆå« Stream?
å› ä¸º:
- ä¸æ˜¯ä¸€æ¬¡æ€§è¿”å›å…¨éƒ¨ç»“æœ
- è€Œæ˜¯**é€æ­¥è¾“å‡º**
- å°±åƒæ‰“å­—æœºé€å­—æ˜¾ç¤º

### åœ¨ LangGraph é‡Œçš„ä½œç”¨
Stream æä¾›å®æ—¶åé¦ˆ:

### ç®€å•ç¤ºä¾‹

```python
# invoke: ç­‰å…¨éƒ¨å®Œæˆ
result = app.invoke(input, config)

# stream: é€æ­¥è¿”å›
for chunk in app.stream(input, config):
    print(chunk)  # æ¯ä¸ªèŠ‚ç‚¹å®Œæˆåè¾“å‡º

# astream_events: token çº§æµå¼
async for event in app.astream_events(input, config):
    if event["event"] == "on_chat_model_stream":
        print(event["data"]["chunk"].content, end="")
```

ğŸ‘ **æ€»ç»“**:Stream = "é€æ­¥è¾“å‡ºç»“æœ,æä¾›å®æ—¶åé¦ˆ"

---

## ğŸ’¡ å­¦ä¹ å»ºè®®

1. **å…ˆç†è§£å­—é¢æ„æ€**,å†ç†è§£æŠ€æœ¯å«ä¹‰
2. **ç»“åˆç¤ºä¾‹ä»£ç **,åŠ¨æ‰‹å®è·µ
3. **å¯¹æ¯”ä½¿ç”¨åœºæ™¯**,åŠ æ·±ç†è§£
4. **ç”±æµ…å…¥æ·±**,å…ˆæŒæ¡æ ¸å¿ƒæ¦‚å¿µ

è¿™äº›æ¦‚å¿µç›¸äº’å…³è”,å½¢æˆäº† LangGraph çš„å®Œæ•´ç”Ÿæ€ç³»ç»Ÿ!

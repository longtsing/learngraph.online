# LangGraph State Reducers è¯¦ç»†è§£è¯» 

>  ç½‘ç«™ä½¿ç”¨è¯´æ˜
> - æœ¬ç½‘ç«™å¯ä»¥å…ç™»é™†è¿è¡Œ Python ä»£ç 
> - Python ä»£ç å¯ä»¥ç¼–è¾‘å¹¶ä¸´æ—¶ä¿å­˜ï¼Œä½†ä¸ä¼šæ°¸ä¹…ä¿å­˜ï¼Œç½‘é¡µåˆ·æ–°åä¼šè‡ªåŠ¨è¿˜åŸ
> - å¯¹ç½‘ç«™çš„ä½¿ç”¨æœ‰ä»»ä½•é—®é¢˜ï¼Œå¯ä»¥åˆ° [é—®é¢˜åé¦ˆ](http://localhost:5173/feedback.html) ï¼ˆæŒ‰é’®åœ¨æ¯ä¸ªé¡µé¢çš„å³ä¸‹è§’ï¼‰å…ç™»å½•è¿›è¡Œè¯„è®º
> - è¿è¡Œ `LangGraph/LangChain`ä»£ç ï¼Œéœ€è¦ç”¨æˆ·è¾“å…¥è‡ªå·±çš„ [API Key](http://localhost:5173/python-run.html)
> - é‡è¦å£°æ˜ï¼šæœ¬ç½‘ç«™ä¸ä¼šä¿å­˜ç”¨æˆ·çš„ API Key æ•°æ®ï¼Œè¯·æ”¾å¿ƒè¾“å…¥


## ğŸ“š æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†è§£è¯» LangGraph ä¸­çš„ **State Reducersï¼ˆçŠ¶æ€å½’çº¦å™¨ï¼‰**ã€‚è¿™æ˜¯ LangGraph çŠ¶æ€ç®¡ç†çš„æ ¸å¿ƒæœºåˆ¶ï¼Œç”¨äºæ§åˆ¶çŠ¶æ€æ›´æ–°çš„æ–¹å¼ã€‚é€šè¿‡ Reducersï¼Œæˆ‘ä»¬å¯ä»¥ä¼˜é›…åœ°å¤„ç†å¹¶è¡ŒèŠ‚ç‚¹çš„çŠ¶æ€å†²çªã€æ¶ˆæ¯è¿½åŠ ã€è‡ªå®šä¹‰èšåˆç­‰å¤æ‚åœºæ™¯ã€‚

**æ ¸å¿ƒä»·å€¼ï¼š**
- è§£å†³å¹¶è¡ŒèŠ‚ç‚¹çš„çŠ¶æ€å†²çªé—®é¢˜
- æä¾›çµæ´»çš„çŠ¶æ€æ›´æ–°ç­–ç•¥
- æ”¯æŒæ¶ˆæ¯çš„è¿½åŠ ã€ä¿®æ”¹å’Œåˆ é™¤
- å…è®¸è‡ªå®šä¹‰çŠ¶æ€èšåˆé€»è¾‘

---

## ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ

### ä»€ä¹ˆæ˜¯ State Reducerï¼Ÿ

**Reducerï¼ˆå½’çº¦å™¨ï¼‰** æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºå®šä¹‰å¦‚ä½•å°†æ–°å€¼åˆå¹¶åˆ°ç°æœ‰çŠ¶æ€ä¸­ã€‚

**ç±»æ¯”ç†è§£ï¼š**
```
æƒ³è±¡ä½ æœ‰ä¸€ä¸ªè´­ç‰©è½¦ï¼ˆçŠ¶æ€ï¼‰
- é»˜è®¤æ–¹å¼ï¼šæ¯æ¬¡éƒ½æ›¿æ¢æ•´ä¸ªè´­ç‰©è½¦ï¼ˆè¦†ç›–ï¼‰
- Reducer æ–¹å¼ï¼šå¯ä»¥é€‰æ‹©"è¿½åŠ å•†å“"ã€"åˆ é™¤å•†å“"ã€"åˆå¹¶è´­ç‰©è½¦"ç­‰ç­–ç•¥
```

**LangGraph ä¸­çš„åº”ç”¨ï¼š**
- å½“å¤šä¸ªèŠ‚ç‚¹åŒæ—¶æ›´æ–°åŒä¸€ä¸ªçŠ¶æ€å­—æ®µæ—¶ï¼ŒReducer å†³å®šå¦‚ä½•å¤„ç†è¿™äº›æ›´æ–°
- é¿å…çŠ¶æ€å†²çªå’Œæ•°æ®ä¸¢å¤±
- æä¾›ä¸€è‡´çš„çŠ¶æ€æ›´æ–°è¡Œä¸º

---

## âš ï¸ é—®é¢˜åœºæ™¯ï¼šé»˜è®¤è¦†ç›–è¡Œä¸º

### åœºæ™¯ 1ï¼šå•èŠ‚ç‚¹æ›´æ–°ï¼ˆæ— é—®é¢˜ï¼‰

```python
from typing_extensions import TypedDict
from langgraph.graph import StateGraph, START, END

class State(TypedDict):
    foo: int

def node_1(state):
    print("---Node 1---")
    return {"foo": state['foo'] + 1}

# æ„å»ºå›¾
builder = StateGraph(State)
builder.add_node("node_1", node_1)
builder.add_edge(START, "node_1")
builder.add_edge("node_1", END)

graph = builder.compile()

# æ‰§è¡Œ
result = graph.invoke({"foo": 1})
# è¾“å‡º: {'foo': 2}
```

**è¯´æ˜ï¼š**
- é»˜è®¤æƒ…å†µä¸‹ï¼ŒèŠ‚ç‚¹è¿”å›çš„çŠ¶æ€ä¼š **è¦†ç›–** åŸæœ‰çŠ¶æ€
- `{"foo": 1}` â†’ `node_1` â†’ `{"foo": 2}`
- å•èŠ‚ç‚¹æ›´æ–°æ—¶æ²¡æœ‰é—®é¢˜

### åœºæ™¯ 2ï¼šå¹¶è¡ŒèŠ‚ç‚¹å†²çªï¼ˆæœ‰é—®é¢˜ï¼ï¼‰âŒ

```python
class State(TypedDict):
    foo: int

def node_1(state):
    print("---Node 1---")
    return {"foo": state['foo'] + 1}

def node_2(state):
    print("---Node 2---")
    return {"foo": state['foo'] + 1}

def node_3(state):
    print("---Node 3---")
    return {"foo": state['foo'] + 1}

# æ„å»ºå›¾
builder = StateGraph(State)
builder.add_node("node_1", node_1)
builder.add_node("node_2", node_2)
builder.add_node("node_3", node_3)

# å…³é”®ï¼šnode_1 åˆ†æ”¯åˆ° node_2 å’Œ node_3ï¼ˆå¹¶è¡Œæ‰§è¡Œï¼‰
builder.add_edge(START, "node_1")
builder.add_edge("node_1", "node_2")
builder.add_edge("node_1", "node_3")
builder.add_edge("node_2", END)
builder.add_edge("node_3", END)

graph = builder.compile()

# æ‰§è¡Œä¼šæŠ¥é”™ï¼
from langgraph.errors import InvalidUpdateError
try:
    graph.invoke({"foo": 1})
except InvalidUpdateError as e:
    print(f"InvalidUpdateError occurred: {e}")
```

**æ‰§è¡Œæµç¨‹ï¼š**
```
è¾“å…¥: {"foo": 1}
  â†“
node_1: {"foo": 2}
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
node_2      node_3
{"foo": 3}  {"foo": 3}
  â†“           â†“
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          âŒ å†²çªï¼
```

**é—®é¢˜åˆ†æï¼š**
1. `node_1` æ‰§è¡Œåï¼Œ`foo = 2`
2. `node_2` å’Œ `node_3` **å¹¶è¡Œæ‰§è¡Œ**ï¼ˆåœ¨åŒä¸€æ­¥ï¼‰
3. ä¸¤ä¸ªèŠ‚ç‚¹éƒ½å°è¯•å°† `foo` è¦†ç›–ä¸º `3`
4. LangGraph ä¸çŸ¥é“åº”è¯¥ä¿ç•™å“ªä¸ªå€¼ â†’ **InvalidUpdateError**

---

## âœ… è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨ Reducer

### æ–¹æ¡ˆ 1ï¼šä½¿ç”¨ `operator.add` Reducer

```python
from operator import add
from typing import Annotated

class State(TypedDict):
    foo: Annotated[list[int], add]  # â­ å…³é”®ï¼šä½¿ç”¨ Annotated + add

def node_1(state):
    print("---Node 1---")
    return {"foo": [state['foo'][-1] + 1]}

def node_2(state):
    print("---Node 2---")
    return {"foo": [state['foo'][-1] + 1]}

def node_3(state):
    print("---Node 3---")
    return {"foo": [state['foo'][-1] + 1]}

# æ„å»ºå›¾ï¼ˆåŒæ ·çš„å¹¶è¡Œç»“æ„ï¼‰
builder = StateGraph(State)
builder.add_node("node_1", node_1)
builder.add_node("node_2", node_2)
builder.add_node("node_3", node_3)

builder.add_edge(START, "node_1")
builder.add_edge("node_1", "node_2")
builder.add_edge("node_1", "node_3")
builder.add_edge("node_2", END)
builder.add_edge("node_3", END)

graph = builder.compile()

# æ‰§è¡ŒæˆåŠŸï¼
result = graph.invoke({"foo": [1]})
# è¾“å‡º: {'foo': [1, 2, 3, 3]}
```

**æ‰§è¡Œæµç¨‹ï¼š**
```
è¾“å…¥: {"foo": [1]}
  â†“
node_1: {"foo": [1, 2]}  (è¿½åŠ  2)
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
node_2         node_3
è¿½åŠ  3         è¿½åŠ  3
  â†“              â†“
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         åˆå¹¶
  {"foo": [1, 2, 3, 3]}  âœ… æˆåŠŸï¼
```

**å…³é”®ç‚¹ï¼š**
- `Annotated[list[int], add]` æŒ‡å®šä½¿ç”¨ `operator.add` ä½œä¸º Reducer
- `operator.add` å¯¹åˆ—è¡¨æ‰§è¡Œæ‹¼æ¥æ“ä½œï¼š`[1, 2] + [3] = [1, 2, 3]`
- å¹¶è¡ŒèŠ‚ç‚¹çš„è¿”å›å€¼ä¼šè¢«**è¿½åŠ **è€Œä¸æ˜¯è¦†ç›–
- æœ€ç»ˆçŠ¶æ€åŒ…å«æ‰€æœ‰èŠ‚ç‚¹çš„æ›´æ–°

---

## ğŸ”¬ æ·±å…¥ç†è§£ Annotated å’Œ Reducer

### Python çŸ¥è¯†ç‚¹ï¼šAnnotated ç±»å‹

```python
from typing import Annotated

# åŸºæœ¬ç”¨æ³•
Annotated[ç±»å‹, å…ƒæ•°æ®1, å…ƒæ•°æ®2, ...]

# åœ¨ LangGraph ä¸­
Annotated[list[int], add]
#         ^^^^^^^^^  ^^^
#         ç±»å‹å®šä¹‰   Reducer å‡½æ•°
```

**Annotated çš„ä½œç”¨ï¼š**
1. **ç±»å‹æç¤º**ï¼š`list[int]` å‘Šè¯‰ IDE å’Œç±»å‹æ£€æŸ¥å™¨è¿™æ˜¯ä¸€ä¸ªæ•´æ•°åˆ—è¡¨
2. **å…ƒæ•°æ®**ï¼š`add` æ˜¯é™„åŠ çš„å…ƒæ•°æ®ï¼ŒLangGraph ç”¨å®ƒæ¥ç¡®å®šçŠ¶æ€æ›´æ–°ç­–ç•¥
3. **ä¸å½±å“è¿è¡Œæ—¶ç±»å‹**ï¼šPython è¿è¡Œæ—¶ä»ç„¶è®¤ä¸ºå®ƒæ˜¯ `list[int]`

### Python çŸ¥è¯†ç‚¹ï¼šoperator.add

```python
import operator

# å¯¹æ•°å­—ï¼šæ‰§è¡ŒåŠ æ³•
operator.add(1, 2)  # â†’ 3

# å¯¹å­—ç¬¦ä¸²ï¼šæ‰§è¡Œæ‹¼æ¥
operator.add("hello", " world")  # â†’ "hello world"

# å¯¹åˆ—è¡¨ï¼šæ‰§è¡Œåˆ—è¡¨æ‹¼æ¥
operator.add([1, 2], [3, 4])  # â†’ [1, 2, 3, 4]

# åœ¨ LangGraph ä¸­
# æ—§çŠ¶æ€: [1, 2]
# æ–°æ›´æ–°: [3]
# ç»“æœ: operator.add([1, 2], [3]) â†’ [1, 2, 3]
```

**ä¸ºä»€ä¹ˆé€‰æ‹© `operator.add`ï¼Ÿ**
- æ˜¯ Python å†…ç½®æ¨¡å—ï¼Œæ€§èƒ½å¥½
- è¯­ä¹‰æ¸…æ™°ï¼šå°†æ–°å€¼"åŠ "åˆ°æ—§å€¼ä¸Š
- å¯¹åˆ—è¡¨çš„æ“ä½œç¬¦åˆç›´è§‰ï¼ˆæ‹¼æ¥ï¼‰

---

## ğŸ› ï¸ è‡ªå®šä¹‰ Reducer

### é—®é¢˜ï¼šoperator.add æ— æ³•å¤„ç† None

```python
from operator import add

class State(TypedDict):
    foo: Annotated[list[int], add]

def node_1(state):
    return {"foo": [2]}

graph = ...  # æ„å»ºå›¾

# ä¼ å…¥ None ä¼šæŠ¥é”™
try:
    graph.invoke({"foo": None})
except TypeError as e:
    print(f"TypeError occurred: {e}")
    # TypeError: unsupported operand type(s) for +: 'NoneType' and 'list'
```

**åŸå› ï¼š**
- `operator.add(None, [2])` æ— æ³•æ‰§è¡Œ
- `None + list` æ˜¯éæ³•æ“ä½œ

### è§£å†³æ–¹æ¡ˆï¼šè‡ªå®šä¹‰ Reducer å‡½æ•°

```python
def reduce_list(left: list | None, right: list | None) -> list:
    """
    å®‰å…¨åœ°åˆå¹¶ä¸¤ä¸ªåˆ—è¡¨ï¼Œå¤„ç† None çš„æƒ…å†µ

    Args:
        left: æ—§çŠ¶æ€ï¼ˆå¯èƒ½æ˜¯ Noneï¼‰
        right: æ–°æ›´æ–°ï¼ˆå¯èƒ½æ˜¯ Noneï¼‰

    Returns:
        åˆå¹¶åçš„åˆ—è¡¨
    """
    if not left:
        left = []
    if not right:
        right = []
    return left + right

# ä½¿ç”¨è‡ªå®šä¹‰ Reducer
class CustomReducerState(TypedDict):
    foo: Annotated[list[int], reduce_list]  # â­ ä½¿ç”¨è‡ªå®šä¹‰å‡½æ•°

def node_1(state):
    print("---Node 1---")
    return {"foo": [2]}

# æ„å»ºå›¾
builder = StateGraph(CustomReducerState)
builder.add_node("node_1", node_1)
builder.add_edge(START, "node_1")
builder.add_edge("node_1", END)

graph = builder.compile()

# ç°åœ¨å¯ä»¥å¤„ç† None äº†ï¼
result = graph.invoke({"foo": None})
# è¾“å‡º: {'foo': [2]}
```

**è‡ªå®šä¹‰ Reducer çš„ä¼˜åŠ¿ï¼š**
- å¯ä»¥å®ç°ä»»æ„å¤æ‚çš„åˆå¹¶é€»è¾‘
- å¤„ç†è¾¹ç¼˜æƒ…å†µï¼ˆå¦‚ Noneã€ç©ºå€¼ï¼‰
- æ›´ç¬¦åˆä¸šåŠ¡éœ€æ±‚

### è‡ªå®šä¹‰ Reducer ç¤ºä¾‹

#### ç¤ºä¾‹ 1ï¼šåªä¿ç•™å”¯ä¸€å€¼

```python
def unique_reducer(left: list | None, right: list | None) -> list:
    """åˆå¹¶åˆ—è¡¨å¹¶å»é‡"""
    if not left:
        left = []
    if not right:
        right = []
    return list(set(left + right))

class State(TypedDict):
    tags: Annotated[list[str], unique_reducer]

# ä½¿ç”¨
# æ—§çŠ¶æ€: {"tags": ["python", "ai"]}
# æ–°æ›´æ–°: {"tags": ["python", "langchain"]}
# ç»“æœ: {"tags": ["python", "ai", "langchain"]}  # è‡ªåŠ¨å»é‡
```

#### ç¤ºä¾‹ 2ï¼šä¿ç•™æœ€æ–°çš„ N ä¸ªå€¼

```python
def keep_last_n(n: int):
    """å·¥å‚å‡½æ•°ï¼šåˆ›å»ºä¸€ä¸ªåªä¿ç•™æœ€æ–° n ä¸ªå€¼çš„ Reducer"""
    def reducer(left: list | None, right: list | None) -> list:
        if not left:
            left = []
        if not right:
            right = []
        combined = left + right
        return combined[-n:]  # åªä¿ç•™æœ€å n ä¸ª
    return reducer

class State(TypedDict):
    history: Annotated[list[str], keep_last_n(5)]  # åªä¿ç•™æœ€æ–° 5 ä¸ª

# ä½¿ç”¨
# æ—§çŠ¶æ€: {"history": ["a", "b", "c", "d", "e"]}
# æ–°æ›´æ–°: {"history": ["f", "g"]}
# ç»“æœ: {"history": ["c", "d", "e", "f", "g"]}  # åªä¿ç•™æœ€æ–° 5 ä¸ª
```

#### ç¤ºä¾‹ 3ï¼šåˆå¹¶å­—å…¸

```python
def merge_dict_reducer(left: dict | None, right: dict | None) -> dict:
    """æ·±åº¦åˆå¹¶ä¸¤ä¸ªå­—å…¸"""
    if not left:
        left = {}
    if not right:
        right = {}
    return {**left, **right}

class State(TypedDict):
    config: Annotated[dict, merge_dict_reducer]

# ä½¿ç”¨
# æ—§çŠ¶æ€: {"config": {"a": 1, "b": 2}}
# æ–°æ›´æ–°: {"config": {"b": 3, "c": 4}}
# ç»“æœ: {"config": {"a": 1, "b": 3, "c": 4}}  # b è¢«è¦†ç›–ï¼Œc è¢«æ·»åŠ 
```

---

## ğŸ’¬ Messages Reducerï¼šå¤„ç†å¯¹è¯æ¶ˆæ¯

### å†…ç½®çš„ add_messages Reducer

LangGraph æä¾›äº†ä¸“é—¨ç”¨äºå¤„ç†æ¶ˆæ¯çš„ Reducerï¼š`add_messages`

**ä¸¤ç§ä½¿ç”¨æ–¹å¼ï¼š**

#### æ–¹å¼ 1ï¼šæ‰‹åŠ¨å®šä¹‰

```python
from typing import Annotated
from langchain_core.messages import AnyMessage
from langgraph.graph.message import add_messages

class CustomMessagesState(TypedDict):
    messages: Annotated[list[AnyMessage], add_messages]
    user_name: str
    session_id: str
```

#### æ–¹å¼ 2ï¼šä½¿ç”¨ MessagesStateï¼ˆæ¨èï¼‰

```python
from langgraph.graph import MessagesState

# MessagesState å·²ç»å†…ç½®äº† messages å­—æ®µå’Œ add_messages reducer
class ExtendedMessagesState(MessagesState):
    # åªéœ€è¦æ·»åŠ é¢å¤–çš„å­—æ®µ
    user_name: str
    session_id: str
```

**MessagesState çš„ä¼˜åŠ¿ï¼š**
- è‡ªåŠ¨åŒ…å« `messages: Annotated[list[AnyMessage], add_messages]`
- å‡å°‘æ ·æ¿ä»£ç 
- æ›´æ¸…æ™°çš„æ„å›¾è¡¨è¾¾

### add_messages çš„åŸºæœ¬ç”¨æ³•

```python
from langgraph.graph.message import add_messages
from langchain_core.messages import AIMessage, HumanMessage

# åˆå§‹çŠ¶æ€
initial_messages = [
    AIMessage(content="Hello! How can I assist you?", name="Model"),
    HumanMessage(content="I'm looking for information on marine biology.", name="Lance")
]

# æ–°æ¶ˆæ¯
new_message = AIMessage(
    content="Sure, I can help with that. What specifically are you interested in?",
    name="Model"
)

# è¿½åŠ æ¶ˆæ¯
result = add_messages(initial_messages, new_message)

# ç»“æœ
# [
#     AIMessage(content="Hello! How can I assist you?", name="Model"),
#     HumanMessage(content="I'm looking for information on marine biology.", name="Lance"),
#     AIMessage(content="Sure, I can help with that...", name="Model")  # âœ… è¿½åŠ æˆåŠŸ
# ]
```

### é«˜çº§åŠŸèƒ½ 1ï¼šæ¶ˆæ¯é‡å†™ï¼ˆRe-writingï¼‰

**æ ¸å¿ƒæœºåˆ¶ï¼š** å¦‚æœæ–°æ¶ˆæ¯çš„ `id` ä¸ç°æœ‰æ¶ˆæ¯ç›¸åŒï¼Œä¼š**è¦†ç›–**æ—§æ¶ˆæ¯

```python
# åˆå§‹çŠ¶æ€
initial_messages = [
    AIMessage(content="Hello! How can I assist you?", name="Model", id="1"),
    HumanMessage(content="I'm looking for information on marine biology.", name="Lance", id="2")
]

# æ–°æ¶ˆæ¯ï¼ˆæ³¨æ„ id="2" ä¸ç¬¬äºŒæ¡æ¶ˆæ¯ç›¸åŒï¼‰
new_message = HumanMessage(
    content="I'm looking for information on whales, specifically",
    name="Lance",
    id="2"  # â­ ç›¸åŒçš„ ID
)

# é‡å†™æ¶ˆæ¯
result = add_messages(initial_messages, new_message)

# ç»“æœ
# [
#     AIMessage(content="Hello! How can I assist you?", name="Model", id="1"),
#     HumanMessage(content="I'm looking for information on whales, specifically", name="Lance", id="2")
#     # âœ… ç¬¬äºŒæ¡æ¶ˆæ¯è¢«é‡å†™
# ]
```

**åº”ç”¨åœºæ™¯ï¼š**
- ä¿®æ­£ç”¨æˆ·è¾“å…¥
- æ›´æ–° AI å“åº”
- å®ç°æ¶ˆæ¯ç¼–è¾‘åŠŸèƒ½

### é«˜çº§åŠŸèƒ½ 2ï¼šæ¶ˆæ¯åˆ é™¤ï¼ˆRemovalï¼‰

**ä½¿ç”¨ RemoveMessageï¼š**

```python
from langchain_core.messages import RemoveMessage, AIMessage, HumanMessage

# æ¶ˆæ¯åˆ—è¡¨
messages = [
    AIMessage("Hi.", name="Bot", id="1"),
    HumanMessage("Hi.", name="Lance", id="2"),
    AIMessage("So you said you were researching ocean mammals?", name="Bot", id="3"),
    HumanMessage("Yes, I know about whales. But what others should I learn about?", name="Lance", id="4")
]

# åˆ›å»ºåˆ é™¤æŒ‡ä»¤ï¼ˆåˆ é™¤å‰ä¸¤æ¡æ¶ˆæ¯ï¼‰
delete_messages = [RemoveMessage(id=m.id) for m in messages[:-2]]
# [RemoveMessage(id="1"), RemoveMessage(id="2")]

# æ‰§è¡Œåˆ é™¤
result = add_messages(messages, delete_messages)

# ç»“æœ
# [
#     AIMessage("So you said you were researching ocean mammals?", name="Bot", id="3"),
#     HumanMessage("Yes, I know about whales...", name="Lance", id="4")
# ]
# âœ… id="1" å’Œ id="2" çš„æ¶ˆæ¯è¢«åˆ é™¤
```

**åº”ç”¨åœºæ™¯ï¼š**
- å®ç°æ»‘åŠ¨çª—å£ï¼ˆåªä¿ç•™æœ€è¿‘ N æ¡æ¶ˆæ¯ï¼‰
- åˆ é™¤æ•æ„Ÿä¿¡æ¯
- æ¸…ç†æ— å…³å¯¹è¯å†å²
- ä¼˜åŒ–ä¸Šä¸‹æ–‡é•¿åº¦ï¼ˆå‡å°‘ Token æ¶ˆè€—ï¼‰

### å®æˆ˜æ¡ˆä¾‹ï¼šæ»‘åŠ¨çª—å£å¯¹è¯

```python
from langgraph.graph import MessagesState, StateGraph, START, END
from langchain_core.messages import RemoveMessage, HumanMessage, AIMessage

class ConversationState(MessagesState):
    max_messages: int = 10  # æœ€å¤šä¿ç•™ 10 æ¡æ¶ˆæ¯

def chat_node(state: ConversationState):
    # æ¨¡æ‹Ÿ AI å“åº”
    response = AIMessage(content="I understand your question.", name="Bot")
    return {"messages": [response]}

def cleanup_node(state: ConversationState):
    """æ¸…ç†æ—§æ¶ˆæ¯ï¼Œåªä¿ç•™æœ€æ–°çš„ max_messages æ¡"""
    messages = state["messages"]
    max_msgs = state.get("max_messages", 10)

    if len(messages) > max_msgs:
        # è®¡ç®—éœ€è¦åˆ é™¤çš„æ¶ˆæ¯æ•°é‡
        num_to_delete = len(messages) - max_msgs
        # åˆ›å»ºåˆ é™¤æŒ‡ä»¤
        delete_messages = [RemoveMessage(id=m.id) for m in messages[:num_to_delete]]
        return {"messages": delete_messages}

    return {}

# æ„å»ºå›¾
builder = StateGraph(ConversationState)
builder.add_node("chat", chat_node)
builder.add_node("cleanup", cleanup_node)

builder.add_edge(START, "chat")
builder.add_edge("chat", "cleanup")
builder.add_edge("cleanup", END)

graph = builder.compile()

# ä½¿ç”¨
initial_state = {
    "messages": [HumanMessage(content="Hello", id=str(i)) for i in range(12)],
    "max_messages": 10
}

result = graph.invoke(initial_state)
# ç»“æœåªä¿ç•™æœ€æ–° 10 æ¡æ¶ˆæ¯
```

---

## ğŸ“ æ ¸å¿ƒçŸ¥è¯†ç‚¹æ€»ç»“

### LangGraph ç‰¹æœ‰æ¦‚å¿µ

#### 1. Reducer æœºåˆ¶

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| **ä½œç”¨** | å®šä¹‰çŠ¶æ€æ›´æ–°ç­–ç•¥ |
| **è§¦å‘æ—¶æœº** | å¤šä¸ªèŠ‚ç‚¹æ›´æ–°åŒä¸€å­—æ®µæ—¶ |
| **é»˜è®¤è¡Œä¸º** | è¦†ç›–ï¼ˆä¼šå¯¼è‡´å¹¶è¡Œå†²çªï¼‰ |
| **Reducer è¡Œä¸º** | è‡ªå®šä¹‰åˆå¹¶é€»è¾‘ï¼ˆå¦‚è¿½åŠ ã€å»é‡ï¼‰ |

#### 2. å†…ç½® Reducer

| Reducer | ç”¨é€” | ç¤ºä¾‹ |
|---------|------|------|
| `operator.add` | æ‹¼æ¥åˆ—è¡¨/å­—ç¬¦ä¸² | `[1, 2] + [3] = [1, 2, 3]` |
| `add_messages` | è¿½åŠ /ä¿®æ”¹/åˆ é™¤æ¶ˆæ¯ | å¯¹è¯å†å²ç®¡ç† |

#### 3. MessagesState

```python
# æ‰‹åŠ¨æ–¹å¼
class State(TypedDict):
    messages: Annotated[list[AnyMessage], add_messages]

# å¿«æ·æ–¹å¼ï¼ˆæ¨èï¼‰
class State(MessagesState):
    pass  # è‡ªåŠ¨åŒ…å« messages å­—æ®µ
```

### Python ç‰¹æœ‰çŸ¥è¯†ç‚¹

#### 1. Annotated ç±»å‹

```python
from typing import Annotated

Annotated[åŸºç¡€ç±»å‹, å…ƒæ•°æ®1, å…ƒæ•°æ®2, ...]

# åœ¨ LangGraph ä¸­
Annotated[list[int], add]
#         ^^^^^^^^^  ^^^
#         ç±»å‹       Reducer
```

**ä½œç”¨ï¼š**
- æä¾›ç±»å‹æç¤ºï¼ˆIDE æ”¯æŒï¼‰
- é™„åŠ å…ƒæ•°æ®ï¼ˆLangGraph ç”¨äºç¡®å®š Reducerï¼‰
- ä¸å½±å“è¿è¡Œæ—¶è¡Œä¸º

#### 2. TypedDict vs Pydantic BaseModel

| ç‰¹æ€§ | TypedDict | BaseModel |
|------|-----------|-----------|
| è¿è¡Œæ—¶éªŒè¯ | âŒ | âœ… |
| ç±»å‹æç¤º | âœ… | âœ… |
| æ€§èƒ½ | æ›´å¿« | ç¨æ…¢ |
| ç”¨é€” | çŠ¶æ€å®šä¹‰ | æ•°æ®æ¨¡å‹ã€API è¾“å‡º |

#### 3. operator æ¨¡å—

```python
import operator

operator.add(a, b)      # a + b
operator.sub(a, b)      # a - b
operator.mul(a, b)      # a * b
operator.truediv(a, b)  # a / b
```

**åœ¨ LangGraph ä¸­çš„åº”ç”¨ï¼š**
- `operator.add` ç”¨äºåˆ—è¡¨æ‹¼æ¥
- æ˜¯ Python å†…ç½®æ¨¡å—ï¼Œæ— éœ€å®‰è£…

#### 4. ç±»å‹æç¤ºä¸­çš„ Union

```python
from typing import Union

# Python 3.10+ å¯ä»¥ä½¿ç”¨ | è¯­æ³•
def reduce_list(left: list | None, right: list | None) -> list:
    ...

# ç­‰ä»·äºï¼ˆæ—§è¯­æ³•ï¼‰
def reduce_list(left: Union[list, None], right: Union[list, None]) -> list:
    ...
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. ä½•æ—¶ä½¿ç”¨ Reducerï¼Ÿ

âœ… **å¿…é¡»ä½¿ç”¨çš„åœºæ™¯ï¼š**
- å›¾ä¸­å­˜åœ¨å¹¶è¡ŒèŠ‚ç‚¹
- å¤šä¸ªèŠ‚ç‚¹å¯èƒ½æ›´æ–°åŒä¸€ä¸ªçŠ¶æ€å­—æ®µ
- éœ€è¦è¿½åŠ è€Œéè¦†ç›–ï¼ˆå¦‚æ¶ˆæ¯å†å²ï¼‰
- éœ€è¦è‡ªå®šä¹‰èšåˆé€»è¾‘ï¼ˆå¦‚å»é‡ã€æ±‚å’Œï¼‰

âŒ **ä¸éœ€è¦ä½¿ç”¨çš„åœºæ™¯ï¼š**
- å®Œå…¨ä¸²è¡Œçš„å›¾ï¼ˆæ— å¹¶è¡ŒèŠ‚ç‚¹ï¼‰
- æ¯ä¸ªå­—æ®µåªè¢«ä¸€ä¸ªèŠ‚ç‚¹æ›´æ–°
- è¦†ç›–è¡Œä¸ºç¬¦åˆé¢„æœŸ

### 2. Reducer è®¾è®¡åŸåˆ™

#### åŸåˆ™ 1ï¼šæ˜ç¡®è¯­ä¹‰

```python
# âœ… å¥½çš„è®¾è®¡ - è¯­ä¹‰æ¸…æ™°
class State(TypedDict):
    message_history: Annotated[list, add_messages]  # æ¶ˆæ¯å†å²ï¼šè¿½åŠ 
    calculation_results: Annotated[list, operator.add]  # è®¡ç®—ç»“æœï¼šæ‹¼æ¥
    user_count: Annotated[int, max]  # ç”¨æˆ·æ•°ï¼šå–æœ€å¤§å€¼

# âŒ ä¸å¥½çš„è®¾è®¡ - è¯­ä¹‰ä¸æ˜
class State(TypedDict):
    data: Annotated[list, add]  # data æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆè¿½åŠ ï¼Ÿ
```

#### åŸåˆ™ 2ï¼šå¤„ç†è¾¹ç¼˜æƒ…å†µ

```python
# âœ… å¥½çš„è®¾è®¡ - å¤„ç† None
def safe_reducer(left: list | None, right: list | None) -> list:
    if not left:
        left = []
    if not right:
        right = []
    return left + right

# âŒ ä¸å¥½çš„è®¾è®¡ - å¯èƒ½å´©æºƒ
def unsafe_reducer(left: list, right: list) -> list:
    return left + right  # å¦‚æœä¼ å…¥ None ä¼šæŠ¥é”™
```

#### åŸåˆ™ 3ï¼šä¿æŒå¹‚ç­‰æ€§ï¼ˆå¦‚æœå¯èƒ½ï¼‰

```python
# âœ… å¹‚ç­‰çš„ Reducer
def unique_add(left: list, right: list) -> list:
    """å¤šæ¬¡æ·»åŠ ç›¸åŒå…ƒç´ åªä¿ç•™ä¸€ä¸ª"""
    return list(set(left + right))

# åº”ç”¨ï¼šå³ä½¿é‡å¤æ‰§è¡Œï¼Œç»“æœä¸€è‡´
state = ["a", "b"]
state = unique_add(state, ["b", "c"])  # ["a", "b", "c"]
state = unique_add(state, ["b", "c"])  # ["a", "b", "c"] - ç›¸åŒç»“æœ
```

### 3. æ¶ˆæ¯ç®¡ç†æœ€ä½³å®è·µ

#### å®è·µ 1ï¼šå®šæœŸæ¸…ç†æ¶ˆæ¯

```python
def should_cleanup(state: MessagesState) -> bool:
    """æ¯ 10 æ¡æ¶ˆæ¯æ¸…ç†ä¸€æ¬¡"""
    return len(state["messages"]) % 10 == 0

builder.add_conditional_edges(
    "chat",
    should_cleanup,
    {True: "cleanup", False: END}
)
```

#### å®è·µ 2ï¼šä¿ç•™ç³»ç»Ÿæ¶ˆæ¯

```python
from langchain_core.messages import SystemMessage

def cleanup_node(state):
    messages = state["messages"]
    # ä¿ç•™ç³»ç»Ÿæ¶ˆæ¯å’Œæœ€æ–° 5 æ¡å¯¹è¯
    system_messages = [m for m in messages if isinstance(m, SystemMessage)]
    recent_messages = [m for m in messages if not isinstance(m, SystemMessage)][-5:]

    # åˆ é™¤å…¶ä»–æ¶ˆæ¯
    to_delete = [m for m in messages if m not in system_messages + recent_messages]
    delete_ops = [RemoveMessage(id=m.id) for m in to_delete]

    return {"messages": delete_ops}
```

#### å®è·µ 3ï¼šå®ç°æ¶ˆæ¯ç¼–è¾‘

```python
def edit_message_node(state):
    """å…è®¸ç”¨æˆ·ç¼–è¾‘æœ€åä¸€æ¡æ¶ˆæ¯"""
    last_message = state["messages"][-1]

    # åˆ›å»ºæ–°æ¶ˆæ¯ï¼Œä½¿ç”¨ç›¸åŒçš„ ID
    edited_message = HumanMessage(
        content=state["edited_content"],
        id=last_message.id,  # â­ ç›¸åŒ ID = è¦†ç›–
        name=last_message.name
    )

    return {"messages": [edited_message]}
```

### 4. æ€§èƒ½ä¼˜åŒ–æŠ€å·§

#### æŠ€å·§ 1ï¼šé¿å…è¿‡å¤§çš„åˆ—è¡¨

```python
# âŒ ä¸å¥½ - åˆ—è¡¨æ— é™å¢é•¿
class State(TypedDict):
    all_results: Annotated[list, operator.add]

# âœ… å¥½ - é™åˆ¶å¤§å°
def limited_add(max_size: int):
    def reducer(left: list | None, right: list | None) -> list:
        if not left:
            left = []
        if not right:
            right = []
        combined = left + right
        return combined[-max_size:]  # åªä¿ç•™æœ€æ–°çš„
    return reducer

class State(TypedDict):
    recent_results: Annotated[list, limited_add(100)]
```

#### æŠ€å·§ 2ï¼šä½¿ç”¨é«˜æ•ˆçš„æ•°æ®ç»“æ„

```python
# å¦‚æœéœ€è¦é¢‘ç¹æŸ¥æ‰¾
def set_reducer(left: set | None, right: set | None) -> set:
    """ä½¿ç”¨é›†åˆå®ç° O(1) æŸ¥æ‰¾"""
    if not left:
        left = set()
    if not right:
        right = set()
    return left | right  # é›†åˆå¹¶é›†

class State(TypedDict):
    unique_ids: Annotated[set, set_reducer]
```

---

## ğŸš€ è¿›é˜¶æŠ€å·§

### 1. æ¡ä»¶æ€§ Reducer

æ ¹æ®çŠ¶æ€åŠ¨æ€é€‰æ‹© Reducerï¼š

```python
def smart_reducer(left: list, right: list, state: dict) -> list:
    """æ ¹æ®çŠ¶æ€é€‰æ‹©åˆå¹¶ç­–ç•¥"""
    if state.get("mode") == "append":
        return left + right
    elif state.get("mode") == "unique":
        return list(set(left + right))
    elif state.get("mode") == "override":
        return right
    else:
        return left + right
```

### 2. ç»„åˆå¤šä¸ª Reducer

```python
def compose_reducers(*reducers):
    """ç»„åˆå¤šä¸ª Reducer"""
    def combined(left, right):
        result = left
        for reducer in reducers:
            result = reducer(result, right)
        return result
    return combined

# ä½¿ç”¨
validate_and_add = compose_reducers(
    validate_list,    # å…ˆéªŒè¯
    deduplicate,      # å†å»é‡
    operator.add      # æœ€åè¿½åŠ 
)
```

### 3. å¸¦æ—¥å¿—çš„ Reducer

```python
def logged_reducer(reducer_func, name: str):
    """ä¸º Reducer æ·»åŠ æ—¥å¿—"""
    def wrapper(left, right):
        print(f"[{name}] Merging: {left} + {right}")
        result = reducer_func(left, right)
        print(f"[{name}] Result: {result}")
        return result
    return wrapper

# ä½¿ç”¨
class State(TypedDict):
    data: Annotated[list, logged_reducer(operator.add, "DataReducer")]
```

---

## ğŸ“Š Reducer æ¨¡å¼å¯¹æ¯”

| æ¨¡å¼ | å®ç° | é€‚ç”¨åœºæ™¯ | ç¤ºä¾‹ |
|------|------|---------|------|
| **è¦†ç›–** | é»˜è®¤è¡Œä¸º | å•èŠ‚ç‚¹æ›´æ–° | é…ç½®è¦†ç›– |
| **è¿½åŠ ** | `operator.add` | æ”¶é›†ç»“æœ | æ—¥å¿—æ”¶é›† |
| **å»é‡è¿½åŠ ** | è‡ªå®šä¹‰ | å”¯ä¸€æ€§çº¦æŸ | æ ‡ç­¾é›†åˆ |
| **æ¶ˆæ¯ç®¡ç†** | `add_messages` | å¯¹è¯å†å² | èŠå¤©æœºå™¨äºº |
| **æ•°å€¼èšåˆ** | `max/min/sum` | ç»Ÿè®¡è®¡ç®— | æ€§èƒ½æŒ‡æ ‡ |

---

## ğŸ¯ å®é™…åº”ç”¨æ¡ˆä¾‹

### æ¡ˆä¾‹ 1ï¼šå¹¶è¡Œ API è°ƒç”¨ç»“æœæ”¶é›†

```python
from typing import Annotated
from operator import add

class State(TypedDict):
    query: str
    api_results: Annotated[list[dict], add]

def call_api_1(state):
    result = {"source": "API1", "data": "..."}
    return {"api_results": [result]}

def call_api_2(state):
    result = {"source": "API2", "data": "..."}
    return {"api_results": [result]}

# ä¸¤ä¸ª API å¹¶è¡Œè°ƒç”¨ï¼Œç»“æœè‡ªåŠ¨åˆå¹¶
# æœ€ç»ˆ: {"api_results": [{"source": "API1", ...}, {"source": "API2", ...}]}
```

### æ¡ˆä¾‹ 2ï¼šèŠå¤©æœºå™¨äººçŠ¶æ€ç®¡ç†

```python
from langgraph.graph import MessagesState

class ChatState(MessagesState):
    user_id: str
    session_id: str
    context: dict

def chat_node(state: ChatState):
    # ç”Ÿæˆå“åº”
    response = generate_response(state["messages"][-1])
    return {"messages": [response]}

def memory_cleanup_node(state: ChatState):
    # åªä¿ç•™æœ€è¿‘ 20 æ¡æ¶ˆæ¯
    messages = state["messages"]
    if len(messages) > 20:
        to_delete = messages[:-20]
        return {"messages": [RemoveMessage(id=m.id) for m in to_delete]}
    return {}
```

### æ¡ˆä¾‹ 3ï¼šæ–‡æ¡£åˆ†æç»“æœèšåˆ

```python
class AnalysisState(TypedDict):
    document: str
    insights: Annotated[list[str], operator.add]
    metrics: Annotated[dict, merge_dict]

def technical_analysis(state):
    insight = "Technical complexity: High"
    metrics = {"lines_of_code": 1000}
    return {"insights": [insight], "metrics": metrics}

def business_analysis(state):
    insight = "Business value: Medium"
    metrics = {"estimated_revenue": 50000}
    return {"insights": [insight], "metrics": metrics}

# å¹¶è¡Œåˆ†æï¼Œç»“æœè‡ªåŠ¨åˆå¹¶
# insights: ["Technical complexity: High", "Business value: Medium"]
# metrics: {"lines_of_code": 1000, "estimated_revenue": 50000}
```

---

## ğŸ” å¸¸è§é—®é¢˜

### Q1: Reducer å’Œæ™®é€šå‡½æ•°æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

**Reducerï¼š**
- ä¸“é—¨ç”¨äºçŠ¶æ€åˆå¹¶
- æ¥å—ä¸¤ä¸ªå‚æ•°ï¼šæ—§çŠ¶æ€å’Œæ–°æ›´æ–°
- è¿”å›åˆå¹¶åçš„çŠ¶æ€
- ç”± LangGraph è‡ªåŠ¨è°ƒç”¨

**æ™®é€šå‡½æ•°ï¼š**
- å¯ä»¥åšä»»ä½•äº‹æƒ…
- å‚æ•°å’Œè¿”å›å€¼ä»»æ„
- éœ€è¦æ‰‹åŠ¨è°ƒç”¨

### Q2: ä¸ºä»€ä¹ˆå¹¶è¡ŒèŠ‚ç‚¹å¿…é¡»ä½¿ç”¨ Reducerï¼Ÿ

å› ä¸ºå¹¶è¡ŒèŠ‚ç‚¹åœ¨**åŒä¸€æ­¥**æ‰§è¡Œï¼Œå®ƒä»¬çš„æ›´æ–°æ˜¯**åŒæ—¶**å‘ç”Ÿçš„ã€‚å¦‚æœæ²¡æœ‰ Reducerï¼š

```
node_2 æ›´æ–°: {"foo": 3}
node_3 æ›´æ–°: {"foo": 3}

é—®é¢˜ï¼šåº”è¯¥ä¿ç•™å“ªä¸ªï¼Ÿ
```

Reducer æä¾›äº†æ˜ç¡®çš„åˆå¹¶ç­–ç•¥ï¼Œé¿å…å†²çªã€‚

### Q3: add_messages å¦‚ä½•çŸ¥é“å“ªäº›æ¶ˆæ¯åº”è¯¥è¦†ç›–ï¼Ÿ

é€šè¿‡æ¶ˆæ¯çš„ `id` å­—æ®µï¼š

```python
# å¦‚æœæ–°æ¶ˆæ¯çš„ id ä¸ç°æœ‰æ¶ˆæ¯ç›¸åŒï¼Œå°±è¦†ç›–
new_msg = HumanMessage(content="Updated", id="123")
old_msgs = [HumanMessage(content="Original", id="123")]

result = add_messages(old_msgs, new_msg)
# ç»“æœ: [HumanMessage(content="Updated", id="123")]
```

### Q4: å¯ä»¥ä¸ºä¸åŒå­—æ®µä½¿ç”¨ä¸åŒçš„ Reducer å—ï¼Ÿ

å¯ä»¥ï¼æ¯ä¸ªå­—æ®µéƒ½å¯ä»¥æœ‰è‡ªå·±çš„ Reducerï¼š

```python
class State(TypedDict):
    messages: Annotated[list, add_messages]      # æ¶ˆæ¯ï¼šè¿½åŠ 
    scores: Annotated[list, operator.add]        # åˆ†æ•°ï¼šæ‹¼æ¥
    max_score: Annotated[int, max]               # æœ€é«˜åˆ†ï¼šå–æœ€å¤§å€¼
    flags: Annotated[set, set_union]             # æ ‡å¿—ï¼šé›†åˆå¹¶é›†
```

### Q5: Reducer ä¼šå½±å“æ€§èƒ½å—ï¼Ÿ

ä¼šæœ‰è½»å¾®å½±å“ï¼Œä½†é€šå¸¸å¯ä»¥å¿½ç•¥ï¼š

- `operator.add`ï¼šéå¸¸å¿«ï¼ˆPython å†…ç½®ï¼‰
- `add_messages`ï¼šéœ€è¦æ£€æŸ¥ IDï¼Œç¨æ…¢ä½†ä»é«˜æ•ˆ
- è‡ªå®šä¹‰ Reducerï¼šå–å†³äºå®ç°å¤æ‚åº¦

**ä¼˜åŒ–å»ºè®®ï¼š**
- é¿å…åœ¨ Reducer ä¸­è¿›è¡Œå¤æ‚è®¡ç®—
- ä½¿ç”¨é«˜æ•ˆçš„æ•°æ®ç»“æ„ï¼ˆå¦‚ set è€Œé listï¼‰
- é™åˆ¶çŠ¶æ€å¤§å°ï¼ˆå¦‚åªä¿ç•™æœ€æ–° N é¡¹ï¼‰

---

## ğŸ“– æ‰©å±•é˜…è¯»

- [LangGraph Reducers å®˜æ–¹æ–‡æ¡£](https://langchain-ai.github.io/langgraph/concepts/low_level/#reducers)
- [add_messages è¯¦ç»†è¯´æ˜](https://langchain-ai.github.io/langgraph/concepts/low_level/#add_messages)
- [Python Annotated ç±»å‹](https://docs.python.org/3/library/typing.html#typing.Annotated)
- [Python operator æ¨¡å—](https://docs.python.org/3/library/operator.html)

---

## ğŸ‰ æ€»ç»“

**State Reducers æ˜¯ LangGraph çŠ¶æ€ç®¡ç†çš„æ ¸å¿ƒæœºåˆ¶**ï¼Œå®ƒè§£å†³äº†ä»¥ä¸‹å…³é”®é—®é¢˜ï¼š

1. **å¹¶è¡ŒèŠ‚ç‚¹å†²çª** - é€šè¿‡å®šä¹‰åˆå¹¶ç­–ç•¥é¿å…çŠ¶æ€å†²çª
2. **çµæ´»çš„çŠ¶æ€æ›´æ–°** - æ”¯æŒè¿½åŠ ã€è¦†ç›–ã€å»é‡ç­‰å¤šç§æ¨¡å¼
3. **æ¶ˆæ¯ç®¡ç†** - å†…ç½®çš„ `add_messages` æä¾›è¿½åŠ ã€ä¿®æ”¹ã€åˆ é™¤åŠŸèƒ½
4. **è‡ªå®šä¹‰é€»è¾‘** - å¯ä»¥å®ç°ä»»æ„å¤æ‚çš„çŠ¶æ€èšåˆé€»è¾‘

**å…³é”®è¦ç‚¹ï¼š**
- ä½¿ç”¨ `Annotated[ç±»å‹, Reducerå‡½æ•°]` å®šä¹‰ Reducer
- `operator.add` ç”¨äºåˆ—è¡¨/å­—ç¬¦ä¸²æ‹¼æ¥
- `add_messages` ç”¨äºæ¶ˆæ¯å†å²ç®¡ç†
- è‡ªå®šä¹‰ Reducer å¤„ç†ç‰¹æ®Šéœ€æ±‚
- å¿…é¡»å¤„ç† `None` ç­‰è¾¹ç¼˜æƒ…å†µ

æŒæ¡ State Reducers æ˜¯æ„å»ºå¤æ‚ LangGraph åº”ç”¨çš„åŸºç¡€ï¼Œå®ƒè®©çŠ¶æ€ç®¡ç†å˜å¾—ä¼˜é›…è€Œå¼ºå¤§ï¼
# 0.2 é¢å‘å¯¹è±¡ä¸å·¥ç¨‹å®è·µ
> **å­¦ä¹ ç›®æ ‡**
> æœ¬ç« æ•™ä½ å¦‚ä½•ä½¿ç”¨é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼ˆOOPï¼‰è®¾è®¡å¯ç»´æŠ¤çš„ AI Agentï¼ŒæŒæ¡æ–‡ä»¶æ“ä½œã€å¼‚å¸¸å¤„ç†ã€ç¯å¢ƒé…ç½®ç­‰å·¥ç¨‹å®è·µï¼Œä¸ºæ„å»ºç”Ÿäº§çº§åº”ç”¨åšå‡†å¤‡ã€‚

---

## ğŸ“‹ æœ¬ç« å†…å®¹

- âœ… æŒæ¡é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼ˆç±»ã€ç»§æ‰¿ã€å°è£…ï¼‰
- âœ… å­¦ä¼šä¼˜é›…çš„å¼‚å¸¸å¤„ç†ï¼ˆtry-exceptã€è‡ªå®šä¹‰å¼‚å¸¸ï¼‰
- âœ… æŒæ¡æ–‡ä»¶ä¸ JSON æ“ä½œï¼ˆä¿å­˜å¯¹è¯å†å²ï¼‰
- âœ… å­¦ä¼šç¯å¢ƒé…ç½®ç®¡ç†ï¼ˆ.envã€API Keyï¼‰
- âœ… æŒæ¡ Git/GitHub åä½œæµç¨‹
- âœ… ç†è§£è™šæ‹Ÿç¯å¢ƒä¸ä¾èµ–ç®¡ç†

---

## ğŸ“š æœ¯è¯­è¡¨

| æœ¯è¯­åç§° | LangGraph å®šä¹‰å’Œè§£è¯» | Python å®šä¹‰å’Œè¯´æ˜ | é‡è¦ç¨‹åº¦ |
|---------|---------------------|------------------|---------|
| **Class** | Agentç³»ç»Ÿçš„è“å›¾ï¼Œå°è£…çŠ¶æ€ç®¡ç†ã€å·¥å…·è°ƒç”¨ã€è®°å¿†å­˜å‚¨ç­‰åŠŸèƒ½æ¨¡å—ã€‚è™½ç„¶LangGraphèŠ‚ç‚¹æ˜¯å‡½æ•°ï¼Œä½†ç±»ç”¨äºç»„ç»‡å¤æ‚é€»è¾‘ | é¢å‘å¯¹è±¡ç¼–ç¨‹çš„æ ¸å¿ƒï¼Œé€šè¿‡`class`å…³é”®å­—å®šä¹‰ï¼ŒåŒ…å«å±æ€§å’Œæ–¹æ³• | â­â­â­â­â­ |
| **__init__** | æ„é€ å‡½æ•°ï¼Œåˆå§‹åŒ–Agenté…ç½®ï¼ˆmodelã€temperatureï¼‰ã€çŠ¶æ€å­˜å‚¨ï¼ˆhistoryï¼‰ç­‰å®ä¾‹å±æ€§ | ç±»çš„åˆå§‹åŒ–æ–¹æ³•ï¼Œåˆ›å»ºå®ä¾‹æ—¶è‡ªåŠ¨è°ƒç”¨ï¼Œ`self`è¡¨ç¤ºå®ä¾‹æœ¬èº« | â­â­â­â­â­ |
| **self** | å®ä¾‹å¼•ç”¨ï¼Œè®¿é—®Agentçš„çŠ¶æ€å’Œæ–¹æ³•ï¼Œå¦‚`self.history`å­˜å‚¨å¯¹è¯å†å² | ç±»æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼ŒæŒ‡å‘å½“å‰å®ä¾‹ï¼Œçº¦å®šä¿—æˆå‘½åä¸ºself | â­â­â­â­â­ |
| **Exception** | å¤„ç†APIè°ƒç”¨å¤±è´¥ã€æ¨¡å‹è¶…æ—¶ã€å‚æ•°é”™è¯¯ç­‰å¼‚å¸¸æƒ…å†µã€‚ç”Ÿäº§ç¯å¢ƒå¿…å¤‡çš„å®¹é”™æœºåˆ¶ | å¼‚å¸¸åŸºç±»ï¼Œé€šè¿‡`try-except`æ•è·å’Œå¤„ç†é”™è¯¯ï¼Œ`raise`ä¸»åŠ¨æŠ›å‡ºå¼‚å¸¸ | â­â­â­â­â­ |
| **try-except** | æ•è·LLMè°ƒç”¨å¤±è´¥ã€ç½‘ç»œè¶…æ—¶ç­‰å¼‚å¸¸ï¼Œå®ç°é‡è¯•ã€é™çº§ã€æ—¥å¿—è®°å½•ç­‰å®¹é”™ç­–ç•¥ | å¼‚å¸¸å¤„ç†è¯­æ³•ï¼Œtryå—æ‰§è¡Œå¯èƒ½å‡ºé”™çš„ä»£ç ï¼Œexceptå—å¤„ç†ç‰¹å®šå¼‚å¸¸ | â­â­â­â­â­ |
| **JSON** | åºåˆ—åŒ–AgentçŠ¶æ€ã€å¯¹è¯å†å²ã€é…ç½®å‚æ•°ï¼ŒæŒä¹…åŒ–åˆ°æ–‡ä»¶æˆ–æ•°æ®åº“ | è½»é‡çº§æ•°æ®äº¤æ¢æ ¼å¼ï¼Œ`json.dumps()`åºåˆ—åŒ–ï¼Œ`json.loads()`ååºåˆ—åŒ– | â­â­â­â­â­ |
| **.env** | å­˜å‚¨API Keyã€æ•°æ®åº“å¯†ç ç­‰æ•æ„Ÿé…ç½®ï¼Œé¿å…ç¡¬ç¼–ç å’Œæ³„éœ²ã€‚ç”Ÿäº§éƒ¨ç½²çš„å®‰å…¨å®è·µ | ç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶ï¼Œé€šè¿‡`python-dotenv`åº“åŠ è½½ï¼Œæ ¼å¼ä¸º`KEY=VALUE` | â­â­â­â­â­ |
| **Inheritance** | ç»§æ‰¿åŸºç¡€Agentç±»ï¼Œæ‰©å±•ä¸“ç”¨åŠŸèƒ½ï¼ˆå¦‚WeatherAgentã€BookingAgentï¼‰ã€‚ä»£ç å¤ç”¨çš„æ ¸å¿ƒæœºåˆ¶ | å­ç±»ç»§æ‰¿çˆ¶ç±»çš„å±æ€§å’Œæ–¹æ³•ï¼Œé€šè¿‡`class Child(Parent)`è¯­æ³•å®ç° | â­â­â­â­ |
| **Property** | ç”¨`@property`è£…é¥°å™¨åˆ›å»ºåªè¯»å±æ€§ï¼ˆå¦‚tokenè®¡æ•°ï¼‰ï¼Œä¿æŠ¤å†…éƒ¨çŠ¶æ€ä¸è¢«æ„å¤–ä¿®æ”¹ | å°†æ–¹æ³•è½¬æ¢ä¸ºå±æ€§è®¿é—®ï¼Œæ”¯æŒ`@setter`å®šä¹‰èµ‹å€¼è¡Œä¸ºï¼Œå¢å¼ºå°è£…æ€§ | â­â­â­ |
| **with** | ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼Œè‡ªåŠ¨å…³é—­æ–‡ä»¶ã€æ•°æ®åº“è¿æ¥ç­‰èµ„æºã€‚é¿å…èµ„æºæ³„éœ²çš„æœ€ä½³å®è·µ | `with`è¯­å¥ä¿è¯èµ„æºæ­£ç¡®é‡Šæ”¾ï¼Œå¸¸ç”¨äºæ–‡ä»¶æ“ä½œ`with open(...) as f` | â­â­â­â­ |

---

## 1. é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼šè®¾è®¡ä½ çš„ Agent

### 1.1 ç±»ä¸å¯¹è±¡ï¼šAgent çš„è“å›¾

åœ¨ LangGraph ä¸­ï¼Œè™½ç„¶ä½¿ç”¨å‡½æ•°å¼ç¼–ç¨‹å®šä¹‰èŠ‚ç‚¹ï¼Œä½†ç†è§£ OOP å¯¹äºè®¾è®¡å¤æ‚ Agent ç³»ç»Ÿè‡³å…³é‡è¦ã€‚

```python
# ä»£ç ç¤ºä¾‹ï¼šåˆ›å»ºä¸€ä¸ªç®€å•çš„ ChatBot ç±»
class ChatBot:
    """åŸºç¡€èŠå¤©æœºå™¨äºº"""

    def __init__(self, name, model="gpt-5", temperature=0.7):
        """åˆå§‹åŒ–æ–¹æ³•

        Args:
            name: æœºå™¨äººåç§°
            model: ä½¿ç”¨çš„æ¨¡å‹
            temperature: æ¸©åº¦å‚æ•°
        """
        self.name = name
        self.model = model
        self.temperature = temperature
        self.conversation_history = []
        self.message_count = 0

    def add_message(self, role, content):
        """æ·»åŠ æ¶ˆæ¯åˆ°å†å²"""
        message = {
            "role": role,
            "content": content,
            "index": self.message_count
        }
        self.conversation_history.append(message)
        self.message_count += 1

    def chat(self, user_message):
        """å¤„ç†ç”¨æˆ·æ¶ˆæ¯"""
        # æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
        self.add_message("user", user_message)

        # ç”Ÿæˆå›å¤ï¼ˆç®€åŒ–ç‰ˆï¼‰
        reply = f"[{self.name}] æ”¶åˆ°: {user_message}"
        self.add_message("assistant", reply)

        return reply

    def get_history(self):
        """è·å–å¯¹è¯å†å²"""
        return self.conversation_history

    def clear_history(self):
        """æ¸…ç©ºå†å²"""
        self.conversation_history = []
        self.message_count = 0
        print(f"âœ… å·²æ¸…ç©º {self.name} çš„å¯¹è¯å†å²")

    def __str__(self):
        """å­—ç¬¦ä¸²è¡¨ç¤º"""
        return f"ChatBot(name={self.name}, model={self.model}, messages={self.message_count})"

    def __repr__(self):
        """å¼€å‘è€…è¡¨ç¤º"""
        return f"ChatBot('{self.name}', '{self.model}', temp={self.temperature})"


# ===== ä½¿ç”¨ç¤ºä¾‹ =====

# åˆ›å»ºæœºå™¨äººå®ä¾‹
bot = ChatBot(name="å°åŠ©æ‰‹", model="gpt-5", temperature=0.7)
print(bot)

# å¯¹è¯
bot.chat("ä½ å¥½")
bot.chat("ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ")

# æŸ¥çœ‹å†å²
print(f"\nå¯¹è¯å†å²ï¼ˆå…± {bot.message_count} æ¡ï¼‰:")
for msg in bot.get_history():
    role_icon = "ğŸ‘¤" if msg["role"] == "user" else "ğŸ¤–"
    print(f"  [{msg['index']}] {role_icon} {msg['content']}")

# æ¸…ç©ºå†å²
bot.clear_history()
print(f"\næ¸…ç©ºå: {bot}")
```

**è¿è¡Œç»“æœï¼š**
```
ChatBot(name=å°åŠ©æ‰‹, model=gpt-5, messages=0)

å¯¹è¯å†å²ï¼ˆå…± 4 æ¡ï¼‰:
  [0] ğŸ‘¤ ä½ å¥½
  [1] ğŸ¤– [å°åŠ©æ‰‹] æ”¶åˆ°: ä½ å¥½
  [2] ğŸ‘¤ ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ
  [3] ğŸ¤– [å°åŠ©æ‰‹] æ”¶åˆ°: ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ

âœ… å·²æ¸…ç©º å°åŠ©æ‰‹ çš„å¯¹è¯å†å²

æ¸…ç©ºå: ChatBot(name=å°åŠ©æ‰‹, model=5, messages=0)
```

### 1.2 ç»§æ‰¿ï¼šæ‰©å±• Agent åŠŸèƒ½

```python
# ä»£ç ç¤ºä¾‹ï¼šåˆ›å»ºå¢å¼ºç‰ˆ ChatBot
class AdvancedChatBot(ChatBot):
    """å¢å¼ºç‰ˆèŠå¤©æœºå™¨äººï¼Œæ”¯æŒæ„å›¾åˆ†ç±»"""

    def __init__(self, name, model="gpt-5", temperature=0.7, enable_intent=True):
        # è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°
        super().__init__(name, model, temperature)
        self.enable_intent = enable_intent
        self.intent_history = []

    def classify_intent(self, message):
        """ç®€å•çš„æ„å›¾åˆ†ç±»"""
        message_lower = message.lower()

        if any(kw in message_lower for kw in ["å¤©æ°”", "æ¸©åº¦", "ä¸‹é›¨"]):
            return "weather"
        elif any(kw in message_lower for kw in ["é¢„è®¢", "è®¢ç¥¨", "é¢„çº¦"]):
            return "booking"
        elif any(kw in message_lower for kw in ["ä½ å¥½", "hi", "hello"]):
            return "greeting"
        else:
            return "general"

    def chat(self, user_message):
        """é‡å†™çˆ¶ç±»æ–¹æ³•ï¼Œæ·»åŠ æ„å›¾åˆ†ç±»"""
        # æ„å›¾åˆ†ç±»
        if self.enable_intent:
            intent = self.classify_intent(user_message)
            self.intent_history.append(intent)
            print(f"ğŸ¯ è¯†åˆ«æ„å›¾: {intent}")

        # è°ƒç”¨çˆ¶ç±»æ–¹æ³•
        reply = super().chat(user_message)
        return reply

    def get_intent_stats(self):
        """è·å–æ„å›¾ç»Ÿè®¡"""
        stats = {}
        for intent in self.intent_history:
            stats[intent] = stats.get(intent, 0) + 1
        return stats

    def __str__(self):
        """é‡å†™å­—ç¬¦ä¸²è¡¨ç¤º"""
        base = super().__str__()
        return f"{base}, intents={len(self.intent_history)}"


# ===== ä½¿ç”¨ç¤ºä¾‹ =====

# åˆ›å»ºå¢å¼ºç‰ˆæœºå™¨äºº
advanced_bot = AdvancedChatBot(name="æ™ºèƒ½åŠ©æ‰‹", enable_intent=True)

# æµ‹è¯•å¯¹è¯
test_messages = [
    "ä½ å¥½ï¼",
    "ä»Šå¤©åŒ—äº¬å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ",
    "å¸®æˆ‘é¢„è®¢æ˜å¤©çš„æœºç¥¨",
    "éšä¾¿èŠèŠ"
]

print("=== å¯¹è¯æµ‹è¯• ===")
for msg in test_messages:
    print(f"\nğŸ‘¤ {msg}")
    reply = advanced_bot.chat(msg)

# æ„å›¾ç»Ÿè®¡
print("\n\n=== æ„å›¾ç»Ÿè®¡ ===")
stats = advanced_bot.get_intent_stats()
for intent, count in sorted(stats.items(), key=lambda x: x[1], reverse=True):
    print(f"  {intent}: {count} æ¬¡")

print(f"\n{advanced_bot}")
```

**è¿è¡Œç»“æœï¼š**
```
=== å¯¹è¯æµ‹è¯• ===

ğŸ‘¤ ä½ å¥½ï¼
ğŸ¯ è¯†åˆ«æ„å›¾: greeting

ğŸ‘¤ ä»Šå¤©åŒ—äº¬å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ
ğŸ¯ è¯†åˆ«æ„å›¾: weather

ğŸ‘¤ å¸®æˆ‘é¢„è®¢æ˜å¤©çš„æœºç¥¨
ğŸ¯ è¯†åˆ«æ„å›¾: booking

ğŸ‘¤ éšä¾¿èŠèŠ
ğŸ¯ è¯†åˆ«æ„å›¾: general


=== æ„å›¾ç»Ÿè®¡ ===
  greeting: 1 æ¬¡
  weather: 1 æ¬¡
  booking: 1 æ¬¡
  general: 1 æ¬¡

ChatBot(name=æ™ºèƒ½åŠ©æ‰‹, model=gpt-5, messages=8), intents=4
```

### 1.3 å°è£…ä¸å±æ€§ï¼šä¿æŠ¤ Agent çŠ¶æ€

```python
# ä»£ç ç¤ºä¾‹ï¼šä½¿ç”¨å±æ€§ä¿æŠ¤æ•æ„Ÿä¿¡æ¯
class SecureChatBot:
    """å®‰å…¨çš„èŠå¤©æœºå™¨äººï¼Œä¿æŠ¤ API Key"""

    def __init__(self, name, api_key):
        self.name = name
        self._api_key = api_key  # ç§æœ‰å±æ€§ï¼ˆçº¦å®šï¼‰
        self._call_count = 0

    @property
    def api_key(self):
        """API Key çš„ getterï¼ˆéšè—éƒ¨åˆ†å†…å®¹ï¼‰"""
        if self._api_key:
            return f"{self._api_key[:8]}...{self._api_key[-4:]}"
        return None

    @api_key.setter
    def api_key(self, value):
        """API Key çš„ setterï¼ˆéªŒè¯æ ¼å¼ï¼‰"""
        if not value or len(value) < 20:
            raise ValueError("API Key æ ¼å¼æ— æ•ˆ")
        self._api_key = value
        print("âœ… API Key å·²æ›´æ–°")

    @property
    def call_count(self):
        """åªè¯»å±æ€§"""
        return self._call_count

    def make_api_call(self):
        """æ¨¡æ‹Ÿ API è°ƒç”¨"""
        self._call_count += 1
        return f"ä½¿ç”¨ API Key {self.api_key} è°ƒç”¨æˆåŠŸï¼ˆç¬¬ {self._call_count} æ¬¡ï¼‰"

    def __str__(self):
        return f"SecureChatBot(name={self.name}, calls={self.call_count})"


# ===== ä½¿ç”¨ç¤ºä¾‹ =====

# åˆ›å»ºå®‰å…¨æœºå™¨äºº
bot = SecureChatBot(
    name="å®‰å…¨åŠ©æ‰‹",
    api_key="sk-1234567890abcdefghijklmnopqrstuvwxyz"
)

# æŸ¥çœ‹ API Keyï¼ˆè‡ªåŠ¨éšè—ï¼‰
print(f"API Key: {bot.api_key}")

# è¿›è¡Œ API è°ƒç”¨
print(bot.make_api_call())
print(bot.make_api_call())

# å°è¯•ç›´æ¥ä¿®æ”¹ call_countï¼ˆå¤±è´¥ï¼‰
try:
    bot.call_count = 100
except AttributeError as e:
    print(f"\nâŒ æ— æ³•ç›´æ¥ä¿®æ”¹: {e}")

# æ›´æ–° API Key
bot.api_key = "sk-newkey1234567890abcdefghijklmnopqrstuvwxyz"
print(f"æ–° API Key: {bot.api_key}")

# æ— æ•ˆçš„ API Key
try:
    bot.api_key = "short"
except ValueError as e:
    print(f"âŒ {e}")

print(f"\n{bot}")
```

**è¿è¡Œç»“æœï¼š**
```
API Key: sk-12345...wxyz
ä½¿ç”¨ API Key sk-12345...wxyz è°ƒç”¨æˆåŠŸï¼ˆç¬¬ 1 æ¬¡ï¼‰
ä½¿ç”¨ API Key sk-12345...wxyz è°ƒç”¨æˆåŠŸï¼ˆç¬¬ 2 æ¬¡ï¼‰

âŒ æ— æ³•ç›´æ¥ä¿®æ”¹: can't set attribute

âœ… API Key å·²æ›´æ–°
æ–° API Key: sk-newke...wxyz
âŒ API Key æ ¼å¼æ— æ•ˆ

SecureChatBot(name=å®‰å…¨åŠ©æ‰‹, calls=2)
```

---

## 2. å¼‚å¸¸å¤„ç†ï¼šä¼˜é›…åœ°å¤„ç†é”™è¯¯

### 2.1 åŸºç¡€å¼‚å¸¸å¤„ç†

```python
# ä»£ç ç¤ºä¾‹ï¼šAPI è°ƒç”¨çš„å®¹é”™å¤„ç†
def call_external_api(endpoint, retries=3):
    """è°ƒç”¨å¤–éƒ¨ APIï¼ˆæ¨¡æ‹Ÿï¼‰

    Args:
        endpoint: API ç«¯ç‚¹
        retries: é‡è¯•æ¬¡æ•°

    Returns:
        API å“åº”æˆ– None
    """
    import random

    for attempt in range(1, retries + 1):
        try:
            print(f"å°è¯• #{attempt}: è°ƒç”¨ {endpoint}")

            # æ¨¡æ‹Ÿéšæœºå¤±è´¥
            if random.random() < 0.6:
                raise ConnectionError("ç½‘ç»œè¿æ¥å¤±è´¥")

            # æ¨¡æ‹ŸæˆåŠŸ
            response = {"status": "success", "data": "å¤©æ°”æ•°æ®"}
            print(f"  âœ… æˆåŠŸ!")
            return response

        except ConnectionError as e:
            print(f"  âŒ è¿æ¥é”™è¯¯: {e}")
            if attempt == retries:
                print(f"  âš ï¸ è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°")
                return None
        except Exception as e:
            print(f"  âŒ æœªçŸ¥é”™è¯¯: {e}")
            return None

    return None


# ===== ä½¿ç”¨ç¤ºä¾‹ =====

result = call_external_api("/api/weather", retries=3)
if result:
    print(f"\næœ€ç»ˆç»“æœ: {result}")
else:
    print("\næœ€ç»ˆç»“æœ: API è°ƒç”¨å¤±è´¥")
```

**è¿è¡Œç»“æœï¼š**
```
å°è¯• #1: è°ƒç”¨ /api/weather
  âŒ è¿æ¥é”™è¯¯: ç½‘ç»œè¿æ¥å¤±è´¥
å°è¯• #2: è°ƒç”¨ /api/weather
  âœ… æˆåŠŸ!

æœ€ç»ˆç»“æœ: {'status': 'success', 'data': 'å¤©æ°”æ•°æ®'}
```

### 2.2 è‡ªå®šä¹‰å¼‚å¸¸ï¼šAgent ç‰¹å®šé”™è¯¯

```python
# ä»£ç ç¤ºä¾‹ï¼šå®šä¹‰ Agent ä¸“ç”¨å¼‚å¸¸
class AgentError(Exception):
    """Agent åŸºç¡€å¼‚å¸¸"""
    pass

class InvalidStateError(AgentError):
    """çŠ¶æ€æ— æ•ˆå¼‚å¸¸"""
    pass

class ToolExecutionError(AgentError):
    """å·¥å…·æ‰§è¡Œå¼‚å¸¸"""
    def __init__(self, tool_name, reason):
        self.tool_name = tool_name
        self.reason = reason
        super().__init__(f"å·¥å…· '{tool_name}' æ‰§è¡Œå¤±è´¥: {reason}")

class MessageLimitError(AgentError):
    """æ¶ˆæ¯é•¿åº¦è¶…é™å¼‚å¸¸"""
    def __init__(self, actual, limit):
        self.actual = actual
        self.limit = limit
        super().__init__(f"æ¶ˆæ¯é•¿åº¦ {actual} è¶…è¿‡é™åˆ¶ {limit}")


def execute_tool(tool_name, params):
    """æ‰§è¡Œå·¥å…·ï¼ˆæ¨¡æ‹Ÿï¼‰"""
    valid_tools = ["weather", "calculator", "search"]

    if tool_name not in valid_tools:
        raise ToolExecutionError(tool_name, "å·¥å…·ä¸å­˜åœ¨")

    if not params:
        raise ToolExecutionError(tool_name, "å‚æ•°ä¸ºç©º")

    return f"{tool_name} æ‰§è¡ŒæˆåŠŸ: {params}"


def validate_message(message, max_length=100):
    """éªŒè¯æ¶ˆæ¯é•¿åº¦"""
    if len(message) > max_length:
        raise MessageLimitError(len(message), max_length)
    return True


# ===== ä½¿ç”¨ç¤ºä¾‹ =====

print("=== å·¥å…·æ‰§è¡Œæµ‹è¯• ===")

# æˆåŠŸæ¡ˆä¾‹
try:
    result = execute_tool("weather", {"city": "åŒ—äº¬"})
    print(f"âœ… {result}")
except ToolExecutionError as e:
    print(f"âŒ {e}")

# å·¥å…·ä¸å­˜åœ¨
try:
    result = execute_tool("unknown_tool", {"param": "value"})
except ToolExecutionError as e:
    print(f"âŒ {e}")
    print(f"   å·¥å…·å: {e.tool_name}")
    print(f"   åŸå› : {e.reason}")

# å‚æ•°ä¸ºç©º
try:
    result = execute_tool("calculator", None)
except ToolExecutionError as e:
    print(f"âŒ {e}")

print("\n=== æ¶ˆæ¯éªŒè¯æµ‹è¯• ===")

# æ­£å¸¸æ¶ˆæ¯
try:
    validate_message("è¿™æ˜¯ä¸€æ¡æ­£å¸¸çš„æ¶ˆæ¯")
    print("âœ… æ¶ˆæ¯éªŒè¯é€šè¿‡")
except MessageLimitError as e:
    print(f"âŒ {e}")

# è¶…é•¿æ¶ˆæ¯
try:
    long_message = "x" * 150
    validate_message(long_message, max_length=100)
except MessageLimitError as e:
    print(f"âŒ {e}")
    print(f"   å®é™…é•¿åº¦: {e.actual}")
    print(f"   é™åˆ¶é•¿åº¦: {e.limit}")
```

**è¿è¡Œç»“æœï¼š**
```
=== å·¥å…·æ‰§è¡Œæµ‹è¯• ===
âœ… weather æ‰§è¡ŒæˆåŠŸ: {'city': 'åŒ—äº¬'}
âŒ å·¥å…· 'unknown_tool' æ‰§è¡Œå¤±è´¥: å·¥å…·ä¸å­˜åœ¨
   å·¥å…·å: unknown_tool
   åŸå› : å·¥å…·ä¸å­˜åœ¨
âŒ å·¥å…· 'calculator' æ‰§è¡Œå¤±è´¥: å‚æ•°ä¸ºç©º

=== æ¶ˆæ¯éªŒè¯æµ‹è¯• ===
âœ… æ¶ˆæ¯éªŒè¯é€šè¿‡
âŒ æ¶ˆæ¯é•¿åº¦ 150 è¶…è¿‡é™åˆ¶ 100
   å®é™…é•¿åº¦: 150
   é™åˆ¶é•¿åº¦: 100
```

### 2.3 ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼šèµ„æºç®¡ç†

```python
# ä»£ç ç¤ºä¾‹ï¼šè‡ªå®šä¹‰ä¸Šä¸‹æ–‡ç®¡ç†å™¨
class ConversationSession:
    """å¯¹è¯ä¼šè¯ç®¡ç†å™¨"""

    def __init__(self, session_id, auto_save=True):
        self.session_id = session_id
        self.auto_save = auto_save
        self.messages = []
        self.start_time = None

    def __enter__(self):
        """è¿›å…¥ä¸Šä¸‹æ–‡"""
        from datetime import datetime
        self.start_time = datetime.now()
        print(f"ğŸ“‚ å¼€å§‹ä¼šè¯: {self.session_id}")
        return self

    def __exit__(self, exc_type, exc_val, exc_tb):
        """é€€å‡ºä¸Šä¸‹æ–‡"""
        from datetime import datetime
        end_time = datetime.now()
        duration = (end_time - self.start_time).total_seconds()

        print(f"\nğŸ“‚ ç»“æŸä¼šè¯: {self.session_id}")
        print(f"   æŒç»­æ—¶é—´: {duration:.2f} ç§’")
        print(f"   æ¶ˆæ¯æ•°é‡: {len(self.messages)}")

        if self.auto_save:
            self.save()

        # å¤„ç†å¼‚å¸¸
        if exc_type is not None:
            print(f"   âš ï¸ å‘ç”Ÿé”™è¯¯: {exc_val}")
            return False  # ä¸æŠ‘åˆ¶å¼‚å¸¸

        return True

    def add_message(self, role, content):
        """æ·»åŠ æ¶ˆæ¯"""
        self.messages.append({"role": role, "content": content})

    def save(self):
        """ä¿å­˜ä¼šè¯"""
        print(f"   ğŸ’¾ ä¿å­˜ä¼šè¯åˆ°æ–‡ä»¶: {self.session_id}.json")


# ===== ä½¿ç”¨ç¤ºä¾‹ =====

# æ­£å¸¸ä½¿ç”¨
print("=== æ­£å¸¸ä¼šè¯ ===")
with ConversationSession("session_001") as session:
    session.add_message("user", "ä½ å¥½")
    session.add_message("assistant", "ä½ å¥½ï¼æœ‰ä»€ä¹ˆå¯ä»¥å¸®ä½ çš„ï¼Ÿ")
    session.add_message("user", "ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ")

# å¼‚å¸¸å¤„ç†
print("\n\n=== å¼‚å¸¸ä¼šè¯ ===")
try:
    with ConversationSession("session_002") as session:
        session.add_message("user", "æ¶ˆæ¯1")
        raise ValueError("æ¨¡æ‹Ÿé”™è¯¯")
        session.add_message("user", "æ¶ˆæ¯2")  # ä¸ä¼šæ‰§è¡Œ
except ValueError as e:
    print(f"âœ… å¼‚å¸¸å·²æ•è·: {e}")
```

**è¿è¡Œç»“æœï¼š**
```
=== æ­£å¸¸ä¼šè¯ ===
ğŸ“‚ å¼€å§‹ä¼šè¯: session_001

ğŸ“‚ ç»“æŸä¼šè¯: session_001
   æŒç»­æ—¶é—´: 0.00 ç§’
   æ¶ˆæ¯æ•°é‡: 3
   ğŸ’¾ ä¿å­˜ä¼šè¯åˆ°æ–‡ä»¶: session_001.json


=== å¼‚å¸¸ä¼šè¯ ===
ğŸ“‚ å¼€å§‹ä¼šè¯: session_002

ğŸ“‚ ç»“æŸä¼šè¯: session_002
   æŒç»­æ—¶é—´: 0.00 ç§’
   æ¶ˆæ¯æ•°é‡: 1
   âš ï¸ å‘ç”Ÿé”™è¯¯: æ¨¡æ‹Ÿé”™è¯¯
   ğŸ’¾ ä¿å­˜ä¼šè¯åˆ°æ–‡ä»¶: session_002.json
âœ… å¼‚å¸¸å·²æ•è·: æ¨¡æ‹Ÿé”™è¯¯
```

---

## 3. æ–‡ä»¶æ“ä½œï¼šæŒä¹…åŒ– Agent æ•°æ®

### 3.1 JSON æ–‡ä»¶ï¼šä¿å­˜å¯¹è¯å†å²

```python
# ä»£ç ç¤ºä¾‹ï¼šå¯¹è¯å†å²çš„ä¿å­˜ä¸åŠ è½½
import json
from datetime import datetime

class ConversationManager:
    """å¯¹è¯ç®¡ç†å™¨"""

    def __init__(self):
        self.conversations = {}

    def create_conversation(self, conv_id):
        """åˆ›å»ºæ–°å¯¹è¯"""
        self.conversations[conv_id] = {
            "id": conv_id,
            "created_at": datetime.now().isoformat(),
            "messages": [],
            "metadata": {}
        }
        return self.conversations[conv_id]

    def add_message(self, conv_id, role, content):
        """æ·»åŠ æ¶ˆæ¯"""
        if conv_id not in self.conversations:
            self.create_conversation(conv_id)

        message = {
            "role": role,
            "content": content,
            "timestamp": datetime.now().isoformat()
        }
        self.conversations[conv_id]["messages"].append(message)

    def save_to_file(self, conv_id, filename):
        """ä¿å­˜å¯¹è¯åˆ° JSON æ–‡ä»¶"""
        if conv_id not in self.conversations:
            raise ValueError(f"å¯¹è¯ {conv_id} ä¸å­˜åœ¨")

        with open(filename, "w", encoding="utf-8") as f:
            json.dump(
                self.conversations[conv_id],
                f,
                ensure_ascii=False,
                indent=2
            )
        print(f"âœ… å¯¹è¯å·²ä¿å­˜åˆ°: {filename}")

    def load_from_file(self, filename):
        """ä» JSON æ–‡ä»¶åŠ è½½å¯¹è¯"""
        with open(filename, "r", encoding="utf-8") as f:
            data = json.load(f)

        conv_id = data["id"]
        self.conversations[conv_id] = data
        print(f"âœ… å·²åŠ è½½å¯¹è¯: {conv_id}")
        return conv_id

    def export_all(self, filename):
        """å¯¼å‡ºæ‰€æœ‰å¯¹è¯"""
        with open(filename, "w", encoding="utf-8") as f:
            json.dump(
                self.conversations,
                f,
                ensure_ascii=False,
                indent=2
            )
        print(f"âœ… æ‰€æœ‰å¯¹è¯å·²å¯¼å‡ºåˆ°: {filename}")


# ===== ä½¿ç”¨ç¤ºä¾‹ =====

manager = ConversationManager()

# åˆ›å»ºå¯¹è¯
manager.create_conversation("conv_001")
manager.add_message("conv_001", "user", "ä½ å¥½")
manager.add_message("conv_001", "assistant", "ä½ å¥½ï¼æœ‰ä»€ä¹ˆå¯ä»¥å¸®ä½ çš„ï¼Ÿ")
manager.add_message("conv_001", "user", "ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ")

# ä¿å­˜å•ä¸ªå¯¹è¯
manager.save_to_file("conv_001", "conversation_001.json")

# åˆ›å»ºç¬¬äºŒä¸ªå¯¹è¯
manager.create_conversation("conv_002")
manager.add_message("conv_002", "user", "å¸®æˆ‘é¢„è®¢æœºç¥¨")
manager.add_message("conv_002", "assistant", "å¥½çš„ï¼Œè¯·é—®æ˜¯å“ªä¸ªåŸå¸‚ï¼Ÿ")

# å¯¼å‡ºæ‰€æœ‰å¯¹è¯
manager.export_all("all_conversations.json")

# åŠ è½½å¯¹è¯
print("\n=== åŠ è½½æµ‹è¯• ===")
new_manager = ConversationManager()
loaded_id = new_manager.load_from_file("conversation_001.json")

conv = new_manager.conversations[loaded_id]
print(f"å¯¹è¯ID: {conv['id']}")
print(f"åˆ›å»ºæ—¶é—´: {conv['created_at']}")
print(f"æ¶ˆæ¯æ•°é‡: {len(conv['messages'])}")
print("\næ¶ˆæ¯å†…å®¹:")
for msg in conv['messages']:
    role_icon = "ğŸ‘¤" if msg["role"] == "user" else "ğŸ¤–"
    print(f"  {role_icon} {msg['content']}")
```

**è¿è¡Œç»“æœï¼š**
```
âœ… å¯¹è¯å·²ä¿å­˜åˆ°: conversation_001.json
âœ… æ‰€æœ‰å¯¹è¯å·²å¯¼å‡ºåˆ°: all_conversations.json

=== åŠ è½½æµ‹è¯• ===
âœ… å·²åŠ è½½å¯¹è¯: conv_001
å¯¹è¯ID: conv_001
åˆ›å»ºæ—¶é—´: 2024-10-27T10:00:00.000000
æ¶ˆæ¯æ•°é‡: 3

æ¶ˆæ¯å†…å®¹:
  ğŸ‘¤ ä½ å¥½
  ğŸ¤– ä½ å¥½ï¼æœ‰ä»€ä¹ˆå¯ä»¥å¸®ä½ çš„ï¼Ÿ
  ğŸ‘¤ ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ
```

### 3.2 æ–‡æœ¬æ–‡ä»¶ï¼šæ—¥å¿—è®°å½•

```python
# ä»£ç ç¤ºä¾‹ï¼šAgent æ—¥å¿—ç³»ç»Ÿ
from datetime import datetime

class AgentLogger:
    """Agent æ—¥å¿—è®°å½•å™¨"""

    def __init__(self, log_file="agent.log"):
        self.log_file = log_file

    def _format_log(self, level, message):
        """æ ¼å¼åŒ–æ—¥å¿—"""
        timestamp = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
        return f"[{timestamp}] [{level}] {message}\n"

    def info(self, message):
        """è®°å½•ä¿¡æ¯"""
        self._write(self._format_log("INFO", message))

    def warning(self, message):
        """è®°å½•è­¦å‘Š"""
        self._write(self._format_log("WARNING", message))

    def error(self, message):
        """è®°å½•é”™è¯¯"""
        self._write(self._format_log("ERROR", message))

    def _write(self, log_entry):
        """å†™å…¥æ—¥å¿—æ–‡ä»¶"""
        with open(self.log_file, "a", encoding="utf-8") as f:
            f.write(log_entry)
        print(log_entry.strip())

    def read_logs(self, lines=10):
        """è¯»å–æœ€è¿‘çš„æ—¥å¿—"""
        try:
            with open(self.log_file, "r", encoding="utf-8") as f:
                all_lines = f.readlines()
                return all_lines[-lines:] if lines else all_lines
        except FileNotFoundError:
            return []


# ===== ä½¿ç”¨ç¤ºä¾‹ =====

logger = AgentLogger("agent_demo.log")

# è®°å½•ä¸åŒçº§åˆ«çš„æ—¥å¿—
logger.info("Agent å¯åŠ¨")
logger.info("åŠ è½½é…ç½®æ–‡ä»¶")
logger.warning("API Key æœªè®¾ç½®ï¼Œä½¿ç”¨é»˜è®¤å€¼")
logger.info("å¼€å§‹å¤„ç†ç”¨æˆ·æ¶ˆæ¯")
logger.error("å·¥å…·è°ƒç”¨å¤±è´¥: connection timeout")
logger.info("Agent åœæ­¢")

# è¯»å–æ—¥å¿—
print("\n=== æœ€è¿‘ 3 æ¡æ—¥å¿— ===")
recent_logs = logger.read_logs(lines=3)
for log in recent_logs:
    print(log.strip())
```

**è¿è¡Œç»“æœï¼š**
```
[2024-10-27 10:00:00] [INFO] Agent å¯åŠ¨
[2024-10-27 10:00:00] [INFO] åŠ è½½é…ç½®æ–‡ä»¶
[2024-10-27 10:00:00] [WARNING] API Key æœªè®¾ç½®ï¼Œä½¿ç”¨é»˜è®¤å€¼
[2024-10-27 10:00:00] [INFO] å¼€å§‹å¤„ç†ç”¨æˆ·æ¶ˆæ¯
[2024-10-27 10:00:00] [ERROR] å·¥å…·è°ƒç”¨å¤±è´¥: connection timeout
[2024-10-27 10:00:00] [INFO] Agent åœæ­¢

=== æœ€è¿‘ 3 æ¡æ—¥å¿— ===
[2024-10-27 10:00:00] [ERROR] å·¥å…·è°ƒç”¨å¤±è´¥: connection timeout
[2024-10-27 10:00:00] [INFO] Agent åœæ­¢
```

---

## 4. ç¯å¢ƒé…ç½®ï¼šç®¡ç† API Key å’Œæ•æ„Ÿä¿¡æ¯

### 4.1 ä½¿ç”¨ .env æ–‡ä»¶

```python
# ä»£ç ç¤ºä¾‹ï¼šç¯å¢ƒå˜é‡ç®¡ç†
import os

# æ–¹æ³•1ï¼šç›´æ¥ä½¿ç”¨ os.environï¼ˆä¸æ¨èï¼‰
# os.environ["OPENAI_API_KEY"] = "sk-..."  # ç¡¬ç¼–ç ï¼Œä¸å®‰å…¨

# æ–¹æ³•2ï¼šä» .env æ–‡ä»¶åŠ è½½ï¼ˆæ¨èï¼‰
def load_env_file(filename=".env"):
    """æ‰‹åŠ¨åŠ è½½ .env æ–‡ä»¶"""
    if not os.path.exists(filename):
        print(f"âš ï¸ {filename} æ–‡ä»¶ä¸å­˜åœ¨")
        return

    with open(filename, "r", encoding="utf-8") as f:
        for line in f:
            line = line.strip()
            if line and not line.startswith("#"):
                key, value = line.split("=", 1)
                os.environ[key.strip()] = value.strip()
    print(f"âœ… å·²åŠ è½½ç¯å¢ƒå˜é‡ä» {filename}")


# åˆ›å»ºç¤ºä¾‹ .env æ–‡ä»¶
env_content = """# API Keys
OPENAI_API_KEY=sk-1234567890abcdef
ANTHROPIC_API_KEY=sk-ant-9876543210

# Configuration
MODEL_NAME=gpt-5
TEMPERATURE=0.7
MAX_TOKENS=1000
"""

with open("example.env", "w", encoding="utf-8") as f:
    f.write(env_content)

# åŠ è½½ç¯å¢ƒå˜é‡
load_env_file("example.env")

# è¯»å–ç¯å¢ƒå˜é‡
openai_key = os.getenv("OPENAI_API_KEY", "NOT_SET")
model = os.getenv("MODEL_NAME", "gpt-5")
temp = float(os.getenv("TEMPERATURE", "0.7"))

print("\n=== ç¯å¢ƒé…ç½® ===")
print(f"OpenAI Key: {openai_key[:10]}...{openai_key[-4:]}")
print(f"Model: {model}")
print(f"Temperature: {temp}")

# æ£€æŸ¥å¿…éœ€çš„ç¯å¢ƒå˜é‡
required_vars = ["OPENAI_API_KEY", "ANTHROPIC_API_KEY"]
missing = [var for var in required_vars if not os.getenv(var)]

if missing:
    print(f"\nâš ï¸ ç¼ºå°‘ç¯å¢ƒå˜é‡: {missing}")
else:
    print(f"\nâœ… æ‰€æœ‰å¿…éœ€ç¯å¢ƒå˜é‡å·²è®¾ç½®")
```

**è¿è¡Œç»“æœï¼š**
```
âœ… å·²åŠ è½½ç¯å¢ƒå˜é‡ä» example.env

=== ç¯å¢ƒé…ç½® ===
OpenAI Key: sk-1234567...cdef
Model: gpt-5
Temperature: 0.7

âœ… æ‰€æœ‰å¿…éœ€ç¯å¢ƒå˜é‡å·²è®¾ç½®
```

### 4.2 é…ç½®ç±»ï¼šç»“æ„åŒ–é…ç½®ç®¡ç†

```python
# ä»£ç ç¤ºä¾‹ï¼šä½¿ç”¨ç±»ç®¡ç†é…ç½®
import os
from typing import Optional

class AgentConfig:
    """Agent é…ç½®ç®¡ç†"""

    def __init__(self, config_file: Optional[str] = None):
        # ä»ç¯å¢ƒå˜é‡æˆ–é»˜è®¤å€¼åŠ è½½
        self.openai_api_key = os.getenv("OPENAI_API_KEY")
        self.model = os.getenv("MODEL_NAME", "gpt-5")
        self.temperature = float(os.getenv("TEMPERATURE", "0.7"))
        self.max_tokens = int(os.getenv("MAX_TOKENS", "1000"))
        self.max_retries = int(os.getenv("MAX_RETRIES", "3"))

        if config_file:
            self.load_from_file(config_file)

    def load_from_file(self, filename):
        """ä»æ–‡ä»¶åŠ è½½é…ç½®"""
        import json
        try:
            with open(filename, "r", encoding="utf-8") as f:
                config = json.load(f)

            # æ›´æ–°é…ç½®
            for key, value in config.items():
                if hasattr(self, key):
                    setattr(self, key, value)

            print(f"âœ… å·²ä» {filename} åŠ è½½é…ç½®")
        except FileNotFoundError:
            print(f"âš ï¸ é…ç½®æ–‡ä»¶ {filename} ä¸å­˜åœ¨")

    def validate(self):
        """éªŒè¯é…ç½®"""
        errors = []

        if not self.openai_api_key:
            errors.append("ç¼ºå°‘ OPENAI_API_KEY")

        if not (0 <= self.temperature <= 2):
            errors.append(f"temperature åº”åœ¨ 0-2 ä¹‹é—´ï¼Œå½“å‰: {self.temperature}")

        if self.max_tokens < 1:
            errors.append(f"max_tokens åº”å¤§äº 0ï¼Œå½“å‰: {self.max_tokens}")

        if errors:
            raise ValueError(f"é…ç½®éªŒè¯å¤±è´¥: {errors}")

        print("âœ… é…ç½®éªŒè¯é€šè¿‡")
        return True

    def __repr__(self):
        """å­—ç¬¦ä¸²è¡¨ç¤º"""
        key_preview = f"{self.openai_api_key[:8]}..." if self.openai_api_key else "NOT_SET"
        return f"""AgentConfig(
    openai_api_key={key_preview},
    model={self.model},
    temperature={self.temperature},
    max_tokens={self.max_tokens},
    max_retries={self.max_retries}
)"""


# ===== ä½¿ç”¨ç¤ºä¾‹ =====

# åˆ›å»ºé…ç½®
config = AgentConfig()
print(config)

# éªŒè¯é…ç½®
try:
    config.validate()
except ValueError as e:
    print(f"âŒ {e}")

# åˆ›å»ºé…ç½®æ–‡ä»¶
config_data = {
    "model": "gpt-5",
    "temperature": 0.5,
    "max_tokens": 2000
}

with open("agent_config.json", "w", encoding="utf-8") as f:
    import json
    json.dump(config_data, f, indent=2)

# ä»æ–‡ä»¶åŠ è½½
config2 = AgentConfig("agent_config.json")
print(f"\næ›´æ–°åçš„é…ç½®:\n{config2}")
```

**è¿è¡Œç»“æœï¼š**
```
AgentConfig(
    openai_api_key=sk-12345...,
    model=gpt-5,
    temperature=0.7,
    max_tokens=1000,
    max_retries=3
)
âœ… é…ç½®éªŒè¯é€šè¿‡

âœ… å·²ä» agent_config.json åŠ è½½é…ç½®

æ›´æ–°åçš„é…ç½®:
AgentConfig(
    openai_api_key=sk-12345...,
    model=gpt-5,
    temperature=0.5,
    max_tokens=2000,
    max_retries=3
)
```

---

## 5. Git/GitHubï¼šç‰ˆæœ¬æ§åˆ¶ä¸åä½œ

### 5.1 Git åŸºç¡€å·¥ä½œæµ

```bash
# ===== åˆå§‹åŒ– Git ä»“åº“ =====

# 1. é…ç½® Gitï¼ˆé¦–æ¬¡ä½¿ç”¨ï¼‰
git config --global user.name "ä½ çš„åå­—"
git config --global user.email "your.email@example.com"

# 2. åˆå§‹åŒ–é¡¹ç›®
mkdir my-agent-project
cd my-agent-project
git init

# 3. åˆ›å»ºé¡¹ç›®æ–‡ä»¶
echo "# AI Agent Project" > README.md
echo "*.pyc" > .gitignore
echo "__pycache__/" >> .gitignore
echo ".env" >> .gitignore

# 4. æŸ¥çœ‹çŠ¶æ€
git status

# 5. æ·»åŠ æ–‡ä»¶
git add README.md .gitignore

# 6. æäº¤æ›´æ”¹
git commit -m "Initial commit: Add README and gitignore"

# 7. æŸ¥çœ‹å†å²
git log --oneline
```

**è¿è¡Œç»“æœï¼š**
```bash
Initialized empty Git repository in /path/to/my-agent-project/.git/

On branch main
No commits yet

Untracked files:
  README.md
  .gitignore

[main (root-commit) a1b2c3d] Initial commit: Add README and gitignore
 2 files changed, 5 insertions(+)

a1b2c3d Initial commit: Add README and gitignore
```

### 5.2 .gitignoreï¼šå¿½ç•¥æ•æ„Ÿæ–‡ä»¶

```bash
# åˆ›å»º .gitignore æ–‡ä»¶
cat > .gitignore << 'EOF'
# Python
__pycache__/
*.py[cod]
*.so
.Python
*.egg-info/
dist/
build/

# ç¯å¢ƒå˜é‡ï¼ˆé‡è¦ï¼ï¼‰
.env
.env.local
*.key
secrets.json

# è™šæ‹Ÿç¯å¢ƒ
venv/
env/
ENV/

# Jupyter Notebook
.ipynb_checkpoints/
*.ipynb

# IDE
.vscode/
.idea/
*.swp
*.swo

# æ•°æ®æ–‡ä»¶
*.db
*.sqlite
*.csv
*.pkl

# æ—¥å¿—
*.log
logs/

# macOS
.DS_Store

# é¡¹ç›®ç‰¹å®š
agent_cache/
temp/
EOF

# æäº¤ .gitignore
git add .gitignore
git commit -m "Add comprehensive .gitignore"
```

### 5.3 GitHub å·¥ä½œæµ

```bash
# ===== è¿æ¥ GitHub =====

# 1. åœ¨ GitHub ä¸Šåˆ›å»ºæ–°ä»“åº“ï¼ˆé€šè¿‡ç½‘é¡µï¼‰
# è®¿é—®: https://github.com/new

# 2. è¿æ¥è¿œç¨‹ä»“åº“
git remote add origin https://github.com/your-username/my-agent-project.git

# 3. æ¨é€åˆ° GitHub
git push -u origin main

# ===== æ—¥å¸¸å¼€å‘æµç¨‹ =====

# 1. åˆ›å»ºæ–°åˆ†æ”¯
git checkout -b feature/add-intent-classifier

# 2. ä¿®æ”¹ä»£ç 
echo "class IntentClassifier: pass" > classifier.py

# 3. æ·»åŠ å¹¶æäº¤
git add classifier.py
git commit -m "feat: Add intent classifier skeleton"

# 4. æ¨é€åˆ†æ”¯
git push origin feature/add-intent-classifier

# 5. åœ¨ GitHub ä¸Šåˆ›å»º Pull Request

# 6. åˆå¹¶ååˆ‡å›ä¸»åˆ†æ”¯
git checkout main
git pull origin main

# 7. åˆ é™¤å·²åˆå¹¶çš„åˆ†æ”¯
git branch -d feature/add-intent-classifier
```

### 5.4 å¸¸ç”¨ Git å‘½ä»¤é€ŸæŸ¥

| å‘½ä»¤ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `git init` | åˆå§‹åŒ–ä»“åº“ | `git init` |
| `git clone` | å…‹éš†è¿œç¨‹ä»“åº“ | `git clone https://github.com/user/repo.git` |
| `git status` | æŸ¥çœ‹çŠ¶æ€ | `git status` |
| `git add` | æ·»åŠ åˆ°æš‚å­˜åŒº | `git add .` |
| `git commit` | æäº¤æ›´æ”¹ | `git commit -m "message"` |
| `git push` | æ¨é€åˆ°è¿œç¨‹ | `git push origin main` |
| `git pull` | æ‹‰å–è¿œç¨‹æ›´æ”¹ | `git pull` |
| `git log` | æŸ¥çœ‹å†å² | `git log --oneline` |
| `git diff` | æŸ¥çœ‹å·®å¼‚ | `git diff` |
| `git branch` | æŸ¥çœ‹/åˆ›å»ºåˆ†æ”¯ | `git branch feature-x` |
| `git checkout` | åˆ‡æ¢åˆ†æ”¯ | `git checkout main` |
| `git merge` | åˆå¹¶åˆ†æ”¯ | `git merge feature-x` |
| `git stash` | æš‚å­˜æ›´æ”¹ | `git stash save "temp"` |
| `git reset` | é‡ç½®æ›´æ”¹ | `git reset --hard HEAD` |

---

## 6. è™šæ‹Ÿç¯å¢ƒä¸ä¾èµ–ç®¡ç†

### 6.1 åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ

```bash
# ===== ä½¿ç”¨ venvï¼ˆPython å†…ç½®ï¼‰=====

# 1. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv agent_env

# 2. æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
# macOS/Linux:
source agent_env/bin/activate

# Windows:
agent_env\Scripts\activate

# 3. éªŒè¯ç¯å¢ƒ
which python  # åº”æ˜¾ç¤ºè™šæ‹Ÿç¯å¢ƒè·¯å¾„
python --version

# 4. å®‰è£…ä¾èµ–
pip install langchain langgraph openai

# 5. æŸ¥çœ‹å·²å®‰è£…åŒ…
pip list

# 6. é€€å‡ºè™šæ‹Ÿç¯å¢ƒ
deactivate
```

### 6.2 ä¾èµ–ç®¡ç†ï¼šrequirements.txt

```bash
# ===== åˆ›å»º requirements.txt =====

# 1. å¯¼å‡ºå½“å‰ç¯å¢ƒä¾èµ–
pip freeze > requirements.txt

# 2. æ‰‹åŠ¨ç¼–è¾‘ requirements.txtï¼ˆæ¨èï¼‰
cat > requirements.txt << 'EOF'
# Core AI Libraries
langchain==0.1.0
langgraph==0.0.20
openai==1.10.0

# Data Processing
numpy==1.24.0
pandas==2.0.0

# Web Framework
fastapi==0.109.0
uvicorn==0.27.0

# Environment
python-dotenv==1.0.0

# Testing
pytest==8.0.0
pytest-asyncio==0.23.0
EOF

# 3. å®‰è£…ä¾èµ–ï¼ˆæ–°ç¯å¢ƒï¼‰
pip install -r requirements.txt

# 4. å‡çº§æ‰€æœ‰åŒ…
pip install --upgrade -r requirements.txt

# 5. ä»…å®‰è£…ç”Ÿäº§ä¾èµ–ï¼ˆåˆ›å»º requirements-prod.txtï¼‰
cat > requirements-prod.txt << 'EOF'
langchain==0.1.0
langgraph==0.0.20
openai==1.10.0
fastapi==0.109.0
uvicorn==0.27.0
python-dotenv==1.0.0
EOF

pip install -r requirements-prod.txt
```

### 6.3 é¡¹ç›®ç»“æ„æœ€ä½³å®è·µ

```bash
# ===== æ¨èçš„ Agent é¡¹ç›®ç»“æ„ =====

my-agent-project/
â”œâ”€â”€ .env                    # ç¯å¢ƒå˜é‡ï¼ˆä¸æäº¤åˆ° gitï¼‰
â”œâ”€â”€ .env.example            # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ .gitignore              # Git å¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ README.md               # é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ requirements.txt        # ä¾èµ–åˆ—è¡¨
â”œâ”€â”€ requirements-dev.txt    # å¼€å‘ä¾èµ–
â”œâ”€â”€ agent/                  # ä¸»ä»£ç ç›®å½•
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ config.py           # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ graph.py            # LangGraph å®šä¹‰
â”‚   â”œâ”€â”€ nodes.py            # èŠ‚ç‚¹å‡½æ•°
â”‚   â”œâ”€â”€ tools.py            # å·¥å…·å®šä¹‰
â”‚   â””â”€â”€ utils.py            # è¾…åŠ©å‡½æ•°
â”œâ”€â”€ tests/                  # æµ‹è¯•ç›®å½•
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ test_nodes.py
â”‚   â””â”€â”€ test_tools.py
â”œâ”€â”€ data/                   # æ•°æ®æ–‡ä»¶
â”‚   â””â”€â”€ conversations/
â”œâ”€â”€ logs/                   # æ—¥å¿—æ–‡ä»¶
â””â”€â”€ scripts/                # è¾…åŠ©è„šæœ¬
    â””â”€â”€ run_agent.py
```

---

## 7. ç»¼åˆå®æˆ˜ï¼šå®Œæ•´çš„ Agent å·¥ç¨‹é¡¹ç›®

è®©æˆ‘ä»¬æ•´åˆæ‰€æœ‰çŸ¥è¯†ï¼Œæ„å»ºä¸€ä¸ªç”Ÿäº§çº§çš„ Agent ç³»ç»Ÿã€‚

```python
# ä»£ç ç¤ºä¾‹ï¼šconfig.py - é…ç½®ç®¡ç†
import os
from typing import Optional
from dotenv import load_dotenv

class AgentConfig:
    """Agent é…ç½®ç®¡ç†"""

    def __init__(self, env_file: Optional[str] = ".env"):
        # åŠ è½½ç¯å¢ƒå˜é‡
        if env_file and os.path.exists(env_file):
            load_dotenv(env_file)

        # API é…ç½®
        self.openai_api_key = os.getenv("OPENAI_API_KEY")
        self.model = os.getenv("MODEL", "5")
        self.temperature = float(os.getenv("TEMPERATURE", "0.7"))
        self.max_tokens = int(os.getenv("MAX_TOKENS", "1000"))

        # Agent é…ç½®
        self.max_retries = int(os.getenv("MAX_RETRIES", "3"))
        self.timeout = int(os.getenv("TIMEOUT", "30"))

        # æ—¥å¿—é…ç½®
        self.log_level = os.getenv("LOG_LEVEL", "INFO")
        self.log_file = os.getenv("LOG_FILE", "agent.log")

    def validate(self):
        """éªŒè¯é…ç½®"""
        if not self.openai_api_key:
            raise ValueError("å¿…é¡»è®¾ç½® OPENAI_API_KEY")
        return True


# ä»£ç ç¤ºä¾‹ï¼šlogger.py - æ—¥å¿—ç®¡ç†
from datetime import datetime
from typing import Literal

class AgentLogger:
    """Agent æ—¥å¿—è®°å½•å™¨"""

    def __init__(self, log_file: str = "agent.log", level: str = "INFO"):
        self.log_file = log_file
        self.level = level
        self.levels = {"DEBUG": 0, "INFO": 1, "WARNING": 2, "ERROR": 3}

    def _should_log(self, level: str) -> bool:
        """åˆ¤æ–­æ˜¯å¦åº”è¯¥è®°å½•"""
        return self.levels.get(level, 1) >= self.levels.get(self.level, 1)

    def _log(self, level: str, message: str):
        """å†…éƒ¨æ—¥å¿—æ–¹æ³•"""
        if not self._should_log(level):
            return

        timestamp = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
        log_entry = f"[{timestamp}] [{level}] {message}\n"

        # å†™å…¥æ–‡ä»¶
        with open(self.log_file, "a", encoding="utf-8") as f:
            f.write(log_entry)

        # æ‰“å°åˆ°æ§åˆ¶å°
        print(log_entry.strip())

    def debug(self, message: str):
        self._log("DEBUG", message)

    def info(self, message: str):
        self._log("INFO", message)

    def warning(self, message: str):
        self._log("WARNING", message)

    def error(self, message: str):
        self._log("ERROR", message)


# ä»£ç ç¤ºä¾‹ï¼šexceptions.py - è‡ªå®šä¹‰å¼‚å¸¸
class AgentError(Exception):
    """Agent åŸºç¡€å¼‚å¸¸"""
    pass

class ConfigurationError(AgentError):
    """é…ç½®é”™è¯¯"""
    pass

class ToolExecutionError(AgentError):
    """å·¥å…·æ‰§è¡Œé”™è¯¯"""
    pass


# ä»£ç ç¤ºä¾‹ï¼šagent.py - ä¸» Agent ç±»
from typing import List, Dict, Any

class ProductionAgent:
    """ç”Ÿäº§çº§ Agent"""

    def __init__(self, config: Optional[AgentConfig] = None):
        # åŠ è½½é…ç½®
        self.config = config or AgentConfig()
        self.config.validate()

        # åˆå§‹åŒ–æ—¥å¿—
        self.logger = AgentLogger(
            log_file=self.config.log_file,
            level=self.config.log_level
        )

        # çŠ¶æ€ç®¡ç†
        self.state = {
            "messages": [],
            "context": {},
            "metadata": {
                "created_at": datetime.now().isoformat(),
                "call_count": 0
            }
        }

        self.logger.info("Agent åˆå§‹åŒ–å®Œæˆ")

    def process_message(self, message: str) -> Dict[str, Any]:
        """å¤„ç†ç”¨æˆ·æ¶ˆæ¯"""
        try:
            self.logger.info(f"å¤„ç†æ¶ˆæ¯: {message}")

            # æ›´æ–°çŠ¶æ€
            self.state["messages"].append({
                "role": "user",
                "content": message
            })
            self.state["metadata"]["call_count"] += 1

            # ç®€åŒ–çš„å¤„ç†é€»è¾‘
            response = self._generate_response(message)

            # æ·»åŠ å“åº”
            self.state["messages"].append({
                "role": "assistant",
                "content": response
            })

            self.logger.info("æ¶ˆæ¯å¤„ç†å®Œæˆ")

            return {
                "status": "success",
                "response": response,
                "call_count": self.state["metadata"]["call_count"]
            }

        except Exception as e:
            self.logger.error(f"å¤„ç†æ¶ˆæ¯å¤±è´¥: {e}")
            raise AgentError(f"æ¶ˆæ¯å¤„ç†å¤±è´¥: {e}")

    def _generate_response(self, message: str) -> str:
        """ç”Ÿæˆå“åº”ï¼ˆç®€åŒ–ç‰ˆï¼‰"""
        # å®é™…åº”ç”¨ä¸­è¿™é‡Œä¼šè°ƒç”¨ LLM
        return f"æ”¶åˆ°ä½ çš„æ¶ˆæ¯: {message}"

    def save_conversation(self, filename: str):
        """ä¿å­˜å¯¹è¯å†å²"""
        try:
            import json
            with open(filename, "w", encoding="utf-8") as f:
                json.dump(self.state, f, ensure_ascii=False, indent=2)
            self.logger.info(f"å¯¹è¯å·²ä¿å­˜åˆ°: {filename}")
        except Exception as e:
            self.logger.error(f"ä¿å­˜å¯¹è¯å¤±è´¥: {e}")
            raise

    def __repr__(self):
        return f"ProductionAgent(calls={self.state['metadata']['call_count']})"


# ===== ä½¿ç”¨ç¤ºä¾‹ =====

# åˆ›å»º .env æ–‡ä»¶
env_content = """OPENAI_API_KEY=sk-test1234567890
MODEL=gpt-5
TEMPERATURE=0.7
LOG_LEVEL=INFO
"""

with open("agent.env", "w") as f:
    f.write(env_content)

# åˆ›å»º Agent
print("=== åˆå§‹åŒ– Agent ===")
agent = ProductionAgent(AgentConfig(env_file="agent.env"))

# å¤„ç†æ¶ˆæ¯
messages = [
    "ä½ å¥½",
    "ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ",
    "å¸®æˆ‘æ€»ç»“ä¸€ä¸‹æˆ‘ä»¬çš„å¯¹è¯"
]

print("\n=== å¤„ç†æ¶ˆæ¯ ===")
for msg in messages:
    result = agent.process_message(msg)
    print(f"âœ… å“åº”: {result['response']}")

# ä¿å­˜å¯¹è¯
print("\n=== ä¿å­˜å¯¹è¯ ===")
agent.save_conversation("production_conversation.json")

print(f"\n{agent}")
```

**è¿è¡Œç»“æœï¼š**
```
=== åˆå§‹åŒ– Agent ===
[2024-10-27 10:00:00] [INFO] Agent åˆå§‹åŒ–å®Œæˆ

=== å¤„ç†æ¶ˆæ¯ ===
[2024-10-27 10:00:00] [INFO] å¤„ç†æ¶ˆæ¯: ä½ å¥½
[2024-10-27 10:00:00] [INFO] æ¶ˆæ¯å¤„ç†å®Œæˆ
âœ… å“åº”: æ”¶åˆ°ä½ çš„æ¶ˆæ¯: ä½ å¥½
[2024-10-27 10:00:00] [INFO] å¤„ç†æ¶ˆæ¯: ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ
[2024-10-27 10:00:00] [INFO] æ¶ˆæ¯å¤„ç†å®Œæˆ
âœ… å“åº”: æ”¶åˆ°ä½ çš„æ¶ˆæ¯: ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ
[2024-10-27 10:00:00] [INFO] å¤„ç†æ¶ˆæ¯: å¸®æˆ‘æ€»ç»“ä¸€ä¸‹æˆ‘ä»¬çš„å¯¹è¯
[2024-10-27 10:00:00] [INFO] æ¶ˆæ¯å¤„ç†å®Œæˆ
âœ… å“åº”: æ”¶åˆ°ä½ çš„æ¶ˆæ¯: å¸®æˆ‘æ€»ç»“ä¸€ä¸‹æˆ‘ä»¬çš„å¯¹è¯

=== ä¿å­˜å¯¹è¯ ===
[2024-10-27 10:00:00] [INFO] å¯¹è¯å·²ä¿å­˜åˆ°: production_conversation.json

ProductionAgent(calls=3)
```

---

## 8. æœ¬ç« æ€»ç»“

### âœ… ä½ å·²ç»æŒæ¡

1. **é¢å‘å¯¹è±¡ç¼–ç¨‹**
   - ç±»ä¸å¯¹è±¡ï¼šè®¾è®¡ Agent è“å›¾
   - ç»§æ‰¿ï¼šæ‰©å±•åŠŸèƒ½
   - å°è£…ï¼šä¿æŠ¤æ•æ„Ÿä¿¡æ¯
   - å±æ€§ï¼š@property è£…é¥°å™¨

2. **å¼‚å¸¸å¤„ç†**
   - try-except-finally
   - è‡ªå®šä¹‰å¼‚å¸¸
   - ä¸Šä¸‹æ–‡ç®¡ç†å™¨

3. **æ–‡ä»¶æ“ä½œ**
   - JSON æ–‡ä»¶ï¼šæŒä¹…åŒ–å¯¹è¯
   - æ–‡æœ¬æ–‡ä»¶ï¼šæ—¥å¿—è®°å½•
   - with è¯­å¥ï¼šå®‰å…¨çš„èµ„æºç®¡ç†

4. **ç¯å¢ƒé…ç½®**
   - .env æ–‡ä»¶ç®¡ç†
   - é…ç½®ç±»è®¾è®¡
   - API Key ä¿æŠ¤

5. **Git/GitHub**
   - ç‰ˆæœ¬æ§åˆ¶åŸºç¡€
   - .gitignore æœ€ä½³å®è·µ
   - åä½œå·¥ä½œæµ

6. **å·¥ç¨‹å®è·µ**
   - è™šæ‹Ÿç¯å¢ƒ
   - requirements.txt
   - é¡¹ç›®ç»“æ„è®¾è®¡

### ğŸ“š ä¸‹ä¸€æ­¥

å‡†å¤‡å¥½äº†å—ï¼Ÿæ¥ä¸‹æ¥æˆ‘ä»¬å°†å­¦ä¹ ï¼š
- **0.3-AIå¼€å‘å·¥å…·é“¾.md** - æŒæ¡ NumPyã€Pandasã€LangChainã€Streamlit ç­‰ AI ç”Ÿæ€ç³»ç»Ÿ

### ğŸ’¡ å®æˆ˜å»ºè®®

1. åˆ›å»ºè‡ªå·±çš„ Agent é¡¹ç›®ï¼Œåº”ç”¨æœ¬ç« çŸ¥è¯†
2. ä¸ºé¡¹ç›®é…ç½® Git ä»“åº“å¹¶æ¨é€åˆ° GitHub
3. ä½¿ç”¨ .env æ–‡ä»¶ç®¡ç† API Key
4. å®ç°å®Œæ•´çš„æ—¥å¿—ç³»ç»Ÿ

---

**ğŸ¯ è®°ä½**ï¼šä¼˜ç§€çš„å·¥ç¨‹å®è·µæ˜¯æ„å»ºå¯ç»´æŠ¤ã€å¯æ‰©å±• AI Agent çš„åŸºç¡€ã€‚æŠ•èµ„æ—¶é—´å­¦ä¹ è¿™äº›æŠ€èƒ½ï¼Œä¼šè®©ä½ çš„å¼€å‘æ•ˆç‡æå‡10å€ï¼

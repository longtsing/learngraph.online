# LangGraph MCP é›†æˆä¸å·¥å…·æ‰©å±•è¯¦ç»†è§£è¯»

## ğŸ“š æ¦‚è¿°

**Model Context Protocol (MCP)** æ˜¯ä¸€ä¸ªæ ‡å‡†åŒ–åè®®ï¼Œç”¨äºè¿æ¥ LLM åº”ç”¨ä¸å¤–éƒ¨å·¥å…·å’Œæ•°æ®æºã€‚æœ¬ç« è®²è§£å¦‚ä½•åœ¨ Research Agent ä¸­é›†æˆ MCPï¼Œå®ç°å·¥å…·èƒ½åŠ›çš„çµæ´»æ‰©å±•ã€‚

**æ ¸å¿ƒä»·å€¼ï¼š**
- ğŸ”Œ **æ ‡å‡†åŒ–æ¥å£** - æ— éœ€ä¸ºæ¯ä¸ªå·¥å…·ç¼–å†™é€‚é…ä»£ç 
- ğŸš€ **åŠ¨æ€å·¥å…·å‘ç°** - è¿è¡Œæ—¶æŸ¥è¯¢å¯ç”¨å·¥å…·
- ğŸŒ **æœ¬åœ° + è¿œç¨‹** - æ”¯æŒæœ¬åœ°æœåŠ¡å™¨å’Œäº‘ç«¯ API
- ğŸ”§ **æ˜“äºæ‰©å±•** - æ’æ‹”å¼æ·»åŠ æ–°å·¥å…·

---

## ğŸ¯ æ ¸å¿ƒæ¦‚å¿µï¼šMCP æ¶æ„

### MCP æ˜¯ä»€ä¹ˆï¼Ÿ

**Model Context Protocol** æ˜¯ä¸€ä¸ªå¼€æ”¾æ ‡å‡†ï¼Œå®šä¹‰äº†ï¼š
- LLM åº”ç”¨ï¼ˆClientï¼‰å¦‚ä½•å‘ç°å’Œè°ƒç”¨å·¥å…·
- å·¥å…·æä¾›æ–¹ï¼ˆServerï¼‰å¦‚ä½•æš´éœ²åŠŸèƒ½
- åŒæ–¹å¦‚ä½•é€šä¿¡ï¼ˆJSON-RPC åè®®ï¼‰

### å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¨¡å‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   LangGraph Agent (Client)       â”‚
â”‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ MultiServerMCPClient       â”‚  â”‚
â”‚  â”‚  - ç®¡ç†å¤šä¸ª MCP server     â”‚  â”‚
â”‚  â”‚  - æŸ¥è¯¢å¯ç”¨å·¥å…·            â”‚  â”‚
â”‚  â”‚  - è½¬å‘å·¥å…·è°ƒç”¨            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“ (stdio / HTTP)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   MCP Server (Tool Provider)     â”‚
â”‚                                  â”‚
â”‚  ç¤ºä¾‹:                           â”‚
â”‚  - Filesystem Server (æ–‡ä»¶æ“ä½œ)  â”‚
â”‚  - Database Server (æ•°æ®åº“æŸ¥è¯¢)  â”‚
â”‚  - API Server (è¿œç¨‹ API è°ƒç”¨)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ æ ¸å¿ƒæŠ€æœ¯ï¼šTransport æ¨¡å¼

### stdio Transportï¼ˆæœ¬åœ°é€šä¿¡ï¼‰

**å·¥ä½œåŸç†ï¼š**
1. Client å¯åŠ¨ Server ä½œä¸ºå­è¿›ç¨‹
2. é€šè¿‡æ ‡å‡†è¾“å…¥/è¾“å‡ºï¼ˆstdin/stdoutï¼‰é€šä¿¡
3. ä½¿ç”¨ JSON-RPC æ ¼å¼äº¤æ¢æ¶ˆæ¯

**é…ç½®ç¤ºä¾‹ï¼š**

```python
mcp_config = {
    "filesystem": {
        "command": "npx",  # å¯åŠ¨å‘½ä»¤
        "args": [
            "-y",  # è‡ªåŠ¨å®‰è£…
            "@modelcontextprotocol/server-filesystem",  # Server åŒ…
            "/path/to/documents"  # Server å‚æ•°ï¼ˆå…è®¸è®¿é—®çš„ç›®å½•ï¼‰
        ],
        "transport": "stdio"  # ä½¿ç”¨ stdin/stdout
    }
}
```

**é€‚ç”¨åœºæ™¯ï¼š**
- âœ… æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿè®¿é—®
- âœ… æœ¬åœ°æ•°æ®åº“æŸ¥è¯¢
- âœ… æœ¬åœ°è„šæœ¬æ‰§è¡Œ
- âœ… å¼€å‘å’Œæµ‹è¯•

**ä¼˜ç‚¹ï¼š**
- å¿«é€Ÿï¼ˆæ— ç½‘ç»œå»¶è¿Ÿï¼‰
- å®‰å…¨ï¼ˆä¸æš´éœ²ç½‘ç»œç«¯å£ï¼‰
- ç®€å•ï¼ˆæ— éœ€è®¤è¯é…ç½®ï¼‰

**ç¼ºç‚¹ï¼š**
- åªèƒ½è®¿é—®æœ¬åœ°èµ„æº
- éœ€è¦å®‰è£… Server è½¯ä»¶

---

### HTTP Transportï¼ˆè¿œç¨‹é€šä¿¡ï¼‰

**å·¥ä½œåŸç†ï¼š**
1. Client è¿æ¥åˆ°å·²è¿è¡Œçš„è¿œç¨‹ Server
2. é€šè¿‡ HTTP/HTTPS å‘é€è¯·æ±‚
3. Server è¿”å› JSON å“åº”

**é…ç½®ç¤ºä¾‹ï¼š**

```python
mcp_config = {
    "remote_api": {
        "url": "https://mcp.example.com/sse",  # Server URL
        "transport": "http",
        "headers": {
            "Authorization": "Bearer YOUR_TOKEN",  # è®¤è¯
            "X-API-Version": "v1"
        }
    }
}
```

**é€‚ç”¨åœºæ™¯ï¼š**
- âœ… ç¬¬ä¸‰æ–¹ API é›†æˆï¼ˆAsana, PayPal, Zapierï¼‰
- âœ… å›¢é˜Ÿå…±äº«çš„ MCP æœåŠ¡
- âœ… äº‘ç«¯æ•°æ®è®¿é—®
- âœ… ç”Ÿäº§éƒ¨ç½²

**ä¼˜ç‚¹ï¼š**
- æ— éœ€æœ¬åœ°å®‰è£…
- å¯è®¿é—®è¿œç¨‹èµ„æº
- ä¾¿äºé›†ä¸­ç®¡ç†

**ç¼ºç‚¹ï¼š**
- ç½‘ç»œå»¶è¿Ÿ
- éœ€è¦è®¤è¯ç®¡ç†
- ä¾èµ–å¤–éƒ¨æœåŠ¡å¯ç”¨æ€§

---

## ğŸ” å…³é”®æŠ€æœ¯ç»†èŠ‚ï¼šä¸ºä»€ä¹ˆå¿…é¡»å¼‚æ­¥ï¼Ÿ

### MCP åè®®çš„å¼‚æ­¥æœ¬è´¨

```python
# âŒ è¿™æ ·ä¸è¡Œ
tools = client.get_tools()  # MCP æ²¡æœ‰åŒæ­¥æ–¹æ³•

# âœ… å¿…é¡»è¿™æ ·
tools = await client.get_tools()  # å¼‚æ­¥è°ƒç”¨
```

**ä¸‰ä¸ªåŸå› ï¼š**

#### 1. **è¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰**

```
Client (Python è¿›ç¨‹)
    â†“ (stdin)
Server (Node.js å­è¿›ç¨‹)
    â†“ (stdout)
Client (Python è¿›ç¨‹)
```

- stdin/stdout æ˜¯ I/O æ“ä½œï¼Œå¤©ç„¶å¼‚æ­¥
- é˜»å¡ç­‰å¾…ä¼šå†»ç»“æ•´ä¸ªè¿›ç¨‹
- å¼‚æ­¥å…è®¸å¹¶å‘å¤„ç†å¤šä¸ªè¯·æ±‚

#### 2. **ç½‘ç»œè¯·æ±‚ï¼ˆHTTPï¼‰**

```python
# HTTP transport å‘é€è¯·æ±‚
await client.tools["read_file"].ainvoke({"path": "..."})

# å¯èƒ½éœ€è¦ç­‰å¾…ï¼š
# - DNS è§£æ: 50ms
# - TLS æ¡æ‰‹: 100ms
# - æœåŠ¡å™¨å¤„ç†: 200ms
# - æ•°æ®ä¼ è¾“: 50ms
# æ€»è®¡: 400ms

# åŒæ­¥ä¼šé˜»å¡ï¼Œå¼‚æ­¥å¯ä»¥åŒæ—¶å‘é€å¤šä¸ªè¯·æ±‚
```

#### 3. **LangChain MCP Adapters çš„è®¾è®¡**

```python
# LangChain MCP å·¥å…·å¼ºåˆ¶å¼‚æ­¥
class MCPTool(StructuredTool):
    def invoke(self, *args, **kwargs):
        raise NotImplementedError(
            "MCP tools must be used asynchronously. Use ainvoke() instead."
        )

    async def ainvoke(self, *args, **kwargs):
        # å®é™…å®ç°
        ...
```

**è®¾è®¡ç†ç”±ï¼š**
- ç¡®ä¿ä¸€è‡´çš„å¼‚æ­¥è¡Œä¸º
- é¿å…é˜»å¡äº‹ä»¶å¾ªç¯
- æ”¯æŒé«˜å¹¶å‘åœºæ™¯

---

## ğŸ› ï¸ å®æˆ˜ï¼šé›†æˆ Filesystem MCP Server

### 1. å®‰è£…å’Œé…ç½®

```python
from langchain_mcp_adapters.client import MultiServerMCPClient

# MCP é…ç½®
mcp_config = {
    "filesystem": {
        "command": "npx",
        "args": [
            "-y",
            "@modelcontextprotocol/server-filesystem",
            str(Path.cwd() / "research_docs")  # å…è®¸è®¿é—®çš„ç›®å½•
        ],
        "transport": "stdio"
    }
}

# åˆ›å»º Client
client = MultiServerMCPClient(mcp_config)
```

**å…³é”®ç‚¹ï¼š**
- `MultiServerMCPClient` å¯ä»¥ç®¡ç†å¤šä¸ª MCP server
- Client è‡ªåŠ¨å¯åŠ¨ server å­è¿›ç¨‹ï¼ˆstdio transportï¼‰
- æˆ–è¿æ¥åˆ°è¿œç¨‹ serverï¼ˆHTTP transportï¼‰

---

### 2. æŸ¥è¯¢å¯ç”¨å·¥å…·

```python
# è·å–æ‰€æœ‰å·¥å…·ï¼ˆå¼‚æ­¥ï¼‰
tools = await client.get_tools()

# è¾“å‡ºç¤ºä¾‹
for tool in tools:
    print(f"Tool: {tool.name}")
    print(f"Description: {tool.description}")
```

**Filesystem Server æä¾›çš„å·¥å…·ï¼š**

| å·¥å…·å | åŠŸèƒ½ | ç¤ºä¾‹ |
|--------|------|------|
| `read_file` | è¯»å–æ–‡ä»¶å†…å®¹ | è¯»å–ç ”ç©¶æ–‡æ¡£ |
| `read_multiple_files` | æ‰¹é‡è¯»å–æ–‡ä»¶ | ä¸€æ¬¡è¯»å–å¤šä¸ªæ–‡æ¡£ |
| `write_file` | å†™å…¥æ–‡ä»¶ | ä¿å­˜ç ”ç©¶ç»“æœ |
| `search_files` | æœç´¢æ–‡ä»¶ | æŒ‰å…³é”®è¯æŸ¥æ‰¾ |
| `list_directory` | åˆ—å‡ºç›®å½• | æŸ¥çœ‹å¯ç”¨æ–‡æ¡£ |
| `list_allowed_directories` | æŸ¥çœ‹æƒé™ | ç¡®è®¤è®¿é—®èŒƒå›´ |

---

### 3. åœ¨ Agent ä¸­ä½¿ç”¨ MCP å·¥å…·

```python
from deep_research_from_scratch.utils import think_tool

async def llm_call(state: ResearcherState):
    """
    Agent å†³ç­–èŠ‚ç‚¹ï¼ˆå¼‚æ­¥ï¼‰

    å…³é”®ï¼šå¿…é¡»å¼‚æ­¥è·å– MCP å·¥å…·
    """
    # è·å– MCP å·¥å…·
    mcp_tools = await client.get_tools()

    # ç»„åˆè‡ªå®šä¹‰å·¥å…·
    all_tools = mcp_tools + [think_tool]

    # ç»‘å®šåˆ°æ¨¡å‹
    model_with_tools = model.bind_tools(all_tools)

    # LLM å†³ç­–
    response = model_with_tools.invoke(
        [SystemMessage(content=research_agent_prompt_with_mcp)] +
        state["researcher_messages"]
    )

    return {"researcher_messages": [response]}
```

---

### 4. å·¥å…·æ‰§è¡ŒèŠ‚ç‚¹ï¼ˆå…³é”®ï¼šå¼‚æ­¥å¤„ç†ï¼‰

```python
async def tool_node(state: ResearcherState):
    """
    æ‰§è¡Œå·¥å…·è°ƒç”¨ï¼ˆå¼‚æ­¥ï¼‰

    é‡è¦ï¼šMCP å·¥å…·å¿…é¡»ç”¨ ainvoke
    """
    tool_calls = state["researcher_messages"][-1].tool_calls

    # è·å–æœ€æ–°å·¥å…·å¼•ç”¨
    mcp_tools = await client.get_tools()
    all_tools = mcp_tools + [think_tool]
    tools_by_name = {tool.name: tool for tool in all_tools}

    # æ‰§è¡Œå·¥å…·è°ƒç”¨
    observations = []
    for tool_call in tool_calls:
        tool = tools_by_name[tool_call["name"]]

        if tool_call["name"] == "think_tool":
            # think_tool æ˜¯åŒæ­¥çš„
            observation = tool.invoke(tool_call["args"])
        else:
            # MCP å·¥å…·æ˜¯å¼‚æ­¥çš„
            observation = await tool.ainvoke(tool_call["args"])

        observations.append(observation)

    # æ ¼å¼åŒ–ç»“æœ
    tool_outputs = [
        ToolMessage(
            content=observation,
            name=tool_call["name"],
            tool_call_id=tool_call["id"]
        )
        for observation, tool_call in zip(observations, tool_calls)
    ]

    return {"researcher_messages": tool_outputs}
```

**å…³é”®åŒºåˆ«ï¼š**

```python
# è‡ªå®šä¹‰å·¥å…·ï¼ˆåŒæ­¥ï¼‰
result = tavily_search.invoke({"query": "..."})

# MCP å·¥å…·ï¼ˆå¼‚æ­¥ï¼‰
result = await read_file.ainvoke({"path": "..."})
```

---

## ğŸ­ å®æˆ˜ç¤ºä¾‹ï¼šä»æœ¬åœ°æ–‡æ¡£ç ”ç©¶

### ç ”ç©¶æµç¨‹

```python
ç ”ç©¶ä¸»é¢˜: "æ€»ç»“æœ¬åœ°æ–‡æ¡£ä¸­å…³äº SF å’–å•¡åº—çš„ä¿¡æ¯"

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Round 1: æ¢ç´¢å¯ç”¨æ–‡æ¡£                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Tool: list_allowed_directories()        â”‚
â”‚ ç»“æœ: ["/path/to/research_docs"]        â”‚
â”‚                                         â”‚
â”‚ Tool: list_directory("/path/to/...")   â”‚
â”‚ ç»“æœ: ["coffee_shops_sf.md",           â”‚
â”‚        "sf_restaurants.md"]             â”‚
â”‚                                         â”‚
â”‚ Tool: think_tool()                      â”‚
â”‚ åæ€: "æ‰¾åˆ°ç›¸å…³æ–‡æ¡£ï¼Œéœ€è¦è¯»å–å†…å®¹"       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Round 2: è¯»å–æ–‡æ¡£                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Tool: read_file("coffee_shops_sf.md")   â”‚
â”‚ ç»“æœ: Blue Bottle, Philz, Sightglass... â”‚
â”‚                                         â”‚
â”‚ Tool: think_tool()                      â”‚
â”‚ åæ€: "å·²è·å¾—è¶³å¤Ÿä¿¡æ¯ï¼Œå¯ä»¥æ€»ç»“"         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”Ÿæˆç­”æ¡ˆ                                 â”‚
â”‚ "åŸºäºæœ¬åœ°æ–‡æ¡£ï¼ŒSF çŸ¥åå’–å•¡åº—åŒ…æ‹¬..."     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹

### 1. LangGraph Platform éƒ¨ç½²é—®é¢˜

**é—®é¢˜ï¼š** åœ¨ LangGraph Platform éƒ¨ç½²æ—¶ï¼ŒMCP client åˆå§‹åŒ–å¯èƒ½å¤±è´¥

```python
# âŒ ç›´æ¥åˆå§‹åŒ–ï¼ˆéƒ¨ç½²æ—¶å¯èƒ½å¤±è´¥ï¼‰
client = MultiServerMCPClient(mcp_config)

# âœ… æ‡’åŠ è½½åˆå§‹åŒ–
_client = None

def get_mcp_client():
    global _client
    if _client is None:
        _client = MultiServerMCPClient(mcp_config)
    return _client

# åœ¨èŠ‚ç‚¹ä¸­ä½¿ç”¨
async def llm_call(state):
    client = get_mcp_client()  # å»¶è¿Ÿåˆå§‹åŒ–
    tools = await client.get_tools()
    ...
```

**åŸå› ï¼š**
- LangGraph Platform å¯èƒ½åœ¨å¯¼å…¥æ—¶æ‰«ææ¨¡å—
- è¿‡æ—©åˆå§‹åŒ–ä¼šå¯åŠ¨å­è¿›ç¨‹ï¼Œå¯¼è‡´èµ„æºé—®é¢˜
- æ‡’åŠ è½½ç¡®ä¿åªåœ¨å®é™…ä½¿ç”¨æ—¶åˆå§‹åŒ–

---

### 2. å·¥å…·å¼•ç”¨æ›´æ–°

```python
# âŒ é”™è¯¯ï¼šé‡ç”¨æ—§çš„å·¥å…·å¼•ç”¨
tools = await client.get_tools()  # åœ¨åˆå§‹åŒ–æ—¶è·å–

async def tool_node(state):
    # ä½¿ç”¨æ—§å¼•ç”¨ - å¯èƒ½å·²å¤±æ•ˆ
    tool.ainvoke(...)

# âœ… æ­£ç¡®ï¼šæ¯æ¬¡é‡æ–°è·å–
async def tool_node(state):
    tools = await client.get_tools()  # é‡æ–°è·å–
    tool = tools_by_name[name]
    await tool.ainvoke(...)
```

**åŸå› ï¼š**
- MCP server å¯èƒ½é‡å¯
- å·¥å…·åˆ—è¡¨å¯èƒ½æ›´æ–°
- é‡æ–°è·å–ç¡®ä¿å¼•ç”¨æœ‰æ•ˆ

---

### 3. Jupyter ç¯å¢ƒçš„å¼‚æ­¥å…¼å®¹

```python
# Jupyter å·²ç»æœ‰äº‹ä»¶å¾ªç¯ï¼Œasyncio.gather å¯èƒ½å†²çª
try:
    import nest_asyncio
    from IPython import get_ipython

    if get_ipython() is not None:
        nest_asyncio.apply()  # å…è®¸åµŒå¥—äº‹ä»¶å¾ªç¯
except ImportError:
    pass  # ä¸åœ¨ Jupyter ä¸­ï¼Œæ— éœ€å¤„ç†
```

---

## ğŸŒ è¿œç¨‹ MCP Server ç¤ºä¾‹

### é…ç½®ç¬¬ä¸‰æ–¹ MCP æœåŠ¡

```python
# ç¤ºä¾‹ï¼šè¿æ¥åˆ° Asana MCP Server
mcp_config = {
    "asana": {
        "url": "https://mcp.asana.com/sse",
        "transport": "http",
        "headers": {
            "Authorization": f"Bearer {os.getenv('ASANA_TOKEN')}",
            "Content-Type": "application/json"
        }
    }
}

client = MultiServerMCPClient(mcp_config)

# è·å–å·¥å…·
tools = await client.get_tools()
# å¯èƒ½åŒ…æ‹¬: create_task, list_projects, update_task ç­‰
```

**å¯ç”¨çš„ç¬¬ä¸‰æ–¹ MCP Serverï¼ˆæˆªè‡³ 2025ï¼‰ï¼š**
- Asana - ä»»åŠ¡ç®¡ç†
- Cloudflare - äº‘æœåŠ¡ç®¡ç†
- PayPal - æ”¯ä»˜å¤„ç†
- Zapier - è‡ªåŠ¨åŒ–é›†æˆ

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. ä½•æ—¶ä½¿ç”¨ MCP vs è‡ªå®šä¹‰å·¥å…·

| åœºæ™¯ | æ¨èæ–¹æ¡ˆ |
|------|----------|
| ç®€å•çš„ API è°ƒç”¨ | è‡ªå®šä¹‰å·¥å…·ï¼ˆ@tool è£…é¥°å™¨ï¼‰|
| å¤æ‚çš„æ–‡ä»¶æ“ä½œ | MCP Filesystem Server |
| ç¬¬ä¸‰æ–¹æœåŠ¡é›†æˆ | MCP HTTP Server |
| éœ€è¦é¢‘ç¹æ›´æ–°çš„å·¥å…· | MCPï¼ˆåŠ¨æ€å‘ç°ï¼‰|
| é«˜æ€§èƒ½è¦æ±‚ | è‡ªå®šä¹‰å·¥å…·ï¼ˆé¿å… IPC å¼€é”€ï¼‰|

### 2. å®‰å…¨è€ƒè™‘

```python
# âŒ ä¸å®‰å…¨ï¼šå…è®¸è®¿é—®æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿ
mcp_config = {
    "filesystem": {
        "args": [..., "/"]  # æ ¹ç›®å½•
    }
}

# âœ… å®‰å…¨ï¼šé™åˆ¶è®¿é—®èŒƒå›´
mcp_config = {
    "filesystem": {
        "args": [..., "/path/to/research_docs_only"]
    }
}
```

### 3. é”™è¯¯å¤„ç†

```python
async def tool_node(state):
    try:
        client = get_mcp_client()
        tools = await client.get_tools()
        # æ‰§è¡Œå·¥å…·
        ...
    except Exception as e:
        # é™çº§ï¼šä½¿ç”¨ç¼“å­˜çš„å·¥å…·æˆ–è¿”å›é”™è¯¯æ¶ˆæ¯
        return {
            "researcher_messages": [
                ToolMessage(
                    content=f"MCP å·¥å…·æ‰§è¡Œå¤±è´¥: {e}",
                    tool_call_id=tool_call["id"]
                )
            ]
        }
```

---

## ğŸ“Š MCP vs è‡ªå®šä¹‰å·¥å…·å¯¹æ¯”

| ç»´åº¦ | MCP å·¥å…· | è‡ªå®šä¹‰å·¥å…· |
|------|----------|-----------|
| **å®ç°å¤æ‚åº¦** | ä½ï¼ˆä½¿ç”¨ç°æˆ serverï¼‰| ä¸­ï¼ˆéœ€è¦ç¼–å†™ä»£ç ï¼‰|
| **æ€§èƒ½** | ä¸­ï¼ˆIPC/HTTP å¼€é”€ï¼‰| é«˜ï¼ˆç›´æ¥è°ƒç”¨ï¼‰|
| **çµæ´»æ€§** | é«˜ï¼ˆåŠ¨æ€å‘ç°ï¼‰| ä¸­ï¼ˆé™æ€å®šä¹‰ï¼‰|
| **ç»´æŠ¤æ€§** | ä½ï¼ˆserver æ›´æ–°è‡ªåŠ¨ç”Ÿæ•ˆï¼‰| ä¸­ï¼ˆéœ€è¦æ‰‹åŠ¨æ›´æ–°ï¼‰|
| **é€‚ç”¨åœºæ™¯** | æ ‡å‡†åŒ–æ“ä½œ | å®šåˆ¶åŒ–é€»è¾‘ |

---

## ğŸ“ æ ¸å¿ƒçŸ¥è¯†ç‚¹æ€»ç»“

### MCP æ¶æ„

```
Client (LangGraph Agent)
    â†“ (æŸ¥è¯¢å·¥å…·)
Server (MCP Server)
    â†“ (è¿”å›å·¥å…·åˆ—è¡¨)
Client ç»‘å®šå·¥å…·
    â†“ (LLM è°ƒç”¨å·¥å…·)
Client è½¬å‘è¯·æ±‚
    â†“ (stdio/HTTP)
Server æ‰§è¡Œ
    â†“ (è¿”å›ç»“æœ)
Client æ¥æ”¶
```

### å¼‚æ­¥å¿…è¦æ€§

1. **IPC é€šä¿¡** - stdin/stdout æ˜¯ I/O æ“ä½œ
2. **ç½‘ç»œè¯·æ±‚** - HTTP è°ƒç”¨éœ€è¦ç­‰å¾…
3. **LangChain è®¾è®¡** - MCP é€‚é…å™¨å¼ºåˆ¶å¼‚æ­¥

### stdio vs HTTP

| stdio | HTTP |
|-------|------|
| æœ¬åœ° | è¿œç¨‹ |
| å¿«é€Ÿ | è¾ƒæ…¢ |
| å®‰å…¨ | éœ€è®¤è¯ |
| éœ€å®‰è£… | æ— éœ€å®‰è£… |

---

## ğŸš€ ä¸‹ä¸€æ­¥

å®Œæˆæœ¬èŠ‚ï¼Œä½ å·²ç»æŒæ¡äº† MCP é›†æˆçš„æ ¸å¿ƒæŠ€æœ¯ã€‚

**ä¸‹ä¸€ç« ï¼š9.4 å¤šæ™ºèƒ½ä½“ååŒç ”ç©¶** - å­¦ä¹ å¦‚ä½•ä½¿ç”¨ Supervisor æ¨¡å¼åè°ƒå¤šä¸ª Research Agentï¼Œå®ç°å¹¶è¡Œç ”ç©¶å’Œä¸Šä¸‹æ–‡éš”ç¦»ï¼

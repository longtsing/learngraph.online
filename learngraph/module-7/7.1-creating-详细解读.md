# 6.1 Creating a Deployment - è¯¦ç»†è§£è¯»

## ä¸€ã€æ¦‚è¿°

### 1.1 æœ¬èŠ‚ç®€ä»‹

æœ¬èŠ‚æ˜¯ LangChain Academy Module-6 çš„ç¬¬ä¸€éƒ¨åˆ†ï¼Œæ ‡å¿—ç€æˆ‘ä»¬ä»**å¼€å‘é˜¶æ®µè¿›å…¥ç”Ÿäº§éƒ¨ç½²é˜¶æ®µ**ã€‚åœ¨ Module-5 ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†åŠŸèƒ½å¼ºå¤§çš„ `task_maistro` åº”ç”¨ï¼ˆä»»åŠ¡ç®¡ç†åŠ©æ‰‹ï¼‰ï¼Œç°åœ¨æ˜¯æ—¶å€™å°†å®ƒéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒï¼Œè®©çœŸå®ç”¨æˆ·å¯ä»¥ä½¿ç”¨äº†ã€‚

### 1.2 ä»€ä¹ˆæ˜¯éƒ¨ç½²ï¼ˆDeploymentï¼‰ï¼Ÿ

**éƒ¨ç½²**æ˜¯å°†åº”ç”¨ç¨‹åºä»å¼€å‘ç¯å¢ƒç§»åˆ°ç”Ÿäº§ç¯å¢ƒçš„è¿‡ç¨‹ï¼Œä½¿å…¶èƒ½å¤Ÿï¼š
- 24/7 å…¨å¤©å€™è¿è¡Œ
- å¤„ç†å¤šä¸ªå¹¶å‘ç”¨æˆ·
- æŒä¹…åŒ–å­˜å‚¨æ•°æ®
- æä¾›ç¨³å®šçš„ API æ¥å£
- æ”¯æŒæ‰©å±•å’Œç›‘æ§

**ç±»æ¯”**ï¼š
```
å¼€å‘ç¯å¢ƒï¼ˆDevelopmentï¼‰          ç”Ÿäº§ç¯å¢ƒï¼ˆProductionï¼‰
    â†“                              â†“
åœ¨ä½ çš„ç”µè„‘ä¸Šè¿è¡Œ                  åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œ
localhost:8000                   your-domain.com
åªæœ‰ä½ èƒ½è®¿é—®                      æ‰€æœ‰ç”¨æˆ·éƒ½èƒ½è®¿é—®
æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­                  æ•°æ®å­˜å‚¨åœ¨æ•°æ®åº“ä¸­
```

### 1.3 LangGraph Platform æ¶æ„

æœ¬èŠ‚å°†ä»‹ç» **LangGraph Platform**ï¼Œè¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„éƒ¨ç½²è§£å†³æ–¹æ¡ˆï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          LangGraph Platform æ¶æ„                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ LangGraph    â”‚   â”‚   Redis      â”‚   â”‚ Postgresâ”‚ â”‚
â”‚  â”‚ Server       â”‚   â”‚  (æ¶ˆæ¯é˜Ÿåˆ—)   â”‚   â”‚ (æ•°æ®åº“)â”‚ â”‚
â”‚  â”‚ (APIæœåŠ¡å™¨)   â”‚â†â†’â”‚  (ç¼“å­˜)      â”‚â†â†’â”‚ (å­˜å‚¨)  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â†‘                                             â”‚
â”‚         â”‚ HTTP/WebSocket                             â”‚
â”‚         â†“                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚         å®¢æˆ·ç«¯åº”ç”¨                        â”‚        â”‚
â”‚  â”‚  (Web, Mobile, Desktop, CLI...)         â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.4 å­¦ä¹ ç›®æ ‡

é€šè¿‡æœ¬èŠ‚å­¦ä¹ ï¼Œä½ å°†æŒæ¡ï¼š

1. **ç†è§£éƒ¨ç½²æ‰€éœ€çš„æ–‡ä»¶ç»“æ„**
   - langgraph.jsonï¼ˆé…ç½®æ–‡ä»¶ï¼‰
   - task_maistro.pyï¼ˆå›¾çš„å®ç°ï¼‰
   - requirements.txtï¼ˆä¾èµ–ç®¡ç†ï¼‰
   - .envï¼ˆç¯å¢ƒå˜é‡ï¼‰

2. **ä½¿ç”¨ LangGraph CLI**
   - å®‰è£…å’ŒåŸºæœ¬å‘½ä»¤
   - æ„å»º Docker é•œåƒ

3. **Docker å’Œå®¹å™¨åŒ–**
   - Docker é•œåƒ vs å®¹å™¨
   - docker-compose ç®¡ç†å¤šå®¹å™¨

4. **è‡ªæ‰˜ç®¡éƒ¨ç½²æµç¨‹**
   - ç«¯åˆ°ç«¯çš„éƒ¨ç½²æ­¥éª¤
   - æœåŠ¡å¯åŠ¨å’ŒéªŒè¯

### 1.5 ä¸ºä»€ä¹ˆéœ€è¦å­¦ä¹ éƒ¨ç½²ï¼Ÿ

**å¼€å‘ vs ç”Ÿäº§çš„å·®å¼‚ï¼š**

| æ–¹é¢ | å¼€å‘ç¯å¢ƒ | ç”Ÿäº§ç¯å¢ƒ |
|------|---------|---------|
| **æ•°æ®æŒä¹…åŒ–** | InMemoryStore | PostgreSQL |
| **å¹¶å‘å¤„ç†** | å•ç”¨æˆ· | å¤šç”¨æˆ·å¹¶å‘ |
| **å¯é æ€§** | å¯ä»¥é‡å¯ | éœ€è¦é«˜å¯ç”¨ |
| **è®¿é—®æ–¹å¼** | æœ¬åœ°ä»£ç è°ƒç”¨ | HTTP API |
| **ç›‘æ§** | print() è°ƒè¯• | æ—¥å¿—å’Œç›‘æ§ç³»ç»Ÿ |
| **æ‰©å±•æ€§** | å•æœºè¿è¡Œ | å¯ä»¥æ°´å¹³æ‰©å±• |

---

## äºŒã€éƒ¨ç½²æ‰€éœ€çš„ä»£ç ç»“æ„

### 2.1 å¿…éœ€çš„æ–‡ä»¶

LangGraph Platform éƒ¨ç½²éœ€è¦ä»¥ä¸‹æ–‡ä»¶ï¼š

```
module-6/deployment/
â”œâ”€â”€ langgraph.json          # LangGraph é…ç½®æ–‡ä»¶
â”œâ”€â”€ task_maistro.py         # å›¾çš„å®ç°ä»£ç 
â”œâ”€â”€ requirements.txt        # Python ä¾èµ–
â”œâ”€â”€ .env                    # ç¯å¢ƒå˜é‡ï¼ˆä¸æäº¤åˆ° gitï¼‰
â””â”€â”€ docker-compose.yml      # Docker å®¹å™¨ç¼–æ’
```

### 2.2 langgraph.json - é…ç½®æ–‡ä»¶

**ä½œç”¨**ï¼šå‘Šè¯‰ LangGraph Server å¦‚ä½•æ‰¾åˆ°å’Œè¿è¡Œä½ çš„å›¾ã€‚

**å…¸å‹å†…å®¹**ï¼š
```json
{
  "dependencies": [".", "./packages/*"],
  "graphs": {
    "task_maistro": "./task_maistro.py:graph"
  },
  "env": ".env"
}
```

**å­—æ®µè¯´æ˜**ï¼š

| å­—æ®µ | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|------|------|--------|
| `dependencies` | Python åŒ…çš„ä½ç½® | `[".", "./packages/*"]` |
| `graphs` | å›¾çš„åç§°å’Œä½ç½® | `{"task_maistro": "./task_maistro.py:graph"}` |
| `env` | ç¯å¢ƒå˜é‡æ–‡ä»¶ | `.env` |

**Python çŸ¥è¯†ç‚¹ - æ¨¡å—è·¯å¾„æ ¼å¼**ï¼š
```python
"./task_maistro.py:graph"
#  ^^^^^^^^^^^^^^^^  ^^^^^
#       æ–‡ä»¶è·¯å¾„      å˜é‡å
#
# è¡¨ç¤ºï¼šä» task_maistro.py æ–‡ä»¶ä¸­å¯¼å…¥ graph å˜é‡
#
# ç­‰ä»·äº Python ä»£ç ï¼š
# from task_maistro import graph
```

### 2.3 task_maistro.py - å›¾çš„å®ç°

**ä½œç”¨**ï¼šåŒ…å«ä½ çš„ LangGraph åº”ç”¨çš„å®Œæ•´å®ç°ã€‚

**å…³é”®ç‚¹**ï¼š
- å¿…é¡»å¯¼å‡ºä¸€ä¸ªç¼–è¯‘åçš„å›¾ï¼ˆé€šå¸¸å‘½åä¸º `graph`ï¼‰
- åŒ…å«æ‰€æœ‰èŠ‚ç‚¹ã€è¾¹ã€çŠ¶æ€å®šä¹‰
- é…ç½® checkpointer å’Œ store

**ç¤ºä¾‹ç»“æ„**ï¼š
```python
from langgraph.graph import StateGraph, START, END
from langgraph.checkpoint.memory import MemorySaver
from langgraph.store.memory import InMemoryStore

# ... å®šä¹‰èŠ‚ç‚¹å‡½æ•° ...

# æ„å»ºå›¾
builder = StateGraph(MessagesState)
builder.add_node("call_model", call_model)
# ... æ·»åŠ æ›´å¤šèŠ‚ç‚¹å’Œè¾¹ ...

# ç¼–è¯‘å›¾
checkpointer = MemorySaver()
store = InMemoryStore()
graph = builder.compile(checkpointer=checkpointer, store=store)
```

**é‡è¦**ï¼šåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œ`MemorySaver` å’Œ `InMemoryStore` ä¼šè¢«è‡ªåŠ¨æ›¿æ¢ä¸º PostgreSQL å’Œ Redisï¼Œæ— éœ€ä¿®æ”¹ä»£ç ï¼

### 2.4 requirements.txt - ä¾èµ–ç®¡ç†

**ä½œç”¨**ï¼šå£°æ˜åº”ç”¨æ‰€éœ€çš„ Python åŒ…å’Œç‰ˆæœ¬ã€‚

**å…¸å‹å†…å®¹**ï¼š
```txt
langgraph>=0.2.0
langchain-openai>=0.2.0
langchain-core>=0.3.0
trustcall>=0.1.0
pydantic>=2.0.0
```

**ç‰ˆæœ¬å·è¯­æ³•**ï¼š

| è¯­æ³• | å«ä¹‰ | ç¤ºä¾‹ |
|------|------|------|
| `==1.0.0` | ç²¾ç¡®ç‰ˆæœ¬ | åªå®‰è£… 1.0.0 |
| `>=1.0.0` | æœ€å°ç‰ˆæœ¬ | 1.0.0 æˆ–æ›´é«˜ |
| `>=1.0,<2.0` | ç‰ˆæœ¬èŒƒå›´ | 1.x ç³»åˆ— |
| `~=1.2.3` | å…¼å®¹ç‰ˆæœ¬ | >=1.2.3, <1.3.0 |

**ç”Ÿæˆ requirements.txt**ï¼š
```bash
# æ–¹æ³• 1ï¼šæ‰‹åŠ¨ç¼–å†™ï¼ˆæ¨èç”¨äºç”Ÿäº§ï¼‰
# åªåˆ—å‡ºç›´æ¥ä¾èµ–ï¼Œç²¾ç¡®æŒ‡å®šç‰ˆæœ¬

# æ–¹æ³• 2ï¼šä»å½“å‰ç¯å¢ƒå¯¼å‡º
pip freeze > requirements.txt

# æ–¹æ³• 3ï¼šä½¿ç”¨ pipreqs åˆ†æä»£ç 
pip install pipreqs
pipreqs /path/to/project
```

### 2.5 .env - ç¯å¢ƒå˜é‡

**ä½œç”¨**ï¼šå­˜å‚¨æ•æ„Ÿä¿¡æ¯ï¼ˆAPI å¯†é’¥ç­‰ï¼‰å’Œé…ç½®å‚æ•°ã€‚

**å…¸å‹å†…å®¹**ï¼š
```bash
# API å¯†é’¥
OPENAI_API_KEY=sk-...
LANGSMITH_API_KEY=ls__...

# å¯é€‰ï¼šè‡ªå®šä¹‰é…ç½®
DATABASE_URI=postgresql://...
REDIS_URI=redis://...
```

**å®‰å…¨æœ€ä½³å®è·µ**ï¼š
```bash
# âŒ ä¸è¦åš
git add .env                    # ä¸è¦æäº¤ .env åˆ° git
print(os.getenv('OPENAI_API_KEY'))  # ä¸è¦æ‰“å°å¯†é’¥

# âœ… åº”è¯¥åš
echo ".env" >> .gitignore       # å°† .env åŠ å…¥ .gitignore
use_api_key = os.getenv('OPENAI_API_KEY')  # ä½¿ç”¨ç¯å¢ƒå˜é‡
```

### 2.6 docker-compose.yml - å®¹å™¨ç¼–æ’

**ä½œç”¨**ï¼šå®šä¹‰å’Œç®¡ç†å¤šä¸ª Docker å®¹å™¨ã€‚

**å…¸å‹å†…å®¹**ï¼š
```yaml
version: '3.8'
services:
  langgraph-redis:
    image: redis:7
    ports:
      - "6379:6379"

  langgraph-postgres:
    image: postgres:16
    environment:
      POSTGRES_PASSWORD: postgres
    ports:
      - "5432:5432"

  langgraph-api:
    image: ${IMAGE_NAME}
    env_file: .env
    ports:
      - "8123:8000"
    depends_on:
      - langgraph-redis
      - langgraph-postgres
```

**æœåŠ¡è¯´æ˜**ï¼š

| æœåŠ¡ | ä½œç”¨ | ç«¯å£ |
|------|------|------|
| `langgraph-redis` | æ¶ˆæ¯é˜Ÿåˆ—å’Œç¼“å­˜ | 6379 |
| `langgraph-postgres` | æ•°æ®æŒä¹…åŒ– | 5432 |
| `langgraph-api` | LangGraph Server | 8123 â†’ 8000 |

---

## ä¸‰ã€LangGraph CLI

### 3.1 ä»€ä¹ˆæ˜¯ CLIï¼Ÿ

**CLI (Command Line Interface)** = å‘½ä»¤è¡Œç•Œé¢

**LangGraph CLI** æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºï¼š
- æ„å»º Docker é•œåƒ
- æœ¬åœ°æµ‹è¯•éƒ¨ç½²
- ç®¡ç†éƒ¨ç½²é…ç½®

### 3.2 å®‰è£… LangGraph CLI

```python
%%capture --no-stderr
%pip install -U langgraph-cli
```

**å‘½ä»¤è§£æ**ï¼š
- `%pip`ï¼šJupyter é­”æ³•å‘½ä»¤ï¼Œåœ¨ notebook ä¸­è¿è¡Œ pip
- `install`ï¼šå®‰è£…åŒ…
- `-U` / `--upgrade`ï¼šå‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬
- `langgraph-cli`ï¼šåŒ…å

**éªŒè¯å®‰è£…**ï¼š
```bash
$ langgraph --version
langgraph-cli version 0.1.0
```

### 3.3 LangGraph CLI å¸¸ç”¨å‘½ä»¤

```bash
# æ„å»º Docker é•œåƒ
langgraph build -t <image-name>

# æœ¬åœ°è¿è¡Œï¼ˆå¼€å‘æ¨¡å¼ï¼‰
langgraph dev

# æŸ¥çœ‹é…ç½®
langgraph config

# æŸ¥çœ‹å¸®åŠ©
langgraph --help
```

---

## å››ã€æ„å»º Docker é•œåƒ

### 4.1 ä»€ä¹ˆæ˜¯ Dockerï¼Ÿ

**Docker** æ˜¯ä¸€ä¸ªå®¹å™¨åŒ–å¹³å°ï¼Œå¯ä»¥å°†åº”ç”¨å’Œæ‰€æœ‰ä¾èµ–æ‰“åŒ…åœ¨ä¸€èµ·ã€‚

**æ ¸å¿ƒæ¦‚å¿µ**ï¼š

```
Docker é•œåƒ (Image)              Docker å®¹å™¨ (Container)
     â†“                                 â†“
    æ¨¡æ¿                               å®ä¾‹
    ç±»ï¼ˆClassï¼‰                        å¯¹è±¡ï¼ˆObjectï¼‰
    é£Ÿè°±                               åšå¥½çš„èœ

    ä¸€æ¬¡æ„å»º                          å¤šæ¬¡è¿è¡Œ
    åªè¯»                               å¯è¯»å†™
```

**ä¸ºä»€ä¹ˆä½¿ç”¨ Dockerï¼Ÿ**

| é—®é¢˜ | æ²¡æœ‰ Docker | æœ‰ Docker |
|------|------------|----------|
| ç¯å¢ƒä¸ä¸€è‡´ | "åœ¨æˆ‘æœºå™¨ä¸Šèƒ½è·‘" | "åœ¨ä»»ä½•åœ°æ–¹éƒ½èƒ½è·‘" |
| ä¾èµ–å†²çª | Python ç‰ˆæœ¬å†²çª | éš”ç¦»çš„ç¯å¢ƒ |
| éƒ¨ç½²å¤æ‚ | éœ€è¦æ‰‹åŠ¨é…ç½® | ä¸€é”®éƒ¨ç½² |
| æ‰©å±•å›°éš¾ | éœ€è¦é…ç½®æ–°æœºå™¨ | å¯åŠ¨æ–°å®¹å™¨ |

### 4.2 æ„å»º LangGraph Server é•œåƒ

**æ­¥éª¤ 1ï¼šè¿›å…¥éƒ¨ç½²ç›®å½•**
```bash
$ cd module-6/deployment
```

**æ­¥éª¤ 2ï¼šæ„å»ºé•œåƒ**
```bash
$ langgraph build -t my-image
```

**å‘½ä»¤è§£æ**ï¼š
- `langgraph build`ï¼šæ„å»º Docker é•œåƒ
- `-t my-image`ï¼šç»™é•œåƒæ‰“æ ‡ç­¾ï¼ˆtagï¼‰ï¼Œåå­—æ˜¯ `my-image`
- LangGraph CLI ä¼šè‡ªåŠ¨ï¼š
  1. è¯»å– `langgraph.json` é…ç½®
  2. æ‰¾åˆ°å›¾çš„ä»£ç ï¼ˆ`task_maistro.py`ï¼‰
  3. å®‰è£… `requirements.txt` ä¸­çš„ä¾èµ–
  4. æ‰“åŒ…æˆ Docker é•œåƒ

**æ„å»ºè¿‡ç¨‹è¾“å‡ºç¤ºä¾‹**ï¼š
```
Building LangGraph Cloud API server Docker image...
[+] Building 45.2s (12/12) FINISHED
 => [internal] load build definition from Dockerfile
 => [internal] load .dockerignore
 => [1/6] FROM docker.io/library/python:3.11-slim
 => [2/6] WORKDIR /app
 => [3/6] COPY requirements.txt .
 => [4/6] RUN pip install -r requirements.txt
 => [5/6] COPY . .
 => [6/6] RUN pip install -e .
 => exporting to image
 => => naming to docker.io/library/my-image
```

**éªŒè¯é•œåƒ**ï¼š
```bash
$ docker images
REPOSITORY   TAG       IMAGE ID       CREATED          SIZE
my-image     latest    abc123def456   2 minutes ago    1.2GB
```

### 4.3 Docker é•œåƒçš„å†…å®¹

Docker é•œåƒåŒ…å«ï¼š

1. **åŸºç¡€ç³»ç»Ÿ**ï¼šPython 3.11 è¿è¡Œç¯å¢ƒ
2. **åº”ç”¨ä»£ç **ï¼štask_maistro.py ç­‰æ–‡ä»¶
3. **ä¾èµ–åŒ…**ï¼šrequirements.txt ä¸­çš„æ‰€æœ‰åŒ…
4. **LangGraph Server**ï¼šHTTP API æœåŠ¡å™¨
5. **å¯åŠ¨è„šæœ¬**ï¼šè‡ªåŠ¨å¯åŠ¨æœåŠ¡çš„å‘½ä»¤

**é•œåƒåˆ†å±‚ç»“æ„**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â† my-image (ä½ çš„åº”ç”¨)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  task_maistro.py           â”‚
â”‚  langgraph.json            â”‚
â”‚  requirements.txt          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â† Python åŒ…å±‚
â”‚  langgraph==0.2.0          â”‚
â”‚  langchain-openai==0.2.0   â”‚
â”‚  ...                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â† Python è¿è¡Œæ—¶
â”‚  Python 3.11               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â† åŸºç¡€æ“ä½œç³»ç»Ÿ
â”‚  Debian Linux (slim)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äº”ã€è®¾ç½® Redis å’Œ PostgreSQL

### 5.1 ä¸ºä»€ä¹ˆéœ€è¦ Redis å’Œ PostgreSQLï¼Ÿ

**å¼€å‘ vs ç”Ÿäº§çš„å­˜å‚¨å·®å¼‚**ï¼š

| ç»„ä»¶ | å¼€å‘ç¯å¢ƒ | ç”Ÿäº§ç¯å¢ƒ |
|------|---------|---------|
| **Checkpointer** | MemorySaver (å†…å­˜) | PostgreSQL (æ•°æ®åº“) |
| **Store** | InMemoryStore (å†…å­˜) | PostgreSQL (æ•°æ®åº“) |
| **æ¶ˆæ¯é˜Ÿåˆ—** | æ—  | Redis |

**ä¸ºä»€ä¹ˆéœ€è¦å®ƒä»¬ï¼Ÿ**

**PostgreSQLï¼ˆæ•°æ®æŒä¹…åŒ–ï¼‰**ï¼š
- ä¿å­˜å¯¹è¯å†å²ï¼ˆthreadsï¼‰
- ä¿å­˜æ£€æŸ¥ç‚¹ï¼ˆcheckpointsï¼‰
- ä¿å­˜é•¿æœŸè®°å¿†ï¼ˆstoreï¼‰
- æ•°æ®ä¸ä¼šå› é‡å¯è€Œä¸¢å¤±

**Redisï¼ˆç¼“å­˜å’Œé˜Ÿåˆ—ï¼‰**ï¼š
- æµå¼ä¼ è¾“ï¼ˆstreamingï¼‰çš„ä¸­é—´ç»“æœ
- ä»»åŠ¡é˜Ÿåˆ—ï¼ˆbackground runsï¼‰
- ä¼šè¯ç¼“å­˜
- é«˜æ€§èƒ½è¯»å†™

### 5.2 æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨å·²æœ‰çš„ Redis å’Œ PostgreSQL

å¦‚æœä½ å·²ç»æœ‰è¿è¡Œçš„ Redis å’Œ PostgreSQL æœåŠ¡å™¨ï¼š

```bash
docker run \
    --env-file .env \
    -p 8123:8000 \
    -e REDIS_URI="redis://your-redis-server:6379" \
    -e DATABASE_URI="postgresql://user:pass@your-postgres:5432/db" \
    -e LANGSMITH_API_KEY="your-api-key" \
    my-image
```

**å‘½ä»¤è§£æ**ï¼š
- `docker run`ï¼šè¿è¡Œå®¹å™¨
- `--env-file .env`ï¼šåŠ è½½ .env æ–‡ä»¶ä¸­çš„ç¯å¢ƒå˜é‡
- `-p 8123:8000`ï¼šç«¯å£æ˜ å°„ï¼ˆä¸»æœº8123 â†’ å®¹å™¨8000ï¼‰
- `-e KEY=VALUE`ï¼šè®¾ç½®ç¯å¢ƒå˜é‡
- `my-image`ï¼šä½¿ç”¨çš„é•œåƒå

**ç«¯å£æ˜ å°„è¯¦è§£**ï¼š
```
-p 8123:8000
   ^^^^  ^^^^
   ä¸»æœº  å®¹å™¨
   ç«¯å£  ç«¯å£

è®¿é—®: http://localhost:8123
  â†“
æ˜ å°„åˆ°å®¹å™¨å†…çš„: http://container:8000
```

### 5.3 æ–¹æ¡ˆäºŒï¼šä½¿ç”¨ docker-compose ä¸€é”®å¯åŠ¨

**æ¨èæ–¹æ¡ˆ**ï¼šä½¿ç”¨ docker-compose åŒæ—¶ç®¡ç†ä¸‰ä¸ªå®¹å™¨ã€‚

**æ­¥éª¤ 1ï¼šå‡†å¤‡é…ç½®æ–‡ä»¶**
```bash
# å¤åˆ¶ç¤ºä¾‹æ–‡ä»¶
$ cp docker-compose-example.yml docker-compose.yml

# ç¼–è¾‘é…ç½®
$ nano docker-compose.yml
```

**æ­¥éª¤ 2ï¼šè®¾ç½®ç¯å¢ƒå˜é‡**

åˆ›å»ºæˆ–ç¼–è¾‘ `.env` æ–‡ä»¶ï¼š
```bash
# é•œåƒåç§°ï¼ˆä½ åˆšæ‰æ„å»ºçš„ï¼‰
IMAGE_NAME=my-image

# API å¯†é’¥
LANGSMITH_API_KEY=ls__your-key-here
OPENAI_API_KEY=sk-your-key-here
```

**æ­¥éª¤ 3ï¼šå¯åŠ¨æ‰€æœ‰æœåŠ¡**
```bash
$ cd module-6/deployment
$ docker compose up
```

**å¯åŠ¨è¿‡ç¨‹è¾“å‡º**ï¼š
```
[+] Running 3/3
 âœ” Container deployment-langgraph-redis-1     Started
 âœ” Container deployment-langgraph-postgres-1  Started
 âœ” Container deployment-langgraph-api-1       Started

langgraph-api-1     | INFO:     Started server process
langgraph-api-1     | INFO:     Waiting for application startup.
langgraph-api-1     | INFO:     Application startup complete.
langgraph-api-1     | INFO:     Uvicorn running on http://0.0.0.0:8000
```

**éªŒè¯æœåŠ¡**ï¼š
```bash
# æ–¹æ³• 1ï¼šæµè§ˆå™¨è®¿é—®
# æ‰“å¼€ http://localhost:8123

# æ–¹æ³• 2ï¼šcurl æµ‹è¯•
$ curl http://localhost:8123/health
{"status": "ok"}

# æ–¹æ³• 3ï¼šæŸ¥çœ‹ API æ–‡æ¡£
# æ‰“å¼€ http://localhost:8123/docs
```

### 5.4 docker-compose è¯¦è§£

**docker-compose.yml ç»“æ„**ï¼š
```yaml
version: '3.8'

services:
  # æœåŠ¡ 1ï¼šRedis
  langgraph-redis:
    image: redis:7                # ä½¿ç”¨å®˜æ–¹ Redis é•œåƒ
    healthcheck:                  # å¥åº·æ£€æŸ¥
      test: ["CMD", "redis-cli", "ping"]
      interval: 5s
      timeout: 1s
      retries: 5

  # æœåŠ¡ 2ï¼šPostgreSQL
  langgraph-postgres:
    image: postgres:16            # ä½¿ç”¨å®˜æ–¹ Postgres é•œåƒ
    environment:
      POSTGRES_DB: langgraph
      POSTGRES_USER: langgraph
      POSTGRES_PASSWORD: langgraph

  # æœåŠ¡ 3ï¼šLangGraph API
  langgraph-api:
    image: ${IMAGE_NAME}          # ä½¿ç”¨ä½ æ„å»ºçš„é•œåƒ
    env_file: .env                # åŠ è½½ç¯å¢ƒå˜é‡
    ports:
      - "8123:8000"               # ç«¯å£æ˜ å°„
    depends_on:                   # ä¾èµ–å…³ç³»
      - langgraph-redis
      - langgraph-postgres
    environment:
      REDIS_URI: redis://langgraph-redis:6379
      POSTGRES_URI: postgresql://langgraph:langgraph@langgraph-postgres:5432/langgraph
```

**æœåŠ¡ä¾èµ–å…³ç³»**ï¼š
```
langgraph-api
    â†“ depends_on
    â”œâ†’ langgraph-redis    (å¿…é¡»å…ˆå¯åŠ¨)
    â””â†’ langgraph-postgres (å¿…é¡»å…ˆå¯åŠ¨)
```

**ç½‘ç»œé€šä¿¡**ï¼š
```
Docker å†…éƒ¨ç½‘ç»œï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  langgraph-redis                        â”‚
â”‚  (hostname: langgraph-redis)            â”‚
â”‚  (port: 6379)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  langgraph-postgres                     â”‚
â”‚  (hostname: langgraph-postgres)         â”‚
â”‚  (port: 5432)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  langgraph-api                          â”‚
â”‚  (å¯ä»¥é€šè¿‡ä¸»æœºåè®¿é—®å…¶ä»–æœåŠ¡)             â”‚
â”‚  (å†…éƒ¨ç«¯å£: 8000)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“ ç«¯å£æ˜ å°„
    localhost:8123 (å¤–éƒ¨è®¿é—®)
```

---

## å…­ã€å¯åŠ¨å’ŒéªŒè¯éƒ¨ç½²

### 6.1 å¯åŠ¨éƒ¨ç½²

**å‰å°è¿è¡Œ**ï¼ˆæŸ¥çœ‹æ—¥å¿—ï¼‰ï¼š
```bash
$ docker compose up
```
- ä¼šå ç”¨ç»ˆç«¯
- å®æ—¶æ˜¾ç¤ºæ—¥å¿—
- Ctrl+C åœæ­¢

**åå°è¿è¡Œ**ï¼ˆå®ˆæŠ¤è¿›ç¨‹ï¼‰ï¼š
```bash
$ docker compose up -d
```
- é‡Šæ”¾ç»ˆç«¯
- æ—¥å¿—å†™å…¥æ–‡ä»¶
- éœ€è¦æ‰‹åŠ¨åœæ­¢

### 6.2 æŸ¥çœ‹æœåŠ¡çŠ¶æ€

```bash
# æŸ¥çœ‹è¿è¡Œçš„å®¹å™¨
$ docker compose ps

NAME                              STATUS    PORTS
deployment-langgraph-api-1        Up        0.0.0.0:8123->8000/tcp
deployment-langgraph-postgres-1   Up        0.0.0.0:5432->5432/tcp
deployment-langgraph-redis-1      Up        0.0.0.0:6379->6379/tcp
```

### 6.3 æŸ¥çœ‹æ—¥å¿—

```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡çš„æ—¥å¿—
$ docker compose logs

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡çš„æ—¥å¿—
$ docker compose logs langgraph-api

# å®æ—¶è·Ÿè¸ªæ—¥å¿—
$ docker compose logs -f langgraph-api
```

### 6.4 è®¿é—®éƒ¨ç½²

éƒ¨ç½²æˆåŠŸåï¼Œä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è®¿é—®ï¼š

**1. API ç«¯ç‚¹**ï¼š
```
http://localhost:8123
```

**2. API æ–‡æ¡£ï¼ˆSwagger UIï¼‰**ï¼š
```
http://localhost:8123/docs
```
- äº¤äº’å¼ API æ–‡æ¡£
- å¯ä»¥ç›´æ¥æµ‹è¯• API
- æŸ¥çœ‹æ‰€æœ‰å¯ç”¨ç«¯ç‚¹

**3. LangGraph Studio**ï¼š
```
https://smith.langchain.com/studio/?baseUrl=http://127.0.0.1:8123
```
- å¯è§†åŒ–å›¾ç¼–è¾‘å™¨
- è°ƒè¯•å’Œç›‘æ§
- æŸ¥çœ‹è¿è¡Œå†å²

### 6.5 æµ‹è¯• API

**æµ‹è¯•å¥åº·æ£€æŸ¥**ï¼š
```bash
$ curl http://localhost:8123/health
{"status": "ok"}
```

**æµ‹è¯•å›¾åˆ—è¡¨**ï¼š
```bash
$ curl http://localhost:8123/graphs
[
  {
    "graph_id": "task_maistro",
    "name": "task_maistro",
    "description": null
  }
]
```

**ä½¿ç”¨ Python SDK æµ‹è¯•**ï¼š
```python
from langgraph_sdk import get_client

# è¿æ¥åˆ°éƒ¨ç½²
client = get_client(url="http://localhost:8123")

# åˆ›å»ºçº¿ç¨‹
thread = await client.threads.create()
print(thread)
```

### 6.6 åœæ­¢å’Œæ¸…ç†

**åœæ­¢æ‰€æœ‰æœåŠ¡**ï¼š
```bash
$ docker compose down
```

**åœæ­¢å¹¶åˆ é™¤æ•°æ®å·**ï¼š
```bash
$ docker compose down -v
```
- ä¼šåˆ é™¤ PostgreSQL ä¸­çš„æ‰€æœ‰æ•°æ®
- è°¨æ…ä½¿ç”¨ï¼

**é‡å¯æœåŠ¡**ï¼š
```bash
$ docker compose restart
```

---

## ä¸ƒã€éƒ¨ç½²æ¶æ„æ·±å…¥ç†è§£

### 7.1 LangGraph Server æ¶æ„

```
                  å®¢æˆ·ç«¯è¯·æ±‚
                      â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   HTTP API   â”‚
              â”‚  (Port 8123) â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â†“                         â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  HTTP   â”‚              â”‚  Queue  â”‚
    â”‚ Worker  â”‚              â”‚ Worker  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“                         â†“
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                  â†“         â†“
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  Redis   â”‚  â”‚Postgres  â”‚
           â”‚ (ç¼“å­˜)   â”‚  â”‚ (å­˜å‚¨)   â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç»„ä»¶è¯´æ˜**ï¼š

**HTTP Worker**ï¼š
- å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚
- ç®¡ç† WebSocket è¿æ¥
- æµå¼ä¼ è¾“ç»“æœ
- è¿”å›å“åº”

**Queue Worker**ï¼š
- æ‰§è¡Œå›¾çš„è¿è¡Œ
- å¤„ç†åå°ä»»åŠ¡
- ç®¡ç†é•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡
- å†™å…¥ç»“æœåˆ°æ•°æ®åº“

**Redis**ï¼š
- ä»»åŠ¡é˜Ÿåˆ—
- æµå¼ä¼ è¾“ç¼“å­˜
- ä¼šè¯ç¼“å­˜
- å‘å¸ƒ/è®¢é˜…

**PostgreSQL**ï¼š
- çº¿ç¨‹ï¼ˆthreadsï¼‰
- è¿è¡Œå†å²ï¼ˆrunsï¼‰
- æ£€æŸ¥ç‚¹ï¼ˆcheckpointsï¼‰
- Store æ•°æ®

### 7.2 è¯·æ±‚å¤„ç†æµç¨‹

**åŒæ­¥è¯·æ±‚æµç¨‹**ï¼š
```
1. å®¢æˆ·ç«¯å‘é€è¯·æ±‚
   â†“
2. HTTP Worker æ¥æ”¶
   â†“
3. Queue Worker å¼€å§‹æ‰§è¡Œå›¾
   â†“
4. å›¾æ‰§è¡Œå®Œæˆ
   â†“
5. ç»“æœå†™å…¥ PostgreSQL
   â†“
6. HTTP Worker è¿”å›ç»“æœ
```

**æµå¼è¯·æ±‚æµç¨‹**ï¼š
```
1. å®¢æˆ·ç«¯å‘é€æµå¼è¯·æ±‚
   â†“
2. HTTP Worker å»ºç«‹ WebSocket
   â†“
3. Queue Worker å¼€å§‹æ‰§è¡Œ
   â†“
4. æ‰§è¡Œè¿‡ç¨‹ä¸­å‘å¸ƒæ›´æ–°åˆ° Redis
   â†“
5. HTTP Worker ä» Redis è®¢é˜…
   â†“
6. å®æ—¶æ¨é€ç»™å®¢æˆ·ç«¯
   â†“
7. æ‰§è¡Œå®Œæˆï¼Œå…³é—­è¿æ¥
```

### 7.3 æ•°æ®æŒä¹…åŒ–

**å¼€å‘ç¯å¢ƒ**ï¼š
```python
# å†…å­˜å­˜å‚¨ï¼ˆé‡å¯ä¸¢å¤±ï¼‰
checkpointer = MemorySaver()
store = InMemoryStore()
```

**ç”Ÿäº§ç¯å¢ƒ**ï¼š
```python
# è‡ªåŠ¨ä½¿ç”¨ PostgreSQLï¼ˆæŒä¹…åŒ–ï¼‰
# æ— éœ€ä¿®æ”¹ä»£ç ï¼
checkpointer = PostgresSaver()  # è‡ªåŠ¨
store = PostgresStore()         # è‡ªåŠ¨
```

**æ•°æ®è¡¨ç»“æ„**ï¼š
```sql
-- threads è¡¨ï¼šå¯¹è¯çº¿ç¨‹
CREATE TABLE threads (
    thread_id TEXT PRIMARY KEY,
    created_at TIMESTAMP,
    metadata JSONB
);

-- checkpoints è¡¨ï¼šçŠ¶æ€æ£€æŸ¥ç‚¹
CREATE TABLE checkpoints (
    thread_id TEXT,
    checkpoint_id TEXT,
    parent_checkpoint_id TEXT,
    type TEXT,
    checkpoint JSONB,
    PRIMARY KEY (thread_id, checkpoint_id)
);

-- store è¡¨ï¼šé•¿æœŸè®°å¿†
CREATE TABLE store (
    namespace TEXT[],
    key TEXT,
    value JSONB,
    created_at TIMESTAMP,
    updated_at TIMESTAMP,
    PRIMARY KEY (namespace, key)
);
```

---

## å…«ã€å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### 8.1 æ„å»ºé•œåƒå¤±è´¥

**é—®é¢˜**ï¼š
```
ERROR: failed to solve: failed to compute cache key
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# 1. ç¡®ä¿ Docker æ­£åœ¨è¿è¡Œ
$ docker ps

# 2. æ¸…ç† Docker ç¼“å­˜
$ docker system prune -a

# 3. é‡æ–°æ„å»º
$ langgraph build -t my-image --no-cache
```

### 8.2 ç«¯å£å·²è¢«å ç”¨

**é—®é¢˜**ï¼š
```
Error: bind: address already in use
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
$ lsof -i :8123

# æ€æ­»è¿›ç¨‹
$ kill -9 <PID>

# æˆ–è€…ä¿®æ”¹ docker-compose.yml ä¸­çš„ç«¯å£
ports:
  - "8124:8000"  # æ”¹ç”¨ 8124 ç«¯å£
```

### 8.3 ç¯å¢ƒå˜é‡æœªåŠ è½½

**é—®é¢˜**ï¼šAPI å¯†é’¥æœªç”Ÿæ•ˆ

**æ£€æŸ¥æ¸…å•**ï¼š
1. `.env` æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Ÿ
2. `.env` æ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®ï¼Ÿ
3. `docker-compose.yml` ä¸­æ˜¯å¦æŒ‡å®šäº† `env_file: .env`ï¼Ÿ
4. æ˜¯å¦é‡å¯äº†å®¹å™¨ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# éªŒè¯ç¯å¢ƒå˜é‡
$ docker compose config

# é‡å¯å®¹å™¨ä»¥åŠ è½½æ–°çš„ç¯å¢ƒå˜é‡
$ docker compose down
$ docker compose up
```

### 8.4 æ•°æ®åº“è¿æ¥å¤±è´¥

**é—®é¢˜**ï¼š
```
Could not connect to database
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# 1. æ£€æŸ¥ PostgreSQL æ˜¯å¦å¯åŠ¨
$ docker compose ps langgraph-postgres

# 2. æŸ¥çœ‹ PostgreSQL æ—¥å¿—
$ docker compose logs langgraph-postgres

# 3. éªŒè¯æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²
# åœ¨ docker-compose.yml ä¸­æ£€æŸ¥ POSTGRES_URI
```

### 8.5 Redis è¿æ¥å¤±è´¥

**é—®é¢˜**ï¼š
```
Could not connect to Redis
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# 1. æ£€æŸ¥ Redis æ˜¯å¦å¯åŠ¨
$ docker compose ps langgraph-redis

# 2. æµ‹è¯• Redis è¿æ¥
$ docker exec -it deployment-langgraph-redis-1 redis-cli ping
PONG

# 3. æ£€æŸ¥ REDIS_URI é…ç½®
```

---

## ä¹ã€éƒ¨ç½²æœ€ä½³å®è·µ

### 9.1 å¼€å‘å·¥ä½œæµ

**æ¨èæµç¨‹**ï¼š
```
1. æœ¬åœ°å¼€å‘å’Œæµ‹è¯•
   â†“
2. æ„å»º Docker é•œåƒ
   â†“
3. æœ¬åœ°æµ‹è¯•éƒ¨ç½²ï¼ˆdocker-composeï¼‰
   â†“
4. éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ
   â†“
5. éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
```

### 9.2 ç‰ˆæœ¬ç®¡ç†

**é•œåƒç‰ˆæœ¬æ ‡è®°**ï¼š
```bash
# å¼€å‘ç‰ˆæœ¬
langgraph build -t my-image:dev

# æµ‹è¯•ç‰ˆæœ¬
langgraph build -t my-image:test

# ç”Ÿäº§ç‰ˆæœ¬
langgraph build -t my-image:v1.0.0
langgraph build -t my-image:latest
```

### 9.3 ç¯å¢ƒåˆ†ç¦»

**å¤šç¯å¢ƒé…ç½®**ï¼š
```
project/
â”œâ”€â”€ .env.development    # å¼€å‘ç¯å¢ƒ
â”œâ”€â”€ .env.test          # æµ‹è¯•ç¯å¢ƒ
â”œâ”€â”€ .env.production    # ç”Ÿäº§ç¯å¢ƒ
â””â”€â”€ docker-compose.yml
```

**ä½¿ç”¨ä¸åŒç¯å¢ƒ**ï¼š
```bash
# å¼€å‘ç¯å¢ƒ
$ cp .env.development .env
$ docker compose up

# ç”Ÿäº§ç¯å¢ƒ
$ cp .env.production .env
$ docker compose up
```

### 9.4 ç›‘æ§å’Œæ—¥å¿—

**æ—¥å¿—ç®¡ç†**ï¼š
```bash
# æŒç»­æŸ¥çœ‹æ—¥å¿—
$ docker compose logs -f

# ä¿å­˜æ—¥å¿—åˆ°æ–‡ä»¶
$ docker compose logs > deployment.log

# ä½¿ç”¨æ—¥å¿—èšåˆå·¥å…·ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
# - ELK Stack (Elasticsearch, Logstash, Kibana)
# - Grafana Loki
# - CloudWatch (AWS)
```

### 9.5 å¤‡ä»½å’Œæ¢å¤

**å¤‡ä»½ PostgreSQL æ•°æ®**ï¼š
```bash
# å¤‡ä»½
$ docker exec deployment-langgraph-postgres-1 \
  pg_dump -U langgraph langgraph > backup.sql

# æ¢å¤
$ docker exec -i deployment-langgraph-postgres-1 \
  psql -U langgraph langgraph < backup.sql
```

---

## åã€Python å’Œ Docker çŸ¥è¯†æ€»ç»“

### 10.1 Docker åŸºç¡€å‘½ä»¤

```bash
# é•œåƒç®¡ç†
docker images                    # åˆ—å‡ºé•œåƒ
docker rmi <image-id>           # åˆ é™¤é•œåƒ
docker pull <image-name>        # æ‹‰å–é•œåƒ

# å®¹å™¨ç®¡ç†
docker ps                        # åˆ—å‡ºè¿è¡Œçš„å®¹å™¨
docker ps -a                     # åˆ—å‡ºæ‰€æœ‰å®¹å™¨
docker stop <container-id>      # åœæ­¢å®¹å™¨
docker rm <container-id>        # åˆ é™¤å®¹å™¨
docker exec -it <container> sh  # è¿›å…¥å®¹å™¨

# docker-compose
docker compose up               # å¯åŠ¨æœåŠ¡
docker compose down             # åœæ­¢æœåŠ¡
docker compose ps               # æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker compose logs             # æŸ¥çœ‹æ—¥å¿—
docker compose restart          # é‡å¯æœåŠ¡
```

### 10.2 ç«¯å£å’Œç½‘ç»œ

**ç«¯å£æ˜ å°„æ ¼å¼**ï¼š
```
-p <host-port>:<container-port>
    ä¸»æœºç«¯å£    å®¹å™¨ç«¯å£

ç¤ºä¾‹ï¼š
-p 8123:8000
  ^^^^  ^^^^
  å¤–éƒ¨  å†…éƒ¨
```

**ç½‘ç»œé€šä¿¡**ï¼š
```python
# å®¹å™¨å†…è®¿é—®å…¶ä»–å®¹å™¨
# ä½¿ç”¨æœåŠ¡åä½œä¸ºä¸»æœºå
redis_url = "redis://langgraph-redis:6379"
postgres_url = "postgresql://langgraph-postgres:5432"

# ä¸»æœºè®¿é—®å®¹å™¨
# ä½¿ç”¨ localhost å’Œæ˜ å°„çš„ç«¯å£
api_url = "http://localhost:8123"
```

### 10.3 ç¯å¢ƒå˜é‡å¤„ç†

**Python è¯»å–ç¯å¢ƒå˜é‡**ï¼š
```python
import os

# æ–¹æ³• 1ï¼šä½¿ç”¨ os.getenvï¼ˆæ¨èï¼‰
api_key = os.getenv('OPENAI_API_KEY')
# å¦‚æœä¸å­˜åœ¨ï¼Œè¿”å› None

# æ–¹æ³• 2ï¼šä½¿ç”¨ os.getenv å¸¦é»˜è®¤å€¼
api_key = os.getenv('OPENAI_API_KEY', 'default-key')

# æ–¹æ³• 3ï¼šä½¿ç”¨ os.environï¼ˆä¸æ¨èï¼‰
api_key = os.environ['OPENAI_API_KEY']
# å¦‚æœä¸å­˜åœ¨ï¼Œä¼šæŠ›å‡º KeyError
```

**åŠ è½½ .env æ–‡ä»¶**ï¼š
```python
from dotenv import load_dotenv
import os

# åŠ è½½ .env æ–‡ä»¶
load_dotenv()

# ç°åœ¨å¯ä»¥è¯»å–ç¯å¢ƒå˜é‡äº†
api_key = os.getenv('OPENAI_API_KEY')
```

---

## åä¸€ã€ä¸‹ä¸€æ­¥

### 11.1 æœ¬èŠ‚å›é¡¾

ä½ å·²ç»å­¦ä¼šäº†ï¼š
- âœ… ç†è§£ LangGraph éƒ¨ç½²çš„æ–‡ä»¶ç»“æ„
- âœ… ä½¿ç”¨ LangGraph CLI æ„å»º Docker é•œåƒ
- âœ… ä½¿ç”¨ docker-compose ç®¡ç†å¤šå®¹å™¨éƒ¨ç½²
- âœ… å¯åŠ¨å’ŒéªŒè¯è‡ªæ‰˜ç®¡éƒ¨ç½²
- âœ… ç†è§£ LangGraph Platform çš„æ¶æ„

### 11.2 ä¸‹èŠ‚é¢„å‘Š

åœ¨ **6.2-connecting** ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ ï¼š
- ä½¿ç”¨ LangGraph SDK è¿æ¥åˆ°éƒ¨ç½²
- Remote Graph çš„ä½¿ç”¨
- Runs å’Œ Threads çš„ç®¡ç†
- Store API çš„æ“ä½œ
- æµå¼ä¼ è¾“å’Œåå°è¿è¡Œ

### 11.3 è¿›é˜¶å­¦ä¹ 

**äº‘å¹³å°éƒ¨ç½²**ï¼š
- AWS ECS/Fargate
- Google Cloud Run
- Azure Container Instances
- Kubernetes

**ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–**ï¼š
- è´Ÿè½½å‡è¡¡
- è‡ªåŠ¨æ‰©å±•
- é«˜å¯ç”¨é…ç½®
- å®‰å…¨åŠ å›º

---

## åäºŒã€æ€»ç»“

### 12.1 æ ¸å¿ƒè¦ç‚¹

1. **éƒ¨ç½² = è®©åº”ç”¨åœ¨ç”Ÿäº§ç¯å¢ƒè¿è¡Œ**
   - éœ€è¦æŒä¹…åŒ–å­˜å‚¨ï¼ˆPostgreSQLï¼‰
   - éœ€è¦ç¼“å­˜å’Œé˜Ÿåˆ—ï¼ˆRedisï¼‰
   - éœ€è¦å®¹å™¨åŒ–ï¼ˆDockerï¼‰

2. **å¿…éœ€çš„æ–‡ä»¶**
   - `langgraph.json`ï¼šé…ç½®
   - `task_maistro.py`ï¼šä»£ç 
   - `requirements.txt`ï¼šä¾èµ–
   - `.env`ï¼šç¯å¢ƒå˜é‡
   - `docker-compose.yml`ï¼šç¼–æ’

3. **éƒ¨ç½²æµç¨‹**
   ```
   ç¼–å†™ä»£ç  â†’ æ„å»ºé•œåƒ â†’ å¯åŠ¨æœåŠ¡ â†’ éªŒè¯è¿è¡Œ
   ```

4. **LangGraph Platform æ¶æ„**
   ```
   Client â†’ HTTP Worker â†’ Queue Worker
                â†“              â†“
              Redis      PostgreSQL
   ```

### 12.2 å…³é”®å‘½ä»¤é€ŸæŸ¥

```bash
# æ„å»ºé•œåƒ
langgraph build -t my-image

# å¯åŠ¨éƒ¨ç½²
docker compose up

# æŸ¥çœ‹çŠ¶æ€
docker compose ps

# æŸ¥çœ‹æ—¥å¿—
docker compose logs -f

# åœæ­¢éƒ¨ç½²
docker compose down
```

### 12.3 æœ€ä½³å®è·µ

- âœ… ä½¿ç”¨ç‰ˆæœ¬æ ‡è®°ç®¡ç†é•œåƒ
- âœ… ä¸è¦æäº¤ .env åˆ° git
- âœ… å®šæœŸå¤‡ä»½ PostgreSQL æ•°æ®
- âœ… ç›‘æ§æ—¥å¿—å’Œæ€§èƒ½
- âœ… ä½¿ç”¨ç¯å¢ƒåˆ†ç¦»ï¼ˆdev/test/prodï¼‰

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼š1.0
**æœ€åæ›´æ–°**ï¼š2024-11-05
**ä½œè€…**ï¼šAI Assistant
**åŸºäº**ï¼šLangChain Academy Module-6 Lesson 6.1

æ­å–œä½ è¿ˆå‡ºäº† LangGraph ç”Ÿäº§éƒ¨ç½²çš„ç¬¬ä¸€æ­¥ï¼ğŸ‰ ç°åœ¨ä½ å·²ç»çŸ¥é“å¦‚ä½•å°†åº”ç”¨éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒäº†ã€‚æ¥ä¸‹æ¥è®©æˆ‘ä»¬å­¦ä¹ å¦‚ä½•è¿æ¥å’Œä½¿ç”¨è¿™ä¸ªéƒ¨ç½²ã€‚

# LangGraph å¤šæ™ºèƒ½ä½“ååŒç ”ç©¶è¯¦ç»†è§£è¯»

## ğŸ“š æ¦‚è¿°

**Multi-Agent Supervisor Pattern** æ˜¯ Deep Research ç³»ç»Ÿçš„é«˜çº§æ¶æ„ï¼Œç”¨äºå¤„ç†å¤æ‚çš„å¤šä¸»é¢˜ç ”ç©¶ä»»åŠ¡ã€‚æœ¬ç« è®²è§£å¦‚ä½•ä½¿ç”¨ Supervisor åè°ƒå¤šä¸ª Research Agent å¹¶è¡Œå·¥ä½œã€‚

**æ ¸å¿ƒä»·å€¼ï¼š**
- ğŸ”€ **ä¸Šä¸‹æ–‡éš”ç¦»** - æ¯ä¸ª Agent ä¸“æ³¨å•ä¸€ä¸»é¢˜
- âš¡ **å¹¶è¡ŒåŠ é€Ÿ** - åŒæ—¶ç ”ç©¶å¤šä¸ªå­ä¸»é¢˜
- ğŸ¯ **è´¨é‡æå‡** - é¿å…å• Agent çš„ä¸Šä¸‹æ–‡å†²çª
- ğŸ§© **çµæ´»åˆ†è§£** - Supervisor æ™ºèƒ½å†³å®šæ˜¯å¦å¹¶è¡Œ

---

## ğŸ¯ æ ¸å¿ƒé—®é¢˜ï¼šä¸ºä»€ä¹ˆéœ€è¦å¤šæ™ºèƒ½ä½“ï¼Ÿ

### å• Agent çš„å±€é™

**é—®é¢˜åœºæ™¯ï¼šå¯¹æ¯”ä»»åŠ¡**

```python
User: "å¯¹æ¯” OpenAIã€Anthropicã€Google çš„ AI å®‰å…¨æ–¹æ³•"

å• Agent æ‰§è¡Œ:
  Search 1: "OpenAI AI safety approach"
  Search 2: "Anthropic AI safety Constitutional AI"
  Search 3: "Google AI safety research"
  Search 4: "OpenAI alignment research"  # å›åˆ° OpenAI
  Search 5: "Anthropic interpretability"  # å›åˆ° Anthropic
  ...

é—®é¢˜:
  âŒ ä¸Šä¸‹æ–‡æ··ä¹± - ä¸‰ä¸ªä¸»é¢˜çš„ä¿¡æ¯äº¤ç»‡
  âŒ Context Clash - "OpenAI" å’Œ "Anthropic" ä¿¡æ¯ç›¸äº’å¹²æ‰°
  âŒ æœç´¢ä½æ•ˆ - åœ¨ä¸»é¢˜é—´åå¤è·³è½¬
  âŒ token æµªè´¹ - æ‰€æœ‰ä¿¡æ¯éƒ½åœ¨ä¸€ä¸ªä¸Šä¸‹æ–‡ä¸­
```

### å¤š Agent çš„ä¼˜åŠ¿

```python
Supervisor å†³ç­–:
  "è¿™æ˜¯å¯¹æ¯”ä»»åŠ¡ï¼Œåˆ†è§£ä¸º 3 ä¸ªç‹¬ç«‹å­ä¸»é¢˜"

Agent A ä¸“æ³¨: OpenAI AI å®‰å…¨
  Search 1: "OpenAI AI safety approach"
  Search 2: "OpenAI alignment team research"
  ç»“è®º: åŸºäº RLHF å’Œ superalignment...

Agent B ä¸“æ³¨: Anthropic AI å®‰å…¨
  Search 1: "Anthropic Constitutional AI"
  Search 2: "Anthropic interpretability research"
  ç»“è®º: åŸºäº Constitutional AI å’Œå¯è§£é‡Šæ€§...

Agent C ä¸“æ³¨: Google AI å®‰å…¨
  Search 1: "Google AI safety research DeepMind"
  Search 2: "Google responsible AI principles"
  ç»“è®º: åŸºäºä¼¦ç†å®¡æŸ¥å’Œæµ‹è¯•æ¡†æ¶...

ä¼˜åŠ¿:
  âœ… ä¸Šä¸‹æ–‡æ¸…æ™° - æ¯ä¸ª Agent åªå…³æ³¨ä¸€ä¸ªä¸»é¢˜
  âœ… æ·±åº¦èšç„¦ - å¯ä»¥æ·±å…¥æŒ–æ˜ç»†èŠ‚
  âœ… å¹¶è¡Œæ‰§è¡Œ - æ€»æ—¶é—´ = max(å„ Agent æ—¶é—´)
  âœ… è´¨é‡æ›´é«˜ - é¿å…ä¿¡æ¯æ··æ·†
```

---

## ğŸ—ï¸ Supervisor Pattern æ¶æ„

### æ•´ä½“æµç¨‹

```
ç ”ç©¶ç®€æŠ¥è¾“å…¥
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Supervisor åˆ†æ                   â”‚
â”‚ - è¿™æ˜¯å¯¹æ¯”ä»»åŠ¡å—ï¼Ÿ                â”‚
â”‚ - éœ€è¦åˆ†è§£ä¸ºå‡ ä¸ªå­ä¸»é¢˜ï¼Ÿ          â”‚
â”‚ - æ¯ä¸ªå­ä¸»é¢˜çš„ç ”ç©¶é‡ç‚¹ï¼Ÿ          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Supervisor å†³ç­–                   â”‚
â”‚                                  â”‚
â”‚ é€‰é¡¹ A: å• Agent                  â”‚
â”‚  â†’ ç®€å•æŸ¥è¯¢ï¼Œæ— éœ€å¹¶è¡Œ             â”‚
â”‚                                  â”‚
â”‚ é€‰é¡¹ B: å¤š Agent å¹¶è¡Œ             â”‚
â”‚  â†’ å¯¹æ¯”ä»»åŠ¡ï¼Œåˆ†è§£ä¸ºå­ä¸»é¢˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“ (é€‰æ‹© B)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Agent Aâ”‚ Agent Bâ”‚ Agent Câ”‚  â† å¹¶è¡Œæ‰§è¡Œ
â”‚ ä¸»é¢˜ 1 â”‚ ä¸»é¢˜ 2 â”‚ ä¸»é¢˜ 3 â”‚
â”‚        â”‚        â”‚        â”‚
â”‚ ç ”ç©¶ä¸­ â”‚ ç ”ç©¶ä¸­ â”‚ ç ”ç©¶ä¸­ â”‚
â”‚   â†“    â”‚   â†“    â”‚   â†“    â”‚
â”‚ å‹ç¼©   â”‚ å‹ç¼©   â”‚ å‹ç¼©   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Supervisor èšåˆ                   â”‚
â”‚ - æ”¶é›†æ‰€æœ‰ Agent çš„ç ”ç©¶ç»“æœ       â”‚
â”‚ - åˆå¹¶å‹ç¼©ç»“æœå’ŒåŸå§‹ç¬”è®°          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
æœ€ç»ˆç ”ç©¶æˆæœ
```

---

## ğŸ”§ æ ¸å¿ƒæŠ€æœ¯å®ç°

### 1. çŠ¶æ€å®šä¹‰

```python
class SupervisorState(TypedDict):
    """Supervisor çŠ¶æ€"""
    # Supervisor çš„å¯¹è¯å†å²
    supervisor_messages: Annotated[Sequence[BaseMessage], add_messages]
    # ç ”ç©¶ç®€æŠ¥ï¼ˆæ¥è‡ª Scopingï¼‰
    research_brief: str
    # å‹ç¼©åçš„ç ”ç©¶ç¬”è®°ï¼ˆæ¥è‡ªå„ Agentï¼‰
    notes: Annotated[list[str], operator.add]
    # ç ”ç©¶è¿­ä»£è®¡æ•°
    research_iterations: int
    # åŸå§‹ç¬”è®°ï¼ˆæœªå‹ç¼©ï¼‰
    raw_notes: Annotated[list[str], operator.add]
```

---

### 2. Supervisor å·¥å…·

```python
@tool
class ConductResearch(BaseModel):
    """å§”æ‰˜ç ”ç©¶ä»»åŠ¡ç»™å­ Agent"""
    research_topic: str = Field(
        description="è¦ç ”ç©¶çš„ä¸»é¢˜ã€‚åº”è¯¥æ˜¯å•ä¸€ä¸»é¢˜ï¼Œå¹¶è¯¦ç»†æè¿°ï¼ˆè‡³å°‘ä¸€æ®µè¯ï¼‰"
    )

@tool
class ResearchComplete(BaseModel):
    """æ ‡è®°ç ”ç©¶å®Œæˆ"""
    pass
```

**ä½¿ç”¨æ–¹å¼ï¼š**

```python
# Supervisor è°ƒç”¨ ConductResearch
Tool Call: ConductResearch(
    research_topic="æ·±å…¥ç ”ç©¶ OpenAI çš„ AI å®‰å…¨æ–¹æ³•ï¼ŒåŒ…æ‹¬..."
)

# è§¦å‘ä¸€ä¸ª Research Agent æ‰§è¡Œ
```

---

### 3. Supervisor å†³ç­–èŠ‚ç‚¹ï¼ˆå…³é”®ï¼‰

```python
async def supervisor(state: SupervisorState) -> Command:
    """
    Supervisor çš„æ ¸å¿ƒå†³ç­–é€»è¾‘

    åˆ†æç ”ç©¶ç®€æŠ¥ï¼Œå†³å®š:
    1. æ˜¯å¦éœ€è¦åˆ†è§£ä»»åŠ¡ï¼Ÿ
    2. åˆ†è§£ä¸ºå‡ ä¸ªå­ä»»åŠ¡ï¼Ÿ
    3. æ¯ä¸ªå­ä»»åŠ¡çš„å…·ä½“å†…å®¹ï¼Ÿ
    """
    supervisor_messages = state.get("supervisor_messages", [])

    # Prompt åŒ…å«å†³ç­–å¯å‘å¼
    system_message = lead_researcher_prompt.format(
        date=get_today_str(),
        max_concurrent_research_units=3,  # æœ€å¤š 3 ä¸ªå¹¶è¡Œ Agent
        max_researcher_iterations=6        # æ¯ä¸ª Agent æœ€å¤š 6 æ¬¡å·¥å…·è°ƒç”¨
    )

    messages = [SystemMessage(content=system_message)] + supervisor_messages

    # LLM å†³ç­–
    response = await supervisor_model_with_tools.ainvoke(messages)

    return Command(
        goto="supervisor_tools",
        update={
            "supervisor_messages": [response],
            "research_iterations": state.get("research_iterations", 0) + 1
        }
    )
```

**Prompt ä¸­çš„å…³é”®å¯å‘å¼ï¼š**

```python
"""
<Scaling Rules>
Simple fact-finding, lists, rankings: Use 1 sub-agent
  Example: "List top 10 SF coffee shops" â†’ 1 agent

Comparisons: Use 1 sub-agent per element
  Example: "Compare OpenAI vs Anthropic vs DeepMind" â†’ 3 agents
  Delegate clear, distinct, non-overlapping subtopics

<Hard Limits>
- Bias towards single agent for simplicity
- Maximum {max_concurrent_research_units} parallel agents
- Stop after {max_researcher_iterations} tool calls if no progress
</Hard Limits>
"""
```

---

### 4. å¹¶è¡Œæ‰§è¡ŒèŠ‚ç‚¹ï¼ˆæ ¸å¿ƒæŠ€æœ¯ï¼‰

```python
import asyncio

async def supervisor_tools(state: SupervisorState) -> Command:
    """
    æ‰§è¡Œ Supervisor çš„å†³ç­–:
    - è°ƒç”¨ think_tool è¿›è¡Œåæ€
    - å¯åŠ¨å¹¶è¡Œ Research Agents
    - èšåˆç»“æœ
    """
    most_recent_message = state["supervisor_messages"][-1]
    tool_calls = most_recent_message.tool_calls

    # åˆ†ç¦»ä¸åŒç±»å‹çš„å·¥å…·è°ƒç”¨
    think_tool_calls = [
        tc for tc in tool_calls if tc["name"] == "think_tool"
    ]

    conduct_research_calls = [
        tc for tc in tool_calls if tc["name"] == "ConductResearch"
    ]

    tool_messages = []
    all_raw_notes = []

    # æ‰§è¡Œ think_toolï¼ˆåŒæ­¥ï¼‰
    for tool_call in think_tool_calls:
        observation = think_tool.invoke(tool_call["args"])
        tool_messages.append(
            ToolMessage(
                content=observation,
                name="think_tool",
                tool_call_id=tool_call["id"]
            )
        )

    # å¹¶è¡Œæ‰§è¡Œ Research Agentsï¼ˆå…³é”®ï¼ï¼‰
    if conduct_research_calls:
        # åˆ›å»ºå¼‚æ­¥ä»»åŠ¡åˆ—è¡¨
        research_tasks = [
            researcher_agent.ainvoke({
                "researcher_messages": [
                    HumanMessage(content=tc["args"]["research_topic"])
                ],
                "research_topic": tc["args"]["research_topic"]
            })
            for tc in conduct_research_calls
        ]

        # å¹¶è¡Œæ‰§è¡Œæ‰€æœ‰ä»»åŠ¡
        research_results = await asyncio.gather(*research_tasks)

        # æ ¼å¼åŒ–ç»“æœ
        for result, tool_call in zip(research_results, conduct_research_calls):
            # å‹ç¼©çš„ç ”ç©¶ä½œä¸º ToolMessage è¿”å›
            tool_messages.append(
                ToolMessage(
                    content=result.get("compressed_research", "Error"),
                    name="ConductResearch",
                    tool_call_id=tool_call["id"]
                )
            )

            # æ”¶é›†åŸå§‹ç¬”è®°
            all_raw_notes.append("\n".join(result.get("raw_notes", [])))

    # å†³å®šä¸‹ä¸€æ­¥
    if should_end(state):
        return Command(
            goto=END,
            update={
                "notes": get_notes_from_tool_calls(state["supervisor_messages"]),
                "raw_notes": all_raw_notes
            }
        )
    else:
        return Command(
            goto="supervisor",
            update={
                "supervisor_messages": tool_messages,
                "raw_notes": all_raw_notes
            }
        )
```

**asyncio.gather å…³é”®ç‚¹ï¼š**

```python
# ä¸²è¡Œæ‰§è¡Œï¼ˆæ…¢ï¼‰
results = []
for task in tasks:
    result = await agent.ainvoke(task)  # ç­‰å¾…æ¯ä¸ªå®Œæˆ
    results.append(result)
# æ€»æ—¶é—´ = sum(å„ Agent æ—¶é—´)

# å¹¶è¡Œæ‰§è¡Œï¼ˆå¿«ï¼‰
results = await asyncio.gather(*[
    agent.ainvoke(task) for task in tasks
])
# æ€»æ—¶é—´ = max(å„ Agent æ—¶é—´)
```

**ç¤ºä¾‹ï¼š3 ä¸ª Agentï¼Œæ¯ä¸ªéœ€è¦ 30 ç§’**
- ä¸²è¡Œï¼š90 ç§’
- å¹¶è¡Œï¼š30 ç§’

---

## ğŸ’¡ æ ¸å¿ƒæŠ€æœ¯ç‚¹è¯¦è§£

### 1. ä¸Šä¸‹æ–‡éš”ç¦»ï¼ˆContext Isolationï¼‰

```python
# Agent A çš„ä¸Šä¸‹æ–‡
{
    "researcher_messages": [
        HumanMessage("ç ”ç©¶ OpenAI AI å®‰å…¨æ–¹æ³•"),
        AIMessage("æœç´¢..."),
        ToolMessage("ç»“æœ A1"),
        AIMessage("å†æœç´¢..."),
        ToolMessage("ç»“æœ A2"),
        ...
    ]
}

# Agent B çš„ä¸Šä¸‹æ–‡ï¼ˆå®Œå…¨ç‹¬ç«‹ï¼‰
{
    "researcher_messages": [
        HumanMessage("ç ”ç©¶ Anthropic AI å®‰å…¨æ–¹æ³•"),
        AIMessage("æœç´¢..."),
        ToolMessage("ç»“æœ B1"),
        ...
    ]
}
```

**å¥½å¤„ï¼š**
- âœ… **æ— å¹²æ‰°** - Agent A çš„æœç´¢ç»“æœä¸ä¼šå½±å“ Agent B
- âœ… **æ·±åº¦èšç„¦** - æ¯ä¸ª Agent å¯ä»¥æ·±å…¥å•ä¸€ä¸»é¢˜
- âœ… **å¹¶è¡Œå®‰å…¨** - ä¸ä¼šç›¸äº’è¦†ç›–çŠ¶æ€

---

### 2. ç ”ç©¶ç»“æœèšåˆ

```python
def get_notes_from_tool_calls(messages: list[BaseMessage]) -> list[str]:
    """
    ä» Supervisor çš„æ¶ˆæ¯å†å²ä¸­æå–ç ”ç©¶ç¬”è®°

    å½“ Supervisor è°ƒç”¨ ConductResearch æ—¶ï¼Œ
    å­ Agent è¿”å›çš„ compressed_research ä½œä¸º ToolMessage.content

    è¿™ä¸ªå‡½æ•°æå–æ‰€æœ‰è¿™äº› ToolMessage çš„å†…å®¹
    """
    return [
        tool_msg.content
        for tool_msg in filter_messages(messages, include_types="tool")
    ]
```

**æ‰§è¡Œæµç¨‹ï¼š**

```
Supervisor è°ƒç”¨ ConductResearch(topic="OpenAI å®‰å…¨")
    â†“
Research Agent æ‰§è¡Œ
    â†“
è¿”å›: {
    "compressed_research": "OpenAI ä½¿ç”¨ RLHF...",  â† è¿™ä¸ª
    "raw_notes": ["è¯¦ç»†ç¬”è®° 1", "è¯¦ç»†ç¬”è®° 2"]
}
    â†“
Supervisor æ”¶åˆ° ToolMessage(
    content="OpenAI ä½¿ç”¨ RLHF...",  â† å‹ç¼©ç»“æœ
    tool_call_id="..."
)
    â†“
æœ€ç»ˆï¼Œget_notes_from_tool_calls æå–æ‰€æœ‰ ToolMessage.content
â†’ ["OpenAI ä½¿ç”¨ RLHF...", "Anthropic ä½¿ç”¨ Constitutional AI...", ...]
```

---

### 3. ç»ˆæ­¢æ¡ä»¶

```python
def should_end(state):
    """å†³å®šæ˜¯å¦ç»“æŸ Supervisor å¾ªç¯"""
    iterations = state["research_iterations"]
    last_message = state["supervisor_messages"][-1]

    # æ¡ä»¶ 1: è¾¾åˆ°æœ€å¤§è¿­ä»£æ¬¡æ•°
    if iterations >= MAX_ITERATIONS:
        return True

    # æ¡ä»¶ 2: æ²¡æœ‰å·¥å…·è°ƒç”¨
    if not last_message.tool_calls:
        return True

    # æ¡ä»¶ 3: LLM è°ƒç”¨äº† ResearchComplete
    if any(tc["name"] == "ResearchComplete" for tc in last_message.tool_calls):
        return True

    return False
```

---

## ğŸ­ å®æˆ˜ç¤ºä¾‹

### ç¤ºä¾‹ï¼šå¯¹æ¯” OpenAI vs Anthropic

```python
ç ”ç©¶ç®€æŠ¥: "å¯¹æ¯” OpenAI å’Œ Anthropic çš„ Deep Research äº§å“"

Supervisor åˆ†æ:
  "è¿™æ˜¯å¯¹æ¯”ä»»åŠ¡ï¼Œæ¶‰åŠä¸¤ä¸ªä¸åŒäº§å“"

Supervisor å†³ç­–:
  Tool Call 1: think_tool(
      "è¿™æ˜¯å¯¹æ¯”ä»»åŠ¡ï¼Œåº”è¯¥ä¸ºæ¯ä¸ªäº§å“åˆ†é…ä¸€ä¸ª Agent"
  )

  Tool Call 2: ConductResearch(
      research_topic="æ·±å…¥ç ”ç©¶ OpenAI Deep Research äº§å“çš„åŠŸèƒ½ã€
                     æ€§èƒ½ã€ä½¿ç”¨ä½“éªŒã€æŠ€æœ¯å®ç°ç­‰æ–¹é¢..."
  )

  Tool Call 3: ConductResearch(
      research_topic="æ·±å…¥ç ”ç©¶ Anthropic (Claude) çš„ç ”ç©¶èƒ½åŠ›ï¼Œ
                     åŒ…æ‹¬åŠŸèƒ½ã€æ€§èƒ½ã€ä½¿ç”¨ä½“éªŒç­‰..."
  )

å¹¶è¡Œæ‰§è¡Œ:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Agent A         â”‚ Agent B         â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ OpenAIç ”ç©¶      â”‚ Anthropicç ”ç©¶   â”‚
  â”‚ Search 1...     â”‚ Search 1...     â”‚
  â”‚ think_tool...   â”‚ think_tool...   â”‚
  â”‚ Search 2...     â”‚ Search 2...     â”‚
  â”‚ Compress...     â”‚ Compress...     â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†“                   â†“
  "OpenAI DR      "Anthropic Claude
   æ”¯æŒå¤šè½®è¿­ä»£,   å…·æœ‰å¼ºå¤§çš„åˆ†æèƒ½åŠ›,
   æ·±åº¦æœç´¢..."    å¯ä»¥..."

èšåˆç»“æœ:
  notes = [
      "OpenAI DR æ”¯æŒå¤šè½®è¿­ä»£...",
      "Anthropic Claude å…·æœ‰å¼ºå¤§çš„åˆ†æèƒ½åŠ›..."
  ]
```

---

## ğŸ“Š å†³ç­–å¯å‘å¼

### ä½•æ—¶ä½¿ç”¨å• Agentï¼Ÿ

| ä»»åŠ¡ç±»å‹ | ç¤ºä¾‹ | Agent æ•°é‡ |
|---------|------|-----------|
| **äº‹å®æŸ¥è¯¢** | "ç‰¹æ–¯æ‹‰ CEO æ˜¯è°ï¼Ÿ" | 1 |
| **åˆ—è¡¨** | "åˆ—å‡º SF æœ€ä½³å’–å•¡åº—" | 1 |
| **æ’å** | "æ’åå‰ 10 çš„ Python åº“" | 1 |
| **æ€»ç»“** | "æ€»ç»“è¿™ç¯‡æ–‡ç« " | 1 |

### ä½•æ—¶ä½¿ç”¨å¤š Agentï¼Ÿ

| ä»»åŠ¡ç±»å‹ | ç¤ºä¾‹ | Agent æ•°é‡ |
|---------|------|-----------|
| **å¯¹æ¯”** | "å¯¹æ¯” A vs B vs C" | 3ï¼ˆæ¯ä¸ªä¸€ä¸ªï¼‰|
| **å¤šç»´åˆ†æ** | "åˆ†æç‰¹æ–¯æ‹‰çš„æŠ€æœ¯ã€å¸‚åœºã€è´¢åŠ¡" | 3ï¼ˆæ¯ä¸ªç»´åº¦ä¸€ä¸ªï¼‰|
| **å¹¶è¡Œç ”ç©¶** | "ç ”ç©¶ AI åœ¨åŒ»ç–—ã€æ•™è‚²ã€é‡‘èçš„åº”ç”¨" | 3ï¼ˆæ¯ä¸ªé¢†åŸŸä¸€ä¸ªï¼‰|

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. å­ä¸»é¢˜å®šä¹‰

```python
# âŒ ä¸æ¸…æ™°çš„åˆ†è§£
Agent A: "ç ”ç©¶ OpenAI"
Agent B: "ç ”ç©¶ Anthropic"
# é—®é¢˜ï¼šèŒƒå›´å¤ªå¹¿ï¼Œå¯èƒ½é‡å 

# âœ… æ¸…æ™°çš„åˆ†è§£
Agent A: "ç ”ç©¶ OpenAI Deep Research äº§å“çš„åŠŸèƒ½ã€æ€§èƒ½ã€
          ä½¿ç”¨åœºæ™¯ã€æŠ€æœ¯å®ç°ã€ä¼˜ç¼ºç‚¹åˆ†æ"
Agent B: "ç ”ç©¶ Anthropic (Claude) çš„æ·±åº¦ç ”ç©¶èƒ½åŠ›ï¼ŒåŒ…æ‹¬
          åŠŸèƒ½ç‰¹æ€§ã€æ€§èƒ½è¡¨ç°ã€ä½¿ç”¨ä½“éªŒã€æŠ€æœ¯ç‰¹ç‚¹"
# å¥½å¤„ï¼šæ˜ç¡®ã€ç‹¬ç«‹ã€æ— é‡å 
```

### 2. é¿å…è¿‡åº¦å¹¶è¡Œ

```python
# âŒ è¿‡åº¦åˆ†è§£
User: "ç ”ç©¶ SF æœ€ä½³å’–å•¡åº—"
Supervisor: ä¸ºæ¯å®¶å’–å•¡åº—åˆ†é…ä¸€ä¸ª Agentï¼ˆ10 ä¸ª Agentï¼‰
# é—®é¢˜ï¼šè¿‡äºå¤æ‚ï¼Œåè€Œé™ä½æ•ˆç‡

# âœ… åˆç†åˆ†è§£
User: "ç ”ç©¶ SF æœ€ä½³å’–å•¡åº—"
Supervisor: ä½¿ç”¨ 1 ä¸ª Agentï¼ˆåˆ—è¡¨ä»»åŠ¡æ— éœ€å¹¶è¡Œï¼‰
```

### 3. é”™è¯¯å¤„ç†

```python
async def supervisor_tools(state):
    try:
        results = await asyncio.gather(*research_tasks)
    except Exception as e:
        # éƒ¨åˆ†å¤±è´¥å¤„ç†
        results = await asyncio.gather(
            *research_tasks,
            return_exceptions=True  # æ”¶é›†å¼‚å¸¸è€ŒéæŠ›å‡º
        )

        # è¿‡æ»¤æˆåŠŸçš„ç»“æœ
        valid_results = [r for r in results if not isinstance(r, Exception)]
        failed_count = len(results) - len(valid_results)

        if failed_count > 0:
            # æ·»åŠ è­¦å‘Šæ¶ˆæ¯
            tool_messages.append(
                ToolMessage(
                    content=f"{failed_count} ä¸ªå­ç ”ç©¶å¤±è´¥ï¼Œå·²å¿½ç•¥",
                    tool_call_id="error"
                )
            )
```

---

## ğŸ“ æ ¸å¿ƒçŸ¥è¯†ç‚¹æ€»ç»“

### Supervisor Pattern ä¼˜åŠ¿

1. **ä¸Šä¸‹æ–‡éš”ç¦»** - é¿å…ä¿¡æ¯æ··æ·†
2. **å¹¶è¡ŒåŠ é€Ÿ** - å‡å°‘æ€»æ‰§è¡Œæ—¶é—´
3. **è´¨é‡æå‡** - æ¯ä¸ª Agent ä¸“æ³¨å•ä¸€ä¸»é¢˜
4. **çµæ´»æ‰©å±•** - æ ¹æ®ä»»åŠ¡åŠ¨æ€è°ƒæ•´ Agent æ•°é‡

### asyncio.gather å¹¶è¡Œæ‰§è¡Œ

```python
# å¹¶è¡Œæ‰§è¡Œå¤šä¸ªå¼‚æ­¥ä»»åŠ¡
results = await asyncio.gather(*tasks)

# å…³é”®ç‚¹:
# - æ‰€æœ‰ä»»åŠ¡åŒæ—¶å¼€å§‹
# - ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ
# - è¿”å›ç»“æœåˆ—è¡¨ï¼ˆé¡ºåºä¸è¾“å…¥ä¸€è‡´ï¼‰
```

### å†³ç­–å¯å‘å¼

- **ç®€å•ä»»åŠ¡** â†’ å• Agent
- **å¯¹æ¯”ä»»åŠ¡** â†’ æ¯ä¸ªå¯¹è±¡ä¸€ä¸ª Agent
- **å¤šç»´åˆ†æ** â†’ æ¯ä¸ªç»´åº¦ä¸€ä¸ª Agent
- **æœ€å¤§å¹¶å‘** â†’ 3 ä¸ª Agentï¼ˆå¯é…ç½®ï¼‰

---

## ğŸš€ ä¸‹ä¸€æ­¥

å®Œæˆæœ¬èŠ‚ï¼Œä½ å·²ç»æŒæ¡äº†å¤šæ™ºèƒ½ä½“ååŒçš„æ ¸å¿ƒæŠ€æœ¯ã€‚

**ä¸‹ä¸€ç« ï¼š9.5 å®Œæ•´ç³»ç»Ÿé›†æˆ** - å­¦ä¹ å¦‚ä½•å°† Scopingã€Researchã€Supervisor å’Œ Report Generation æ•´åˆä¸ºç«¯åˆ°ç«¯çš„ Deep Research ç³»ç»Ÿï¼

# 0.1 Python æ ¸å¿ƒåŸºç¡€ï¼šä¸º AI Agent å¼€å‘æ‰“åŸºç¡€

> **å­¦ä¹ ç›®æ ‡**
> å¯¹äºæœ‰ä¸€å®š Python åŸºç¡€çš„æœ‹å‹ï¼Œæœ¬ç« å¯ä»¥è·³è¿‡ï¼Œä»ç¬¬ä¸€ç« å¼€å§‹ä½ çš„æ™ºèƒ½ä½“æ­å»ºä¹‹æ—…ã€‚
> æœ¬ç« ä¸“ä¸º LangGraph å’Œ AI Agent å¼€å‘è®¾è®¡ï¼Œé€šè¿‡å®æˆ˜ä»£ç å¿«é€ŸæŒæ¡ Python æ ¸å¿ƒè¯­æ³•ã€‚æˆ‘ä»¬é‡‡ç”¨"å…ˆçœ‹ä»£ç ï¼Œåå­¦åŸç†"çš„æ–¹å¼ï¼Œæ¯ä¸ªæ¦‚å¿µéƒ½å…³è”å®é™…çš„ Agent å¼€å‘åœºæ™¯ã€‚

---

## æœ¬ç« å†…å®¹

- âœ… æŒæ¡ Python å˜é‡ä¸æ•°æ®ç±»å‹
- âœ… ç†è§£æ•°æ®ç»“æ„ï¼ˆListã€Dictã€Tupleã€Setï¼‰åœ¨ Agent ä¸­çš„åº”ç”¨
- âœ… å­¦ä¼šæ§åˆ¶æµï¼ˆæ¡ä»¶åˆ¤æ–­ã€å¾ªç¯ï¼‰
- âœ… æŒæ¡å‡½æ•°å®šä¹‰ä¸ Lambda è¡¨è¾¾å¼
- âœ… ç†è§£ç±»å‹æç¤ºï¼ˆä¸º LangGraph åšå‡†å¤‡ï¼‰

---

## 1. ç¯å¢ƒå‡†å¤‡ï¼šå¼€å§‹ä½ çš„ç¬¬ä¸€è¡Œä»£ç 

### æ¨èå¼€å‘ç¯å¢ƒ

**é€‰é¡¹ 1ï¼šåœ¨çº¿è¿è¡Œï¼ˆæœ€ç®€å•ï¼‰**
- æœ¬ç½‘ç«™å†…ç½® Python è¿è¡Œç¯å¢ƒï¼Œæ— éœ€å®‰è£…
- éœ€è¦è¿è¡Œ LangGraph ä»£ç æ—¶ï¼Œè¯·å…ˆé…ç½® [API Key](http://localhost:5173/python-run.html)

**é€‰é¡¹ 2ï¼šæœ¬åœ° Jupyter Labï¼ˆæ¨èå­¦ä¹ ï¼‰**
```bash
# å®‰è£… Jupyter Lab
pip install jupyterlab

# å¯åŠ¨
jupyter lab
```

**é€‰é¡¹ 3ï¼šCursor / VS Codeï¼ˆæ¨èå¼€å‘ï¼‰**
```bash
# å®‰è£…æ‰©å±•ï¼š
# 1. Python (by Microsoft)
# 2. Jupyter (by Microsoft)
```

### Hello, AI World!

è¿è¡Œä½ çš„ç¬¬ä¸€ä¸ª Python ç¨‹åºï¼š

```python
# éªŒè¯ç¯å¢ƒ
import sys
print(f"Python ç‰ˆæœ¬: {sys.version}")
print(f"ğŸ¤– ä½ å¥½ï¼ŒAI Agent ä¸–ç•Œï¼")
```

**é¢„æœŸç»“æœï¼š**
```
Python ç‰ˆæœ¬: 3.13.0 (main, Oct  7 2024, 05:02:14) [Clang 15.0.0]
ğŸ¤– ä½ å¥½ï¼ŒAI Agent ä¸–ç•Œï¼
```

---

## 2. å˜é‡ä¸æ•°æ®ç±»å‹ï¼šAI çŠ¶æ€çš„åŸºçŸ³

### 2.1 å˜é‡ï¼šå­˜å‚¨ Agent çŠ¶æ€

åœ¨ AI Agent ä¸­ï¼Œå˜é‡ç”¨äºå­˜å‚¨ç”¨æˆ·æ¶ˆæ¯ã€ç³»ç»ŸçŠ¶æ€ã€å¯¹è¯å†å²ç­‰å…³é”®ä¿¡æ¯ã€‚

```python
# ä»£ç ç¤ºä¾‹ï¼šAgent åŸºæœ¬çŠ¶æ€
user_message = "å¸®æˆ‘æŸ¥ä¸€ä¸‹ä»Šå¤©çš„å¤©æ°”"
user_id = "user_12345"
message_count = 3
is_authenticated = True
confidence_score = 0.85

print(f"ç”¨æˆ·æ¶ˆæ¯: {user_message}")
print(f"ç”¨æˆ·ID: {user_id}")
print(f"æ¶ˆæ¯æ•°é‡: {message_count}")
print(f"å·²è®¤è¯: {is_authenticated}")
print(f"ç½®ä¿¡åº¦: {confidence_score}")

# æŸ¥çœ‹ç±»å‹
print(f"\næ•°æ®ç±»å‹:")
print(f"  user_message: {type(user_message)}")
print(f"  message_count: {type(message_count)}")
print(f"  confidence_score: {type(confidence_score)}")
print(f"  is_authenticated: {type(is_authenticated)}")
```

**é¢„æœŸç»“æœï¼š**
```
ç”¨æˆ·æ¶ˆæ¯: å¸®æˆ‘æŸ¥ä¸€ä¸‹ä»Šå¤©çš„å¤©æ°”
ç”¨æˆ·ID: user_12345
æ¶ˆæ¯æ•°é‡: 3
å·²è®¤è¯: True
ç½®ä¿¡åº¦: 0.85

æ•°æ®ç±»å‹:
  user_message: <class 'str'>
  message_count: <class 'int'>
  confidence_score: <class 'float'>
  is_authenticated: <class 'bool'>
```

### ğŸ“– æ ¸å¿ƒæ•°æ®ç±»å‹

| ç±»å‹ | è¯´æ˜ | AI åº”ç”¨åœºæ™¯ |
|------|------|------------|
| `str` | å­—ç¬¦ä¸²ï¼ˆæ–‡æœ¬ï¼‰ | ç”¨æˆ·æ¶ˆæ¯ã€AI å›å¤ã€æç¤ºè¯ |
| `int` | æ•´æ•° | æ¶ˆæ¯è®¡æ•°ã€æ­¥éª¤ç¼–å·ã€é‡è¯•æ¬¡æ•° |
| `float` | æµ®ç‚¹æ•° | ç½®ä¿¡åº¦åˆ†æ•°ã€æ¸©åº¦å‚æ•°ã€ç›¸ä¼¼åº¦ |
| `bool` | å¸ƒå°”å€¼ | æ¡ä»¶åˆ¤æ–­ã€çŠ¶æ€æ ‡å¿—ã€å·¥å…·è°ƒç”¨æˆåŠŸä¸å¦ |
| `None` | ç©ºå€¼ | å¯é€‰å‚æ•°ã€æœªåˆå§‹åŒ–çš„çŠ¶æ€ |

### 2.2 å­—ç¬¦ä¸²æ“ä½œï¼šå¤„ç†æ–‡æœ¬

```python
# ä»£ç ç¤ºä¾‹ï¼šå­—ç¬¦ä¸²åœ¨ Agent ä¸­çš„å¸¸è§æ“ä½œ
user_input = "   å¸®æˆ‘é¢„è®¢æ˜å¤©å»åŒ—äº¬çš„æœºç¥¨   "

# æ¸…ç†è¾“å…¥
cleaned = user_input.strip()  # å»é™¤é¦–å°¾ç©ºæ ¼
print(f"æ¸…ç†å: '{cleaned}'")

# å¤§å°å†™è½¬æ¢
lowercase = cleaned.lower()
uppercase = cleaned.upper()
print(f"å°å†™: {lowercase}")
print(f"å¤§å†™: {uppercase}")

# å­—ç¬¦ä¸²æ‹¼æ¥
prompt = f"ç”¨æˆ·è¯·æ±‚ï¼š{cleaned}\nè¯·åˆ†ææ„å›¾å¹¶ç»™å‡ºå»ºè®®ã€‚"
print(f"\næ„å»ºçš„æç¤ºè¯:\n{prompt}")

# å­—ç¬¦ä¸²åˆ†å‰²
keywords = "å¤©æ°”,èˆªç­,é…’åº—,é¤å…"
keyword_list = keywords.split(",")
print(f"\nå…³é”®è¯åˆ—è¡¨: {keyword_list}")

# æ£€æŸ¥å­ä¸²
if "é¢„è®¢" in cleaned:
    print("\nâœ… æ£€æµ‹åˆ°é¢„è®¢æ„å›¾")

# å­—ç¬¦ä¸²æ›¿æ¢
sanitized = cleaned.replace("æ˜å¤©", "2024-10-28")
print(f"æ—¥æœŸè§„èŒƒåŒ–: {sanitized}")
```

**é¢„æœŸç»“æœï¼š**
```
æ¸…ç†å: 'å¸®æˆ‘é¢„è®¢æ˜å¤©å»åŒ—äº¬çš„æœºç¥¨'
å°å†™: å¸®æˆ‘é¢„è®¢æ˜å¤©å»åŒ—äº¬çš„æœºç¥¨
å¤§å†™: å¸®æˆ‘é¢„è®¢æ˜å¤©å»åŒ—äº¬çš„æœºç¥¨

æ„å»ºçš„æç¤ºè¯:
ç”¨æˆ·è¯·æ±‚ï¼šå¸®æˆ‘é¢„è®¢æ˜å¤©å»åŒ—äº¬çš„æœºç¥¨
è¯·åˆ†ææ„å›¾å¹¶ç»™å‡ºå»ºè®®ã€‚

å…³é”®è¯åˆ—è¡¨: ['å¤©æ°”', 'èˆªç­', 'é…’åº—', 'é¤å…']

âœ… æ£€æµ‹åˆ°é¢„è®¢æ„å›¾
æ—¥æœŸè§„èŒƒåŒ–: å¸®æˆ‘é¢„è®¢2024-10-28å»åŒ—äº¬çš„æœºç¥¨
```

### 2.3 f-stringï¼šç°ä»£å­—ç¬¦ä¸²æ ¼å¼åŒ–

```python
# ä»£ç ç¤ºä¾‹ï¼šæ„å»º AI æç¤ºè¯
user_name = "Alice"
city = "åŒ—äº¬"
temperature = 0.7
max_tokens = 1000

# f-string åŸºç¡€
greeting = f"ä½ å¥½ï¼Œ{user_name}ï¼"
print(greeting)

# è¡¨è¾¾å¼æ±‚å€¼
tokens_used = 850
remaining = f"å·²ä½¿ç”¨ {tokens_used}/{max_tokens} tokens ({tokens_used/max_tokens:.1%})"
print(remaining)

# å¤šè¡Œ f-stringï¼ˆæ„å»ºå¤æ‚æç¤ºè¯ï¼‰
system_prompt = f"""ä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½åŠ©æ‰‹ã€‚
ç”¨æˆ·ä¿¡æ¯ï¼š
- å§“åï¼š{user_name}
- ä½ç½®ï¼š{city}

å‚æ•°è®¾ç½®ï¼š
- Temperature: {temperature}
- Max Tokens: {max_tokens}

è¯·æ ¹æ®ç”¨æˆ·éœ€æ±‚æä¾›å¸®åŠ©ã€‚"""

print(f"\n{system_prompt}")

# æ ¼å¼åŒ–æ•°å­—
pi = 3.14159265359
print(f"\nÏ€ â‰ˆ {pi:.2f}")  # ä¿ç•™2ä½å°æ•°
print(f"Ï€ â‰ˆ {pi:.5f}")  # ä¿ç•™5ä½å°æ•°
```

**é¢„æœŸç»“æœï¼š**
```
ä½ å¥½ï¼ŒAliceï¼
å·²ä½¿ç”¨ 850/1000 tokens (85.0%)

ä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½åŠ©æ‰‹ã€‚
ç”¨æˆ·ä¿¡æ¯ï¼š
- å§“åï¼šAlice
- ä½ç½®ï¼šåŒ—äº¬

å‚æ•°è®¾ç½®ï¼š
- Temperature: 0.7
- Max Tokens: 1000

è¯·æ ¹æ®ç”¨æˆ·éœ€æ±‚æä¾›å¸®åŠ©ã€‚

Ï€ â‰ˆ 3.14
Ï€ â‰ˆ 3.14159
```

---

## 3. æ•°æ®ç»“æ„ï¼šç»„ç»‡ Agent æ•°æ®

### 3.1 åˆ—è¡¨ï¼ˆListï¼‰ï¼šå¯¹è¯å†å²ç®¡ç†

åˆ—è¡¨æ˜¯ AI Agent ä¸­æœ€å¸¸ç”¨çš„æ•°æ®ç»“æ„ï¼Œç”¨äºå­˜å‚¨æ¶ˆæ¯åºåˆ—ã€å·¥å…·è°ƒç”¨è®°å½•ç­‰ã€‚

```python
# ä»£ç ç¤ºä¾‹ï¼šç®¡ç†å¯¹è¯å†å²
messages = []

# æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
messages.append({"role": "user", "content": "ä½ å¥½"})
messages.append({"role": "assistant", "content": "ä½ å¥½ï¼æœ‰ä»€ä¹ˆå¯ä»¥å¸®ä½ çš„å—ï¼Ÿ"})
messages.append({"role": "user", "content": "ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"})

# è®¿é—®æ¶ˆæ¯
print("=== å¯¹è¯å†å² ===")
print(f"æ€»æ¶ˆæ¯æ•°: {len(messages)}")
print(f"ç¬¬ä¸€æ¡æ¶ˆæ¯: {messages[0]}")
print(f"æœ€åä¸€æ¡æ¶ˆæ¯: {messages[-1]}")
print(f"æœ€è¿‘ä¸¤æ¡æ¶ˆæ¯: {messages[-2:]}")

# éå†æ¶ˆæ¯
print("\n=== å®Œæ•´å¯¹è¯ ===")
for i, msg in enumerate(messages, 1):
    role_icon = "ğŸ‘¤" if msg["role"] == "user" else "ğŸ¤–"
    print(f"{i}. {role_icon} {msg['content']}")

# åˆ—è¡¨æ“ä½œ
messages.insert(0, {"role": "system", "content": "ä½ æ˜¯ä¸€ä¸ªå‹å¥½çš„åŠ©æ‰‹"})
print(f"\næ·»åŠ ç³»ç»Ÿæ¶ˆæ¯åï¼Œæ€»æ¶ˆæ¯æ•°: {len(messages)}")

# åˆ é™¤æ¶ˆæ¯
removed = messages.pop(1)  # åˆ é™¤ç´¢å¼•1çš„æ¶ˆæ¯
print(f"åˆ é™¤çš„æ¶ˆæ¯: {removed}")

# åˆ—è¡¨æ¨å¯¼å¼ï¼ˆè¿‡æ»¤ç”¨æˆ·æ¶ˆæ¯ï¼‰
user_messages = [msg for msg in messages if msg["role"] == "user"]
print(f"\nç”¨æˆ·æ¶ˆæ¯: {user_messages}")
```

**é¢„æœŸç»“æœï¼š**
```
=== å¯¹è¯å†å² ===
æ€»æ¶ˆæ¯æ•°: 3
ç¬¬ä¸€æ¡æ¶ˆæ¯: {'role': 'user', 'content': 'ä½ å¥½'}
æœ€åä¸€æ¡æ¶ˆæ¯: {'role': 'user', 'content': 'ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ'}
æœ€è¿‘ä¸¤æ¡æ¶ˆæ¯: [{'role': 'assistant', 'content': 'ä½ å¥½ï¼æœ‰ä»€ä¹ˆå¯ä»¥å¸®ä½ çš„å—ï¼Ÿ'}, {'role': 'user', 'content': 'ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ'}]

=== å®Œæ•´å¯¹è¯ ===
1. ğŸ‘¤ ä½ å¥½
2. ğŸ¤– ä½ å¥½ï¼æœ‰ä»€ä¹ˆå¯ä»¥å¸®ä½ çš„å—ï¼Ÿ
3. ğŸ‘¤ ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ

æ·»åŠ ç³»ç»Ÿæ¶ˆæ¯åï¼Œæ€»æ¶ˆæ¯æ•°: 4
åˆ é™¤çš„æ¶ˆæ¯: {'role': 'user', 'content': 'ä½ å¥½'}

ç”¨æˆ·æ¶ˆæ¯: [{'role': 'user', 'content': 'ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ'}]
```

### 3.2 å­—å…¸ï¼ˆDictï¼‰ï¼šAgent çŠ¶æ€ç®¡ç†

å­—å…¸æ˜¯ LangGraph çš„æ ¸å¿ƒæ•°æ®ç»“æ„ï¼Œç”¨äºå­˜å‚¨ Agent çš„çŠ¶æ€ä¿¡æ¯ã€‚

```python
# ä»£ç ç¤ºä¾‹ï¼šLangGraph çŠ¶æ€å¯¹è±¡
agent_state = {
    "user_id": "user_12345",
    "session_id": "sess_abc",
    "messages": [
        {"role": "user", "content": "å¸®æˆ‘æŸ¥å¤©æ°”"},
        {"role": "assistant", "content": "å¥½çš„ï¼Œè¯·é—®æ˜¯å“ªä¸ªåŸå¸‚ï¼Ÿ"}
    ],
    "context": {
        "intent": "weather_query",
        "location": None,
        "confidence": 0.92
    },
    "tool_calls": [],
    "metadata": {
        "start_time": "2024-10-27 10:00:00",
        "turn_count": 1
    }
}

# è®¿é—®æ•°æ®
print(f"ç”¨æˆ·ID: {agent_state['user_id']}")
print(f"æ„å›¾: {agent_state['context']['intent']}")
print(f"ç½®ä¿¡åº¦: {agent_state['context']['confidence']:.1%}")

# æ›´æ–°çŠ¶æ€
agent_state['context']['location'] = "åŒ—äº¬"
agent_state['metadata']['turn_count'] += 1

print(f"\næ›´æ–°åçš„ä½ç½®: {agent_state['context']['location']}")
print(f"å¯¹è¯è½®æ¬¡: {agent_state['metadata']['turn_count']}")

# æ·»åŠ æ–°å­—æ®µ
agent_state['context']['weather_data'] = {
    "temperature": 22,
    "condition": "æ™´æœ—"
}

# è·å–æ‰€æœ‰é”®
print(f"\nçŠ¶æ€é¡¶å±‚å­—æ®µ: {list(agent_state.keys())}")
print(f"ä¸Šä¸‹æ–‡å­—æ®µ: {list(agent_state['context'].keys())}")

# å®‰å…¨è®¿é—®ï¼ˆä½¿ç”¨ getï¼‰
api_key = agent_state.get('api_key', 'NOT_SET')
print(f"\nAPI Key: {api_key}")

# æ£€æŸ¥é”®æ˜¯å¦å­˜åœ¨
if 'tool_calls' in agent_state:
    print("âœ… çŠ¶æ€åŒ…å« tool_calls å­—æ®µ")

# å­—å…¸éå†
print("\n=== å…ƒæ•°æ®è¯¦æƒ… ===")
for key, value in agent_state['metadata'].items():
    print(f"  {key}: {value}")
```

**é¢„æœŸç»“æœï¼š**
```
ç”¨æˆ·ID: user_12345
æ„å›¾: weather_query
ç½®ä¿¡åº¦: 92.0%

æ›´æ–°åçš„ä½ç½®: åŒ—äº¬
å¯¹è¯è½®æ¬¡: 2

çŠ¶æ€é¡¶å±‚å­—æ®µ: ['user_id', 'session_id', 'messages', 'context', 'tool_calls', 'metadata']
ä¸Šä¸‹æ–‡å­—æ®µ: ['intent', 'location', 'confidence', 'weather_data']

API Key: NOT_SET
âœ… çŠ¶æ€åŒ…å« tool_calls å­—æ®µ

=== å…ƒæ•°æ®è¯¦æƒ… ===
  start_time: 2024-10-27 10:00:00
  turn_count: 2
```

### 3.3 å…ƒç»„ï¼ˆTupleï¼‰ï¼šä¸å¯å˜æ•°æ®

```python
# ä»£ç ç¤ºä¾‹ï¼šæ¶ˆæ¯æ ¼å¼ã€é…ç½®å¸¸é‡
# å…ƒç»„ç”¨äºå›ºå®šæ ¼å¼çš„æ•°æ®
message_format = ("role", "content", "timestamp")
print(f"æ¶ˆæ¯æ ¼å¼: {message_format}")

# è§£åŒ…å…ƒç»„
role, content, timestamp = message_format
print(f"å­—æ®µ1: {role}, å­—æ®µ2: {content}, å­—æ®µ3: {timestamp}")

# å¤šè¿”å›å€¼ï¼ˆå®é™…æ˜¯å…ƒç»„ï¼‰
def parse_message(text):
    """è§£ææ¶ˆæ¯ï¼Œè¿”å›æ„å›¾å’Œå®ä½“"""
    intent = "weather_query"
    entity = "åŒ—äº¬"
    confidence = 0.95
    return intent, entity, confidence  # è¿”å›å…ƒç»„

intent, entity, conf = parse_message("åŒ—äº¬å¤©æ°”")
print(f"\nè§£æç»“æœ: æ„å›¾={intent}, å®ä½“={entity}, ç½®ä¿¡åº¦={conf}")

# å…ƒç»„ä¸å¯ä¿®æ”¹
try:
    message_format[0] = "new_role"
except TypeError as e:
    print(f"\nâŒ å…ƒç»„ä¸å¯ä¿®æ”¹: {e}")

# å…ƒç»„ä½œä¸ºå­—å…¸é”®ï¼ˆåˆ—è¡¨ä¸è¡Œï¼‰
cache = {
    ("user_123", "weather"): "æ™´å¤© 22Â°C",
    ("user_456", "weather"): "å¤šäº‘ 18Â°C"
}
print(f"\nç¼“å­˜æŸ¥è¯¢: {cache[('user_123', 'weather')]}")
```

**é¢„æœŸç»“æœï¼š**
```
æ¶ˆæ¯æ ¼å¼: ('role', 'content', 'timestamp')
å­—æ®µ1: role, å­—æ®µ2: content, å­—æ®µ3: timestamp

è§£æç»“æœ: æ„å›¾=weather_query, å®ä½“=åŒ—äº¬, ç½®ä¿¡åº¦=0.95

âŒ å…ƒç»„ä¸å¯ä¿®æ”¹: 'tuple' object does not support item assignment

ç¼“å­˜æŸ¥è¯¢: æ™´å¤© 22Â°C
```

### 3.4 é›†åˆï¼ˆSetï¼‰ï¼šå»é‡ä¸å¿«é€ŸæŸ¥æ‰¾

```python
# ä»£ç ç¤ºä¾‹ï¼šç®¡ç†ç”¨æˆ·å…´è¶£æ ‡ç­¾
user_interests = {"ç§‘æŠ€", "æ—…æ¸¸", "ç¾é£Ÿ", "ç§‘æŠ€", "è¿åŠ¨"}  # è‡ªåŠ¨å»é‡
print(f"ç”¨æˆ·å…´è¶£ï¼ˆå·²å»é‡ï¼‰: {user_interests}")

# æ·»åŠ å…´è¶£
user_interests.add("é˜…è¯»")
user_interests.add("ç§‘æŠ€")  # é‡å¤æ·»åŠ æ— æ•ˆ
print(f"æ·»åŠ å: {user_interests}")

# é›†åˆè¿ç®—
available_topics = {"ç§‘æŠ€", "ç¾é£Ÿ", "å¨±ä¹", "è´¢ç»"}

# äº¤é›†ï¼šç”¨æˆ·æ„Ÿå…´è¶£ä¸”å¯ç”¨çš„è¯é¢˜
common = user_interests & available_topics
print(f"\næ¨èè¯é¢˜ï¼ˆäº¤é›†ï¼‰: {common}")

# å¹¶é›†ï¼šæ‰€æœ‰ç›¸å…³è¯é¢˜
all_topics = user_interests | available_topics
print(f"æ‰€æœ‰è¯é¢˜ï¼ˆå¹¶é›†ï¼‰: {all_topics}")

# å·®é›†ï¼šç”¨æˆ·å…´è¶£ä½†ä¸å¯ç”¨çš„
missing = user_interests - available_topics
print(f"ç¼ºå¤±è¯é¢˜ï¼ˆå·®é›†ï¼‰: {missing}")

# å¿«é€Ÿæ£€æŸ¥
if "ç§‘æŠ€" in user_interests:
    print("\nâœ… ç”¨æˆ·å¯¹ç§‘æŠ€æ„Ÿå…´è¶£")

# è½¬æ¢ï¼šåˆ—è¡¨ â†’ é›†åˆï¼ˆå»é‡ï¼‰
message_keywords = ["å¤©æ°”", "æŸ¥è¯¢", "å¤©æ°”", "åŒ—äº¬", "æŸ¥è¯¢"]
unique_keywords = set(message_keywords)
print(f"\nå…³é”®è¯å»é‡: {list(unique_keywords)}")
```

**é¢„æœŸç»“æœï¼š**
```
ç”¨æˆ·å…´è¶£ï¼ˆå·²å»é‡ï¼‰: {'è¿åŠ¨', 'æ—…æ¸¸', 'ç§‘æŠ€', 'ç¾é£Ÿ'}
æ·»åŠ å: {'è¿åŠ¨', 'æ—…æ¸¸', 'é˜…è¯»', 'ç§‘æŠ€', 'ç¾é£Ÿ'}

æ¨èè¯é¢˜ï¼ˆäº¤é›†ï¼‰: {'ç§‘æŠ€', 'ç¾é£Ÿ'}
æ‰€æœ‰è¯é¢˜ï¼ˆå¹¶é›†ï¼‰: {'å¨±ä¹', 'è¿åŠ¨', 'æ—…æ¸¸', 'é˜…è¯»', 'è´¢ç»', 'ç§‘æŠ€', 'ç¾é£Ÿ'}
ç¼ºå¤±è¯é¢˜ï¼ˆå·®é›†ï¼‰: {'è¿åŠ¨', 'æ—…æ¸¸', 'é˜…è¯»'}

âœ… ç”¨æˆ·å¯¹ç§‘æŠ€æ„Ÿå…´è¶£

å…³é”®è¯å»é‡: ['æŸ¥è¯¢', 'å¤©æ°”', 'åŒ—äº¬']
```

### ğŸ“Š æ•°æ®ç»“æ„é€‰æ‹©æŒ‡å—

| æ•°æ®ç»“æ„ | æœ‰åº | å¯å˜ | å»é‡ | ä½¿ç”¨åœºæ™¯ |
|---------|------|------|------|---------|
| **List** | âœ… | âœ… | âŒ | å¯¹è¯å†å²ã€æ¶ˆæ¯é˜Ÿåˆ—ã€å·¥å…·è°ƒç”¨è®°å½• |
| **Dict** | âŒ | âœ… | Keyå»é‡ | Agent çŠ¶æ€ã€é…ç½®å‚æ•°ã€API å“åº” |
| **Tuple** | âœ… | âŒ | âŒ | å›ºå®šæ ¼å¼ã€å‡½æ•°è¿”å›ã€å¸¸é‡å®šä¹‰ |
| **Set** | âŒ | âœ… | âœ… | æ ‡ç­¾å»é‡ã€æƒé™æ£€æŸ¥ã€é›†åˆè¿ç®— |

---

## 4. æ§åˆ¶æµï¼šAgent å†³ç­–é€»è¾‘

### 4.1 æ¡ä»¶åˆ¤æ–­ï¼šè·¯ç”±ä¸å†³ç­–

åœ¨ LangGraph ä¸­ï¼Œæ¡ä»¶åˆ¤æ–­ç”¨äºå®ç°æ¡ä»¶è¾¹ï¼ˆConditional Edgeï¼‰ï¼Œå†³å®š Agent çš„ä¸‹ä¸€æ­¥è¡Œä¸ºã€‚

```python
# ä»£ç ç¤ºä¾‹ï¼šæ ¹æ®ç”¨æˆ·æ„å›¾è·¯ç”±
def route_by_intent(user_message):
    """æ ¹æ®ç”¨æˆ·æ¶ˆæ¯è·¯ç”±åˆ°ä¸åŒèŠ‚ç‚¹"""
    message_lower = user_message.lower()

    # å¤šæ¡ä»¶åˆ¤æ–­
    if "å¤©æ°”" in message_lower:
        intent = "weather_query"
        next_node = "weather_tool"
        confidence = 0.9
    elif "é¢„è®¢" in message_lower or "è®¢ç¥¨" in message_lower:
        intent = "booking"
        next_node = "booking_tool"
        confidence = 0.85
    elif "è®¡ç®—" in message_lower or "=" in message_lower:
        intent = "calculator"
        next_node = "calculator_tool"
        confidence = 0.95
    else:
        intent = "general_chat"
        next_node = "llm_response"
        confidence = 0.5

    return {
        "intent": intent,
        "next_node": next_node,
        "confidence": confidence
    }

# æµ‹è¯•è·¯ç”±
test_messages = [
    "ä»Šå¤©åŒ—äº¬å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ",
    "å¸®æˆ‘é¢„è®¢æ˜å¤©å»ä¸Šæµ·çš„æœºç¥¨",
    "è®¡ç®— 123 + 456",
    "ä½ å¥½ï¼Œä»‹ç»ä¸€ä¸‹ä½ è‡ªå·±"
]

print("=== Intent Routing ===")
for msg in test_messages:
    result = route_by_intent(msg)
    print(f"\næ¶ˆæ¯: {msg}")
    print(f"  â†’ æ„å›¾: {result['intent']}")
    print(f"  â†’ ä¸‹ä¸€èŠ‚ç‚¹: {result['next_node']}")
    print(f"  â†’ ç½®ä¿¡åº¦: {result['confidence']:.0%}")
```

**é¢„æœŸç»“æœï¼š**
```
=== Intent Routing ===

æ¶ˆæ¯: ä»Šå¤©åŒ—äº¬å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ
  â†’ æ„å›¾: weather_query
  â†’ ä¸‹ä¸€èŠ‚ç‚¹: weather_tool
  â†’ ç½®ä¿¡åº¦: 90%

æ¶ˆæ¯: å¸®æˆ‘é¢„è®¢æ˜å¤©å»ä¸Šæµ·çš„æœºç¥¨
  â†’ æ„å›¾: booking
  â†’ ä¸‹ä¸€èŠ‚ç‚¹: booking_tool
  â†’ ç½®ä¿¡åº¦: 85%

æ¶ˆæ¯: è®¡ç®— 123 + 456
  â†’ æ„å›¾: calculator
  â†’ ä¸‹ä¸€èŠ‚ç‚¹: calculator_tool
  â†’ ç½®ä¿¡åº¦: 95%

æ¶ˆæ¯: ä½ å¥½ï¼Œä»‹ç»ä¸€ä¸‹ä½ è‡ªå·±
  â†’ æ„å›¾: general_chat
  â†’ ä¸‹ä¸€èŠ‚ç‚¹: llm_response
  â†’ ç½®ä¿¡åº¦: 50%
```

### 4.2 ä¸‰å…ƒè¿ç®—ç¬¦ï¼šç®€æ´çš„æ¡ä»¶è¡¨è¾¾å¼

```python
# ä»£ç ç¤ºä¾‹ï¼šå¿«é€Ÿæ¡ä»¶èµ‹å€¼
def evaluate_response_quality(confidence_score):
    """è¯„ä¼°å“åº”è´¨é‡"""
    # ä¼ ç»Ÿ if-else
    if confidence_score > 0.8:
        quality = "é«˜è´¨é‡"
    else:
        quality = "éœ€è¦ç¡®è®¤"

    # ä¸‰å…ƒè¿ç®—ç¬¦ï¼ˆæ›´ç®€æ´ï¼‰
    quality_concise = "é«˜è´¨é‡" if confidence_score > 0.8 else "éœ€è¦ç¡®è®¤"

    # åµŒå¥—ä¸‰å…ƒè¿ç®—ç¬¦
    level = "ä¼˜ç§€" if confidence_score > 0.9 else "è‰¯å¥½" if confidence_score > 0.7 else "ä¸€èˆ¬"

    return {
        "quality": quality_concise,
        "level": level,
        "should_confirm": confidence_score < 0.8
    }

# æµ‹è¯•
scores = [0.95, 0.75, 0.5]
for score in scores:
    result = evaluate_response_quality(score)
    print(f"ç½®ä¿¡åº¦ {score}: {result}")
```

**é¢„æœŸç»“æœï¼š**
```
ç½®ä¿¡åº¦ 0.95: {'quality': 'é«˜è´¨é‡', 'level': 'ä¼˜ç§€', 'should_confirm': False}
ç½®ä¿¡åº¦ 0.75: {'quality': 'éœ€è¦ç¡®è®¤', 'level': 'è‰¯å¥½', 'should_confirm': True}
ç½®ä¿¡åº¦ 0.5: {'quality': 'éœ€è¦ç¡®è®¤', 'level': 'ä¸€èˆ¬', 'should_confirm': True}
```

### 4.3 for å¾ªç¯ï¼šæ‰¹é‡å¤„ç†

```python
# ä»£ç ç¤ºä¾‹ï¼šæ‰¹é‡å¤„ç†æ¶ˆæ¯
messages = [
    {"id": 1, "content": "å¤©æ°”æŸ¥è¯¢", "processed": False},
    {"id": 2, "content": "é¢„è®¢æœºç¥¨", "processed": False},
    {"id": 3, "content": "é—²èŠ", "processed": False}
]

print("=== å¤„ç†æ¶ˆæ¯é˜Ÿåˆ— ===")
for i, msg in enumerate(messages):
    print(f"\nå¤„ç†æ¶ˆæ¯ #{msg['id']}: {msg['content']}")

    # æ¨¡æ‹Ÿå¤„ç†
    msg['processed'] = True
    msg['timestamp'] = f"2024-10-27 10:0{i}:00"

    print(f"  âœ… å·²å¤„ç†ï¼Œæ—¶é—´æˆ³: {msg['timestamp']}")

# åˆ—è¡¨æ¨å¯¼å¼ï¼šç®€æ´çš„å¾ªç¯
processed_ids = [msg['id'] for msg in messages if msg['processed']]
print(f"\nå·²å¤„ç†çš„æ¶ˆæ¯ID: {processed_ids}")

# å­—å…¸æ¨å¯¼å¼
id_to_content = {msg['id']: msg['content'] for msg in messages}
print(f"IDæ˜ å°„: {id_to_content}")

# range å¾ªç¯
print("\n=== é‡è¯•æœºåˆ¶ ===")
max_retries = 3
for attempt in range(1, max_retries + 1):
    print(f"å°è¯• #{attempt}/{max_retries}")
    success = (attempt == 2)  # æ¨¡æ‹Ÿç¬¬2æ¬¡æˆåŠŸ
    if success:
        print("  âœ… æˆåŠŸ!")
        break
    print("  âŒ å¤±è´¥ï¼Œé‡è¯•ä¸­...")
```

**é¢„æœŸç»“æœï¼š**
```
=== å¤„ç†æ¶ˆæ¯é˜Ÿåˆ— ===

å¤„ç†æ¶ˆæ¯ #1: å¤©æ°”æŸ¥è¯¢
  âœ… å·²å¤„ç†ï¼Œæ—¶é—´æˆ³: 2024-10-27 10:00:00

å¤„ç†æ¶ˆæ¯ #2: é¢„è®¢æœºç¥¨
  âœ… å·²å¤„ç†ï¼Œæ—¶é—´æˆ³: 2024-10-27 10:01:00

å¤„ç†æ¶ˆæ¯ #3: é—²èŠ
  âœ… å·²å¤„ç†ï¼Œæ—¶é—´æˆ³: 2024-10-27 10:02:00

å·²å¤„ç†çš„æ¶ˆæ¯ID: [1, 2, 3]
IDæ˜ å°„: {1: 'å¤©æ°”æŸ¥è¯¢', 2: 'é¢„è®¢æœºç¥¨', 3: 'é—²èŠ'}

=== é‡è¯•æœºåˆ¶ ===
å°è¯• #1/3
  âŒ å¤±è´¥ï¼Œé‡è¯•ä¸­...
å°è¯• #2/3
  âœ… æˆåŠŸ!
```

### 4.4 while å¾ªç¯ï¼šæ¡ä»¶é©±åŠ¨

```python
# ä»£ç ç¤ºä¾‹ï¼šAPI é‡è¯•é€»è¾‘
import time

def call_api_with_retry(max_retries=3, delay=1):
    """æ¨¡æ‹Ÿå¸¦é‡è¯•çš„ API è°ƒç”¨"""
    attempt = 0

    while attempt < max_retries:
        attempt += 1
        print(f"API è°ƒç”¨å°è¯• #{attempt}...")

        # æ¨¡æ‹Ÿ API è°ƒç”¨ï¼ˆç¬¬2æ¬¡æˆåŠŸï¼‰
        success = (attempt == 2)

        if success:
            print("  âœ… API è°ƒç”¨æˆåŠŸ!")
            return {"status": "success", "data": "å¤©æ°”æ•°æ®"}
        else:
            print(f"  âŒ å¤±è´¥ï¼Œ{delay}ç§’åé‡è¯•...")
            if attempt < max_retries:
                time.sleep(delay)

    # æ‰€æœ‰å°è¯•éƒ½å¤±è´¥
    print("\nâš ï¸ è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œè°ƒç”¨å¤±è´¥")
    return {"status": "failed", "error": "Max retries exceeded"}

# æ‰§è¡Œ
result = call_api_with_retry(max_retries=3, delay=0.5)
print(f"\næœ€ç»ˆç»“æœ: {result}")

# break å’Œ continue
print("\n=== å¤„ç†æ¶ˆæ¯ï¼ˆè·³è¿‡æ— æ•ˆæ¶ˆæ¯ï¼‰===")
messages = ["valid_msg_1", "", "valid_msg_2", None, "valid_msg_3"]
processed_count = 0

for msg in messages:
    if not msg:  # è·³è¿‡ç©ºæ¶ˆæ¯
        print(f"â­ï¸  è·³è¿‡æ— æ•ˆæ¶ˆæ¯")
        continue

    print(f"âœ… å¤„ç†: {msg}")
    processed_count += 1

    if processed_count >= 2:  # åªå¤„ç†2æ¡
        print("â¸ï¸  è¾¾åˆ°å¤„ç†ä¸Šé™ï¼Œåœæ­¢")
        break

print(f"\næ€»å…±å¤„ç†: {processed_count} æ¡æ¶ˆæ¯")
```

**é¢„æœŸç»“æœï¼š**
```
API è°ƒç”¨å°è¯• #1...
  âŒ å¤±è´¥ï¼Œ0.5ç§’åé‡è¯•...
API è°ƒç”¨å°è¯• #2...
  âœ… API è°ƒç”¨æˆåŠŸ!

æœ€ç»ˆç»“æœ: {'status': 'success', 'data': 'å¤©æ°”æ•°æ®'}

=== å¤„ç†æ¶ˆæ¯ï¼ˆè·³è¿‡æ— æ•ˆæ¶ˆæ¯ï¼‰===
âœ… å¤„ç†: valid_msg_1
â­ï¸  è·³è¿‡æ— æ•ˆæ¶ˆæ¯
âœ… å¤„ç†: valid_msg_2
â¸ï¸  è¾¾åˆ°å¤„ç†ä¸Šé™ï¼Œåœæ­¢

æ€»å…±å¤„ç†: 2 æ¡æ¶ˆæ¯
```

---

## 5. å‡½æ•°ï¼šä»£ç å¤ç”¨çš„è‰ºæœ¯

### 5.1 å‡½æ•°åŸºç¡€ï¼šLangGraph èŠ‚ç‚¹å‡½æ•°

åœ¨ LangGraph ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ¥æ”¶çŠ¶æ€å¹¶è¿”å›æ›´æ–°åçš„çŠ¶æ€ã€‚

```python
# ä»£ç ç¤ºä¾‹ï¼šå®šä¹‰ Agent èŠ‚ç‚¹å‡½æ•°
def process_user_message(state):
    """å¤„ç†ç”¨æˆ·æ¶ˆæ¯çš„èŠ‚ç‚¹å‡½æ•°

    Args:
        state: Agent çŠ¶æ€å­—å…¸

    Returns:
        æ›´æ–°åçš„çŠ¶æ€
    """
    user_message = state["messages"][-1]["content"]

    # æå–å…³é”®ä¿¡æ¯
    intent = "unknown"
    if "å¤©æ°”" in user_message:
        intent = "weather"
    elif "é¢„è®¢" in user_message:
        intent = "booking"

    # æ›´æ–°çŠ¶æ€
    state["intent"] = intent
    state["processed"] = True

    print(f"ğŸ“¥ å¤„ç†æ¶ˆæ¯: {user_message}")
    print(f"ğŸ¯ è¯†åˆ«æ„å›¾: {intent}")

    return state

# æµ‹è¯•èŠ‚ç‚¹å‡½æ•°
initial_state = {
    "messages": [
        {"role": "user", "content": "ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"}
    ],
    "intent": None,
    "processed": False
}

updated_state = process_user_message(initial_state)
print(f"\næ›´æ–°åçš„çŠ¶æ€: {updated_state}")
```

**é¢„æœŸç»“æœï¼š**
```
ğŸ“¥ å¤„ç†æ¶ˆæ¯: ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ
ğŸ¯ è¯†åˆ«æ„å›¾: weather

æ›´æ–°åçš„çŠ¶æ€: {'messages': [{'role': 'user', 'content': 'ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ'}], 'intent': 'weather', 'processed': True}
```

### 5.2 å‚æ•°ä¸è¿”å›å€¼

```python
# ä»£ç ç¤ºä¾‹ï¼šçµæ´»çš„å‡½æ•°å‚æ•°
def create_prompt(
    system_role="helpful assistant",  # é»˜è®¤å‚æ•°
    user_message=None,                # å¯é€‰å‚æ•°
    temperature=0.7,                  # æ¨¡å‹å‚æ•°
    max_tokens=1000,
    **kwargs                          # é¢å¤–å‚æ•°
):
    """æ„å»º LLM æç¤ºè¯

    Args:
        system_role: ç³»ç»Ÿè§’è‰²
        user_message: ç”¨æˆ·æ¶ˆæ¯
        temperature: æ¸©åº¦å‚æ•°
        max_tokens: æœ€å¤§ token æ•°
        **kwargs: å…¶ä»–å‚æ•°

    Returns:
        dict: æç¤ºè¯é…ç½®
    """
    if user_message is None:
        raise ValueError("å¿…é¡»æä¾› user_message")

    config = {
        "system": system_role,
        "user": user_message,
        "parameters": {
            "temperature": temperature,
            "max_tokens": max_tokens
        }
    }

    # æ·»åŠ é¢å¤–å‚æ•°
    if kwargs:
        config["extra"] = kwargs

    return config

# ä½¿ç”¨å‡½æ•°
prompt1 = create_prompt(user_message="ä½ å¥½")
print("åŸºç¡€è°ƒç”¨:")
print(prompt1)

prompt2 = create_prompt(
    system_role="ä¸“ä¸šçš„å¤©æ°”åŠ©æ‰‹",
    user_message="åŒ—äº¬å¤©æ°”ï¼Ÿ",
    temperature=0.5,
    top_p=0.9,  # é¢å¤–å‚æ•°
    model="gpt-4"
)
print("\nå®Œæ•´è°ƒç”¨:")
print(prompt2)

# è¿”å›å¤šä¸ªå€¼
def analyze_sentiment(text):
    """åˆ†ææ–‡æœ¬æƒ…æ„Ÿ"""
    # ç®€åŒ–çš„æƒ…æ„Ÿåˆ†æ
    score = 0.8 if "å¥½" in text else 0.3
    label = "ç§¯æ" if score > 0.5 else "æ¶ˆæ"
    confidence = score

    return score, label, confidence  # è¿”å›å…ƒç»„

# æ¥æ”¶å¤šä¸ªè¿”å›å€¼
score, label, conf = analyze_sentiment("ä»Šå¤©å¤©æ°”çœŸå¥½ï¼")
print(f"\næƒ…æ„Ÿåˆ†æ: å¾—åˆ†={score}, æ ‡ç­¾={label}, ç½®ä¿¡åº¦={conf}")
```

**é¢„æœŸç»“æœï¼š**
```
åŸºç¡€è°ƒç”¨:
{'system': 'helpful assistant', 'user': 'ä½ å¥½', 'parameters': {'temperature': 0.7, 'max_tokens': 1000}}

å®Œæ•´è°ƒç”¨:
{'system': 'ä¸“ä¸šçš„å¤©æ°”åŠ©æ‰‹', 'user': 'åŒ—äº¬å¤©æ°”ï¼Ÿ', 'parameters': {'temperature': 0.5, 'max_tokens': 1000}, 'extra': {'top_p': 0.9, 'model': 'gpt-4'}}

æƒ…æ„Ÿåˆ†æ: å¾—åˆ†=0.8, æ ‡ç­¾=ç§¯æ, ç½®ä¿¡åº¦=0.8
```

### 5.3 Lambda å‡½æ•°ï¼šæ¡ä»¶è¾¹çš„åˆ©å™¨

```python
# ä»£ç ç¤ºä¾‹ï¼šLambda åœ¨ LangGraph ä¸­çš„åº”ç”¨
# ä¼ ç»Ÿå‡½æ•°
def should_continue(state):
    return state.get("continue", True)

# Lambda ç­‰ä»·å†™æ³•ï¼ˆæ›´ç®€æ´ï¼‰
should_continue_lambda = lambda state: state.get("continue", True)

# Lambda ç”¨äºæ’åº
messages = [
    {"id": 3, "content": "third", "priority": 2},
    {"id": 1, "content": "first", "priority": 1},
    {"id": 2, "content": "second", "priority": 3}
]

# æŒ‰ä¼˜å…ˆçº§æ’åº
sorted_by_priority = sorted(messages, key=lambda x: x["priority"])
print("æŒ‰ä¼˜å…ˆçº§æ’åº:")
for msg in sorted_by_priority:
    print(f"  ID={msg['id']}, Priority={msg['priority']}")

# Lambda ç”¨äºè¿‡æ»¤
high_priority = list(filter(lambda x: x["priority"] >= 2, messages))
print(f"\né«˜ä¼˜å…ˆçº§æ¶ˆæ¯: {[m['id'] for m in high_priority]}")

# Lambda ç”¨äºæ˜ å°„
ids = list(map(lambda x: x["id"], messages))
print(f"æ‰€æœ‰ID: {ids}")

# LangGraph æ¡ä»¶è¾¹ç¤ºä¾‹ï¼ˆæ¦‚å¿µæ¼”ç¤ºï¼‰
def route_based_on_intent(state):
    """æ ¹æ®æ„å›¾è·¯ç”±åˆ°ä¸åŒèŠ‚ç‚¹"""
    intent_routes = {
        "weather": "weather_node",
        "booking": "booking_node",
        "chat": "llm_node"
    }

    intent = state.get("intent", "chat")
    return intent_routes.get(intent, "llm_node")

# Lambda ç‰ˆæœ¬
route_lambda = lambda s: {
    "weather": "weather_node",
    "booking": "booking_node"
}.get(s.get("intent", "chat"), "llm_node")

# æµ‹è¯•
test_state = {"intent": "weather"}
print(f"\nè·¯ç”±ç»“æœ: {route_based_on_intent(test_state)}")
print(f"Lambda è·¯ç”±: {route_lambda(test_state)}")
```

**é¢„æœŸç»“æœï¼š**
```
æŒ‰ä¼˜å…ˆçº§æ’åº:
  ID=1, Priority=1
  ID=3, Priority=2
  ID=2, Priority=3

é«˜ä¼˜å…ˆçº§æ¶ˆæ¯: [3, 2]
æ‰€æœ‰ID: [3, 1, 2]

è·¯ç”±ç»“æœ: weather_node
Lambda è·¯ç”±: weather_node
```

---

## 6. ç±»å‹æç¤ºï¼šä¸º LangGraph åšå‡†å¤‡

ç±»å‹æç¤ºï¼ˆType Hintsï¼‰æ˜¯ Python 3.5+ å¼•å…¥çš„ç‰¹æ€§ï¼Œåœ¨ LangGraph ä¸­å¤§é‡ä½¿ç”¨ã€‚

### 6.1 åŸºç¡€ç±»å‹æç¤º

```python
# ä»£ç ç¤ºä¾‹ï¼šç±»å‹æç¤ºåŸºç¡€
from typing import List, Dict, Optional, Union

# å˜é‡ç±»å‹æç¤º
user_name: str = "Alice"
age: int = 25
score: float = 0.85
is_active: bool = True

# å‡½æ•°ç±»å‹æç¤º
def format_message(role: str, content: str) -> dict:
    """æ ¼å¼åŒ–æ¶ˆæ¯

    Args:
        role: è§’è‰²ï¼ˆuser/assistantï¼‰
        content: æ¶ˆæ¯å†…å®¹

    Returns:
        æ ¼å¼åŒ–çš„æ¶ˆæ¯å­—å…¸
    """
    return {"role": role, "content": content}

# åˆ—è¡¨ç±»å‹æç¤º
messages: List[dict] = [
    {"role": "user", "content": "hello"},
    {"role": "assistant", "content": "hi"}
]

# å­—å…¸ç±»å‹æç¤º
state: Dict[str, any] = {
    "user_id": "123",
    "count": 5
}

# Optional ç±»å‹ï¼ˆå¯ä»¥æ˜¯æŒ‡å®šç±»å‹æˆ– Noneï¼‰
def get_user_name(user_id: str) -> Optional[str]:
    """è·å–ç”¨æˆ·åï¼Œå¯èƒ½è¿”å› None"""
    users = {"123": "Alice", "456": "Bob"}
    return users.get(user_id)  # å¯èƒ½è¿”å› None

result = get_user_name("789")
print(f"æŸ¥è¯¢ç»“æœ: {result}")  # None

# Union ç±»å‹ï¼ˆå¤šä¸ªå¯èƒ½çš„ç±»å‹ï¼‰
def process_input(value: Union[str, int, float]) -> str:
    """å¤„ç†ä¸åŒç±»å‹çš„è¾“å…¥"""
    return f"å¤„ç†: {value} (ç±»å‹: {type(value).__name__})"

print(process_input("hello"))
print(process_input(123))
print(process_input(3.14))
```

**é¢„æœŸç»“æœï¼š**
```
æŸ¥è¯¢ç»“æœ: None
å¤„ç†: hello (ç±»å‹: str)
å¤„ç†: 123 (ç±»å‹: int)
å¤„ç†: 3.14 (ç±»å‹: float)
```

### 6.2 LangGraph é£æ ¼çš„ç±»å‹æç¤º

```python
# ä»£ç ç¤ºä¾‹ï¼šæ¨¡æ‹Ÿ LangGraph çš„ç±»å‹å®šä¹‰
from typing import TypedDict, List, Literal

# TypedDictï¼šå®šä¹‰ä¸¥æ ¼çš„å­—å…¸ç»“æ„
class Message(TypedDict):
    role: Literal["user", "assistant", "system"]
    content: str

class AgentState(TypedDict):
    messages: List[Message]
    intent: str
    next_node: str

# ä½¿ç”¨ç±»å‹åŒ–çš„çŠ¶æ€
def create_initial_state(user_message: str) -> AgentState:
    """åˆ›å»ºåˆå§‹çŠ¶æ€"""
    return {
        "messages": [
            {"role": "user", "content": user_message}
        ],
        "intent": "unknown",
        "next_node": "classifier"
    }

# èŠ‚ç‚¹å‡½æ•°ä½¿ç”¨ç±»å‹æç¤º
def classify_intent(state: AgentState) -> AgentState:
    """æ„å›¾åˆ†ç±»èŠ‚ç‚¹"""
    user_message = state["messages"][-1]["content"]

    if "å¤©æ°”" in user_message:
        state["intent"] = "weather"
        state["next_node"] = "weather_tool"
    else:
        state["intent"] = "general"
        state["next_node"] = "llm"

    return state

# æµ‹è¯•
initial = create_initial_state("ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ")
print("åˆå§‹çŠ¶æ€:")
print(initial)

updated = classify_intent(initial)
print("\nåˆ†ç±»å:")
print(f"æ„å›¾: {updated['intent']}")
print(f"ä¸‹ä¸€èŠ‚ç‚¹: {updated['next_node']}")
```

**é¢„æœŸç»“æœï¼š**
```
åˆå§‹çŠ¶æ€:
{'messages': [{'role': 'user', 'content': 'ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ'}], 'intent': 'unknown', 'next_node': 'classifier'}

åˆ†ç±»å:
æ„å›¾: weather
ä¸‹ä¸€èŠ‚ç‚¹: weather_tool
```

---

## 7. å®æˆ˜æ¡ˆä¾‹ï¼šæ„å»ºç®€å•çš„æ„å›¾åˆ†ç±»å™¨

è®©æˆ‘ä»¬ç»¼åˆè¿ç”¨æœ¬ç« æ‰€æœ‰çŸ¥è¯†ï¼Œæ„å»ºä¸€ä¸ªå®Œæ•´çš„æ„å›¾åˆ†ç±»ç³»ç»Ÿã€‚

```python
# ä»£ç ç¤ºä¾‹ï¼šå®Œæ•´çš„æ„å›¾åˆ†ç±»å™¨
from typing import Dict, List, Tuple

class IntentClassifier:
    """ç®€å•çš„æ„å›¾åˆ†ç±»å™¨"""

    def __init__(self):
        """åˆå§‹åŒ–åˆ†ç±»å™¨"""
        self.intent_patterns = {
            "weather": ["å¤©æ°”", "æ¸©åº¦", "ä¸‹é›¨", "æ™´å¤©"],
            "booking": ["é¢„è®¢", "è®¢ç¥¨", "é¢„çº¦", "å®‰æ’"],
            "calculator": ["è®¡ç®—", "åŠ ", "å‡", "ä¹˜", "é™¤", "="],
            "greeting": ["ä½ å¥½", "hi", "hello", "æ—©ä¸Šå¥½"]
        }
        self.history: List[Dict] = []

    def classify(self, message: str) -> Dict[str, any]:
        """åˆ†ç±»æ¶ˆæ¯

        Args:
            message: ç”¨æˆ·æ¶ˆæ¯

        Returns:
            åˆ†ç±»ç»“æœ
        """
        message_lower = message.lower()
        scores = {}

        # è®¡ç®—æ¯ä¸ªæ„å›¾çš„åŒ¹é…åˆ†æ•°
        for intent, keywords in self.intent_patterns.items():
            score = sum(1 for kw in keywords if kw in message_lower)
            if score > 0:
                scores[intent] = score

        # æ‰¾åˆ°æœ€é«˜åˆ†æ„å›¾
        if scores:
            best_intent = max(scores.items(), key=lambda x: x[1])
            intent, confidence = best_intent[0], best_intent[1] / 5
        else:
            intent, confidence = "unknown", 0.0

        # è®°å½•å†å²
        result = {
            "message": message,
            "intent": intent,
            "confidence": min(confidence, 1.0),
            "all_scores": scores
        }
        self.history.append(result)

        return result

    def batch_classify(self, messages: List[str]) -> List[Dict]:
        """æ‰¹é‡åˆ†ç±»"""
        return [self.classify(msg) for msg in messages]

    def get_stats(self) -> Dict[str, int]:
        """è·å–ç»Ÿè®¡ä¿¡æ¯"""
        intent_counts = {}
        for record in self.history:
            intent = record["intent"]
            intent_counts[intent] = intent_counts.get(intent, 0) + 1
        return intent_counts

    def clear_history(self):
        """æ¸…ç©ºå†å²"""
        self.history = []


# ===== ä½¿ç”¨ç¤ºä¾‹ =====

# 1. åˆ›å»ºåˆ†ç±»å™¨
classifier = IntentClassifier()

# 2. å•æ¡æ¶ˆæ¯åˆ†ç±»
test_messages = [
    "ä»Šå¤©åŒ—äº¬å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ",
    "å¸®æˆ‘é¢„è®¢æ˜å¤©çš„æœºç¥¨",
    "è®¡ç®— 123 + 456",
    "ä½ å¥½ï¼Œè¯·é—®æœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©çš„å—ï¼Ÿ",
    "è¿™æ˜¯ä¸€ä¸ªéšæœºæ¶ˆæ¯"
]

print("=== å•æ¡åˆ†ç±» ===")
for msg in test_messages:
    result = classifier.classify(msg)
    print(f"\næ¶ˆæ¯: {msg}")
    print(f"  æ„å›¾: {result['intent']}")
    print(f"  ç½®ä¿¡åº¦: {result['confidence']:.0%}")
    if result['all_scores']:
        print(f"  å¾—åˆ†è¯¦æƒ…: {result['all_scores']}")

# 3. æ‰¹é‡åˆ†ç±»
batch_messages = [
    "æ˜å¤©ä¼šä¸‹é›¨å—ï¼Ÿ",
    "è®¢ä¸€å¼ å»ä¸Šæµ·çš„ç¥¨",
    "æ—©ä¸Šå¥½ï¼"
]

print("\n\n=== æ‰¹é‡åˆ†ç±» ===")
batch_results = classifier.batch_classify(batch_messages)
for result in batch_results:
    print(f"{result['message']} â†’ {result['intent']}")

# 4. ç»Ÿè®¡åˆ†æ
print("\n\n=== ç»Ÿè®¡ä¿¡æ¯ ===")
stats = classifier.get_stats()
for intent, count in sorted(stats.items(), key=lambda x: x[1], reverse=True):
    print(f"  {intent}: {count} æ¡")

print(f"\næ€»å¤„ç†æ¶ˆæ¯æ•°: {len(classifier.history)}")
```

**é¢„æœŸç»“æœï¼š**
```
=== å•æ¡åˆ†ç±» ===

æ¶ˆæ¯: ä»Šå¤©åŒ—äº¬å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ
  æ„å›¾: weather
  ç½®ä¿¡åº¦: 20%
  å¾—åˆ†è¯¦æƒ…: {'weather': 1}

æ¶ˆæ¯: å¸®æˆ‘é¢„è®¢æ˜å¤©çš„æœºç¥¨
  æ„å›¾: booking
  ç½®ä¿¡åº¦: 20%
  å¾—åˆ†è¯¦æƒ…: {'booking': 1}

æ¶ˆæ¯: è®¡ç®— 123 + 456
  æ„å›¾: calculator
  ç½®ä¿¡åº¦: 20%
  å¾—åˆ†è¯¦æƒ…: {'calculator': 1}

æ¶ˆæ¯: ä½ å¥½ï¼Œè¯·é—®æœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©çš„å—ï¼Ÿ
  æ„å›¾: greeting
  ç½®ä¿¡åº¦: 20%
  å¾—åˆ†è¯¦æƒ…: {'greeting': 1}

æ¶ˆæ¯: è¿™æ˜¯ä¸€ä¸ªéšæœºæ¶ˆæ¯
  æ„å›¾: unknown
  ç½®ä¿¡åº¦: 0%


=== æ‰¹é‡åˆ†ç±» ===
æ˜å¤©ä¼šä¸‹é›¨å—ï¼Ÿ â†’ weather
è®¢ä¸€å¼ å»ä¸Šæµ·çš„ç¥¨ â†’ booking
æ—©ä¸Šå¥½ï¼ â†’ greeting


=== ç»Ÿè®¡ä¿¡æ¯ ===
  weather: 2 æ¡
  booking: 2 æ¡
  greeting: 2 æ¡
  calculator: 1 æ¡
  unknown: 1 æ¡

æ€»å¤„ç†æ¶ˆæ¯æ•°: 8
```

---

## 8. æœ¬ç« æ€»ç»“

### âœ… ä½ å·²ç»æŒæ¡

1. **å˜é‡ä¸æ•°æ®ç±»å‹**
   - åŸºç¡€ç±»å‹ï¼šstr, int, float, bool, None
   - å­—ç¬¦ä¸²æ“ä½œï¼šstrip(), lower(), split(), f-string

2. **æ•°æ®ç»“æ„**
   - Listï¼šå¯¹è¯å†å²ã€æ¶ˆæ¯é˜Ÿåˆ—
   - Dictï¼šAgent çŠ¶æ€ã€é…ç½®
   - Tupleï¼šå›ºå®šæ ¼å¼ã€å¤šè¿”å›å€¼
   - Setï¼šå»é‡ã€é›†åˆè¿ç®—

3. **æ§åˆ¶æµ**
   - if-elif-elseï¼šæ„å›¾è·¯ç”±
   - for å¾ªç¯ï¼šæ‰¹é‡å¤„ç†
   - while å¾ªç¯ï¼šé‡è¯•æœºåˆ¶
   - åˆ—è¡¨/å­—å…¸æ¨å¯¼å¼

4. **å‡½æ•°**
   - å‡½æ•°å®šä¹‰ä¸è°ƒç”¨
   - å‚æ•°ï¼ˆé»˜è®¤ã€å¯é€‰ã€**kwargsï¼‰
   - Lambda è¡¨è¾¾å¼
   - å¤šè¿”å›å€¼

5. **ç±»å‹æç¤º**
   - åŸºç¡€ç±»å‹ï¼šstr, int, List, Dict
   - é«˜çº§ç±»å‹ï¼šOptional, Union, TypedDict
   - å‡½æ•°æ³¨è§£

### ğŸ“š ä¸‹ä¸€æ­¥

å‡†å¤‡å¥½äº†å—ï¼Ÿæ¥ä¸‹æ¥æˆ‘ä»¬å°†å­¦ä¹ ï¼š
- **0.2-é¢å‘å¯¹è±¡ä¸å·¥ç¨‹å®è·µ.md** - æ„å»ºç”Ÿäº§çº§ Agent
- **0.3-AIå¼€å‘å·¥å…·é“¾.md** - æŒæ¡ AI ç”Ÿæ€ç³»ç»Ÿ

### ğŸ’¡ ç»ƒä¹ å»ºè®®

1. ä¿®æ”¹æ„å›¾åˆ†ç±»å™¨ï¼Œæ·»åŠ æ›´å¤šæ„å›¾ç±»åˆ«
2. å®ç°ä¸€ä¸ªç®€å•çš„å¯¹è¯ç®¡ç†å™¨
3. å°è¯•ä½¿ç”¨ç±»å‹æç¤ºé‡æ„ä½ çš„ä»£ç 

---

**ğŸ¯ è®°ä½**ï¼šPython çš„æ ¸å¿ƒä¸æ˜¯è¯­æ³•ï¼Œè€Œæ˜¯ç”¨å®ƒè§£å†³å®é™…é—®é¢˜ã€‚åœ¨ LangGraph å¼€å‘ä¸­ï¼Œä½ ä¼šä¸æ–­ä½¿ç”¨è¿™äº›åŸºç¡€çŸ¥è¯†æ¥æ„å»ºå¼ºå¤§çš„ AI Agentï¼

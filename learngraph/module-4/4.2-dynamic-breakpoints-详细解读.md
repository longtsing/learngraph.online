# LangGraph Dynamic Breakpoints è¯¦ç»†è§£è¯»

## ğŸ“š æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†è§£è¯» LangGraph ä¸­çš„ **Dynamic Breakpointsï¼ˆåŠ¨æ€æ–­ç‚¹ï¼‰** åŠŸèƒ½ã€‚è¿™æ˜¯ä¸€ç§é«˜çº§çš„äººæœºäº¤äº’ï¼ˆHuman-in-the-Loopï¼‰æŠ€æœ¯ï¼Œå…è®¸å›¾åœ¨è¿è¡Œæ—¶æ ¹æ®ç‰¹å®šæ¡ä»¶**è‡ªåŠ¨ä¸­æ–­**ï¼Œè€Œä¸æ˜¯ç”±å¼€å‘è€…é¢„å…ˆåœ¨èŠ‚ç‚¹ä¸Šè®¾ç½®å›ºå®šçš„æ–­ç‚¹ã€‚

---

## ğŸ“š æœ¯è¯­è¡¨

| æœ¯è¯­åç§° | LangGraph å®šä¹‰å’Œè§£è¯» | Python å®šä¹‰å’Œè¯´æ˜ | é‡è¦ç¨‹åº¦ |
|---------|---------------------|------------------|---------|
| **Dynamic Breakpoint** | è¿è¡Œæ—¶æ¡ä»¶æ€§ä¸­æ–­æœºåˆ¶ï¼ŒèŠ‚ç‚¹å†…éƒ¨æ ¹æ®ä¸šåŠ¡é€»è¾‘åŠ¨æ€å†³å®šæ˜¯å¦æš‚åœï¼Œè€Œéç¼–è¯‘æ—¶å›ºå®šè®¾ç½® | é€šè¿‡æŠ›å‡º `NodeInterrupt` å¼‚å¸¸å®ç° | â­â­â­â­â­ |
| **NodeInterrupt** | åŠ¨æ€æ–­ç‚¹çš„æ ¸å¿ƒç±»ï¼Œåœ¨èŠ‚ç‚¹å†…éƒ¨æŠ›å‡ºæ­¤å¼‚å¸¸å¯è§¦å‘ä¸­æ–­ï¼Œå¹¶ä¼ é€’ä¸­æ–­åŸå› ä¿¡æ¯ | `from langgraph.errors import NodeInterrupt` | â­â­â­â­â­ |
| **raise NodeInterrupt** | è§¦å‘åŠ¨æ€ä¸­æ–­çš„è¯­æ³•ï¼Œä¼ å…¥å­—ç¬¦ä¸²å‚æ•°ä½œä¸ºä¸­æ–­åŸå› ï¼Œç«‹å³åœæ­¢èŠ‚ç‚¹æ‰§è¡Œå¹¶æš‚åœå›¾ | `raise NodeInterrupt("ä¸­æ–­åŸå› è¯´æ˜")` | â­â­â­â­â­ |
| **state.tasks** | çŠ¶æ€å¯¹è±¡çš„ä»»åŠ¡åˆ—è¡¨å±æ€§ï¼ŒåŒ…å«å¾…æ‰§è¡Œä»»åŠ¡å’Œä¸­æ–­ä¿¡æ¯(interrupts)çš„è¯¦ç»†æ•°æ® | `state.tasks[0].interrupts` è®¿é—®ä¸­æ–­è¯¦æƒ… | â­â­â­â­ |
| **Interrupt.value** | ä¸­æ–­å¯¹è±¡çš„å€¼å±æ€§ï¼Œå­˜å‚¨é€šè¿‡ NodeInterrupt ä¼ é€’çš„ä¸­æ–­åŸå› å­—ç¬¦ä¸² | `state.tasks[0].interrupts[0].value` | â­â­â­â­ |
| **Interrupt.when** | ä¸­æ–­å‘ç”Ÿæ—¶æœºï¼Œå€¼ä¸º 'during'(èŠ‚ç‚¹æ‰§è¡ŒæœŸé—´/åŠ¨æ€æ–­ç‚¹)æˆ– 'before'(èŠ‚ç‚¹æ‰§è¡Œå‰/é™æ€æ–­ç‚¹) | å­—ç¬¦ä¸²æšä¸¾å€¼: "during" æˆ– "before" | â­â­â­ |
| **update_state()** | æ›´æ–°å›¾çŠ¶æ€çš„æ–¹æ³•ï¼Œç”¨äºä¿®æ”¹ä¸­æ–­æ—¶çš„çŠ¶æ€ï¼Œæ˜¯ä»ä¸­æ–­æ¢å¤çš„å¿…è¦æ­¥éª¤ | `graph.update_state(config, new_state)` | â­â­â­â­â­ |
| **æ¡ä»¶æ€§ä¸­æ–­** | åŸºäºä¸šåŠ¡è§„åˆ™çš„æ™ºèƒ½ä¸­æ–­ï¼Œåªåœ¨æ»¡è¶³ç‰¹å®šæ¡ä»¶æ—¶è§¦å‘ï¼Œå¦‚è¾“å…¥è¿‡é•¿ã€é£é™©è¯„åˆ†é«˜ç­‰ | if æ¡ä»¶åˆ¤æ–­ + raise NodeInterrupt | â­â­â­â­â­ |
| **ä¿¡æ¯ä¼ é€’æœºåˆ¶** | åŠ¨æ€æ–­ç‚¹å¯æºå¸¦ç»“æ„åŒ–ä¿¡æ¯(å¦‚ JSON)ï¼Œå‘ç”¨æˆ·ä¼ é€’è¯¦ç»†çš„ä¸­æ–­åŸå› å’Œå»ºè®® | é€šè¿‡ NodeInterrupt å‚æ•°ä¼ é€’å­—ç¬¦ä¸²æˆ– JSON | â­â­â­â­ |
| **çŠ¶æ€æ¢å¤å¾ªç¯** | ä¸­æ–­åè‹¥ä¸ä¿®æ”¹çŠ¶æ€ç›´æ¥æ¢å¤ï¼Œä¼šé‡æ–°è§¦å‘ç›¸åŒä¸­æ–­ï¼Œå½¢æˆå¾ªç¯ï¼Œå¿…é¡»ä¿®æ”¹çŠ¶æ€æ‰èƒ½é€šè¿‡ | Python å¼‚å¸¸å¤„ç†å’ŒçŠ¶æ€ç®¡ç†æœºåˆ¶ | â­â­â­â­ |
| **PregelTask** | ä»»åŠ¡å¯¹è±¡ï¼ŒåŒ…å«èŠ‚ç‚¹åç§°ã€é”™è¯¯ä¿¡æ¯ã€ä¸­æ–­åˆ—è¡¨ç­‰ï¼Œç”¨äºè¿½è¸ªå›¾æ‰§è¡ŒçŠ¶æ€ | LangGraph å†…éƒ¨æ•°æ®ç»“æ„ | â­â­â­ |

---

## ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ

### ä»€ä¹ˆæ˜¯ Dynamic Breakpointsï¼Ÿ

Dynamic Breakpointsï¼ˆåŠ¨æ€æ–­ç‚¹ï¼‰æ˜¯ LangGraph æä¾›çš„ä¸€ç§**å†…éƒ¨ä¸­æ–­æœºåˆ¶**ï¼Œä¸ä¼ ç»Ÿçš„é™æ€æ–­ç‚¹ä¸åŒï¼š

| ç‰¹æ€§ | é™æ€æ–­ç‚¹ | åŠ¨æ€æ–­ç‚¹ |
|------|---------|---------|
| **è®¾ç½®æ—¶æœº** | å›¾ç¼–è¯‘æ—¶é¢„å…ˆè®¾ç½® | è¿è¡Œæ—¶æ ¹æ®æ¡ä»¶è§¦å‘ |
| **è§¦å‘æ–¹å¼** | å›ºå®šåœ¨ç‰¹å®šèŠ‚ç‚¹ | èŠ‚ç‚¹å†…éƒ¨é€»è¾‘å†³å®š |
| **çµæ´»æ€§** | æ¯æ¬¡æ‰§è¡Œéƒ½ä¼šä¸­æ–­ | å¯ä»¥æ¡ä»¶æ€§ä¸­æ–­ |
| **ä¿¡æ¯ä¼ é€’** | æ— æ³•ä¼ é€’ä¸­æ–­åŸå›  | å¯ä»¥ä¼ é€’è¯¦ç»†ä¿¡æ¯ |

### ä¸ºä»€ä¹ˆéœ€è¦ Dynamic Breakpointsï¼Ÿ

å›é¡¾äººæœºäº¤äº’çš„ä¸‰å¤§åº”ç”¨åœºæ™¯ï¼š

1. **Approvalï¼ˆå®¡æ‰¹ï¼‰** - ä¸­æ–­åç­‰å¾…ç”¨æˆ·æ‰¹å‡†æŸä¸ªæ“ä½œ
2. **Debuggingï¼ˆè°ƒè¯•ï¼‰** - å›æº¯å›¾çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œé‡ç°æˆ–é¿å…é—®é¢˜
3. **Editingï¼ˆç¼–è¾‘ï¼‰** - ä¿®æ”¹çŠ¶æ€ï¼Œæ³¨å…¥äººç±»åé¦ˆ

Dynamic Breakpoints ç‰¹åˆ«é€‚åˆä»¥ä¸‹åœºæ™¯ï¼š

âœ… **æ¡ä»¶æ€§ä¸­æ–­**ï¼šåªåœ¨æ»¡è¶³ç‰¹å®šæ¡ä»¶æ—¶æ‰ä¸­æ–­ï¼ˆå¦‚è¾“å…¥è¿‡é•¿ã€æ£€æµ‹åˆ°æ•æ„Ÿå†…å®¹ã€é£é™©è¯„åˆ†è¿‡é«˜ï¼‰

âœ… **ä¿¡æ¯ä¼ é€’**ï¼šå‘Šè¯‰ç”¨æˆ·ä¸ºä»€ä¹ˆä¼šä¸­æ–­ï¼ˆå¦‚"è¾“å…¥è¶…è¿‡å­—æ•°é™åˆ¶"ã€"æ£€æµ‹åˆ°ä¸å®‰å…¨å†…å®¹"ï¼‰

âœ… **æ™ºèƒ½æ§åˆ¶**ï¼šæ ¹æ®ä¸šåŠ¡é€»è¾‘åŠ¨æ€å†³å®šæ˜¯å¦éœ€è¦äººå·¥ä»‹å…¥

---

## ğŸ­ å®æˆ˜æ¡ˆä¾‹ï¼šæ¡ä»¶é•¿åº¦æ£€æŸ¥ç³»ç»Ÿ

æˆ‘ä»¬å°†æ„å»ºä¸€ä¸ªç®€å•çš„ä¸‰æ­¥å¤„ç†æµç¨‹ï¼Œå½“è¾“å…¥é•¿åº¦è¶…è¿‡ 5 ä¸ªå­—ç¬¦æ—¶è‡ªåŠ¨ä¸­æ–­ï¼Œè¦æ±‚äººå·¥å®¡æ ¸ã€‚

### ç³»ç»Ÿéœ€æ±‚

**æµç¨‹ï¼š**
1. **Step 1**ï¼šæ¥æ”¶å¹¶å¤„ç†è¾“å…¥
2. **Step 2**ï¼šæ£€æŸ¥è¾“å…¥é•¿åº¦ï¼Œå¦‚æœè¶…è¿‡ 5 ä¸ªå­—ç¬¦åˆ™ä¸­æ–­
3. **Step 3**ï¼šç»§ç»­å¤„ç†ï¼ˆåªæœ‰é€šè¿‡ Step 2 åæ‰æ‰§è¡Œï¼‰

### ç³»ç»Ÿæ¶æ„å›¾

```
ç”¨æˆ·è¾“å…¥
   â†“
[step_1] å¤„ç†è¾“å…¥
   â†“
[step_2] æ£€æŸ¥é•¿åº¦
   â†“ (len > 5 ?)
   â”œâ”€ Yes â†’ æŠ›å‡º NodeInterrupt (ä¸­æ–­å¹¶ä¼ é€’åŸå› )
   â”œâ”€ No  â†’ ç»§ç»­
   â†“
[step_3] æœ€ç»ˆå¤„ç†
   â†“
  END
```

---

## ğŸ”§ ä»£ç å®ç°è¯¦è§£

### 1. å¯¼å…¥ä¾èµ–

```python
from IPython.display import Image, display
from typing_extensions import TypedDict
from langgraph.checkpoint.memory import MemorySaver
from langgraph.errors import NodeInterrupt  # â­ æ ¸å¿ƒï¼šåŠ¨æ€ä¸­æ–­
from langgraph.graph import START, END, StateGraph
```

**å…³é”®å¯¼å…¥ï¼š**
- `NodeInterrupt`ï¼šè¿™æ˜¯å®ç°åŠ¨æ€æ–­ç‚¹çš„æ ¸å¿ƒç±»
- `MemorySaver`ï¼šç”¨äºä¿å­˜çŠ¶æ€ï¼Œæ”¯æŒä¸­æ–­åæ¢å¤

---

### 2. å®šä¹‰çŠ¶æ€

```python
class State(TypedDict):
    input: str  # ç®€å•çŠ¶æ€ï¼šåªåŒ…å«è¾“å…¥å­—ç¬¦ä¸²
```

**è¯´æ˜ï¼š**
- è¿™æ˜¯ä¸€ä¸ªæç®€çš„çŠ¶æ€å®šä¹‰ï¼ŒåªåŒ…å«ç”¨æˆ·è¾“å…¥
- å®é™…åº”ç”¨ä¸­å¯ä»¥åŒ…å«æ›´å¤šå­—æ®µï¼ˆå¦‚å¤„ç†ç»“æœã€å…ƒæ•°æ®ç­‰ï¼‰

---

### 3. å®ç°ä¸‰ä¸ªå¤„ç†èŠ‚ç‚¹

#### Step 1ï¼šåˆå§‹å¤„ç†

```python
def step_1(state: State) -> State:
    print("---Step 1---")
    return state  # ç›´æ¥è¿”å›çŠ¶æ€ï¼Œä¸åšä¿®æ”¹
```

**åŠŸèƒ½ï¼š** è¿™æ˜¯ç¬¬ä¸€ä¸ªå¤„ç†æ­¥éª¤ï¼Œè¿™é‡Œåªæ˜¯ç®€å•è¾“å‡ºæ—¥å¿—ã€‚

---

#### Step 2ï¼šæ¡ä»¶æ£€æŸ¥ä¸åŠ¨æ€ä¸­æ–­ â­

```python
def step_2(state: State) -> State:
    # æ£€æŸ¥è¾“å…¥é•¿åº¦
    if len(state['input']) > 5:
        # æŠ›å‡º NodeInterruptï¼Œä¼ é€’ä¸­æ–­åŸå› 
        raise NodeInterrupt(f"Received input that is longer than 5 characters: {state['input']}")

    print("---Step 2---")
    return state
```

**æ ¸å¿ƒæœºåˆ¶è¯¦è§£ï¼š**

```python
raise NodeInterrupt(message)
#     ^^^^^^^^^^^^^ ^^^^^^^
#     åŠ¨æ€ä¸­æ–­ç±»     ä¸­æ–­ä¿¡æ¯ï¼ˆä¼ é€’ç»™ç”¨æˆ·ï¼‰
```

**å…³é”®ç‚¹ï¼š**
1. **æ¡ä»¶åˆ¤æ–­**ï¼š`len(state['input']) > 5` - åªåœ¨æ»¡è¶³æ¡ä»¶æ—¶ä¸­æ–­
2. **æŠ›å‡ºå¼‚å¸¸**ï¼šä½¿ç”¨ `raise NodeInterrupt` è§¦å‘ä¸­æ–­
3. **ä¼ é€’ä¿¡æ¯**ï¼šå­—ç¬¦ä¸²å‚æ•°ä¼šè¢«è®°å½•åˆ°çŠ¶æ€ä¸­ï¼Œç”¨æˆ·å¯ä»¥çœ‹åˆ°ä¸­æ–­åŸå› 
4. **æ‰§è¡Œåœæ­¢**ï¼šä¸€æ—¦æŠ›å‡ºï¼ŒèŠ‚ç‚¹çš„åç»­ä»£ç ä¸ä¼šæ‰§è¡Œï¼Œå›¾ä¼šç«‹å³æš‚åœ

**ä¸ Python å¼‚å¸¸å¤„ç†çš„å…³ç³»ï¼š**

`NodeInterrupt` æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å¼‚å¸¸ç±»ï¼Œä½†å®ƒä¸æ˜¯ç”¨æ¥å¤„ç†é”™è¯¯çš„ï¼Œè€Œæ˜¯ç”¨æ¥**æœ‰æ„åœ°æš‚åœæ‰§è¡Œ**ï¼š

```python
# æ™®é€šå¼‚å¸¸ - è¡¨ç¤ºé”™è¯¯
try:
    result = risky_operation()
except Exception as e:
    handle_error(e)

# NodeInterrupt - è¡¨ç¤ºéœ€è¦äººå·¥ä»‹å…¥
if needs_human_review(data):
    raise NodeInterrupt("éœ€è¦äººå·¥å®¡æ ¸")  # ä¸éœ€è¦ try-except
```

---

#### Step 3ï¼šæœ€ç»ˆå¤„ç†

```python
def step_3(state: State) -> State:
    print("---Step 3---")
    return state
```

**åŠŸèƒ½ï¼š** åªæœ‰é€šè¿‡ Step 2 çš„æ£€æŸ¥åï¼Œæ‰ä¼šæ‰§è¡Œè¿™ä¸€æ­¥ã€‚

---

### 4. æ„å»ºå›¾

```python
builder = StateGraph(State)

# æ·»åŠ ä¸‰ä¸ªèŠ‚ç‚¹
builder.add_node("step_1", step_1)
builder.add_node("step_2", step_2)
builder.add_node("step_3", step_3)

# æ·»åŠ è¾¹ï¼šå®šä¹‰æ‰§è¡Œé¡ºåº
builder.add_edge(START, "step_1")
builder.add_edge("step_1", "step_2")
builder.add_edge("step_2", "step_3")
builder.add_edge("step_3", END)

# è®¾ç½®å†…å­˜æ£€æŸ¥ç‚¹ï¼ˆå¿…éœ€ï¼ï¼‰
memory = MemorySaver()

# ç¼–è¯‘å›¾
graph = builder.compile(checkpointer=memory)
```

**é‡è¦æé†’ï¼š**
- `checkpointer=memory` æ˜¯**å¿…éœ€çš„**ï¼
- æ²¡æœ‰ checkpointerï¼Œå›¾æ— æ³•åœ¨ä¸­æ–­åæ¢å¤
- Memory Saver ä¼šåœ¨æ¯ä¸ªèŠ‚ç‚¹åä¿å­˜çŠ¶æ€å¿«ç…§

---

### 5. æ‰§è¡Œå›¾ï¼šè§¦å‘åŠ¨æ€ä¸­æ–­

```python
initial_input = {"input": "hello world"}  # 11 ä¸ªå­—ç¬¦ï¼Œè¶…è¿‡ 5
thread_config = {"configurable": {"thread_id": "1"}}

# è¿è¡Œå›¾
for event in graph.stream(initial_input, thread_config, stream_mode="values"):
    print(event)
```

**è¾“å‡ºï¼š**
```
{'input': 'hello world'}
---Step 1---
{'input': 'hello world'}
```

**åˆ†æï¼š**
1. å›¾å¼€å§‹æ‰§è¡Œï¼ŒçŠ¶æ€ä¸º `{"input": "hello world"}`
2. `step_1` æ‰§è¡Œå¹¶è¾“å‡ºæ—¥å¿—
3. `step_2` å¼€å§‹æ‰§è¡Œï¼Œæ£€æµ‹åˆ°é•¿åº¦è¶…è¿‡ 5ï¼ŒæŠ›å‡º `NodeInterrupt`
4. **å›¾ç«‹å³æš‚åœ**ï¼Œä¸ä¼šæ‰§è¡Œ `step_3`

---

### 6. æ£€æŸ¥ä¸­æ–­çŠ¶æ€

#### æŸ¥çœ‹ä¸‹ä¸€ä¸ªå¾…æ‰§è¡ŒèŠ‚ç‚¹

```python
state = graph.get_state(thread_config)
print(state.next)
```

**è¾“å‡ºï¼š**
```
('step_2',)
```

**è¯´æ˜ï¼š**
- `state.next` æ˜¾ç¤ºä¸‹ä¸€ä¸ªè¦æ‰§è¡Œçš„èŠ‚ç‚¹æ˜¯ `step_2`
- å› ä¸º `step_2` ä¸­æ–­äº†ï¼Œå®ƒä¼šé‡æ–°æ‰§è¡Œï¼ˆé™¤éçŠ¶æ€è¢«ä¿®æ”¹ï¼‰

---

#### æŸ¥çœ‹ä¸­æ–­ä¿¡æ¯

```python
print(state.tasks)
```

**è¾“å‡ºï¼š**
```python
(PregelTask(
    id='6eb3910d-e231-5ba2-b25e-28ad575690bd',
    name='step_2',
    error=None,
    interrupts=(
        Interrupt(
            value='Received input that is longer than 5 characters: hello world',
            when='during'
        ),
    ),
    state=None
),)
```

**å…³é”®ä¿¡æ¯è§£è¯»ï¼š**

| å­—æ®µ | å€¼ | è¯´æ˜ |
|------|-----|------|
| `name` | `'step_2'` | ä¸­æ–­å‘ç”Ÿåœ¨å“ªä¸ªèŠ‚ç‚¹ |
| `error` | `None` | è¿™ä¸æ˜¯é”™è¯¯ï¼Œæ‰€ä»¥ä¸º None |
| `interrupts` | `Interrupt(...)` | ä¸­æ–­è¯¦æƒ… |
| `value` | `'Received input...'` | æˆ‘ä»¬ä¼ é€’çš„ä¸­æ–­åŸå›  |
| `when` | `'during'` | ä¸­æ–­å‘ç”Ÿåœ¨èŠ‚ç‚¹æ‰§è¡Œ**æœŸé—´** |

**`when` å­—æ®µè¯´æ˜ï¼š**
- `'during'`ï¼šä¸­æ–­å‘ç”Ÿåœ¨èŠ‚ç‚¹å†…éƒ¨ï¼ˆåŠ¨æ€æ–­ç‚¹ï¼‰
- `'before'`ï¼šä¸­æ–­å‘ç”Ÿåœ¨èŠ‚ç‚¹ä¹‹å‰ï¼ˆé™æ€æ–­ç‚¹ï¼‰

---

### 7. å°è¯•æ¢å¤æ‰§è¡Œï¼ˆå¤±è´¥æ¡ˆä¾‹ï¼‰

```python
# å°è¯•ç»§ç»­æ‰§è¡Œ
for event in graph.stream(None, thread_config, stream_mode="values"):
    print(event)
```

**è¾“å‡ºï¼š**
```
{'input': 'hello world'}
```

**å†æ¬¡æ£€æŸ¥çŠ¶æ€ï¼š**
```python
state = graph.get_state(thread_config)
print(state.next)
```

**è¾“å‡ºï¼š**
```
('step_2',)
```

**é—®é¢˜åˆ†æï¼š**
- è°ƒç”¨ `graph.stream(None, ...)` ä¼šé‡æ–°æ‰§è¡Œ `step_2`
- ä½†çŠ¶æ€æ²¡æœ‰æ”¹å˜ï¼Œ`input` ä»ç„¶æ˜¯ `"hello world"`
- æ‰€ä»¥å†æ¬¡è§¦å‘ `NodeInterrupt`ï¼Œé™·å…¥å¾ªç¯ï¼

**æ•™è®­ï¼š** å¿…é¡»ä¿®æ”¹çŠ¶æ€æ‰èƒ½é€šè¿‡ä¸­æ–­ç‚¹ã€‚

---

### 8. ä¿®æ”¹çŠ¶æ€å¹¶æ¢å¤æ‰§è¡Œï¼ˆæˆåŠŸæ¡ˆä¾‹ï¼‰

#### æ›´æ–°çŠ¶æ€

```python
graph.update_state(
    thread_config,
    {"input": "hi"},  # ä¿®æ”¹è¾“å…¥ä¸ºçŸ­å­—ç¬¦ä¸²ï¼ˆ2 ä¸ªå­—ç¬¦ï¼‰
)
```

**è¾“å‡ºï¼š**
```python
{
    'configurable': {
        'thread_id': '1',
        'checkpoint_ns': '',
        'checkpoint_id': '1ef6a434-06cf-6f1e-8002-0ea6dc69e075'
    }
}
```

**è¯´æ˜ï¼š**
- `update_state` ä¼šä¿®æ”¹å½“å‰çŠ¶æ€
- è¿”å›çš„æ˜¯æ–°çš„ checkpoint ID
- ä¸‹æ¬¡æ‰§è¡Œæ—¶ä¼šä½¿ç”¨æ–°çŠ¶æ€

---

#### ç»§ç»­æ‰§è¡Œ

```python
for event in graph.stream(None, thread_config, stream_mode="values"):
    print(event)
```

**è¾“å‡ºï¼š**
```
{'input': 'hi'}
---Step 2---
{'input': 'hi'}
---Step 3---
{'input': 'hi'}
```

**æˆåŠŸï¼åˆ†æï¼š**
1. ä» `step_2` é‡æ–°å¼€å§‹æ‰§è¡Œ
2. æ­¤æ—¶ `state['input']` æ˜¯ `"hi"`ï¼ˆ2 ä¸ªå­—ç¬¦ï¼‰
3. é•¿åº¦æ£€æŸ¥é€šè¿‡ï¼Œä¸ä¼šæŠ›å‡º `NodeInterrupt`
4. ç»§ç»­æ‰§è¡Œ `step_3`ï¼Œå®Œæˆæ•´ä¸ªæµç¨‹

---

## ğŸ“ æ ¸å¿ƒçŸ¥è¯†ç‚¹æ€»ç»“

### LangGraph ç‰¹æœ‰æ¦‚å¿µ

#### 1. NodeInterrupt ç±»

**è¯­æ³•ï¼š**
```python
from langgraph.errors import NodeInterrupt

raise NodeInterrupt(message: str)
```

**ç‰¹ç‚¹ï¼š**
- å¯ä»¥åœ¨èŠ‚ç‚¹å†…éƒ¨çš„**ä»»ä½•ä½ç½®**æŠ›å‡º
- å¿…é¡»ä¼ é€’ä¸€ä¸ªå­—ç¬¦ä¸²å‚æ•°ï¼ˆä¸­æ–­åŸå› ï¼‰
- ä¼šç«‹å³åœæ­¢èŠ‚ç‚¹æ‰§è¡Œ
- ä¸­æ–­ä¿¡æ¯ä¼šä¿å­˜åˆ° `state.tasks[].interrupts`

**ä¸é™æ€æ–­ç‚¹çš„å¯¹æ¯”ï¼š**

```python
# é™æ€æ–­ç‚¹ - åœ¨ç¼–è¯‘æ—¶è®¾ç½®
graph = builder.compile(
    checkpointer=memory,
    interrupt_before=["step_2"]  # æ€»æ˜¯åœ¨ step_2 ä¹‹å‰ä¸­æ–­
)

# åŠ¨æ€æ–­ç‚¹ - åœ¨è¿è¡Œæ—¶è§¦å‘
def step_2(state):
    if some_condition(state):
        raise NodeInterrupt("æ¡ä»¶æ»¡è¶³ï¼Œéœ€è¦äººå·¥å®¡æ ¸")  # æ¡ä»¶æ€§ä¸­æ–­
    return state
```

---

#### 2. ä¸­æ–­åçš„çŠ¶æ€ç®¡ç†

##### state.next

æ˜¾ç¤ºä¸‹ä¸€ä¸ªå¾…æ‰§è¡Œçš„èŠ‚ç‚¹ï¼š

```python
state = graph.get_state(thread_config)
print(state.next)  # ('step_2',)
```

##### state.tasks

åŒ…å«æ‰€æœ‰å¾…æ‰§è¡Œä»»åŠ¡çš„è¯¦ç»†ä¿¡æ¯ï¼š

```python
state.tasks[0].name        # èŠ‚ç‚¹åç§°
state.tasks[0].interrupts  # ä¸­æ–­ä¿¡æ¯åˆ—è¡¨
state.tasks[0].error       # é”™è¯¯ä¿¡æ¯ï¼ˆå¦‚æœæœ‰ï¼‰
```

---

#### 3. çŠ¶æ€æ¢å¤æµç¨‹

```
1. ä¸­æ–­å‘ç”Ÿ
   â†“
2. è°ƒç”¨ get_state() æ£€æŸ¥çŠ¶æ€
   â†“
3. è°ƒç”¨ update_state() ä¿®æ”¹çŠ¶æ€
   â†“
4. è°ƒç”¨ stream(None, ...) ç»§ç»­æ‰§è¡Œ
   â†“
5. ä»ä¸­æ–­ç‚¹é‡æ–°å¼€å§‹
```

**å…³é”®ç»†èŠ‚ï¼š**
- `stream(None, ...)` ä¸­çš„ `None` è¡¨ç¤º**ä¸æä¾›æ–°è¾“å…¥**ï¼Œä½¿ç”¨å½“å‰çŠ¶æ€
- å¦‚æœçŠ¶æ€æœªä¿®æ”¹ï¼Œä¼šé‡æ–°æ‰§è¡Œç›¸åŒçš„é€»è¾‘ï¼ˆå¯èƒ½å†æ¬¡ä¸­æ–­ï¼‰

---

### Python ç‰¹æœ‰çŸ¥è¯†ç‚¹

#### 1. TypedDict åŸºç¡€

```python
from typing_extensions import TypedDict

class State(TypedDict):
    input: str
```

**ä½œç”¨ï¼š**
- å®šä¹‰å­—å…¸çš„ç»“æ„å’Œç±»å‹
- æä¾› IDE è‡ªåŠ¨è¡¥å…¨å’Œç±»å‹æ£€æŸ¥
- LangGraph ä½¿ç”¨å®ƒæ¥éªŒè¯çŠ¶æ€

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```python
# åˆ›å»ºçŠ¶æ€
state: State = {"input": "hello"}

# ç±»å‹æ£€æŸ¥ä¼šæ•è·é”™è¯¯
state = {"input": 123}  # âŒ é”™è¯¯ï¼šåº”è¯¥æ˜¯ str
state = {"output": "hi"}  # âŒ é”™è¯¯ï¼šç¼ºå°‘ 'input' é”®
```

---

#### 2. Python å¼‚å¸¸æœºåˆ¶

è™½ç„¶ `NodeInterrupt` æ˜¯ä¸€ä¸ªå¼‚å¸¸ï¼Œä½†åœ¨ LangGraph ä¸­ä¸éœ€è¦æ‰‹åŠ¨æ•è·ï¼š

```python
# âœ… æ­£ç¡®ç”¨æ³•
def step_2(state):
    if condition:
        raise NodeInterrupt("reason")  # LangGraph ä¼šè‡ªåŠ¨å¤„ç†
    return state

# âŒ ä¸éœ€è¦è¿™æ ·åš
def step_2(state):
    try:
        if condition:
            raise NodeInterrupt("reason")
    except NodeInterrupt as e:
        # ä¸éœ€è¦æ•è·ï¼LangGraph ä¼šè‡ªåŠ¨å¤„ç†
        pass
```

**åŸç†ï¼š** LangGraph çš„æ‰§è¡Œå¼•æ“ä¼šæ•è· `NodeInterrupt`ï¼Œä¿å­˜çŠ¶æ€ï¼Œç„¶åä¼˜é›…åœ°æš‚åœæ‰§è¡Œã€‚

---

#### 3. å­—ç¬¦ä¸²æ ¼å¼åŒ–ï¼ˆf-stringï¼‰

```python
raise NodeInterrupt(f"Received input that is longer than 5 characters: {state['input']}")
```

**f-string è¯­æ³•ï¼š**
- ä»¥ `f` å¼€å¤´çš„å­—ç¬¦ä¸²
- ä½¿ç”¨ `{}` æ’å…¥å˜é‡æˆ–è¡¨è¾¾å¼
- åœ¨è¿è¡Œæ—¶è‡ªåŠ¨è®¡ç®—å’Œæ ¼å¼åŒ–

**ç­‰ä»·å†™æ³•ï¼š**
```python
# f-string (æ¨è)
message = f"Input: {state['input']}, Length: {len(state['input'])}"

# .format() (ä¼ ç»Ÿ)
message = "Input: {}, Length: {}".format(state['input'], len(state['input']))

# % æ ¼å¼åŒ– (è€å¼)
message = "Input: %s, Length: %d" % (state['input'], len(state['input']))
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. ä½•æ—¶ä½¿ç”¨åŠ¨æ€æ–­ç‚¹ï¼Ÿ

âœ… **é€‚ç”¨åœºæ™¯ï¼š**
- **å†…å®¹å®¡æ ¸**ï¼šæ£€æµ‹æ•æ„Ÿè¯ã€è¿è§„å†…å®¹æ—¶ä¸­æ–­
- **é£é™©è¯„ä¼°**ï¼šé£é™©è¯„åˆ†è¶…è¿‡é˜ˆå€¼æ—¶éœ€è¦äººå·¥å®¡æ ¸
- **èµ„æºé™åˆ¶**ï¼šè¾“å…¥è¿‡å¤§ã€è¯·æ±‚è¿‡å¤šæ—¶ä¸­æ–­
- **ç”¨æˆ·ç¡®è®¤**ï¼šéœ€è¦æ ¹æ® AI çš„åˆ¤æ–­å†³å®šæ˜¯å¦éœ€è¦ç”¨æˆ·ç¡®è®¤
- **è°ƒè¯•æ¨¡å¼**ï¼šåœ¨å¼€å‘æ—¶æ ¹æ®æ—¥å¿—çº§åˆ«åŠ¨æ€ä¸­æ–­

âŒ **ä¸é€‚ç”¨åœºæ™¯ï¼š**
- æ€»æ˜¯éœ€è¦ä¸­æ–­çš„èŠ‚ç‚¹ï¼ˆç”¨é™æ€æ–­ç‚¹æ›´ç®€å•ï¼‰
- èŠ‚ç‚¹ä¹‹é—´çš„æµç¨‹æ§åˆ¶ï¼ˆç”¨æ¡ä»¶è¾¹ï¼‰
- é”™è¯¯å¤„ç†ï¼ˆç”¨ try-exceptï¼‰

---

### 2. åŠ¨æ€æ–­ç‚¹çš„ä¿¡æ¯ä¼ é€’æŠ€å·§

#### æŠ€å·§ 1ï¼šç»“æ„åŒ–ä¿¡æ¯

```python
import json

def check_content(state):
    risk_score = calculate_risk(state['input'])

    if risk_score > 0.8:
        # ä¼ é€’ JSON æ ¼å¼çš„è¯¦ç»†ä¿¡æ¯
        info = {
            "reason": "é«˜é£é™©å†…å®¹",
            "risk_score": risk_score,
            "detected_issues": ["æš´åŠ›", "æ•æ„Ÿè¯"],
            "suggestion": "å»ºè®®äººå·¥å®¡æ ¸æˆ–æ‹’ç»"
        }
        raise NodeInterrupt(json.dumps(info, ensure_ascii=False))

    return state
```

**ç”¨æˆ·ç«¯è§£æï¼š**
```python
state = graph.get_state(thread_config)
interrupt_value = state.tasks[0].interrupts[0].value
info = json.loads(interrupt_value)
print(f"é£é™©è¯„åˆ†: {info['risk_score']}")
print(f"å»ºè®®: {info['suggestion']}")
```

---

#### æŠ€å·§ 2ï¼šå¤šæ¡ä»¶æ£€æŸ¥

```python
def validate_input(state):
    errors = []

    # æ£€æŸ¥ 1ï¼šé•¿åº¦
    if len(state['input']) > 1000:
        errors.append("è¾“å…¥è¶…è¿‡ 1000 å­—ç¬¦")

    # æ£€æŸ¥ 2ï¼šæ ¼å¼
    if not is_valid_format(state['input']):
        errors.append("æ ¼å¼ä¸ç¬¦åˆè¦æ±‚")

    # æ£€æŸ¥ 3ï¼šå†…å®¹
    if contains_profanity(state['input']):
        errors.append("åŒ…å«ä¸å½“å†…å®¹")

    if errors:
        raise NodeInterrupt(f"éªŒè¯å¤±è´¥: {', '.join(errors)}")

    return state
```

---

#### æŠ€å·§ 3ï¼šæä¾›ä¿®å¤å»ºè®®

```python
def check_data(state):
    data = state['data']

    if missing_fields := [f for f in required_fields if f not in data]:
        suggestion = f"è¯·è¡¥å……ä»¥ä¸‹å­—æ®µ: {', '.join(missing_fields)}"
        raise NodeInterrupt(f"æ•°æ®ä¸å®Œæ•´ã€‚{suggestion}")

    return state
```

---

### 3. çŠ¶æ€ä¿®æ”¹ç­–ç•¥

#### ç­–ç•¥ 1ï¼šæœ€å°ä¿®æ”¹åŸåˆ™

åªä¿®æ”¹å¿…è¦çš„å­—æ®µï¼Œä¿ç•™å…¶ä»–ä¿¡æ¯ï¼š

```python
# âœ… å¥½çš„åšæ³• - åªä¿®æ”¹éœ€è¦çš„å­—æ®µ
graph.update_state(thread_config, {"input": "hi"})

# âŒ é¿å… - è¦†ç›–æ•´ä¸ªçŠ¶æ€ï¼ˆå¯èƒ½ä¸¢å¤±å…¶ä»–ä¿¡æ¯ï¼‰
graph.update_state(thread_config, {"input": "hi", "other_field": None})
```

---

#### ç­–ç•¥ 2ï¼šä¿ç•™å†å²è®°å½•

```python
class State(TypedDict):
    input: str
    original_input: str  # ä¿ç•™åŸå§‹è¾“å…¥
    modification_history: list  # è®°å½•ä¿®æ”¹å†å²

def step_2(state):
    if len(state['input']) > 5:
        raise NodeInterrupt(f"è¾“å…¥è¿‡é•¿: {state['input']}")
    return state

# ä¿®æ”¹æ—¶ä¿ç•™å†å²
state = graph.get_state(thread_config)
original = state.values['input']
graph.update_state(thread_config, {
    "input": "hi",
    "original_input": original,
    "modification_history": [{"from": original, "to": "hi", "reason": "é•¿åº¦è¶…é™"}]
})
```

---

#### ç­–ç•¥ 3ï¼šæ¡ä»¶æ€§ä¿®æ”¹

```python
# æ ¹æ®ä¸­æ–­åŸå› å†³å®šå¦‚ä½•ä¿®æ”¹
state = graph.get_state(thread_config)
interrupt_msg = state.tasks[0].interrupts[0].value

if "é•¿åº¦" in interrupt_msg:
    # æˆªæ–­è¾“å…¥
    graph.update_state(thread_config, {"input": original[:5]})
elif "æ ¼å¼" in interrupt_msg:
    # ä¿®æ­£æ ¼å¼
    graph.update_state(thread_config, {"input": fix_format(original)})
```

---

### 4. ä¸ LangGraph API/Studio é›†æˆ

åœ¨å®é™…åº”ç”¨ä¸­ï¼Œé€šå¸¸ä¼šé€šè¿‡ API ä¸å›¾äº¤äº’ã€‚ä»¥ä¸‹æ˜¯å®Œæ•´çš„å·¥ä½œæµç¨‹ï¼š

#### è¿æ¥åˆ° LangGraph æœåŠ¡

```python
from langgraph_sdk import get_client

# è¿æ¥åˆ°æœ¬åœ°å¼€å‘æœåŠ¡å™¨
URL = "http://127.0.0.1:2024"
client = get_client(url=URL)

# æœç´¢å¯ç”¨çš„å›¾
assistants = await client.assistants.search()
```

---

#### åˆ›å»ºçº¿ç¨‹å¹¶æ‰§è¡Œ

```python
# åˆ›å»ºæ–°çº¿ç¨‹
thread = await client.threads.create()

# æ‰§è¡Œå›¾
async for chunk in client.runs.stream(
    thread["thread_id"],
    assistant_id="dynamic_breakpoints",
    input={"input": "hello world"},
    stream_mode="values"
):
    print(f"Event type: {chunk.event}")
    print(chunk.data)
```

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
Event type: metadata
{'run_id': '1ef6a43a-1b04-64d0-9a79-1caff72c8a89'}

Event type: values
{'input': 'hello world'}

Event type: values
{'input': 'hello world'}
```

---

#### æ£€æŸ¥ä¸­æ–­çŠ¶æ€

```python
# è·å–å½“å‰çŠ¶æ€
current_state = await client.threads.get_state(thread['thread_id'])

print(current_state['next'])  # ['step_2']
print(current_state['tasks'][0]['interrupts'])  # ä¸­æ–­è¯¦æƒ…
```

---

#### æ›´æ–°çŠ¶æ€å¹¶æ¢å¤

```python
# æ›´æ–°çŠ¶æ€
await client.threads.update_state(
    thread['thread_id'],
    {"input": "hi!"}
)

# ç»§ç»­æ‰§è¡Œï¼ˆä¼ å…¥ Noneï¼‰
async for chunk in client.runs.stream(
    thread["thread_id"],
    assistant_id="dynamic_breakpoints",
    input=None,  # â­ None è¡¨ç¤ºä½¿ç”¨å½“å‰çŠ¶æ€
    stream_mode="values"
):
    print(chunk.data)
```

**è¾“å‡ºï¼š**
```
{'input': 'hi!'}
---Step 2---
{'input': 'hi!'}
---Step 3---
{'input': 'hi!'}
```

---

## ğŸš€ è¿›é˜¶æŠ€å·§

### 1. å¤šçº§ä¸­æ–­æ¡ä»¶

```python
def advanced_check(state):
    input_text = state['input']

    # ç¬¬ä¸€çº§ï¼šä¸¥é‡é—®é¢˜ - ç«‹å³æ‹’ç»
    if contains_illegal_content(input_text):
        raise NodeInterrupt(
            "ä¸¥é‡è¿è§„ï¼šæ£€æµ‹åˆ°éæ³•å†…å®¹ï¼Œå·²è‡ªåŠ¨æ‹’ç»ã€‚"
        )

    # ç¬¬äºŒçº§ï¼šä¸­ç­‰é£é™© - éœ€è¦å®¡æ ¸
    risk = calculate_risk(input_text)
    if risk > 0.7:
        raise NodeInterrupt(
            f"ä¸­ç­‰é£é™© (è¯„åˆ†: {risk})ï¼šå»ºè®®äººå·¥å®¡æ ¸ã€‚"
        )

    # ç¬¬ä¸‰çº§ï¼šè½»å¾®é—®é¢˜ - è­¦å‘Šä½†ç»§ç»­
    if risk > 0.4:
        print(f"âš ï¸ è­¦å‘Šï¼šæ£€æµ‹åˆ°è½»å¾®é£é™© (è¯„åˆ†: {risk})")

    return state
```

---

### 2. å¸¦è¶…æ—¶çš„ä¸­æ–­

```python
from datetime import datetime, timedelta

class State(TypedDict):
    input: str
    interrupt_timestamp: str
    max_wait_seconds: int

def timed_check(state):
    if needs_approval(state['input']):
        timestamp = datetime.now().isoformat()
        raise NodeInterrupt(
            f"éœ€è¦å®¡æ‰¹ã€‚è¶…æ—¶æ—¶é—´ï¼š{state.get('max_wait_seconds', 3600)} ç§’"
        )
    return state

# æ¢å¤æ—¶æ£€æŸ¥è¶…æ—¶
state = graph.get_state(thread_config)
if state.tasks and state.tasks[0].interrupts:
    interrupt_time = datetime.fromisoformat(state.values['interrupt_timestamp'])
    if datetime.now() - interrupt_time > timedelta(seconds=state.values['max_wait_seconds']):
        # è¶…æ—¶å¤„ç†ï¼šè‡ªåŠ¨æ‹’ç»æˆ–ä½¿ç”¨é»˜è®¤å€¼
        graph.update_state(thread_config, {"input": "TIMEOUT_REJECTED"})
```

---

### 3. ä¸­æ–­åçš„å¤šè·¯å¾„é€‰æ‹©

```python
class State(TypedDict):
    input: str
    approval_decision: str  # "approve", "reject", "modify"

def check_content(state):
    if needs_review(state['input']):
        raise NodeInterrupt("å†…å®¹éœ€è¦å®¡æ ¸ï¼Œè¯·é€‰æ‹©æ“ä½œ")
    return state

def handle_decision(state):
    decision = state.get('approval_decision', 'reject')

    if decision == 'approve':
        return {"status": "approved"}
    elif decision == 'modify':
        return {"input": state.get('modified_input', state['input'])}
    else:
        return {"status": "rejected"}

# ç”¨æˆ·å†³ç­–åæ›´æ–°
graph.update_state(thread_config, {
    "approval_decision": "modify",
    "modified_input": "ä¿®æ”¹åçš„å†…å®¹"
})
```

---

### 4. ç»„åˆé™æ€ä¸åŠ¨æ€æ–­ç‚¹

```python
# ç¼–è¯‘æ—¶è®¾ç½®é™æ€æ–­ç‚¹
graph = builder.compile(
    checkpointer=memory,
    interrupt_before=["final_step"]  # æ€»æ˜¯åœ¨æœ€åä¸€æ­¥å‰ä¸­æ–­
)

# èŠ‚ç‚¹ä¸­ä½¿ç”¨åŠ¨æ€æ–­ç‚¹
def middle_step(state):
    if high_risk(state['data']):
        raise NodeInterrupt("æ£€æµ‹åˆ°é«˜é£é™©ï¼Œéœ€è¦é¢å¤–å®¡æ ¸")  # åŠ¨æ€ä¸­æ–­
    return state
```

**ç»„åˆæ•ˆæœï¼š**
- `middle_step`ï¼šåªåœ¨é«˜é£é™©æ—¶ä¸­æ–­
- `final_step`ï¼šæ€»æ˜¯ä¸­æ–­ï¼ˆæœ€ç»ˆç¡®è®¤ï¼‰

---

## ğŸ“Š é™æ€ vs åŠ¨æ€æ–­ç‚¹å¯¹æ¯”

| ç‰¹æ€§ | é™æ€æ–­ç‚¹ | åŠ¨æ€æ–­ç‚¹ |
|------|---------|---------|
| **è®¾ç½®æ–¹å¼** | `interrupt_before=["node"]` | `raise NodeInterrupt()` |
| **ä¸­æ–­æ—¶æœº** | èŠ‚ç‚¹æ‰§è¡Œå‰ | èŠ‚ç‚¹æ‰§è¡Œä¸­ |
| **è§¦å‘æ¡ä»¶** | æ€»æ˜¯è§¦å‘ | æ ¹æ®é€»è¾‘æ¡ä»¶ |
| **ä¿¡æ¯ä¼ é€’** | æ—  | å¯ä»¥ä¼ é€’è¯¦ç»†ä¿¡æ¯ |
| **çµæ´»æ€§** | ä½ï¼ˆå›ºå®šèŠ‚ç‚¹ï¼‰ | é«˜ï¼ˆåŠ¨æ€å†³å®šï¼‰ |
| **é€‚ç”¨åœºæ™¯** | å›ºå®šå®¡æ‰¹ç‚¹ | æ¡ä»¶æ€§å®¡æ ¸ |

**å®é™…åº”ç”¨å»ºè®®ï¼š**

```python
# é™æ€æ–­ç‚¹ - ç”¨äºå›ºå®šæµç¨‹
interrupt_before=["deploy", "payment"]  # æ€»æ˜¯éœ€è¦ç¡®è®¤çš„æ­¥éª¤

# åŠ¨æ€æ–­ç‚¹ - ç”¨äºæ™ºèƒ½åˆ¤æ–­
def content_filter(state):
    if ai_detects_issue(state['content']):  # AI åˆ¤æ–­
        raise NodeInterrupt("AI æ£€æµ‹åˆ°æ½œåœ¨é—®é¢˜")
    return state
```

---

## ğŸ¯ å®é™…åº”ç”¨æ¡ˆä¾‹

### æ¡ˆä¾‹ 1ï¼šå†…å®¹å®¡æ ¸ç³»ç»Ÿ

```python
class ContentState(TypedDict):
    content: str
    category: str
    risk_score: float

def content_moderation(state: ContentState):
    # ä½¿ç”¨ AI æ¨¡å‹è¯„ä¼°å†…å®¹
    result = moderation_model.analyze(state['content'])
    state['risk_score'] = result.risk_score

    # é«˜é£é™©ï¼šç«‹å³æ‹’ç»
    if result.risk_score > 0.9:
        raise NodeInterrupt(
            f"é«˜é£é™©å†…å®¹ (è¯„åˆ†: {result.risk_score})ï¼Œå·²è‡ªåŠ¨æ‹’ç»ã€‚"
            f"æ£€æµ‹åˆ°çš„é—®é¢˜: {', '.join(result.issues)}"
        )

    # ä¸­é£é™©ï¼šäººå·¥å®¡æ ¸
    if result.risk_score > 0.5:
        raise NodeInterrupt(
            f"ä¸­é£é™©å†…å®¹ (è¯„åˆ†: {result.risk_score})ï¼Œéœ€è¦äººå·¥å®¡æ ¸ã€‚"
            f"å¯ç–‘ç‚¹: {', '.join(result.warnings)}"
        )

    # ä½é£é™©ï¼šè‡ªåŠ¨é€šè¿‡
    return state

# äººå·¥å®¡æ ¸åçš„å¤„ç†
def handle_review(state):
    decision = state.get('review_decision')
    if decision == 'approve':
        return {"status": "approved"}
    elif decision == 'reject':
        return {"status": "rejected"}
    else:
        return {"status": "needs_modification"}
```

---

### æ¡ˆä¾‹ 2ï¼šé‡‘èäº¤æ˜“å®¡æ‰¹

```python
class TransactionState(TypedDict):
    amount: float
    account: str
    risk_factors: list
    approval_required: bool

def transaction_check(state: TransactionState):
    amount = state['amount']

    # è§„åˆ™ 1ï¼šå¤§é¢äº¤æ˜“
    if amount > 10000:
        raise NodeInterrupt(
            f"å¤§é¢äº¤æ˜“éœ€å®¡æ‰¹ï¼šé‡‘é¢ ${amount:,.2f} è¶…è¿‡é™é¢ $10,000"
        )

    # è§„åˆ™ 2ï¼šå¼‚å¸¸æ¨¡å¼
    if detect_anomaly(state['account']):
        risk_factors = analyze_risk(state)
        raise NodeInterrupt(
            f"æ£€æµ‹åˆ°å¼‚å¸¸äº¤æ˜“æ¨¡å¼ã€‚é£é™©å› ç´ : {', '.join(risk_factors)}"
        )

    # è§„åˆ™ 3ï¼šæ–°è´¦æˆ·
    if is_new_account(state['account']):
        raise NodeInterrupt(
            f"æ–°è´¦æˆ·é¦–æ¬¡å¤§é¢äº¤æ˜“ï¼Œéœ€è¦èº«ä»½éªŒè¯"
        )

    return state
```

---

### æ¡ˆä¾‹ 3ï¼šAI åŠ©æ‰‹çš„æ•æ„Ÿæ“ä½œç¡®è®¤

```python
class AssistantState(TypedDict):
    user_request: str
    planned_action: str
    destructive: bool

def plan_execution(state: AssistantState):
    action = parse_action(state['user_request'])
    state['planned_action'] = action

    # æ£€æµ‹ç ´åæ€§æ“ä½œ
    destructive_keywords = ['delete', 'remove', 'drop', 'truncate']
    if any(kw in action.lower() for kw in destructive_keywords):
        state['destructive'] = True
        raise NodeInterrupt(
            f"âš ï¸ æ£€æµ‹åˆ°æ½œåœ¨ç ´åæ€§æ“ä½œ: {action}\n"
            f"æ­¤æ“ä½œå¯èƒ½æ— æ³•æ’¤é”€ï¼Œéœ€è¦æ‚¨çš„æ˜ç¡®ç¡®è®¤ã€‚"
        )

    return state

# ç”¨æˆ·ç¡®è®¤åç»§ç»­
graph.update_state(thread_config, {"user_confirmed": True})
```

---

### æ¡ˆä¾‹ 4ï¼šå¤šæ­¥éª¤éªŒè¯æµç¨‹

```python
class VerificationState(TypedDict):
    user_id: str
    verification_steps: list
    current_step: int

def verification_flow(state: VerificationState):
    steps = ['identity', 'email', 'phone', 'document']
    current = state['current_step']

    if current < len(steps):
        step_name = steps[current]
        raise NodeInterrupt(
            f"éªŒè¯æ­¥éª¤ {current + 1}/{len(steps)}: è¯·å®Œæˆ{step_name}éªŒè¯"
        )

    return {"verification_complete": True}

# ç”¨æˆ·å®Œæˆæ¯ä¸€æ­¥åæ›´æ–°
for step in range(4):
    # ç”¨æˆ·å®ŒæˆéªŒè¯
    user_completes_verification(step)

    # æ›´æ–°çŠ¶æ€
    graph.update_state(thread_config, {"current_step": step + 1})

    # ç»§ç»­æ‰§è¡Œ
    graph.stream(None, thread_config)
```

---

## ğŸ” å¸¸è§é—®é¢˜

### Q1: NodeInterrupt å’Œæ™®é€š Python å¼‚å¸¸æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

**æ™®é€šå¼‚å¸¸ï¼š** è¡¨ç¤ºé”™è¯¯ï¼Œéœ€è¦æ•è·å’Œå¤„ç†
```python
try:
    result = risky_operation()
except ValueError as e:
    handle_error(e)  # é”™è¯¯å¤„ç†é€»è¾‘
```

**NodeInterruptï¼š** è¡¨ç¤ºéœ€è¦æš‚åœï¼Œç”± LangGraph è‡ªåŠ¨å¤„ç†
```python
if needs_human_review(data):
    raise NodeInterrupt("éœ€è¦äººå·¥å®¡æ ¸")  # ä¸éœ€è¦ try-except
```

**å…³é”®åŒºåˆ«ï¼š**
- æ™®é€šå¼‚å¸¸ä¼šä¸­æ–­ç¨‹åºæ‰§è¡Œï¼ˆé™¤éæ•è·ï¼‰
- NodeInterrupt ä¼šæš‚åœå›¾æ‰§è¡Œï¼Œä½†å¯ä»¥æ¢å¤
- æ™®é€šå¼‚å¸¸è¡¨ç¤º"å‡ºé”™äº†"ï¼ŒNodeInterrupt è¡¨ç¤º"éœ€è¦ç­‰å¾…"

---

### Q2: ä¸ºä»€ä¹ˆå¿…é¡»ä½¿ç”¨ MemorySaverï¼Ÿ

å› ä¸ºåŠ¨æ€æ–­ç‚¹éœ€è¦ï¼š
1. **ä¿å­˜ä¸­æ–­æ—¶çš„çŠ¶æ€**
2. **è®°å½•ä¸­æ–­åŸå› **
3. **æ”¯æŒçŠ¶æ€æ¢å¤**

æ²¡æœ‰ checkpointerï¼Œå›¾æ— æ³•ä¿å­˜è¿™äº›ä¿¡æ¯ï¼š

```python
# âŒ é”™è¯¯ - æ— æ³•ä½¿ç”¨åŠ¨æ€æ–­ç‚¹
graph = builder.compile()  # æ²¡æœ‰ checkpointer

# âœ… æ­£ç¡®
memory = MemorySaver()
graph = builder.compile(checkpointer=memory)
```

---

### Q3: èƒ½å¦åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ä¸­å¤šæ¬¡æŠ›å‡º NodeInterruptï¼Ÿ

ä¸èƒ½ã€‚ä¸€æ—¦æŠ›å‡º `NodeInterrupt`ï¼ŒèŠ‚ç‚¹æ‰§è¡Œç«‹å³åœæ­¢ï¼š

```python
def check(state):
    if condition_1:
        raise NodeInterrupt("æ¡ä»¶ 1 è§¦å‘")

    # âŒ å¦‚æœæ¡ä»¶ 1 ä¸ºçœŸï¼Œè¿™é‡Œæ°¸è¿œä¸ä¼šæ‰§è¡Œ
    if condition_2:
        raise NodeInterrupt("æ¡ä»¶ 2 è§¦å‘")
```

**è§£å†³æ–¹æ¡ˆï¼š** åˆå¹¶æ¡ä»¶æˆ–ä½¿ç”¨å¤šä¸ªèŠ‚ç‚¹
```python
def check(state):
    errors = []
    if condition_1:
        errors.append("æ¡ä»¶ 1 å¤±è´¥")
    if condition_2:
        errors.append("æ¡ä»¶ 2 å¤±è´¥")

    if errors:
        raise NodeInterrupt(f"æ£€æµ‹åˆ°é—®é¢˜: {', '.join(errors)}")
```

---

### Q4: å¦‚ä½•åœ¨ä¸­æ–­åå®Œå…¨å–æ¶ˆæ‰§è¡Œï¼Œè€Œä¸æ˜¯ç»§ç»­ï¼Ÿ

æœ‰ä¸¤ç§æ–¹æ³•ï¼š

**æ–¹æ³• 1ï¼šæ›´æ–°çŠ¶æ€ä¸ºç»ˆæ­¢æ ‡å¿—**
```python
class State(TypedDict):
    input: str
    cancelled: bool

def check(state):
    if should_cancel(state):
        raise NodeInterrupt("æ“ä½œéœ€è¦å–æ¶ˆ")
    return state

def next_step(state):
    if state.get('cancelled'):
        return END  # ç›´æ¥ç»“æŸ
    # æ­£å¸¸é€»è¾‘
    return state

# ç”¨æˆ·å†³å®šå–æ¶ˆ
graph.update_state(thread_config, {"cancelled": True})
```

**æ–¹æ³• 2ï¼šä¸è°ƒç”¨ stream ç»§ç»­æ‰§è¡Œ**
```python
# æ£€æŸ¥ä¸­æ–­åŸå› 
state = graph.get_state(thread_config)
if "cancel" in state.tasks[0].interrupts[0].value.lower():
    # ä¸è°ƒç”¨ streamï¼Œæ‰§è¡Œå°±æ­¤ç»“æŸ
    print("æ“ä½œå·²å–æ¶ˆ")
else:
    # å¦åˆ™ä¿®æ”¹çŠ¶æ€å¹¶ç»§ç»­
    graph.update_state(thread_config, new_state)
    graph.stream(None, thread_config)
```

---

### Q5: èƒ½å¦åœ¨æ¡ä»¶è¾¹ä¸­ä½¿ç”¨åŠ¨æ€æ–­ç‚¹ï¼Ÿ

ä¸èƒ½ç›´æ¥åœ¨æ¡ä»¶å‡½æ•°ä¸­æŠ›å‡º `NodeInterrupt`ï¼š

```python
# âŒ è¿™ä¸ä¼šå·¥ä½œ
def route(state):
    if needs_approval(state):
        raise NodeInterrupt("éœ€è¦å®¡æ‰¹")  # æ¡ä»¶å‡½æ•°ä¸­æ— æ•ˆ
    return "next_node"

builder.add_conditional_edges("start", route)
```

**æ­£ç¡®åšæ³•ï¼š** åœ¨èŠ‚ç‚¹ä¸­æŠ›å‡ºï¼Œç„¶åç”¨æ¡ä»¶è¾¹è·¯ç”±
```python
def approval_node(state):
    if needs_approval(state):
        raise NodeInterrupt("éœ€è¦å®¡æ‰¹")
    return state

def route(state):
    if state.get('approved'):
        return "continue"
    else:
        return "reject"

builder.add_node("approval", approval_node)
builder.add_conditional_edges("approval", route, ["continue", "reject"])
```

---

## ğŸ“– æ‰©å±•é˜…è¯»

- [LangGraph Dynamic Breakpoints å®˜æ–¹æ–‡æ¡£](https://langchain-ai.github.io/langgraph/how-tos/human_in_the_loop/dynamic_breakpoints/)
- [Human-in-the-Loop å®Œæ•´æŒ‡å—](https://langchain-ai.github.io/langgraph/concepts/human_in_the_loop/)
- [LangGraph API å‚è€ƒ](https://langchain-ai.github.io/langgraph/reference/graphs/)

---

## ğŸ‰ æ€»ç»“

Dynamic Breakpoints æ˜¯ LangGraph ä¸­å¼ºå¤§çš„äººæœºäº¤äº’æœºåˆ¶ï¼Œå…è®¸å›¾æ ¹æ®ä¸šåŠ¡é€»è¾‘æ™ºèƒ½åœ°å†³å®šä½•æ—¶éœ€è¦äººå·¥ä»‹å…¥ã€‚å…³é”®è¦ç‚¹ï¼š

1. **ä½¿ç”¨ `NodeInterrupt`** åœ¨èŠ‚ç‚¹å†…éƒ¨è§¦å‘åŠ¨æ€ä¸­æ–­
2. **ä¼ é€’è¯¦ç»†ä¿¡æ¯** å‘Šè¯‰ç”¨æˆ·ä¸ºä»€ä¹ˆä¼šä¸­æ–­
3. **æ£€æŸ¥çŠ¶æ€** ä½¿ç”¨ `get_state()` äº†è§£ä¸­æ–­åŸå› 
4. **ä¿®æ”¹çŠ¶æ€** ä½¿ç”¨ `update_state()` è§£å†³é—®é¢˜
5. **ç»§ç»­æ‰§è¡Œ** è°ƒç”¨ `stream(None, ...)` ä»ä¸­æ–­ç‚¹æ¢å¤

é€šè¿‡ç»“åˆé™æ€æ–­ç‚¹å’ŒåŠ¨æ€æ–­ç‚¹ï¼Œä½ å¯ä»¥æ„å»ºçµæ´»ã€æ™ºèƒ½çš„ AI åº”ç”¨ï¼Œåœ¨è‡ªåŠ¨åŒ–å’Œäººå·¥æ§åˆ¶ä¹‹é—´æ‰¾åˆ°å®Œç¾çš„å¹³è¡¡ï¼

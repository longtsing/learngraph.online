# 5.3 è°ƒè¯•æŠ€å·§

## å¼•è¨€

> **å°ç™½ç†è§£ - ä»€ä¹ˆæ˜¯è°ƒè¯•ï¼ˆDebugï¼‰ï¼Ÿ**
>
> è°ƒè¯• = **æ‰¾å‡ºç¨‹åºå“ªé‡Œå‡ºé”™äº†**
>
> ç±»æ¯”ï¼šä¿®ç†æ±½è½¦
> - è½¦åäº† â†’ ä¸çŸ¥é“å“ªé‡Œå
> - æ‰“å¼€å¼•æ“ç›–ï¼Œæ£€æŸ¥å„ä¸ªéƒ¨ä»¶ â†’ è°ƒè¯•
> - å‘ç°æ˜¯ç”µæ± æ²¡ç”µ â†’ æ‰¾åˆ° bug
> - æ¢ç”µæ±  â†’ ä¿®å¤ bug
>
> **ç¨‹åºå‘˜çš„è°ƒè¯•æ–¹æ³•**ï¼š
>
> | æ–¹æ³• | é€‚ç”¨åœºæ™¯ | ç±»æ¯” |
> |------|---------|------|
> | `print` è°ƒè¯• | å¿«é€Ÿæ£€æŸ¥å˜é‡å€¼ | æ‹¿æ‰‹ç”µç­’ç…§ä¸€ä¸‹ |
> | `pdb` è°ƒè¯•å™¨ | é€è¡Œæ‰§è¡Œï¼Œæ·±å…¥æ’æŸ¥ | æ…¢åŠ¨ä½œå›æ”¾ |
> | æ—¥å¿— | é•¿æœŸç›‘æ§ã€ç”Ÿäº§ç¯å¢ƒ | å®‰è£…è¡Œè½¦è®°å½•ä»ª |
> | æ–­ç‚¹è°ƒè¯• | IDE ä¸­å¯è§†åŒ–è°ƒè¯• | åœ¨åœ°å›¾ä¸Šæ’æ——å­ |

## print è°ƒè¯•

> **å°ç™½ç†è§£ - print è°ƒè¯•**
>
> æœ€ç®€å•ã€æœ€å¸¸ç”¨çš„è°ƒè¯•æ–¹æ³•ï¼š**åœ¨å…³é”®ä½ç½®æ‰“å°å˜é‡å€¼**
>
> ```python
> def calculate(x, y):
>     print(f"[DEBUG] x={x}, y={y}")  # çœ‹çœ‹ä¼ è¿›æ¥ä»€ä¹ˆ
>     result = x + y
>     print(f"[DEBUG] result={result}")  # çœ‹çœ‹è®¡ç®—ç»“æœ
>     return result
> ```
>
> **ä¼˜ç‚¹**ï¼šç®€å•å¿«é€Ÿ
> **ç¼ºç‚¹**ï¼šä»£ç é‡Œåˆ°å¤„æ˜¯ printï¼Œè®°å¾—åˆ æ‰

```python
def process_agent_response(response: dict) -> str:
    """å¤„ç† Agent å“åº”"""
    print(f"[DEBUG] æ”¶åˆ°å“åº”: {response}")
    
    if "choices" in response:
        choices = response["choices"]
        print(f"[DEBUG] choices æ•°é‡: {len(choices)}")
        
        if choices:
            message = choices[0].get("message", {})
            content = message.get("content", "")
            print(f"[DEBUG] å†…å®¹é•¿åº¦: {len(content)}")
            return content
    
    print("[DEBUG] å“åº”æ ¼å¼é”™è¯¯")
    return ""

# ä½¿ç”¨
response = {
    "choices": [
        {"message": {"content": "ä½ å¥½!"}}
    ]
}

result = process_agent_response(response)
```

## pdb è°ƒè¯•å™¨

> **å°ç™½ç†è§£ - pdb æ˜¯ä»€ä¹ˆï¼Ÿ**
>
> pdb = **Python Debugger**ï¼ŒPython å†…ç½®çš„è°ƒè¯•å™¨
>
> ç±»æ¯”ï¼š**è§†é¢‘æ’­æ”¾å™¨çš„æš‚åœå’Œæ…¢æ”¾**
> - ç¨‹åºæ­£å¸¸è¿è¡Œ = è§†é¢‘æ­£å¸¸æ’­æ”¾
> - `pdb.set_trace()` = æŒ‰æš‚åœ
> - ç„¶åä½ å¯ä»¥ä¸€å¸§ä¸€å¸§çœ‹ï¼ˆé€è¡Œæ‰§è¡Œï¼‰
>
> **pdb å¸¸ç”¨å‘½ä»¤**ï¼š
>
> | å‘½ä»¤ | å…¨ç§° | ä½œç”¨ |
> |------|------|------|
> | `n` | next | æ‰§è¡Œä¸‹ä¸€è¡Œ |
> | `s` | step | è¿›å…¥å‡½æ•°å†…éƒ¨ |
> | `c` | continue | ç»§ç»­è¿è¡Œç›´åˆ°ä¸‹ä¸€ä¸ªæ–­ç‚¹ |
> | `p x` | print | æ‰“å°å˜é‡ x çš„å€¼ |
> | `l` | list | æ˜¾ç¤ºå½“å‰ä»£ç ä½ç½® |
> | `q` | quit | é€€å‡ºè°ƒè¯• |

```python
import pdb

def calculate_cost(tokens: int, price_per_1k: float) -> float:
    """è®¡ç®— API è°ƒç”¨æˆæœ¬"""
    # è®¾ç½®æ–­ç‚¹
    pdb.set_trace()

    cost = (tokens / 1000) * price_per_1k
    return cost

# è¿è¡Œæ—¶ä¼šåœ¨ set_trace() å¤„æš‚åœ
# å¸¸ç”¨å‘½ä»¤:
# - n (next): æ‰§è¡Œä¸‹ä¸€è¡Œ
# - s (step): è¿›å…¥å‡½æ•°
# - c (continue): ç»§ç»­æ‰§è¡Œ
# - p variable: æ‰“å°å˜é‡
# - l (list): æ˜¾ç¤ºä»£ç 
# - q (quit): é€€å‡ºè°ƒè¯•

result = calculate_cost(1000, 0.002)
```

## breakpoint() å‡½æ•°ï¼ˆPython 3.7+ï¼‰

> **å°ç™½ç†è§£ - breakpoint() æ˜¯ä»€ä¹ˆï¼Ÿ**
>
> `breakpoint()` = **pdb.set_trace() çš„ç®€åŒ–ç‰ˆ**
>
> ç±»æ¯”ï¼š
> - `pdb.set_trace()` = æ‰‹åŠ¨è®¾ç½®é—¹é’Ÿçš„æ‰€æœ‰å‚æ•°
> - `breakpoint()` = ç›´æ¥è¯´"æ˜æ—©7ç‚¹å«æˆ‘"
>
> **ä¸¤è€…æ•ˆæœä¸€æ ·ï¼Œbreakpoint() æ›´ç®€æ´**
>
> ```python
> # æ—§å†™æ³•ï¼ˆPython 3.6 åŠä¹‹å‰ï¼‰
> import pdb
> pdb.set_trace()
>
> # æ–°å†™æ³•ï¼ˆPython 3.7+ï¼‰
> breakpoint()  # ä¸€è¡Œæå®šï¼
> ```

```python
def complex_calculation(data: list) -> float:
    """å¤æ‚è®¡ç®—"""
    result = 0.0
    
    for item in data:
        # ä½¿ç”¨ breakpoint() ä»£æ›¿ pdb.set_trace()
        breakpoint()
        
        if isinstance(item, (int, float)):
            result += item
        elif isinstance(item, str):
            result += len(item)
    
    return result

# ä½¿ç”¨
data = [1, 2, "hello", 3.5]
total = complex_calculation(data)
```

## è£…é¥°å™¨è°ƒè¯•å·¥å…·

> **å°ç™½ç†è§£ - ä»€ä¹ˆæ˜¯è°ƒè¯•è£…é¥°å™¨ï¼Ÿ**
>
> è£…é¥°å™¨è°ƒè¯• = **ç»™å‡½æ•°è£…ä¸€ä¸ª"ç›‘æ§å™¨"**
>
> ç±»æ¯”ï¼š**åº—é“ºé—¨å£çš„è®¡æ•°å™¨**
> - é¡¾å®¢è¿›æ¥ â†’ è®°å½•"è°è¿›æ¥äº†"
> - é¡¾å®¢ç¦»å¼€ â†’ è®°å½•"ä¹°äº†ä»€ä¹ˆï¼ŒèŠ±äº†å¤šé•¿æ—¶é—´"
>
> ```
> @debug              â† è£…ä¸€ä¸ªç›‘æ§å™¨
> def my_function():  â† è¢«ç›‘æ§çš„å‡½æ•°
>     ...
>
> è°ƒç”¨ my_function() æ—¶è‡ªåŠ¨æ‰“å°ï¼š
> â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
> â”‚ è°ƒç”¨ my_function(å‚æ•°1, å‚æ•°2) â”‚
> â”‚   è¿”å› "ç»“æœ"                â”‚
> â”‚   è€—æ—¶ 0.5ç§’                 â”‚
> â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
> ```
>
> **å¥½å¤„**ï¼šä¸ç”¨æ”¹å‡½æ•°å†…éƒ¨ä»£ç ï¼Œå°±èƒ½ç›‘æ§å®ƒçš„è¿è¡Œ

```python
import functools
from typing import Callable, Any
import time

def debug(func: Callable) -> Callable:
    """è°ƒè¯•è£…é¥°å™¨ï¼šæ‰“å°å‡½æ•°è°ƒç”¨ä¿¡æ¯"""
    @functools.wraps(func)
    def wrapper(*args, **kwargs):
        # æ ¼å¼åŒ–å‚æ•°
        args_repr = [repr(a) for a in args]
        kwargs_repr = [f"{k}={v!r}" for k, v in kwargs.items()]
        signature = ", ".join(args_repr + kwargs_repr)
        
        print(f"è°ƒç”¨ {func.__name__}({signature})")
        
        # æ‰§è¡Œå‡½æ•°
        start = time.time()
        result = func(*args, **kwargs)
        end = time.time()
        
        print(f"  è¿”å› {result!r}")
        print(f"  è€—æ—¶ {end - start:.4f}ç§’")
        
        return result
    
    return wrapper

@debug
def call_llm(prompt: str, model: str = "gpt-4") -> str:
    """è°ƒç”¨ LLM"""
    time.sleep(0.5)  # æ¨¡æ‹Ÿ API è°ƒç”¨
    return f"æ¥è‡ª {model} çš„å“åº”"

# ä½¿ç”¨
result = call_llm("ä½ å¥½", model="gpt-3.5-turbo")
```

## æ€§èƒ½åˆ†æ

> **å°ç™½ç†è§£ - ä»€ä¹ˆæ˜¯æ€§èƒ½åˆ†æï¼Ÿ**
>
> æ€§èƒ½åˆ†æ = **æ‰¾å‡ºç¨‹åºå“ªé‡Œæ…¢**
>
> ç±»æ¯”ï¼š**ä½“æ£€**
> - ç¨‹åºè¿è¡Œæ…¢ = èº«ä½“ä¸èˆ’æœ
> - æ€§èƒ½åˆ†æ = åšä¸€ä¸ªå…¨èº«æ£€æŸ¥
> - æŠ¥å‘Šæ˜¾ç¤º = "å¿ƒè„æ­£å¸¸ï¼Œä½†è¡€å‹é«˜"ï¼ˆæŸå‡½æ•°è€—æ—¶è¿‡é•¿ï¼‰
>
> **cProfile æ¨¡å—**ï¼š
> ```
> æŠ¥å‘Šæ ¼å¼ï¼š
> â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
> â”‚ å‡½æ•°å          è°ƒç”¨æ¬¡æ•°    æ€»è€—æ—¶    â”‚
> â”‚ process_data    1000æ¬¡     2.5ç§’      â”‚ â† ç“¶é¢ˆåœ¨è¿™ï¼
> â”‚ save_file       100æ¬¡      0.1ç§’      â”‚
> â”‚ load_config     1æ¬¡        0.01ç§’     â”‚
> â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
> ```
>
> **ä»€ä¹ˆæ—¶å€™ç”¨ï¼Ÿ**
> - ç¨‹åºè¿è¡Œå¾ˆæ…¢ï¼Œä½†ä¸çŸ¥é“æ…¢åœ¨å“ª
> - æƒ³ä¼˜åŒ–ä»£ç ï¼Œä½†è¦å…ˆæ‰¾åˆ°ç“¶é¢ˆ

```python
import cProfile
import pstats
from io import StringIO

def profile_function(func: Callable) -> Callable:
    """æ€§èƒ½åˆ†æè£…é¥°å™¨"""
    @functools.wraps(func)
    def wrapper(*args, **kwargs):
        profiler = cProfile.Profile()
        profiler.enable()
        
        result = func(*args, **kwargs)
        
        profiler.disable()
        
        # ç”ŸæˆæŠ¥å‘Š
        stream = StringIO()
        ps = pstats.Stats(profiler, stream=stream)
        ps.sort_stats('cumulative')
        ps.print_stats(10)  # æ˜¾ç¤ºå‰ 10 ä¸ªæœ€æ…¢çš„å‡½æ•°
        
        print(stream.getvalue())
        
        return result
    
    return wrapper

@profile_function
def process_large_dataset(data: list) -> list:
    """å¤„ç†å¤§æ•°æ®é›†"""
    result = []
    for item in data:
        # ä¸€äº›å¤æ‚å¤„ç†
        processed = item ** 2
        result.append(processed)
    return result

# ä½¿ç”¨
data = list(range(10000))
result = process_large_dataset(data)
```

## å†…å­˜åˆ†æ

> **å°ç™½ç†è§£ - ä»€ä¹ˆæ˜¯å†…å­˜åˆ†æï¼Ÿ**
>
> å†…å­˜åˆ†æ = **çœ‹ç¨‹åºå ç”¨äº†å¤šå°‘å†…å­˜**
>
> ç±»æ¯”ï¼š**å†°ç®±ç©ºé—´ç®¡ç†**
> - å†…å­˜ = å†°ç®±çš„å­˜å‚¨ç©ºé—´
> - å˜é‡ã€æ•°æ® = å†°ç®±é‡Œçš„é£Ÿç‰©
> - å†…å­˜åˆ†æ = çœ‹çœ‹å†°ç®±å“ªé‡Œè¢«å æ»¡äº†
>
> **ä¸ºä»€ä¹ˆè¦å…³å¿ƒå†…å­˜ï¼Ÿ**
> ```
> åœºæ™¯ï¼šå¤„ç†100ä¸‡æ¡æ•°æ®
>
> æ²¡æœ‰å†…å­˜æ„è¯†ï¼š
> data = [x for x in è¶…å¤§æ–‡ä»¶]  # ä¸€æ¬¡æ€§åŠ è½½ï¼Œå†…å­˜çˆ†äº†ğŸ’¥
>
> æœ‰å†…å­˜æ„è¯†ï¼š
> for x in è¶…å¤§æ–‡ä»¶:  # ä¸€æ¡ä¸€æ¡å¤„ç†ï¼Œå†…å­˜å¹³ç¨³
>     process(x)
> ```
>
> **tracemalloc å‘Šè¯‰ä½ **ï¼š
> - å½“å‰å†…å­˜ä½¿ç”¨é‡
> - å³°å€¼å†…å­˜ä½¿ç”¨é‡ï¼ˆæœ€é«˜ç”¨äº†å¤šå°‘ï¼‰

```python
import tracemalloc
from typing import Callable

def memory_profile(func: Callable) -> Callable:
    """å†…å­˜åˆ†æè£…é¥°å™¨"""
    @functools.wraps(func)
    def wrapper(*args, **kwargs):
        # å¼€å§‹è¿½è¸ª
        tracemalloc.start()
        
        result = func(*args, **kwargs)
        
        # è·å–å†…å­˜ä½¿ç”¨æƒ…å†µ
        current, peak = tracemalloc.get_traced_memory()
        tracemalloc.stop()
        
        print(f"{func.__name__} å†…å­˜ä½¿ç”¨:")
        print(f"  å½“å‰: {current / 1024 / 1024:.2f} MB")
        print(f"  å³°å€¼: {peak / 1024 / 1024:.2f} MB")
        
        return result
    
    return wrapper

@memory_profile
def create_large_list(size: int) -> list:
    """åˆ›å»ºå¤§åˆ—è¡¨"""
    return [i for i in range(size)]

# ä½¿ç”¨
large_list = create_large_list(1000000)
```

## è‡ªå®šä¹‰è°ƒè¯•ä¸Šä¸‹æ–‡ç®¡ç†å™¨

> **å°ç™½ç†è§£ - è°ƒè¯•ä¸Šä¸‹æ–‡ç®¡ç†å™¨**
>
> ä¸Šä¸‹æ–‡ç®¡ç†å™¨ = **è‡ªåŠ¨åŒ–çš„"è¿›å…¥/é€€å‡º"è®°å½•**
>
> ç±»æ¯”ï¼š**ä¼šè®®å®¤é¢„çº¦ç³»ç»Ÿ**
> ```
> with debug_context("API è°ƒç”¨"):  # è¿›å…¥ä¼šè®®å®¤ï¼ˆè‡ªåŠ¨æ‰“å°"è¿›å…¥"ï¼‰
>     # å¼€ä¼šï¼ˆä½ çš„ä»£ç ï¼‰
>     response = call_api()
> # ç¦»å¼€ä¼šè®®å®¤ï¼ˆè‡ªåŠ¨æ‰“å°"é€€å‡º"ï¼‰
> ```
>
> **è¾“å‡ºæ•ˆæœ**ï¼š
> ```
> [è¿›å…¥] API è°ƒç”¨
> å“åº”: {...}
> [é€€å‡º] API è°ƒç”¨
> ```
>
> **å¥½å¤„**ï¼š
> - è‡ªåŠ¨è®°å½•ä»£ç å—çš„å¼€å§‹å’Œç»“æŸ
> - å¦‚æœå‡ºé”™ï¼Œè‡ªåŠ¨æ‰“å°é”™è¯¯ä¿¡æ¯
> - ç”¨ `with` è¯­æ³•ï¼Œä»£ç æ›´æ•´æ´

```python
from contextlib import contextmanager
from typing import Any
import sys

@contextmanager
def debug_context(name: str, verbose: bool = True):
    """è°ƒè¯•ä¸Šä¸‹æ–‡"""
    if verbose:
        print(f"[è¿›å…¥] {name}")
    
    try:
        yield
    except Exception as e:
        print(f"[é”™è¯¯] {name}: {e}")
        print(f"  ç±»å‹: {type(e).__name__}")
        print(f"  ä½ç½®: {sys.exc_info()[2].tb_frame.f_code.co_filename}")
        raise
    finally:
        if verbose:
            print(f"[é€€å‡º] {name}")

# ä½¿ç”¨
with debug_context("API è°ƒç”¨"):
    # ä½ çš„ä»£ç 
    response = {"status": "success"}
    print(f"å“åº”: {response}")
```

## æ–­è¨€å’ŒéªŒè¯

> **å°ç™½ç†è§£ - ä»€ä¹ˆæ˜¯æ–­è¨€ï¼ˆassertï¼‰ï¼Ÿ**
>
> æ–­è¨€ = **ç¨‹åºé‡Œçš„"æ£€æŸ¥ç«™"**
>
> ç±»æ¯”ï¼š**æœºåœºå®‰æ£€**
> ```python
> assert æœ‰æœºç¥¨, "æ²¡æœ‰æœºç¥¨ä¸èƒ½ç™»æœº"      # æ£€æŸ¥ç‚¹1
> assert æ²¡æœ‰è¿ç¦å“, "ä¸èƒ½å¸¦å±é™©ç‰©å“"    # æ£€æŸ¥ç‚¹2
> # éƒ½é€šè¿‡äº†æ‰èƒ½ç™»æœº
> ```
>
> **Python æ–­è¨€è¯­æ³•**ï¼š
> ```python
> assert æ¡ä»¶, "æ¡ä»¶ä¸æ»¡è¶³æ—¶çš„é”™è¯¯ä¿¡æ¯"
>
> # ç­‰ä»·äºï¼š
> if not æ¡ä»¶:
>     raise AssertionError("æ¡ä»¶ä¸æ»¡è¶³æ—¶çš„é”™è¯¯ä¿¡æ¯")
> ```
>
> **ä»€ä¹ˆæ—¶å€™ç”¨ï¼Ÿ**
> - æ£€æŸ¥å‡½æ•°å‚æ•°æ˜¯å¦åˆæ³•
> - éªŒè¯é…ç½®æ˜¯å¦æ­£ç¡®
> - ç¡®ä¿æ•°æ®æ ¼å¼ç¬¦åˆé¢„æœŸ
>
> **æ³¨æ„**ï¼šç”Ÿäº§ç¯å¢ƒå¯ä»¥ç”¨ `-O` å‚æ•°ç¦ç”¨æ–­è¨€ï¼Œæ‰€ä»¥é‡è¦çš„éªŒè¯ä¸è¦åªç”¨ assert

```python
from typing import Dict, Any, List

def validate_agent_config(config: Dict[str, Any]):
    """éªŒè¯ Agent é…ç½®"""
    # ä½¿ç”¨æ–­è¨€è¿›è¡Œå¿«é€Ÿæ£€æŸ¥
    assert "model" in config, "ç¼ºå°‘ model é…ç½®"
    assert "temperature" in config, "ç¼ºå°‘ temperature é…ç½®"
    
    # è¯¦ç»†éªŒè¯
    temperature = config["temperature"]
    assert 0 <= temperature <= 2, \
        f"temperature å¿…é¡»åœ¨ 0-2 ä¹‹é—´ï¼Œå½“å‰å€¼: {temperature}"
    
    assert isinstance(config.get("tools", []), list), \
        "tools å¿…é¡»æ˜¯åˆ—è¡¨"
    
    print("é…ç½®éªŒè¯é€šè¿‡")

# ä½¿ç”¨
try:
    config = {
        "model": "gpt-4",
        "temperature": 0.7,
        "tools": ["search", "calculator"]
    }
    validate_agent_config(config)
except AssertionError as e:
    print(f"é…ç½®é”™è¯¯: {e}")
```

## æ—¥å¿—è°ƒè¯•æŠ€å·§

> **å°ç™½ç†è§£ - ç”¨æ—¥å¿—è°ƒè¯•**
>
> æ—¥å¿—è°ƒè¯• = **print è°ƒè¯•çš„å‡çº§ç‰ˆ**
>
> | å¯¹æ¯” | print è°ƒè¯• | æ—¥å¿—è°ƒè¯• |
> |------|-----------|---------|
> | è¾“å‡ºåˆ°å“ª | åªèƒ½è¾“å‡ºåˆ°å±å¹• | å±å¹• + æ–‡ä»¶ |
> | èƒ½å¦å…³é—­ | è¦æ‰‹åŠ¨åˆ ä»£ç  | æ”¹ä¸€ä¸ªçº§åˆ«å°±è¡Œ |
> | ä¿¡æ¯ä¸°å¯Œ | åªæœ‰ä½ å†™çš„å†…å®¹ | è‡ªåŠ¨åŠ æ—¶é—´ã€ä½ç½® |
> | ç”Ÿäº§ç¯å¢ƒ | ä¸èƒ½ç”¨ | å¯ä»¥ç”¨ |
>
> **ä¸ºä»€ä¹ˆç”¨æ—¥å¿—è°ƒè¯•ï¼Ÿ**
> - å¼€å‘æ—¶ï¼š`DEBUG` çº§åˆ«ï¼Œçœ‹æ‰€æœ‰ç»†èŠ‚
> - ä¸Šçº¿åï¼š`WARNING` çº§åˆ«ï¼Œåªçœ‹é‡è¦ä¿¡æ¯
> - **ä¸€å¥—ä»£ç ï¼Œä¸¤ç§æ¨¡å¼**

```python
import logging
from typing import Any

# é…ç½®æ—¥å¿—
logging.basicConfig(
    level=logging.DEBUG,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler('debug.log'),
        logging.StreamHandler()
    ]
)

logger = logging.getLogger(__name__)

class DebugAgent:
    """å¸¦è°ƒè¯•æ—¥å¿—çš„ Agent"""
    
    def __init__(self, name: str):
        self.name = name
        logger.info(f"åˆå§‹åŒ– Agent: {name}")
    
    def process(self, input: str) -> str:
        """å¤„ç†è¾“å…¥"""
        logger.debug(f"æ”¶åˆ°è¾“å…¥: {input}")
        
        try:
            # å¤„ç†é€»è¾‘
            result = self._internal_process(input)
            logger.debug(f"å¤„ç†ç»“æœ: {result}")
            return result
        
        except Exception as e:
            logger.error(f"å¤„ç†å¤±è´¥: {e}", exc_info=True)
            raise
    
    def _internal_process(self, input: str) -> str:
        """å†…éƒ¨å¤„ç†"""
        logger.debug("å¼€å§‹å†…éƒ¨å¤„ç†")
        
        # æ¨¡æ‹Ÿå¤„ç†
        if not input:
            raise ValueError("è¾“å…¥ä¸èƒ½ä¸ºç©º")
        
        return f"å¤„ç†ç»“æœ: {input.upper()}"

# ä½¿ç”¨
agent = DebugAgent("TestBot")

try:
    result = agent.process("hello")
    print(result)
    
    # è§¦å‘é”™è¯¯
    result = agent.process("")
except Exception as e:
    print(f"é”™è¯¯: {e}")
```

## VS Code è°ƒè¯•é…ç½®

> **å°ç™½ç†è§£ - ä»€ä¹ˆæ˜¯ IDE è°ƒè¯•ï¼Ÿ**
>
> IDE è°ƒè¯• = **å¯è§†åŒ–çš„ pdb**
>
> å¯¹æ¯”ï¼š
> - pdbï¼šå‘½ä»¤è¡Œè¾“å…¥ `n`ã€`s`ã€`c`ï¼ˆè®°å‘½ä»¤ï¼‰
> - VS Code è°ƒè¯•ï¼šç‚¹æŒ‰é’®ã€çœ‹ç•Œé¢ï¼ˆæ‰€è§å³æ‰€å¾—ï¼‰
>
> **VS Code è°ƒè¯•ç•Œé¢**ï¼š
> ```
> â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
> â”‚  â–¶ï¸ â­ï¸ â¹ï¸  è°ƒè¯•æ§åˆ¶æŒ‰é’®                      â”‚
> â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
> â”‚ å˜é‡é¢æ¿           â”‚ ä»£ç ç¼–è¾‘å™¨             â”‚
> â”‚ x = 10             â”‚ 1  def foo():          â”‚
> â”‚ name = "å¼ ä¸‰"      â”‚ 2 â†’ print(x)  â† æ–­ç‚¹   â”‚
> â”‚                    â”‚ 3    return x          â”‚
> â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
> â”‚ è°ƒç”¨å †æ ˆ â”‚ è°ƒè¯•æ§åˆ¶å°                       â”‚
> â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
> ```
>
> **æ“ä½œæ–¹å¼**ï¼š
> - ç‚¹å‡»è¡Œå·å·¦è¾¹ â†’ è®¾ç½®æ–­ç‚¹ï¼ˆçº¢ç‚¹ï¼‰
> - æŒ‰ F5 â†’ å¼€å§‹è°ƒè¯•
> - æŒ‰ F10 â†’ ä¸‹ä¸€æ­¥ï¼ˆä¸è¿›å…¥å‡½æ•°ï¼‰
> - æŒ‰ F11 â†’ è¿›å…¥å‡½æ•°å†…éƒ¨

åˆ›å»º `.vscode/launch.json`:

```json
{
    "version": "0.2.0",
    "configurations": [
        {
            "name": "Python: Current File",
            "type": "python",
            "request": "launch",
            "program": "${file}",
            "console": "integratedTerminal",
            "justMyCode": false
        },
        {
            "name": "Python: Agent Script",
            "type": "python",
            "request": "launch",
            "program": "${workspaceFolder}/agent_main.py",
            "args": ["--verbose", "--debug"],
            "console": "integratedTerminal",
            "env": {
                "DEBUG": "true"
            }
        },
        {
            "name": "Python: Attach",
            "type": "python",
            "request": "attach",
            "connect": {
                "host": "localhost",
                "port": 5678
            }
        }
    ]
}
```

## è¿œç¨‹è°ƒè¯•ï¼ˆdebugpyï¼‰

> **å°ç™½ç†è§£ - ä»€ä¹ˆæ˜¯è¿œç¨‹è°ƒè¯•ï¼Ÿ**
>
> è¿œç¨‹è°ƒè¯• = **ç¨‹åºè·‘åœ¨æœåŠ¡å™¨ä¸Šï¼Œä½ åœ¨è‡ªå·±ç”µè„‘ä¸Šè°ƒè¯•å®ƒ**
>
> ç±»æ¯”ï¼š**è¿œç¨‹åŒ»ç–—**
> - ç—…äººåœ¨è€å®¶ï¼ˆç¨‹åºåœ¨æœåŠ¡å™¨ï¼‰
> - åŒ»ç”Ÿåœ¨åŒ—äº¬ï¼ˆä½ åœ¨æœ¬åœ°ç”µè„‘ï¼‰
> - é€šè¿‡è§†é¢‘é—®è¯Šï¼ˆç½‘ç»œè¿æ¥è°ƒè¯•ï¼‰
>
> **åœºæ™¯**ï¼š
> - ç¨‹åºéƒ¨ç½²åœ¨äº‘æœåŠ¡å™¨ä¸Šå‡ºäº† bug
> - ä¸å¯èƒ½æ¯æ¬¡éƒ½ç™»å½•æœåŠ¡å™¨ç”¨å‘½ä»¤è¡Œè°ƒè¯•
> - è¿œç¨‹è°ƒè¯•è®©ä½ ç”¨æœ¬åœ° VS Code ç›´æ¥è°ƒè¯•è¿œç¨‹ç¨‹åº

```python
# å®‰è£…: pip install debugpy
import debugpy

# å¯åŠ¨è°ƒè¯•æœåŠ¡å™¨
debugpy.listen(("0.0.0.0", 5678))
print("ç­‰å¾…è°ƒè¯•å™¨è¿æ¥...")
debugpy.wait_for_client()  # å¯é€‰ï¼šç­‰å¾…è°ƒè¯•å™¨è¿æ¥

# ä½ çš„ä»£ç 
def main():
    print("ç¨‹åºå¼€å§‹è¿è¡Œ")
    # ...

if __name__ == "__main__":
    main()
```

## å•å…ƒæµ‹è¯•ä¸­çš„è°ƒè¯•

> **å°ç™½ç†è§£ - æµ‹è¯•ä¸­æ€ä¹ˆè°ƒè¯•ï¼Ÿ**
>
> å•å…ƒæµ‹è¯• = **è‡ªåŠ¨åŒ–çš„æ£€æŸ¥ç¨‹åº**
>
> ç±»æ¯”ï¼š**å·¥å‚çš„è´¨æ£€æµç¨‹**
> ```
> äº§å“ç”Ÿäº§å®Œ â†’ è´¨æ£€å‘˜æ£€æŸ¥ â†’ åˆæ ¼å°±å‘è´§ï¼Œä¸åˆæ ¼å°±é€€å›
> ä»£ç å†™å®Œ   â†’ æµ‹è¯•è¿è¡Œ   â†’ é€šè¿‡å°±éƒ¨ç½²ï¼Œå¤±è´¥å°±ä¿®å¤
> ```
>
> **æµ‹è¯•ä¸­çš„è°ƒè¯•æŠ€å·§**ï¼š
> 1. ç”¨ `breakpoint()` åœ¨æµ‹è¯•ä¸­æš‚åœ
> 2. ç”¨ `self.assertEqual()` å¯¹æ¯”æœŸæœ›å€¼å’Œå®é™…å€¼
> 3. æµ‹è¯•å¤±è´¥æ—¶ï¼ŒæŸ¥çœ‹è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯

```python
import unittest

class TestAgentLogic(unittest.TestCase):
    """Agent é€»è¾‘æµ‹è¯•"""
    
    def setUp(self):
        """æµ‹è¯•å‰å‡†å¤‡"""
        self.agent = DebugAgent("TestAgent")
    
    def test_process_valid_input(self):
        """æµ‹è¯•æœ‰æ•ˆè¾“å…¥"""
        result = self.agent.process("hello")
        self.assertEqual(result, "å¤„ç†ç»“æœ: HELLO")
    
    def test_process_empty_input(self):
        """æµ‹è¯•ç©ºè¾“å…¥"""
        with self.assertRaises(ValueError) as context:
            self.agent.process("")
        
        self.assertIn("è¾“å…¥ä¸èƒ½ä¸ºç©º", str(context.exception))
    
    def test_with_debug(self):
        """å¸¦è°ƒè¯•çš„æµ‹è¯•"""
        # åœ¨æµ‹è¯•ä¸­ä½¿ç”¨ breakpoint()
        input_value = "test"
        breakpoint()  # è°ƒè¯•å™¨ä¼šåœ¨è¿™é‡Œåœæ­¢
        result = self.agent.process(input_value)
        self.assertIsNotNone(result)

# è¿è¡Œæµ‹è¯•
if __name__ == '__main__':
    unittest.main()
```

## æœ€ä½³å®è·µ

> **å°ç™½ç†è§£ - è°ƒè¯•çš„é»„é‡‘æ³•åˆ™**
>
> 1. **ä»ç®€å•å¼€å§‹**ï¼šå…ˆç”¨ printï¼Œä¸å¤Ÿå†ç”¨ pdb
> 2. **è®°å¾—æ¸…ç†**ï¼šè°ƒè¯•å®Œåˆ æ‰ print å’Œ breakpoint
> 3. **æ—¥å¿—ä¸ºç‹**ï¼šæ­£å¼é¡¹ç›®ç”¨æ—¥å¿—ï¼Œä¸ç”¨ print
> 4. **å–„ç”¨å·¥å…·**ï¼šVS Code è°ƒè¯•æ¯”å‘½ä»¤è¡Œæ–¹ä¾¿100å€

### 1. æ—¥å¿—çº§åˆ«ä½¿ç”¨
```python
# DEBUG: è¯¦ç»†çš„è¯Šæ–­ä¿¡æ¯
logger.debug(f"å˜é‡å€¼: x={x}, y={y}")

# INFO: ä¸€èˆ¬ä¿¡æ¯
logger.info("Agent å¯åŠ¨æˆåŠŸ")

# WARNING: è­¦å‘Šä¿¡æ¯
logger.warning("API å“åº”è¾ƒæ…¢")

# ERROR: é”™è¯¯ä¿¡æ¯
logger.error("API è°ƒç”¨å¤±è´¥", exc_info=True)

# CRITICAL: ä¸¥é‡é”™è¯¯
logger.critical("ç³»ç»Ÿå´©æºƒ")
```

### 2. ä¸´æ—¶è°ƒè¯•æŠ€å·§
```python
# ä½¿ç”¨ç¯å¢ƒå˜é‡æ§åˆ¶è°ƒè¯•è¾“å‡º
import os

DEBUG = os.getenv("DEBUG", "false").lower() == "true"

def debug_print(*args, **kwargs):
    """æ¡ä»¶æ‰“å°"""
    if DEBUG:
        print("[DEBUG]", *args, **kwargs)

# ä½¿ç”¨
debug_print("è¿™åªåœ¨ DEBUG=true æ—¶æ˜¾ç¤º")
```

### 3. å¼‚å¸¸è¿½è¸ª
```python
import traceback

try:
    # å¯èƒ½å‡ºé”™çš„ä»£ç 
    risky_operation()
except Exception as e:
    # æ‰“å°å®Œæ•´çš„å¼‚å¸¸è¿½è¸ª
    traceback.print_exc()
    
    # æˆ–è€…è®°å½•åˆ°æ—¥å¿—
    logger.error("å¼‚å¸¸è¯¦æƒ…:", exc_info=True)
```

## å…³é”®è¦ç‚¹

> **å°ç™½æ€»ç»“ - è°ƒè¯•å·¥å…·é€‰æ‹©æŒ‡å—**
>
> | åœºæ™¯ | æ¨èå·¥å…· | ç†ç”± |
> |------|---------|------|
> | å¿«é€Ÿçœ‹å˜é‡å€¼ | `print()` | æœ€ç®€å• |
> | é€è¡Œæ’æŸ¥é—®é¢˜ | `pdb` / `breakpoint()` | å¯ä»¥æš‚åœã€å•æ­¥æ‰§è¡Œ |
> | é•¿æœŸç›‘æ§ | `logging` | å¯ä»¥è®°å½•åˆ°æ–‡ä»¶ |
> | å¤æ‚é¡¹ç›® | VS Code è°ƒè¯• | å¯è§†åŒ–ç•Œé¢ |
> | æ€§èƒ½é—®é¢˜ | `cProfile` | æ‰¾å‡ºæ…¢çš„å‡½æ•° |
> | å†…å­˜é—®é¢˜ | `tracemalloc` | æ‰¾å‡ºå†…å­˜å ç”¨ |
>
> **è®°å¿†å£è¯€**ï¼š
> ```
> print ç”¨æ¥å¿«é€Ÿçœ‹ï¼Œpdb æš‚åœæ…¢æ…¢æŸ¥
> æ—¥å¿—è®°å½•ä¸ä¼šä¸¢ï¼ŒIDE è°ƒè¯•æœ€æ–¹ä¾¿
> æ€§èƒ½åˆ†ææ‰¾ç“¶é¢ˆï¼Œå†…å­˜è¿½è¸ªé˜²çˆ†ç‚¸
> ```

1. **é€‰æ‹©åˆé€‚çš„å·¥å…·**ï¼šprint å¿«é€Ÿã€pdb æ·±å…¥ã€æ—¥å¿—æŒä¹…
2. **æ–­ç‚¹ç­–ç•¥**ï¼šåœ¨å…³é”®ä½ç½®è®¾ç½®æ–­ç‚¹
3. **æ—¥å¿—çº§åˆ«**ï¼šåˆç†ä½¿ç”¨ä¸åŒçº§åˆ«çš„æ—¥å¿—
4. **æ€§èƒ½åˆ†æ**ï¼šæ‰¾å‡ºæ€§èƒ½ç“¶é¢ˆ
5. **å•å…ƒæµ‹è¯•**ï¼šç¼–å†™æµ‹è¯•å¸®åŠ©è°ƒè¯•

---

**ä¸‹ä¸€èŠ‚ï¼š[5.4 å°ç»“å’Œå¤ä¹ ](5.4-å°ç»“å’Œå¤ä¹ .md)**

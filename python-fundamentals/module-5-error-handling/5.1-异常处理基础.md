# 5.1 异常处理基础

## try/except/finally

```python
def call_api(endpoint: str) -> dict:
    """调用 API（带异常处理）"""
    try:
        # 模拟 API 调用
        if not endpoint:
            raise ValueError("端点不能为空")
        
        # 实际调用逻辑
        response = {"status": "success", "data": {}}
        return response
        
    except ValueError as e:
        print(f"参数错误: {e}")
        return {"status": "error", "message": str(e)}
    
    except Exception as e:
        print(f"未知错误: {e}")
        return {"status": "error", "message": "系统错误"}
    
    finally:
        print("API 调用完成")

# 使用
result = call_api("")
```

## 自定义异常

```python
class AgentError(Exception):
    """Agent 基础异常"""
    pass

class ModelNotFoundError(AgentError):
    """模型未找到"""
    pass

class APIKeyError(AgentError):
    """API 密钥错误"""
    pass

def create_agent(model: str, api_key: str):
    if not api_key:
        raise APIKeyError("API 密钥未配置")
    
    if model not in ["gpt-4", "gpt-3.5-turbo"]:
        raise ModelNotFoundError(f"模型 {model} 不存在")
    
    return {"model": model, "status": "ready"}

# 使用
try:
    agent = create_agent("gpt-5", "")
except APIKeyError as e:
    print(f"密钥错误: {e}")
except ModelNotFoundError as e:
    print(f"模型错误: {e}")
```

---

**下一节：[5.2 日志系统](5.2-日志系统.md)**

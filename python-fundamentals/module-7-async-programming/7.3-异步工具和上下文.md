# 6.2 异步工具和上下文

## 异步上下文管理器

```python
import asyncio

class AsyncDatabaseConnection:
    """异步数据库连接"""
    
    async def __aenter__(self):
        """进入上下文"""
        print("连接数据库...")
        await asyncio.sleep(0.1)
        return self
    
    async def __aexit__(self, exc_type, exc_val, exc_tb):
        """退出上下文"""
        print("关闭数据库...")
        await asyncio.sleep(0.1)
    
    async def query(self, sql: str) -> list:
        """执行查询"""
        await asyncio.sleep(0.1)
        return [{"result": "data"}]

async def main():
    async with AsyncDatabaseConnection() as db:
        results = await db.query("SELECT * FROM agents")
        print(results)

asyncio.run(main())
```

## 异步 LangChain Tool

```python
from typing import Optional
import asyncio

class AsyncTool:
    """异步工具基类"""
    
    async def arun(self, query: str) -> str:
        """异步运行"""
        raise NotImplementedError

class AsyncSearchTool(AsyncTool):
    """异步搜索工具"""
    
    async def arun(self, query: str) -> str:
        await asyncio.sleep(0.5)  # 模拟 API 调用
        return f"搜索结果: {query}"

async def main():
    tool = AsyncSearchTool()
    result = await tool.arun("Python")
    print(result)

asyncio.run(main())
```

---

**下一节：[6.3 实战：异步 Agent](6.3-实战：异步Agent.md)**

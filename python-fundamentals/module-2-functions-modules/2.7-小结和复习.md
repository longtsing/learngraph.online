# 1.6 å°ç»“å’Œå¤ä¹ 

## æ­å–œï¼ä½ å·²æŒæ¡å‡½æ•°å¼ç¼–ç¨‹çš„ç²¾é«“

é€šè¿‡ Module 1 çš„å­¦ä¹ ï¼Œä½ å·²ç»ä»"èƒ½å†™ä»£ç "è¿›åŒ–åˆ°"ä¼šå†™ä¼˜é›…ä»£ç "ã€‚ä½ ç°åœ¨æŒæ¡äº†ï¼š

- âœ… **å‡½æ•°åŸºç¡€**ï¼šå‚æ•°ã€è¿”å›å€¼ã€ç±»å‹æ³¨è§£
- âœ… **é«˜é˜¶å‡½æ•°**ï¼šmap/filter/reduceã€Lambdaã€é—­åŒ…
- âœ… **è£…é¥°å™¨**ï¼šPython æœ€å¼ºå¤§çš„ç‰¹æ€§ä¹‹ä¸€
- âœ… **æ¨¡å—åŒ–**ï¼šç»„ç»‡å¤§å‹é¡¹ç›®çš„è‰ºæœ¯
- âœ… **LangChain Tool**ï¼šçœŸå®ä¸–ç•Œçš„åº”ç”¨

è¿™äº›æŠ€èƒ½è®©ä½ èƒ½å¤Ÿé˜…è¯»å’Œç†è§£ LangChain çš„æºç ï¼Œæ„å»ºå¯ç»´æŠ¤çš„ Agent ç³»ç»Ÿã€‚

---

## æ ¸å¿ƒæ¦‚å¿µé€ŸæŸ¥è¡¨

### å‡½æ•°ç­¾å

```python
def function_name(
    required_param: type,
    default_param: type = default_value,
    *args,
    **kwargs
) -> return_type:
    """æ–‡æ¡£å­—ç¬¦ä¸²"""
    pass
```

### é«˜é˜¶å‡½æ•°æ¨¡å¼

```python
# å‡½æ•°ä½œä¸ºå‚æ•°
def apply(func, value):
    return func(value)

# å‡½æ•°ä½œä¸ºè¿”å›å€¼
def multiplier(n):
    return lambda x: x * n

# é—­åŒ…
def counter():
    count = 0
    def increment():
        nonlocal count
        count += 1
        return count
    return increment
```

### è£…é¥°å™¨æ¨¡å¼

```python
from functools import wraps

def decorator(func):
    @wraps(func)
    def wrapper(*args, **kwargs):
        # å‰ç½®é€»è¾‘
        result = func(*args, **kwargs)
        # åç½®é€»è¾‘
        return result
    return wrapper

# å¸¦å‚æ•°çš„è£…é¥°å™¨
def decorator_with_args(param):
    def decorator(func):
        @wraps(func)
        def wrapper(*args, **kwargs):
            # ä½¿ç”¨ param
            return func(*args, **kwargs)
        return wrapper
    return decorator
```

### æ¨¡å—å¯¼å…¥

```python
# åŸºæœ¬å¯¼å…¥
import module
from module import function
from package.module import Class

# ç›¸å¯¹å¯¼å…¥ï¼ˆåŒ…å†…éƒ¨ï¼‰
from .module import function
from ..package import Class
```

---

## ğŸ”¥ é«˜éš¾åº¦ç¼–ç æŒ‘æˆ˜

### æŒ‘æˆ˜ 1ï¼šè£…é¥°å™¨é“¾ï¼ˆéš¾åº¦ï¼šâ­â­â­â­ï¼‰

#### ä»»åŠ¡æè¿°

å®ç°ä¸€ä¸ªè£…é¥°å™¨ç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒï¼š

1. **æ³¨å†Œè£…é¥°å™¨**ï¼šå°†è£…é¥°å™¨æ³¨å†Œåˆ°ç³»ç»Ÿä¸­
2. **æŒ‰åç§°åº”ç”¨è£…é¥°å™¨**ï¼šé€šè¿‡é…ç½®æ–‡ä»¶åº”ç”¨è£…é¥°å™¨
3. **è£…é¥°å™¨ç»„åˆ**ï¼šæ”¯æŒå¤šä¸ªè£…é¥°å™¨çš„é“¾å¼ç»„åˆ
4. **æ¡ä»¶è£…é¥°å™¨**ï¼šæ ¹æ®æ¡ä»¶å†³å®šæ˜¯å¦åº”ç”¨è£…é¥°å™¨
5. **è£…é¥°å™¨ä¼˜å…ˆçº§**ï¼šæ”¯æŒè£…é¥°å™¨æ’åº

#### æŠ€æœ¯è¦æ±‚

- ä½¿ç”¨**é«˜é˜¶å‡½æ•°**
- ä½¿ç”¨**è£…é¥°å™¨**
- ä½¿ç”¨**é—­åŒ…**
- å®ç°**å…ƒç¼–ç¨‹**

#### é¢„æœŸåŠŸèƒ½

```python
# æ³¨å†Œè£…é¥°å™¨
register_decorator("log", log_decorator)
register_decorator("retry", retry_decorator)
register_decorator("cache", cache_decorator)

# é€šè¿‡é…ç½®åº”ç”¨è£…é¥°å™¨
@apply_decorators(["log", "retry", "cache"])
def critical_function():
    pass

# æ¡ä»¶è£…é¥°å™¨
@conditional_decorator(lambda: DEBUG_MODE, debug_decorator)
def process_data():
    pass

# è£…é¥°å™¨ä¼˜å…ˆçº§
@apply_with_priority([
    (log_decorator, 1),      # æœ€å¤–å±‚
    (retry_decorator, 2),
    (cache_decorator, 3)     # æœ€å†…å±‚
])
def api_call():
    pass
```

#### ä½ çš„è§£å†³æ–¹æ¡ˆ

```python
from functools import wraps
from typing import Callable, Dict, List, Tuple, Any

# è£…é¥°å™¨æ³¨å†Œè¡¨
_decorator_registry: Dict[str, Callable] = {}


def register_decorator(name: str, decorator: Callable) -> None:
    """
    æ³¨å†Œè£…é¥°å™¨åˆ°ç³»ç»Ÿ
    
    Args:
        name: è£…é¥°å™¨åç§°
        decorator: è£…é¥°å™¨å‡½æ•°
    """
    # TODO: å®ç°æ³¨å†Œé€»è¾‘
    pass


def apply_decorators(decorator_names: List[str]) -> Callable:
    """
    åº”ç”¨å¤šä¸ªè£…é¥°å™¨
    
    Args:
        decorator_names: è£…é¥°å™¨åç§°åˆ—è¡¨
    
    Returns:
        ç»„åˆåçš„è£…é¥°å™¨
    """
    # TODO: å®ç°
    pass


def conditional_decorator(
    condition: Callable[[], bool],
    decorator: Callable
) -> Callable:
    """
    æ¡ä»¶è£…é¥°å™¨ï¼šåªåœ¨æ¡ä»¶ä¸ºçœŸæ—¶åº”ç”¨
    
    Args:
        condition: æ¡ä»¶å‡½æ•°
        decorator: è¦åº”ç”¨çš„è£…é¥°å™¨
    
    Returns:
        æ¡ä»¶è£…é¥°å™¨
    """
    # TODO: å®ç°
    pass


def apply_with_priority(
    decorators_with_priority: List[Tuple[Callable, int]]
) -> Callable:
    """
    æŒ‰ä¼˜å…ˆçº§åº”ç”¨è£…é¥°å™¨
    
    Args:
        decorators_with_priority: (è£…é¥°å™¨, ä¼˜å…ˆçº§) å…ƒç»„åˆ—è¡¨
            ä¼˜å…ˆçº§æ•°å­—è¶Šå°è¶Šå¤–å±‚
    
    Returns:
        ç»„åˆåçš„è£…é¥°å™¨
    """
    # TODO: å®ç°
    pass


# æµ‹è¯•ä»£ç 
def main():
    # å®šä¹‰ä¸€äº›æµ‹è¯•è£…é¥°å™¨
    def log_decorator(func):
        @wraps(func)
        def wrapper(*args, **kwargs):
            print(f"[LOG] è°ƒç”¨ {func.__name__}")
            return func(*args, **kwargs)
        return wrapper
    
    def timer_decorator(func):
        @wraps(func)
        def wrapper(*args, **kwargs):
            import time
            start = time.time()
            result = func(*args, **kwargs)
            print(f"[TIMER] è€—æ—¶ {time.time() - start:.4f}ç§’")
            return result
        return wrapper
    
    # æµ‹è¯•æ³¨å†Œ
    register_decorator("log", log_decorator)
    register_decorator("timer", timer_decorator)
    
    # æµ‹è¯•åº”ç”¨
    @apply_decorators(["log", "timer"])
    def test_function():
        print("æ‰§è¡Œå‡½æ•°")
    
    test_function()


if __name__ == "__main__":
    main()
```

---

### æŒ‘æˆ˜ 2ï¼šå‡½æ•°å¼æ•°æ®å¤„ç†ç®¡é“ï¼ˆéš¾åº¦ï¼šâ­â­â­â­â­ï¼‰

#### ä»»åŠ¡æè¿°

å®ç°ä¸€ä¸ªå‡½æ•°å¼ç¼–ç¨‹é£æ ¼çš„æ•°æ®å¤„ç†ç®¡é“ï¼Œç”¨äºå¤„ç† Agent çš„æ¶ˆæ¯å†å²ï¼š

1. **ç®¡é“æ„å»º**ï¼šé“¾å¼è°ƒç”¨å¤šä¸ªå¤„ç†å‡½æ•°
2. **Lazy Evaluation**ï¼šå»¶è¿Ÿæ‰§è¡Œï¼Œåªåœ¨éœ€è¦æ—¶è®¡ç®—
3. **å¹¶è¡Œå¤„ç†**ï¼šæ”¯æŒå¹¶è¡Œæ‰§è¡Œç‹¬ç«‹çš„å¤„ç†æ­¥éª¤
4. **é”™è¯¯æ¢å¤**ï¼šå¤„ç†å¤±è´¥æ—¶çš„å›é€€æœºåˆ¶
5. **æ€§èƒ½åˆ†æ**ï¼šç»Ÿè®¡æ¯ä¸ªæ­¥éª¤çš„æ‰§è¡Œæ—¶é—´

#### æŠ€æœ¯è¦æ±‚

- ä½¿ç”¨**é«˜é˜¶å‡½æ•°**
- ä½¿ç”¨**é—­åŒ…**
- ä½¿ç”¨**ç”Ÿæˆå™¨**
- å®ç°**é“¾å¼è°ƒç”¨**

#### é¢„æœŸåŠŸèƒ½

```python
# åˆ›å»ºå¤„ç†ç®¡é“
pipeline = (
    Pipeline()
    .filter(lambda msg: msg["role"] == "user")
    .map(lambda msg: msg["content"].lower())
    .filter(lambda text: len(text) > 10)
    .map(lambda text: text.strip())
    .distinct()
    .take(5)
)

# æ‰§è¡Œç®¡é“
messages = [
    {"role": "user", "content": "  Hello World!  "},
    {"role": "assistant", "content": "Hi there!"},
    {"role": "user", "content": "How are you?"},
]

results = pipeline.execute(messages)
print(results)

# æ€§èƒ½åˆ†æ
stats = pipeline.get_stats()
print(f"æ€»è€—æ—¶: {stats['total_time']}")
print(f"å„æ­¥éª¤è€—æ—¶: {stats['step_times']}")
```

#### ä½ çš„è§£å†³æ–¹æ¡ˆ

```python
from typing import Callable, List, Any, Iterator, Optional
import time
from functools import reduce


class Pipeline:
    """å‡½æ•°å¼æ•°æ®å¤„ç†ç®¡é“"""
    
    def __init__(self):
        """åˆå§‹åŒ–ç®¡é“"""
        self.steps: List[Tuple[str, Callable]] = []
        self.stats: Dict[str, Any] = {}
    
    def filter(self, predicate: Callable[[Any], bool]) -> 'Pipeline':
        """
        è¿‡æ»¤å…ƒç´ 
        
        Args:
            predicate: è¿‡æ»¤æ¡ä»¶å‡½æ•°
        
        Returns:
            Pipeline å®ä¾‹ï¼ˆæ”¯æŒé“¾å¼è°ƒç”¨ï¼‰
        """
        # TODO: å®ç°
        pass
    
    def map(self, transformer: Callable[[Any], Any]) -> 'Pipeline':
        """
        æ˜ å°„è½¬æ¢
        
        Args:
            transformer: è½¬æ¢å‡½æ•°
        
        Returns:
            Pipeline å®ä¾‹
        """
        # TODO: å®ç°
        pass
    
    def distinct(self) -> 'Pipeline':
        """å»é‡"""
        # TODO: å®ç°
        pass
    
    def take(self, n: int) -> 'Pipeline':
        """å–å‰ n ä¸ªå…ƒç´ """
        # TODO: å®ç°
        pass
    
    def execute(self, data: List[Any]) -> List[Any]:
        """
        æ‰§è¡Œç®¡é“
        
        Args:
            data: è¾“å…¥æ•°æ®
        
        Returns:
            å¤„ç†åçš„æ•°æ®
        """
        # TODO: å®ç°
        pass
    
    def get_stats(self) -> Dict[str, Any]:
        """è·å–æ€§èƒ½ç»Ÿè®¡"""
        return self.stats


# æµ‹è¯•ä»£ç 
def main():
    # æµ‹è¯•æ•°æ®
    messages = [
        {"role": "user", "content": "  Hello  "},
        {"role": "assistant", "content": "Hi!"},
        {"role": "user", "content": "How are you?"},
        {"role": "user", "content": "  Hello  "},  # é‡å¤
        {"role": "user", "content": "Python is great!"},
    ]
    
    # åˆ›å»ºç®¡é“
    pipeline = (
        Pipeline()
        .filter(lambda msg: msg["role"] == "user")
        .map(lambda msg: msg["content"].strip())
        .distinct()
        .map(lambda text: text.lower())
        .take(3)
    )
    
    # æ‰§è¡Œ
    results = pipeline.execute(messages)
    print("ç»“æœ:", results)
    
    # ç»Ÿè®¡
    print("\næ€§èƒ½ç»Ÿè®¡:")
    print(pipeline.get_stats())


if __name__ == "__main__":
    main()
```

---

## æŒ‘æˆ˜ç­”æ¡ˆæç¤º

### æŒ‘æˆ˜ 1 æç¤º

<details>
<summary>ç‚¹å‡»æŸ¥çœ‹æç¤º</summary>

**æ³¨å†Œè£…é¥°å™¨**ï¼š
```python
def register_decorator(name: str, decorator: Callable) -> None:
    _decorator_registry[name] = decorator
```

**åº”ç”¨è£…é¥°å™¨**ï¼š
```python
def apply_decorators(names: List[str]) -> Callable:
    def decorator(func: Callable) -> Callable:
        result = func
        for name in reversed(names):  # åå‘åº”ç”¨
            dec = _decorator_registry[name]
            result = dec(result)
        return result
    return decorator
```

</details>

### æŒ‘æˆ˜ 2 æç¤º

<details>
<summary>ç‚¹å‡»æŸ¥çœ‹æç¤º</summary>

**é“¾å¼è°ƒç”¨**ï¼š
```python
def filter(self, predicate):
    self.steps.append(("filter", predicate))
    return self  # è¿”å› self æ”¯æŒé“¾å¼è°ƒç”¨
```

**æ‰§è¡Œç®¡é“**ï¼š
```python
def execute(self, data):
    result = data
    for step_name, step_func in self.steps:
        if step_name == "filter":
            result = [x for x in result if step_func(x)]
        elif step_name == "map":
            result = [step_func(x) for x in result]
    return result
```

</details>

---

## è‡ªæˆ‘è¯„ä¼°æ¸…å•

åœ¨è¿›å…¥ Module 2 ä¹‹å‰ï¼Œç¡®ä¿ä½ èƒ½å¤Ÿï¼š

- [ ] ç‹¬ç«‹ç¼–å†™å¸¦ç±»å‹æ³¨è§£çš„å‡½æ•°
- [ ] ä½¿ç”¨ map/filter/reduce å¤„ç†æ•°æ®
- [ ] ç†è§£å¹¶ç¼–å†™è£…é¥°å™¨
- [ ] ä½¿ç”¨é—­åŒ…ç®¡ç†ç§æœ‰çŠ¶æ€
- [ ] ç»„ç»‡æ¨¡å—åŒ–çš„é¡¹ç›®ç»“æ„
- [ ] åˆ›å»ºè‡ªå®šä¹‰ LangChain Tool
- [ ] å®Œæˆè‡³å°‘ä¸€ä¸ªé«˜éš¾åº¦æŒ‘æˆ˜ï¼ˆ60%+æ­£ç¡®ï¼‰

---

## å­¦ä¹ èµ„æº

### æ¨èé˜…è¯»
- [Python Decoratorsæ·±å…¥ç†è§£](https://realpython.com/primer-on-python-decorators/)
- [Functional Programming in Python](https://realpython.com/python-functional-programming/)
- [LangChain Tools æ–‡æ¡£](https://python.langchain.com/docs/modules/tools/)

### è¿›é˜¶ä¸»é¢˜
- æè¿°ç¬¦ï¼ˆDescriptorsï¼‰
- å…ƒç±»ï¼ˆMetaclassesï¼‰
- å¼‚æ­¥è£…é¥°å™¨
- ç±»å‹ç³»ç»Ÿé«˜çº§ç”¨æ³•

---

## ä¸‹ä¸€æ­¥

æ­å–œå®Œæˆ Module 1ï¼ä½ å·²ç»æŒæ¡äº†å‡½æ•°å¼ç¼–ç¨‹çš„æ ¸å¿ƒæŠ€èƒ½ã€‚

åœ¨ **Module 2: æ•°æ®ç»“æ„ä¸çŠ¶æ€ç®¡ç†** ä¸­ï¼Œä½ å°†å­¦ä¹ ï¼š
- åˆ—è¡¨ã€å­—å…¸ã€é›†åˆçš„é«˜çº§ç”¨æ³•
- TypedDict ä¸ Pydanticï¼šç±»å‹å®‰å…¨çš„çŠ¶æ€ç®¡ç†
- æ•°æ®ç±»ï¼ˆdataclassï¼‰
- Agent çŠ¶æ€çš„è®¾è®¡æ¨¡å¼
- å®æˆ˜ï¼šæ„å»º LangGraph çš„çŠ¶æ€ç®¡ç†ç³»ç»Ÿ

**ç»§ç»­å‰è¿›ï¼Œä½ ç¦»æ„å»ºç”Ÿäº§çº§ AI Agent è¶Šæ¥è¶Šè¿‘äº†ï¼**

---

**ä¸‹ä¸€ç« ï¼š[Module 2: æ•°æ®ç»“æ„ä¸çŠ¶æ€ç®¡ç†](../module-2-data-structures/2.0-æœ¬ç« ä»‹ç».md)**

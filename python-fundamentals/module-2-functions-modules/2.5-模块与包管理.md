# 1.4 æ¨¡å—ä¸åŒ…ç®¡ç†

## å¼•è¨€ï¼šç»„ç»‡ä»£ç çš„è‰ºæœ¯

æƒ³è±¡ä½ æ­£åœ¨æ„å»ºä¸€ä¸ªå¤æ‚çš„ AI Agent ç³»ç»Ÿï¼ŒåŒ…å«ï¼š
- LLM API è°ƒç”¨æ¨¡å—
- å·¥å…·ï¼ˆToolsï¼‰æ¨¡å—  
- æç¤ºè¯ç®¡ç†æ¨¡å—
- æ•°æ®å¤„ç†æ¨¡å—
- æ—¥å¿—å’Œç›‘æ§æ¨¡å—

å¦‚æœæŠŠæ‰€æœ‰ä»£ç éƒ½å†™åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œï¼Œé‚£å°†æ˜¯**ç»´æŠ¤çš„å™©æ¢¦**ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦**æ¨¡å—åŒ–**â€”â€”å°†ä»£ç ç»„ç»‡æˆç‹¬ç«‹çš„ã€å¯å¤ç”¨çš„æ¨¡å—ã€‚

## å­¦ä¹ ç›®æ ‡

- âœ… ç†è§£æ¨¡å—ï¼ˆModuleï¼‰å’ŒåŒ…ï¼ˆPackageï¼‰çš„åŒºåˆ«
- âœ… æŒæ¡ import è¯­å¥çš„å„ç§å½¢å¼
- âœ… ç†è§£ \_\_name\_\_ å’Œ \_\_main\_\_ çš„ä½œç”¨
- âœ… æ„å»ºè§„èŒƒçš„é¡¹ç›®ç›®å½•ç»“æ„
- âœ… å®æˆ˜ï¼šç»„ç»‡ Agent é¡¹ç›®ä»£ç 

---

## ç¬¬ä¸€éƒ¨åˆ†ï¼šæ¨¡å—åŸºç¡€

### ä»€ä¹ˆæ˜¯æ¨¡å—ï¼Ÿ

**æ¨¡å—**å°±æ˜¯ä¸€ä¸ªåŒ…å« Python ä»£ç çš„ `.py` æ–‡ä»¶ã€‚

åˆ›å»º `math_utils.py`ï¼š
```python
"""æ•°å­¦å·¥å…·æ¨¡å—"""

def add(a: int, b: int) -> int:
    """åŠ æ³•"""
    return a + b

def multiply(a: int, b: int) -> int:
    """ä¹˜æ³•"""
    return a * b

PI = 3.14159
```

ä½¿ç”¨æ¨¡å—ï¼š
```python
# main.py
import math_utils

result = math_utils.add(3, 5)
print(result)  # 8
print(math_utils.PI)  # 3.14159
```

---

## ç¬¬äºŒéƒ¨åˆ†ï¼šimport çš„å¤šç§å½¢å¼

### 1. åŸºæœ¬ import

```python
import math_utils

result = math_utils.add(3, 5)
```

### 2. import asï¼ˆåˆ«åï¼‰

```python
import math_utils as mu

result = mu.add(3, 5)
```

### 3. from importï¼ˆå¯¼å…¥ç‰¹å®šé¡¹ï¼‰

```python
from math_utils import add, PI

result = add(3, 5)
print(PI)
```

### 4. from import as

```python
from math_utils import add as addition

result = addition(3, 5)
```

### 5. from import *ï¼ˆä¸æ¨èï¼ï¼‰

```python
from math_utils import *

# é—®é¢˜ï¼šä¸çŸ¥é“å¯¼å…¥äº†ä»€ä¹ˆï¼Œå¯èƒ½äº§ç”Ÿå‘½åå†²çª
result = add(3, 5)
```

> **âš ï¸ æœ€ä½³å®è·µ**ï¼š
> - âœ… æ˜ç¡®å¯¼å…¥ï¼š`from module import specific_function`
> - âŒ é¿å…ï¼š`from module import *`

---

## ç¬¬ä¸‰éƒ¨åˆ†ï¼šåŒ…ï¼ˆPackageï¼‰

### ä»€ä¹ˆæ˜¯åŒ…ï¼Ÿ

**åŒ…**æ˜¯åŒ…å« `__init__.py` æ–‡ä»¶çš„ç›®å½•ï¼Œå¯ä»¥åŒ…å«å¤šä¸ªæ¨¡å—ã€‚

é¡¹ç›®ç»“æ„ï¼š
```
my_agent/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ llm.py
â”œâ”€â”€ tools.py
â””â”€â”€ utils/
    â”œâ”€â”€ __init__.py
    â”œâ”€â”€ text.py
    â””â”€â”€ logging.py
```

### `__init__.py` çš„ä½œç”¨

```python
# my_agent/__init__.py
"""AI Agent åŒ…"""

from .llm import call_llm
from .tools import search_web, calculate

__version__ = "0.1.0"
__all__ = ["call_llm", "search_web", "calculate"]
```

ä½¿ç”¨åŒ…ï¼š
```python
import my_agent

# å¯ä»¥ç›´æ¥ä½¿ç”¨
result = my_agent.call_llm("Hello")

# æˆ–è€…
from my_agent import search_web
```

---

## ç¬¬å››éƒ¨åˆ†ï¼šç›¸å¯¹å¯¼å…¥ vs ç»å¯¹å¯¼å…¥

### ç»å¯¹å¯¼å…¥ï¼ˆæ¨èï¼‰

```python
# my_agent/tools.py
from my_agent.utils.text import clean_text
from my_agent.llm import call_llm
```

### ç›¸å¯¹å¯¼å…¥

```python
# my_agent/tools.py
from .utils.text import clean_text  # å½“å‰åŒ…çš„ utils.text
from .llm import call_llm            # å½“å‰åŒ…çš„ llm
from ..other_package import something  # ä¸Šçº§åŒ…
```

> **ğŸ’¡ æœ€ä½³å®è·µ**ï¼š
> - åŒ…å†…éƒ¨ä½¿ç”¨ç›¸å¯¹å¯¼å…¥
> - è·¨åŒ…ä½¿ç”¨ç»å¯¹å¯¼å…¥

---

## ç¬¬äº”éƒ¨åˆ†ï¼š`__name__` å’Œ `__main__`

### ç†è§£ `__name__` å˜é‡

```python
# my_module.py
print(f"__name__ çš„å€¼: {__name__}")

def main():
    print("æ‰§è¡Œä¸»å‡½æ•°")

if __name__ == "__main__":
    main()
```

**è¿è¡Œæ•ˆæœ**ï¼š
```bash
# ç›´æ¥è¿è¡Œ
$ python my_module.py
__name__ çš„å€¼: __main__
æ‰§è¡Œä¸»å‡½æ•°

# ä½œä¸ºæ¨¡å—å¯¼å…¥
$ python
>>> import my_module
__name__ çš„å€¼: my_module
```

> **ğŸ’¡ åº”ç”¨åœºæ™¯**ï¼š
> - æ¨¡å—æ—¢å¯ä»¥è¢«å¯¼å…¥ä½¿ç”¨
> - ä¹Ÿå¯ä»¥ç›´æ¥è¿è¡Œæµ‹è¯•

---

## ç¬¬å…­éƒ¨åˆ†ï¼šå®æˆ˜ - Agent é¡¹ç›®ç»“æ„

### æ ‡å‡†é¡¹ç›®ç»“æ„

```
ai_agent_project/
â”‚
â”œâ”€â”€ pyproject.toml          # Poetry é…ç½®
â”œâ”€â”€ README.md               # é¡¹ç›®è¯´æ˜
â”œâ”€â”€ .gitignore             # Git å¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ .env                   # ç¯å¢ƒå˜é‡ï¼ˆä¸æäº¤ï¼‰
â”‚
â”œâ”€â”€ src/                   # æºä»£ç ç›®å½•
â”‚   â””â”€â”€ ai_agent/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ agent.py       # Agent ä¸»é€»è¾‘
â”‚       â”œâ”€â”€ llm/           # LLM æ¨¡å—
â”‚       â”‚   â”œâ”€â”€ __init__.py
â”‚       â”‚   â”œâ”€â”€ openai_client.py
â”‚       â”‚   â””â”€â”€ anthropic_client.py
â”‚       â”œâ”€â”€ tools/         # Tools æ¨¡å—
â”‚       â”‚   â”œâ”€â”€ __init__.py
â”‚       â”‚   â”œâ”€â”€ web_search.py
â”‚       â”‚   â””â”€â”€ calculator.py
â”‚       â”œâ”€â”€ prompts/       # æç¤ºè¯æ¨¡å—
â”‚       â”‚   â”œâ”€â”€ __init__.py
â”‚       â”‚   â””â”€â”€ templates.py
â”‚       â””â”€â”€ utils/         # å·¥å…·å‡½æ•°
â”‚           â”œâ”€â”€ __init__.py
â”‚           â”œâ”€â”€ logging.py
â”‚           â””â”€â”€ config.py
â”‚
â”œâ”€â”€ tests/                 # æµ‹è¯•ç›®å½•
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ test_agent.py
â”‚   â””â”€â”€ test_tools.py
â”‚
â”œâ”€â”€ examples/              # ç¤ºä¾‹è„šæœ¬
â”‚   â””â”€â”€ basic_usage.py
â”‚
â””â”€â”€ docs/                  # æ–‡æ¡£
    â””â”€â”€ api.md
```

### å®ç°ç¤ºä¾‹

**1. llm/openai_client.py**
```python
"""OpenAI API å®¢æˆ·ç«¯"""

from typing import Optional
import os

def call_openai(
    prompt: str,
    model: str = "gpt-3.5-turbo",
    api_key: Optional[str] = None
) -> str:
    """è°ƒç”¨ OpenAI API"""
    api_key = api_key or os.getenv("OPENAI_API_KEY")
    # å®é™…å®ç°...
    return f"[OpenAIå“åº”] {prompt}"
```

**2. tools/web_search.py**
```python
"""ç½‘ç»œæœç´¢å·¥å…·"""

def search_web(query: str) -> str:
    """æœç´¢ç½‘ç»œ"""
    # å®é™…å®ç°ä¼šè°ƒç”¨æœç´¢ API
    return f"æœç´¢ç»“æœ: {query}"
```

**3. `__init__.py`**
```python
"""AI Agent åŒ…"""

from .llm.openai_client import call_openai
from .tools.web_search import search_web

__version__ = "0.1.0"
__all__ = ["call_openai", "search_web"]
```

**4. ä½¿ç”¨**
```python
# examples/basic_usage.py
from ai_agent import call_openai, search_web

if __name__ == "__main__":
    response = call_openai("What is AI?")
    print(response)
    
    results = search_web("Python tutorials")
    print(results)
```

---

## æœ¬èŠ‚æ€»ç»“

### æ ¸å¿ƒæ¦‚å¿µ

1. **æ¨¡å—** = .py æ–‡ä»¶
2. **åŒ…** = åŒ…å« `__init__.py` çš„ç›®å½•
3. **ç»å¯¹å¯¼å…¥ vs ç›¸å¯¹å¯¼å…¥**
4. **`if __name__ == "__main__"`** æ¨¡å¼
5. **è§„èŒƒçš„é¡¹ç›®ç»“æ„**

### æœ€ä½³å®è·µ

- âœ… ä½¿ç”¨æ˜ç¡®çš„ import
- âœ… ç»„ç»‡æ¸…æ™°çš„ç›®å½•ç»“æ„
- âœ… åœ¨ `__init__.py` ä¸­æš´éœ²å…¬å…± API
- âœ… ä½¿ç”¨ `__all__` æ§åˆ¶å¯¼å‡º
- âœ… æ¨¡å—å’ŒåŒ…åä½¿ç”¨å°å†™+ä¸‹åˆ’çº¿

---

**ä¸‹ä¸€èŠ‚ï¼š[1.5 å®æˆ˜ï¼šæ„å»ºç¬¬ä¸€ä¸ª LangChain Tool](1.5-å®æˆ˜ï¼šæ„å»ºç¬¬ä¸€ä¸ªLangChainTool.md)**

# 2.1 åˆ—è¡¨ä¸å…ƒç»„ï¼šç®¡ç† Agent çš„æ¶ˆæ¯å†å²

## å¼•è¨€ï¼šAgent çš„æ—¶é—´çº¿

æƒ³è±¡ä¸€ä¸ªå®¢æœ Agent æ­£åœ¨ä¸ç”¨æˆ·å¯¹è¯ï¼š
```
User: "ä½ å¥½"
Agent: "æ‚¨å¥½ï¼æœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©æ‚¨ï¼Ÿ"
User: "æˆ‘æƒ³æŸ¥è®¢å•"
Agent: "è¯·å‘Šè¯‰æˆ‘æ‚¨çš„è®¢å•å·"
User: "12345"
Agent: "æ­£åœ¨ä¸ºæ‚¨æŸ¥è¯¢è®¢å• 12345..."
```

è¿™ä¸ªå¯¹è¯å†å²éœ€è¦å­˜å‚¨åœ¨æŸä¸ªæ•°æ®ç»“æ„ä¸­ï¼Œä»¥ä¾¿ Agent èƒ½å¤Ÿï¼š
- è®°ä½ä¸Šä¸‹æ–‡
- å›æº¯å†å²
- ç”Ÿæˆæ‘˜è¦

**åˆ—è¡¨ï¼ˆListï¼‰** æ˜¯å®Œç¾çš„é€‰æ‹©â€”â€”å®ƒä¿æŒé¡ºåºã€å¯ä»¥è¿½åŠ ã€æ”¯æŒç´¢å¼•ã€‚

> **ğŸ¯ å°ç™½ç†è§£æŒ‡å—ï¼šä»€ä¹ˆæ˜¯"åˆ—è¡¨"ï¼Ÿ**
>
> åˆ—è¡¨å°±åƒ**å¾®ä¿¡èŠå¤©è®°å½•**ï¼š
> - æ¯æ¡æ¶ˆæ¯æŒ‰**æ—¶é—´é¡ºåº**æ’åˆ—ï¼ˆç¬¬1æ¡ã€ç¬¬2æ¡ã€ç¬¬3æ¡...ï¼‰
> - ä½ å¯ä»¥éšæ—¶**å¾€ä¸‹åŠ æ–°æ¶ˆæ¯**ï¼ˆè¿½åŠ ï¼‰
> - ä½ å¯ä»¥**ç¿»åˆ°ä»»æ„ä¸€æ¡**æŸ¥çœ‹ï¼ˆç´¢å¼•ï¼‰
> - ä½ ä¹Ÿå¯ä»¥**åˆ é™¤æŸæ¡æ¶ˆæ¯**ï¼ˆç§»é™¤ï¼‰
>
> åœ¨ç¼–ç¨‹ä¸­ï¼Œåˆ—è¡¨ç”¨æ–¹æ‹¬å· `[]` è¡¨ç¤ºã€‚æ¯”å¦‚ `["è‹¹æœ", "é¦™è•‰", "æ©™å­"]` å°±æ˜¯ä¸€ä¸ªåŒ…å«ä¸‰ç§æ°´æœçš„åˆ—è¡¨ã€‚

## å­¦ä¹ ç›®æ ‡

- âœ… æŒæ¡åˆ—è¡¨çš„åˆ›å»ºå’ŒåŸºæœ¬æ“ä½œ
- âœ… ç†è§£åˆ—è¡¨æ¨å¯¼å¼
- âœ… æŒæ¡åˆ‡ç‰‡æ“ä½œ
- âœ… äº†è§£å…ƒç»„çš„ä¸å¯å˜ç‰¹æ€§
- âœ… å®æˆ˜ï¼šæ„å»ºæ¶ˆæ¯å†å²ç®¡ç†å™¨

---

## ç¬¬ä¸€éƒ¨åˆ†ï¼šåˆ—è¡¨åŸºç¡€

### åˆ›å»ºåˆ—è¡¨

```python
# ç©ºåˆ—è¡¨
messages: list = []
messages: list[str] = []  # å¸¦ç±»å‹æ³¨è§£

# å¸¦åˆå§‹å€¼çš„åˆ—è¡¨
messages = ["Hello", "Hi", "How are you?"]

# ä½¿ç”¨ list() æ„é€ å‡½æ•°
numbers = list(range(5))  # [0, 1, 2, 3, 4]

# åˆ—è¡¨å¯ä»¥åŒ…å«ä¸åŒç±»å‹ï¼ˆä½†ä¸æ¨èï¼‰
mixed = [1, "hello", 3.14, True]
```

### åŸºæœ¬æ“ä½œ

```python
messages = ["Hello", "Hi"]

# è¿½åŠ å…ƒç´ 
messages.append("Good morning")
print(messages)  # ['Hello', 'Hi', 'Good morning']

# æ’å…¥å…ƒç´ 
messages.insert(1, "Hey")  # åœ¨ç´¢å¼• 1 å¤„æ’å…¥
print(messages)  # ['Hello', 'Hey', 'Hi', 'Good morning']

# åˆ é™¤å…ƒç´ 
messages.remove("Hey")  # åˆ é™¤ç¬¬ä¸€ä¸ªåŒ¹é…çš„å…ƒç´ 
print(messages)  # ['Hello', 'Hi', 'Good morning']

# å¼¹å‡ºå…ƒç´ 
last = messages.pop()  # åˆ é™¤å¹¶è¿”å›æœ€åä¸€ä¸ªå…ƒç´ 
print(last)  # 'Good morning'
print(messages)  # ['Hello', 'Hi']

# æ‰©å±•åˆ—è¡¨
messages.extend(["See you", "Bye"])
print(messages)  # ['Hello', 'Hi', 'See you', 'Bye']

# è·å–é•¿åº¦
print(len(messages))  # 4

# æ£€æŸ¥æˆå‘˜
print("Hello" in messages)  # True
```

### ç´¢å¼•å’Œåˆ‡ç‰‡

```python
messages = ["Hello", "Hi", "Hey", "Good morning", "Bye"]

# æ­£å‘ç´¢å¼•ï¼ˆä» 0 å¼€å§‹ï¼‰
print(messages[0])   # 'Hello'
print(messages[2])   # 'Hey'

# è´Ÿå‘ç´¢å¼•ï¼ˆä» -1 å¼€å§‹ï¼‰
print(messages[-1])  # 'Bye'ï¼ˆæœ€åä¸€ä¸ªï¼‰
print(messages[-2])  # 'Good morning'ï¼ˆå€’æ•°ç¬¬äºŒä¸ªï¼‰

# åˆ‡ç‰‡ [start:end:step]
print(messages[1:3])    # ['Hi', 'Hey']ï¼ˆç´¢å¼• 1 åˆ° 2ï¼‰
print(messages[:2])     # ['Hello', 'Hi']ï¼ˆå‰ä¸¤ä¸ªï¼‰
print(messages[2:])     # ['Hey', 'Good morning', 'Bye']ï¼ˆä»ç´¢å¼• 2 åˆ°æœ«å°¾ï¼‰
print(messages[::2])    # ['Hello', 'Hey', 'Bye']ï¼ˆæ¯éš”ä¸€ä¸ªï¼‰
print(messages[::-1])   # åè½¬åˆ—è¡¨
```

> **ğŸ’¡ å…³é”®æ¦‚å¿µ**ï¼šåˆ‡ç‰‡åˆ›å»º**æ–°åˆ—è¡¨**ï¼Œä¸ä¿®æ”¹åŸåˆ—è¡¨ã€‚

> **ğŸ¯ å°ç™½ç†è§£æŒ‡å—ï¼šç´¢å¼•å’Œåˆ‡ç‰‡**
>
> **ç´¢å¼•**å°±åƒ**ç”µå½±é™¢åº§ä½å·**ï¼š
> - Python ä» **0** å¼€å§‹æ•°ï¼ˆç¬¬ä¸€ä¸ªæ˜¯ 0 å·ï¼Œä¸æ˜¯ 1 å·ï¼ï¼‰
> - `messages[0]` å°±æ˜¯"ç¬¬ä¸€ä¸ªå…ƒç´ "
> - `messages[-1]` æ˜¯ä»åå¾€å‰æ•°çš„"æœ€åä¸€ä¸ª"ï¼ˆè´Ÿæ•°è¡¨ç¤ºå€’ç€æ•°ï¼‰
>
> **åˆ‡ç‰‡**å°±åƒ**å¤å°æœºå¤å°æŒ‡å®šé¡µæ•°**ï¼š
> - `messages[1:3]` = "ä»ç¬¬2ä¸ªåˆ°ç¬¬3ä¸ª"ï¼ˆæ³¨æ„ï¼šä¸åŒ…æ‹¬ç»“æŸä½ç½®ï¼ï¼‰
> - `messages[:2]` = "å‰2ä¸ª"
> - `messages[2:]` = "ä»ç¬¬3ä¸ªå¼€å§‹åˆ°æœ€å"
> - `messages[::-1]` = "å…¨éƒ¨å€’è¿‡æ¥"ï¼ˆå¾ˆå¸¸ç”¨çš„æŠ€å·§ï¼ï¼‰
>
> è®°ä½ï¼šåˆ‡ç‰‡æ˜¯**å¤åˆ¶ä¸€ä»½æ–°çš„**ï¼Œä¸ä¼šæ”¹å˜åŸæ¥çš„åˆ—è¡¨ã€‚

---

## ç¬¬äºŒéƒ¨åˆ†ï¼šåˆ—è¡¨æ¨å¯¼å¼

> **ğŸ¯ å°ç™½ç†è§£æŒ‡å—ï¼šä»€ä¹ˆæ˜¯åˆ—è¡¨æ¨å¯¼å¼ï¼Ÿ**
>
> åˆ—è¡¨æ¨å¯¼å¼æ˜¯ Python çš„"**ä¸€è¡Œé­”æ³•**"â€”â€”æŠŠåŸæœ¬éœ€è¦å¥½å‡ è¡Œçš„ä»£ç å‹ç¼©æˆä¸€è¡Œã€‚
>
> æƒ³è±¡ä½ æœ‰ä¸€å †è‹¹æœï¼Œæƒ³æŠŠæ¯ä¸ªè‹¹æœéƒ½å‰Šçš®ï¼š
> - **ä¼ ç»Ÿæ–¹å¼**ï¼šæ‹¿ä¸€ä¸ªç©ºç¯®å­ï¼Œä¸€ä¸ªä¸€ä¸ªå‰Šï¼Œå‰Šå®Œæ”¾è¿›ç¯®å­
> - **åˆ—è¡¨æ¨å¯¼å¼**ï¼šä¸€å¥è¯ï¼š"ç»™æˆ‘ä¸€ç¯®å­å‰Šå¥½çš®çš„è‹¹æœ"
>
> è¯­æ³•æ¨¡æ¿ï¼š`[å¯¹æ¯ä¸ªå…ƒç´ åšä»€ä¹ˆ for å…ƒç´  in åŸåˆ—è¡¨]`

### åŸºæœ¬è¯­æ³•

```python
# ä¼ ç»Ÿæ–¹å¼
squares = []
for i in range(10):
    squares.append(i ** 2)

# åˆ—è¡¨æ¨å¯¼å¼ï¼ˆæ›´ Pythonicï¼‰
squares = [i ** 2 for i in range(10)]
print(squares)  # [0, 1, 4, 9, 16, 25, 36, 49, 64, 81]
```

### å¸¦æ¡ä»¶çš„åˆ—è¡¨æ¨å¯¼å¼

```python
# åªä¿ç•™å¶æ•°çš„å¹³æ–¹
even_squares = [i ** 2 for i in range(10) if i % 2 == 0]
print(even_squares)  # [0, 4, 16, 36, 64]

# AI åº”ç”¨ï¼šè¿‡æ»¤æœ‰æ•ˆæ¶ˆæ¯
messages = ["Hello", "", "World", "", "AI"]
valid = [msg for msg in messages if msg]  # è¿‡æ»¤ç©ºå­—ç¬¦ä¸²
print(valid)  # ['Hello', 'World', 'AI']

# è½¬æ¢æ¶ˆæ¯æ ¼å¼
raw_messages = ["hello", "world"]
formatted = [f"User: {msg.upper()}" for msg in raw_messages]
print(formatted)  # ['User: HELLO', 'User: WORLD']
```

### åµŒå¥—åˆ—è¡¨æ¨å¯¼å¼

```python
# å±•å¹³åµŒå¥—åˆ—è¡¨
nested = [[1, 2], [3, 4], [5, 6]]
flat = [item for sublist in nested for item in sublist]
print(flat)  # [1, 2, 3, 4, 5, 6]

# AI åº”ç”¨ï¼šå±•å¹³å¯¹è¯æ‰¹æ¬¡
batches = [
    [{"role": "user", "content": "Hi"}],
    [{"role": "assistant", "content": "Hello"}],
]
all_messages = [msg for batch in batches for msg in batch]
```

---

## ç¬¬ä¸‰éƒ¨åˆ†ï¼šé«˜çº§åˆ—è¡¨æ“ä½œ

### æ’åº

```python
numbers = [3, 1, 4, 1, 5, 9, 2, 6]

# sorted() - è¿”å›æ–°åˆ—è¡¨
sorted_nums = sorted(numbers)
print(sorted_nums)  # [1, 1, 2, 3, 4, 5, 6, 9]

# reverse=True é™åº
desc = sorted(numbers, reverse=True)

# key å‚æ•°ï¼šè‡ªå®šä¹‰æ’åº
words = ["apple", "pie", "a", "longer"]
by_length = sorted(words, key=len)
print(by_length)  # ['a', 'pie', 'apple', 'longer']

# AI åº”ç”¨ï¼šæŒ‰ç½®ä¿¡åº¦æ’åº
results = [
    {"text": "Result 1", "confidence": 0.8},
    {"text": "Result 2", "confidence": 0.95},
    {"text": "Result 3", "confidence": 0.7},
]
sorted_results = sorted(results, key=lambda x: x["confidence"], reverse=True)
```

### åˆ—è¡¨æ‹¼æ¥å’Œå¤åˆ¶

```python
# æ‹¼æ¥
list1 = [1, 2, 3]
list2 = [4, 5, 6]
combined = list1 + list2  # [1, 2, 3, 4, 5, 6]

# é‡å¤
repeated = [0] * 5  # [0, 0, 0, 0, 0]

# æµ…æ‹·è´ vs æ·±æ‹·è´
original = [1, [2, 3], 4]

# æµ…æ‹·è´
shallow = original.copy()  # æˆ– original[:]
shallow[1][0] = 999
print(original)  # [1, [999, 3], 4]ï¼ˆåµŒå¥—åˆ—è¡¨è¢«ä¿®æ”¹ï¼ï¼‰

# æ·±æ‹·è´
import copy
deep = copy.deepcopy(original)
deep[1][0] = 777
print(original)  # [1, [999, 3], 4]ï¼ˆä¸å—å½±å“ï¼‰
```

> **ğŸ¯ å°ç™½ç†è§£æŒ‡å—ï¼šæµ…æ‹·è´ vs æ·±æ‹·è´**
>
> æƒ³è±¡ä½ æœ‰ä¸€ä¸ª**æ–‡ä»¶å¤¹**ï¼Œé‡Œé¢æœ‰ä¸€äº›**æ–‡ä»¶**å’Œä¸€ä¸ª**å­æ–‡ä»¶å¤¹**ï¼š
>
> **æµ…æ‹·è´**å°±åƒ**å¤åˆ¶å¿«æ·æ–¹å¼**ï¼š
> - å¤–å±‚çš„æ–‡ä»¶å¤¹æ˜¯æ–°çš„
> - ä½†å­æ–‡ä»¶å¤¹åªæ˜¯åˆ›å»ºäº†ä¸€ä¸ª"å¿«æ·æ–¹å¼"ï¼ŒæŒ‡å‘åŸæ¥çš„ä½ç½®
> - ä¿®æ”¹å­æ–‡ä»¶å¤¹é‡Œçš„ä¸œè¥¿ï¼ŒåŸæ¥çš„ä¹Ÿä¼šå˜ï¼
>
> **æ·±æ‹·è´**å°±åƒ**å®Œå…¨å¤åˆ¶æ‰€æœ‰å†…å®¹**ï¼š
> - æ–‡ä»¶å¤¹æ˜¯æ–°çš„ï¼Œå­æ–‡ä»¶å¤¹ä¹Ÿæ˜¯æ–°çš„
> - ä¸¤è¾¹å®Œå…¨ç‹¬ç«‹ï¼Œäº’ä¸å½±å“
>
> **ä»€ä¹ˆæ—¶å€™ç”¨æ·±æ‹·è´ï¼Ÿ** å½“ä½ çš„åˆ—è¡¨é‡Œé¢è¿˜æœ‰åˆ—è¡¨ï¼ˆåµŒå¥—ç»“æ„ï¼‰æ—¶ï¼Œæƒ³è¦å®Œå…¨ç‹¬ç«‹çš„å‰¯æœ¬å°±ç”¨ `copy.deepcopy()`ã€‚

---

## ç¬¬å››éƒ¨åˆ†ï¼šå…ƒç»„ï¼ˆTupleï¼‰

> **ğŸ¯ å°ç™½ç†è§£æŒ‡å—ï¼šä»€ä¹ˆæ˜¯å…ƒç»„ï¼Ÿ**
>
> å…ƒç»„å°±åƒ**æ‰“å°å¥½çš„èº«ä»½è¯**â€”â€”ä¸€æ—¦åˆ¶ä½œå®Œæˆï¼Œå°±ä¸èƒ½ä¿®æ”¹äº†ã€‚
>
> åˆ—è¡¨ vs å…ƒç»„çš„åŒºåˆ«ï¼š
> - **åˆ—è¡¨ `[]`**ï¼šåƒ**ç™½æ¿**ï¼Œå¯ä»¥éšæ—¶æ“¦æ‰é‡å†™
> - **å…ƒç»„ `()`**ï¼šåƒ**åˆ»åœ¨çŸ³å¤´ä¸Šçš„å­—**ï¼Œåˆ»å®Œå°±ä¸èƒ½æ”¹äº†
>
> ä¸ºä»€ä¹ˆè¦ç”¨å…ƒç»„ï¼Ÿ
> 1. **æ›´å®‰å…¨**ï¼šé˜²æ­¢é‡è¦æ•°æ®è¢«æ„å¤–ä¿®æ”¹ï¼ˆæ¯”å¦‚åæ ‡ã€é…ç½®ï¼‰
> 2. **æ›´å¿«**ï¼šå› ä¸ºä¸èƒ½ä¿®æ”¹ï¼ŒPython å¯ä»¥åšä¼˜åŒ–
> 3. **å¯ä»¥å½“å­—å…¸çš„é”®**ï¼šåˆ—è¡¨ä¸è¡Œï¼Œå…ƒç»„å¯ä»¥

### å…ƒç»„åŸºç¡€

```python
# å…ƒç»„æ˜¯ä¸å¯å˜çš„åˆ—è¡¨
coordinates = (40.7128, -74.0060)
rgb = (255, 128, 0)

# å…ƒç»„è§£åŒ…
lat, lon = coordinates
print(f"çº¬åº¦: {lat}, ç»åº¦: {lon}")

# å•å…ƒç´ å…ƒç»„ï¼ˆæ³¨æ„é€—å·ï¼ï¼‰
single = (42,)  # æ­£ç¡®
not_tuple = (42)  # è¿™æ˜¯ intï¼Œä¸æ˜¯å…ƒç»„ï¼

# ä¸ºä»€ä¹ˆä½¿ç”¨å…ƒç»„ï¼Ÿ
# 1. æ€§èƒ½ï¼šæ¯”åˆ—è¡¨ç•¥å¿«
# 2. å®‰å…¨ï¼šä¸å¯å˜ï¼Œé˜²æ­¢æ„å¤–ä¿®æ”¹
# 3. å¯ä½œä¸ºå­—å…¸é”®ï¼ˆåˆ—è¡¨ä¸è¡Œï¼‰
```

> **ğŸ¯ å°ç™½æ˜“é”™ç‚¹ï¼šå•å…ƒç´ å…ƒç»„**
>
> `(42)` ä¸æ˜¯å…ƒç»„ï¼Python è®¤ä¸ºè¿™åªæ˜¯æ•°å­¦ä¸­çš„æ‹¬å·ï¼Œç»“æœæ˜¯æ•´æ•° `42`ã€‚
>
> è¦åˆ›å»ºåªæœ‰ä¸€ä¸ªå…ƒç´ çš„å…ƒç»„ï¼Œ**å¿…é¡»åŠ é€—å·**ï¼š`(42,)`
>
> è¿™å°±åƒ"ä¸€äººæˆå›¢"â€”â€”ä½ å¾—è¡¨æ˜è¿™æ˜¯ä¸ª"å›¢"ï¼Œä¸åªæ˜¯ä¸€ä¸ªäººç«™åœ¨é‚£é‡Œã€‚

### å…ƒç»„çš„åº”ç”¨åœºæ™¯

```python
# å‡½æ•°è¿”å›å¤šä¸ªå€¼
def get_user_info():
    return "Alice", 25, "alice@example.com"

name, age, email = get_user_info()

# ç”¨ä½œå­—å…¸é”®
location_data = {
    (40.7128, -74.0060): "New York",
    (51.5074, -0.1278): "London",
}

# ä¸å¯å˜çš„é…ç½®
DEFAULT_CONFIG = (
    "gpt-3.5-turbo",  # model
    0.7,              # temperature
    2000,             # max_tokens
)
```

---

## ç¬¬äº”éƒ¨åˆ†ï¼šå®æˆ˜ - æ¶ˆæ¯å†å²ç®¡ç†å™¨

> **ğŸ¯ å°ç™½ç†è§£æŒ‡å—ï¼šä¸ºä»€ä¹ˆéœ€è¦æ¶ˆæ¯å†å²ç®¡ç†å™¨ï¼Ÿ**
>
> æƒ³è±¡ä½ æ˜¯ä¸€ä¸ªå®¢æœï¼Œç”¨æˆ·è¯´ï¼š"æˆ‘è¦é€€ä¸Šæ¬¡ä¹°çš„é‚£ä¸ªä¸œè¥¿"ã€‚
>
> å¦‚æœä½ ä¸è®°å¾—"ä¸Šæ¬¡ä¹°çš„æ˜¯ä»€ä¹ˆ"ï¼Œä½ å°±æ²¡æ³•å¸®ä»–é€€è´§ï¼
>
> æ¶ˆæ¯å†å²ç®¡ç†å™¨å°±æ˜¯å¸® AI è®°ä½å¯¹è¯å†…å®¹çš„å·¥å…·ï¼š
> - **è®°å½•æ¯ä¸€è½®å¯¹è¯**ï¼ˆè°è¯´äº†ä»€ä¹ˆï¼‰
> - **æ§åˆ¶è®°å¿†é•¿åº¦**ï¼ˆä¸èƒ½è®°å¤ªå¤šï¼Œå¦åˆ™ä¼š"çˆ†å†…å­˜"ï¼‰
> - **æ”¯æŒæœç´¢å’Œç­›é€‰**ï¼ˆå¿«é€Ÿæ‰¾åˆ°å…³é”®ä¿¡æ¯ï¼‰
> - **è½¬æ¢æ ¼å¼**ï¼ˆä¸åŒçš„ AI ç³»ç»Ÿéœ€è¦ä¸åŒçš„æ ¼å¼ï¼‰

```python
"""
Agent æ¶ˆæ¯å†å²ç®¡ç†å™¨
æ¼”ç¤ºåˆ—è¡¨åœ¨ AI Agent ä¸­çš„å®é™…åº”ç”¨
"""

from typing import List, Dict, Optional, Literal
from dataclasses import dataclass
from datetime import datetime


@dataclass
class Message:
    """æ¶ˆæ¯æ•°æ®ç±»"""
    role: Literal["user", "assistant", "system"]
    content: str
    timestamp: datetime
    metadata: Optional[Dict] = None


class MessageHistory:
    """æ¶ˆæ¯å†å²ç®¡ç†å™¨"""
    
    def __init__(self, max_messages: int = 100):
        """
        åˆå§‹åŒ–æ¶ˆæ¯å†å²
        
        Args:
            max_messages: æœ€å¤§ä¿å­˜æ¶ˆæ¯æ•°
        """
        self.messages: List[Message] = []
        self.max_messages = max_messages
    
    def add_message(
        self,
        role: Literal["user", "assistant", "system"],
        content: str,
        metadata: Optional[Dict] = None
    ) -> None:
        """
        æ·»åŠ æ¶ˆæ¯
        
        Args:
            role: æ¶ˆæ¯è§’è‰²
            content: æ¶ˆæ¯å†…å®¹
            metadata: å…ƒæ•°æ®
        """
        message = Message(
            role=role,
            content=content,
            timestamp=datetime.now(),
            metadata=metadata
        )
        
        self.messages.append(message)
        
        # ä¿æŒåœ¨æœ€å¤§é™åˆ¶å†…
        if len(self.messages) > self.max_messages:
            self.messages = self.messages[-self.max_messages:]
    
    def get_recent(self, n: int = 10) -> List[Message]:
        """
        è·å–æœ€è¿‘çš„ n æ¡æ¶ˆæ¯
        
        Args:
            n: æ¶ˆæ¯æ•°é‡
        
        Returns:
            æ¶ˆæ¯åˆ—è¡¨
        """
        return self.messages[-n:]
    
    def get_by_role(self, role: str) -> List[Message]:
        """
        æŒ‰è§’è‰²ç­›é€‰æ¶ˆæ¯
        
        Args:
            role: æ¶ˆæ¯è§’è‰²
        
        Returns:
            ç­›é€‰åçš„æ¶ˆæ¯åˆ—è¡¨
        """
        return [msg for msg in self.messages if msg.role == role]
    
    def search(self, keyword: str) -> List[Message]:
        """
        æœç´¢åŒ…å«å…³é”®è¯çš„æ¶ˆæ¯
        
        Args:
            keyword: æœç´¢å…³é”®è¯
        
        Returns:
            åŒ…å«å…³é”®è¯çš„æ¶ˆæ¯åˆ—è¡¨
        """
        return [
            msg for msg in self.messages
            if keyword.lower() in msg.content.lower()
        ]
    
    def get_context_window(
        self,
        max_tokens: int = 2000,
        tokens_per_message: int = 50
    ) -> List[Message]:
        """
        è·å–ç¬¦åˆ token é™åˆ¶çš„ä¸Šä¸‹æ–‡çª—å£
        
        Args:
            max_tokens: æœ€å¤§ token æ•°
            tokens_per_message: æ¯æ¡æ¶ˆæ¯å¹³å‡ token æ•°
        
        Returns:
            ä¸Šä¸‹æ–‡æ¶ˆæ¯åˆ—è¡¨
        """
        max_messages = max_tokens // tokens_per_message
        return self.get_recent(max_messages)
    
    def to_langchain_format(self) -> List[Dict[str, str]]:
        """
        è½¬æ¢ä¸º LangChain æ¶ˆæ¯æ ¼å¼
        
        Returns:
            LangChain æ ¼å¼çš„æ¶ˆæ¯åˆ—è¡¨
        """
        return [
            {
                "role": msg.role,
                "content": msg.content
            }
            for msg in self.messages
        ]
    
    def clear(self) -> None:
        """æ¸…ç©ºæ¶ˆæ¯å†å²"""
        self.messages = []
    
    def get_summary(self) -> Dict:
        """
        è·å–å†å²æ‘˜è¦
        
        Returns:
            æ‘˜è¦ä¿¡æ¯
        """
        total = len(self.messages)
        by_role = {}
        
        for msg in self.messages:
            by_role[msg.role] = by_role.get(msg.role, 0) + 1
        
        return {
            "total_messages": total,
            "by_role": by_role,
            "first_message": self.messages[0].timestamp if self.messages else None,
            "last_message": self.messages[-1].timestamp if self.messages else None,
        }


# ä½¿ç”¨ç¤ºä¾‹
def main():
    """æ¼”ç¤ºæ¶ˆæ¯å†å²ç®¡ç†å™¨"""
    history = MessageHistory(max_messages=50)
    
    # æ·»åŠ å¯¹è¯
    history.add_message("user", "ä½ å¥½")
    history.add_message("assistant", "æ‚¨å¥½ï¼æœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©æ‚¨ï¼Ÿ")
    history.add_message("user", "å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ")
    history.add_message("assistant", "è®©æˆ‘ä¸ºæ‚¨æŸ¥è¯¢å¤©æ°”ä¿¡æ¯...")
    history.add_message("user", "è°¢è°¢")
    
    # è·å–æœ€è¿‘æ¶ˆæ¯
    recent = history.get_recent(3)
    print(f"æœ€è¿‘ 3 æ¡æ¶ˆæ¯: {len(recent)}")
    
    # æŒ‰è§’è‰²ç­›é€‰
    user_messages = history.get_by_role("user")
    print(f"ç”¨æˆ·æ¶ˆæ¯æ•°: {len(user_messages)}")
    
    # æœç´¢
    results = history.search("å¤©æ°”")
    print(f"åŒ…å«'å¤©æ°”'çš„æ¶ˆæ¯: {len(results)}")
    
    # è·å–æ‘˜è¦
    summary = history.get_summary()
    print(f"\næ‘˜è¦: {summary}")
    
    # è½¬æ¢ä¸º LangChain æ ¼å¼
    langchain_messages = history.to_langchain_format()
    print(f"\nLangChain æ ¼å¼: {langchain_messages[:2]}")


if __name__ == "__main__":
    main()
```

---

## æœ¬èŠ‚æ€»ç»“

### æ ¸å¿ƒè¦ç‚¹

1. **åˆ—è¡¨**ï¼šæœ‰åºã€å¯å˜ã€æ”¯æŒç´¢å¼•å’Œåˆ‡ç‰‡
2. **åˆ—è¡¨æ¨å¯¼å¼**ï¼šç®€æ´çš„åˆ—è¡¨åˆ›å»ºæ–¹å¼
3. **å…ƒç»„**ï¼šä¸å¯å˜çš„åˆ—è¡¨ï¼Œæ›´å®‰å…¨
4. **åˆ‡ç‰‡**ï¼š`[start:end:step]`
5. **æ·±æ‹·è´ vs æµ…æ‹·è´**ï¼šæ³¨æ„åµŒå¥—æ•°æ®

### åœ¨ AI Agent ä¸­çš„åº”ç”¨

| æ“ä½œ | åº”ç”¨åœºæ™¯ |
|------|----------|
| `append()` | æ·»åŠ æ–°æ¶ˆæ¯åˆ°å†å² |
| `[-n:]` | è·å–æœ€è¿‘ n æ¡æ¶ˆæ¯ |
| åˆ—è¡¨æ¨å¯¼å¼ | è¿‡æ»¤å’Œè½¬æ¢æ¶ˆæ¯ |
| `sorted()` | æŒ‰ç½®ä¿¡åº¦æ’åºç»“æœ |
| åˆ‡ç‰‡ | ç®¡ç†ä¸Šä¸‹æ–‡çª—å£ |

---

**ä¸‹ä¸€èŠ‚ï¼š[2.2 å­—å…¸ï¼šAgent çŠ¶æ€çš„æ ¸å¿ƒæ•°æ®ç»“æ„](2.2-å­—å…¸ï¼šAgentçŠ¶æ€çš„æ ¸å¿ƒæ•°æ®ç»“æ„.md)**

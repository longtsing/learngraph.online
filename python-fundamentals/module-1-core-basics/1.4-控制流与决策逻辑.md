# 0.3 æ§åˆ¶æµä¸å†³ç­–é€»è¾‘

## å¼•è¨€ï¼šè®© Agent å­¦ä¼š"æ€è€ƒ"

ä¸€ä¸ªçœŸæ­£çš„ AI Agent ä¸ä»…ä»…æ˜¯ç®€å•åœ°æ‰§è¡ŒæŒ‡ä»¤â€”â€”å®ƒéœ€è¦èƒ½å¤Ÿ**åšå†³ç­–**ã€**å¾ªç¯å¤„ç†**ä»»åŠ¡ã€**æ ¹æ®æ¡ä»¶é€‰æ‹©ä¸åŒçš„è·¯å¾„**ã€‚è¿™å°±æ˜¯**æ§åˆ¶æµ**çš„ä½œç”¨ã€‚

æƒ³è±¡ä¸€ä¸ªå®¢æœ Agentï¼š
- **å¦‚æœ**ç”¨æˆ·é—®å€™ï¼Œå›å¤é—®å€™è¯­
- **å¦åˆ™å¦‚æœ**ç”¨æˆ·æé—®ï¼Œæœç´¢çŸ¥è¯†åº“
- **å¦åˆ™å¦‚æœ**ç”¨æˆ·æŠ•è¯‰ï¼Œè½¬æ¥äººå·¥
- **å¾ªç¯å¤„ç†**æ¯ä¸€æ¡æ–°æ¶ˆæ¯
- **æ ¹æ®æ¡ä»¶**å†³å®šæ˜¯å¦éœ€è¦è°ƒç”¨å¤–éƒ¨ API

è¿™ä¸€åˆ‡ï¼Œéƒ½ä¾èµ–äºæœ¬èŠ‚è¦å­¦ä¹ çš„æ§åˆ¶æµç»“æ„ã€‚

> **ğŸ¯ å°ç™½ç†è§£**ï¼šä»€ä¹ˆæ˜¯"æ§åˆ¶æµ"ï¼Ÿ
>
> **æ§åˆ¶æµ** = ç¨‹åºæ‰§è¡Œçš„"è·¯çº¿å›¾"
>
> æƒ³è±¡ä½ åœ¨ç©ä¸€ä¸ªå†’é™©æ¸¸æˆï¼š
>
> ```
> ä½ é‡åˆ°ä¸€ä¸ªå²”è·¯å£
>     â”‚
>     â”œâ”€â”€ å¦‚æœé€‰å·¦è¾¹ â†’ é‡åˆ°å®è—
>     â”‚
>     â””â”€â”€ å¦‚æœé€‰å³è¾¹ â†’ é‡åˆ°æ€ªç‰©
>                        â”‚
>                        â”œâ”€â”€ å¦‚æœæ‰“èµ¢äº† â†’ è·å¾—ç»éªŒ
>                        â”‚
>                        â””â”€â”€ å¦‚æœæ‰“è¾“äº† â†’ é‡æ–°å¼€å§‹
> ```
>
> ç¨‹åºä¹Ÿæ˜¯è¿™æ ·ï¼å®ƒä¸æ˜¯å‚»å‚»åœ°ä»å¤´åˆ°å°¾æ‰§è¡Œï¼Œè€Œæ˜¯ä¼šï¼š
>
> 1. **åšåˆ¤æ–­**ï¼ˆif/elseï¼‰ï¼šèµ°å“ªæ¡è·¯ï¼Ÿ
> 2. **é‡å¤åšäº‹**ï¼ˆå¾ªç¯ï¼‰ï¼šåˆ·æ€ª100æ¬¡
> 3. **è·³å‡º/è·³è¿‡**ï¼ˆbreak/continueï¼‰ï¼šé‡åˆ° Boss å°±é€ƒè·‘
>
> **æ²¡æœ‰æ§åˆ¶æµçš„ç¨‹åº** = åªä¼šç›´çº¿å‰è¿›çš„ NPC
> **æœ‰æ§åˆ¶æµçš„ç¨‹åº** = ä¼šæ€è€ƒã€ä¼šå†³ç­–çš„æ™ºèƒ½ Agent

## å­¦ä¹ ç›®æ ‡

- âœ… æŒæ¡ if/elif/else æ¡ä»¶è¯­å¥
- âœ… ç†è§£ for å¾ªç¯å’Œ while å¾ªç¯
- âœ… å­¦ä¼šä½¿ç”¨ break å’Œ continue æ§åˆ¶å¾ªç¯
- âœ… ç†è§£æ§åˆ¶æµåœ¨ LangGraph çŠ¶æ€æœºä¸­çš„åº”ç”¨
- âœ… æ„å»ºä¸€ä¸ªå…·æœ‰å†³ç­–èƒ½åŠ›çš„ç®€å• Agent

---

## ç¬¬ä¸€éƒ¨åˆ†ï¼šæ¡ä»¶è¯­å¥â€”â€”Agent çš„å†³ç­–æ ‘

> **ğŸ¯ å°ç™½ç†è§£**ï¼šif è¯­å¥å°±æ˜¯"å¦‚æœ...å°±..."
>
> ç”Ÿæ´»ä¸­æˆ‘ä»¬æ—¶åˆ»åœ¨åšåˆ¤æ–­ï¼š
> - **å¦‚æœ**ä¸‹é›¨äº†ï¼Œ**å°±**å¸¦ä¼
> - **å¦‚æœ**é¥¿äº†ï¼Œ**å°±**åƒé¥­
> - **å¦‚æœ**å›°äº†ï¼Œ**å°±**ç¡è§‰
>
> åœ¨ Python ä¸­ï¼Œè¿™ç§åˆ¤æ–­ç”¨ `if` è¯­å¥æ¥è¡¨è¾¾ï¼š
>
> ```python
> if ä¸‹é›¨äº†:
>     å¸¦ä¼
> ```
>
> **æ³¨æ„ä¸¤ä¸ªå…³é”®ç‚¹**ï¼š
> 1. `if` åé¢è·Ÿçš„æ˜¯ä¸€ä¸ª**æ¡ä»¶**ï¼ˆç»“æœæ˜¯ True æˆ– Falseï¼‰
> 2. æ¡ä»¶åé¢è¦åŠ **å†’å· `:`**
> 3. è¦æ‰§è¡Œçš„ä»£ç è¦**ç¼©è¿›**ï¼ˆæŒ‰4ä¸ªç©ºæ ¼æˆ–1ä¸ªTabï¼‰
>
> **ç¼©è¿›å¾ˆé‡è¦ï¼** Python ç”¨ç¼©è¿›æ¥åˆ¤æ–­å“ªäº›ä»£ç å±äº if è¯­å¥ï¼š
> ```python
> if æ¡ä»¶:
>     è¿™è¡Œå±äº ifï¼ˆç¼©è¿›äº†ï¼‰
>     è¿™è¡Œä¹Ÿå±äº ifï¼ˆç¼©è¿›äº†ï¼‰
> è¿™è¡Œä¸å±äº ifï¼ˆæ²¡ç¼©è¿›ï¼‰
> ```

### if è¯­å¥ï¼šå•ä¸€æ¡ä»¶åˆ¤æ–­

```python
temperature: float = 0.9

if temperature > 1.0:
    print("è­¦å‘Š: æ¸©åº¦å‚æ•°è¿‡é«˜ï¼Œå¯èƒ½å¯¼è‡´è¾“å‡ºä¸ç¨³å®š")
```

### if-else è¯­å¥ï¼šäºŒé€‰ä¸€

```python
api_key: str | None = None

if api_key:
    print("API å¯†é’¥å·²é…ç½®ï¼Œå¼€å§‹åˆå§‹åŒ– Agent")
else:
    print("é”™è¯¯: è¯·å…ˆé…ç½® API å¯†é’¥")
```

### if-elif-else è¯­å¥ï¼šå¤šæ¡ä»¶åˆ†æ”¯

```python
def route_user_intent(intent: str) -> str:
    """
    æ ¹æ®ç”¨æˆ·æ„å›¾è·¯ç”±åˆ°ä¸åŒçš„å¤„ç†å™¨
    
    è¿™æ¨¡æ‹Ÿäº† LangGraph ä¸­çš„æ¡ä»¶è·¯ç”± (conditional routing)
    """
    if intent == "greeting":
        return "å¤„ç†é—®å€™"
    elif intent == "question":
        return "è°ƒç”¨ RAG ç³»ç»Ÿ"
    elif intent == "complaint":
        return "è½¬æ¥äººå·¥å®¢æœ"
    elif intent == "goodbye":
        return "ç»“æŸå¯¹è¯"
    else:
        return "æœªçŸ¥æ„å›¾ï¼Œè¯·æ±‚æ¾„æ¸…"

# æµ‹è¯•è·¯ç”±é€»è¾‘
print(route_user_intent("question"))    # è°ƒç”¨ RAG ç³»ç»Ÿ
print(route_user_intent("complaint"))   # è½¬æ¥äººå·¥å®¢æœ
print(route_user_intent("unknown"))     # æœªçŸ¥æ„å›¾ï¼Œè¯·æ±‚æ¾„æ¸…
```

> **ğŸ”— ä¸ Agent çš„è”ç³»**ï¼šLangGraph çš„ `add_conditional_edges()` æœ¬è´¨ä¸Šå°±æ˜¯æ ¹æ®çŠ¶æ€å€¼è¿›è¡Œ if/elif/else åˆ¤æ–­ï¼Œå†³å®šä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚

### åµŒå¥—æ¡ä»¶ï¼šå¤„ç†å¤æ‚é€»è¾‘

```python
def should_retry(
    attempt_count: int,
    max_retries: int,
    error_type: str
) -> bool:
    """
    å†³å®šæ˜¯å¦åº”è¯¥é‡è¯• API è°ƒç”¨
    
    Args:
        attempt_count: å½“å‰å°è¯•æ¬¡æ•°
        max_retries: æœ€å¤§é‡è¯•æ¬¡æ•°
        error_type: é”™è¯¯ç±»å‹
    
    Returns:
        æ˜¯å¦åº”è¯¥é‡è¯•
    """
    if attempt_count < max_retries:
        if error_type == "rate_limit":
            return True  # é€Ÿç‡é™åˆ¶é”™è¯¯ï¼Œåº”è¯¥é‡è¯•
        elif error_type == "timeout":
            return True  # è¶…æ—¶é”™è¯¯ï¼Œåº”è¯¥é‡è¯•
        elif error_type == "server_error":
            return True  # æœåŠ¡å™¨é”™è¯¯ï¼Œåº”è¯¥é‡è¯•
        else:
            return False  # å…¶ä»–é”™è¯¯ï¼ˆå¦‚è®¤è¯å¤±è´¥ï¼‰ï¼Œä¸åº”é‡è¯•
    else:
        return False  # å·²è¾¾æœ€å¤§é‡è¯•æ¬¡æ•°

# æµ‹è¯•
print(should_retry(2, 3, "rate_limit"))    # True
print(should_retry(3, 3, "rate_limit"))    # Falseï¼ˆå·²è¾¾ä¸Šé™ï¼‰
print(should_retry(1, 3, "auth_error"))    # Falseï¼ˆä¸å¯é‡è¯•çš„é”™è¯¯ï¼‰
```

### ä¸‰å…ƒè¡¨è¾¾å¼ï¼šç®€æ´çš„æ¡ä»¶èµ‹å€¼

```python
# ä¼ ç»Ÿå†™æ³•
tokens_used: int = 1800
max_tokens: int = 2000

if tokens_used < max_tokens:
    status = "æ­£å¸¸"
else:
    status = "è¶…é™"

# ä¸‰å…ƒè¡¨è¾¾å¼ï¼ˆæ›´ç®€æ´ï¼‰
status: str = "æ­£å¸¸" if tokens_used < max_tokens else "è¶…é™"

# åœ¨å‡½æ•°è°ƒç”¨ä¸­ä½¿ç”¨
def get_model(is_premium_user: bool) -> str:
    return "gpt-4" if is_premium_user else "gpt-3.5-turbo"

print(get_model(True))   # gpt-4
print(get_model(False))  # gpt-3.5-turbo
```

---

## ç¬¬äºŒéƒ¨åˆ†ï¼šfor å¾ªç¯â€”â€”æ‰¹é‡å¤„ç†çš„åˆ©å™¨

> **ğŸ¯ å°ç™½ç†è§£**ï¼šfor å¾ªç¯å°±æ˜¯"å¯¹äºæ¯ä¸€ä¸ª...åš..."
>
> æƒ³è±¡ä½ æ˜¯è€å¸ˆï¼Œè¦ç»™å…¨ç­åŒå­¦å‘ä½œä¸šï¼š
>
> **æ²¡æœ‰å¾ªç¯**ï¼ˆç´¯æ­»ï¼‰ï¼š
> ```
> ç»™ç¬¬1ä¸ªå­¦ç”Ÿå‘ä½œä¸š
> ç»™ç¬¬2ä¸ªå­¦ç”Ÿå‘ä½œä¸š
> ç»™ç¬¬3ä¸ªå­¦ç”Ÿå‘ä½œä¸š
> ...ï¼ˆå†™50éï¼‰
> ç»™ç¬¬50ä¸ªå­¦ç”Ÿå‘ä½œä¸š
> ```
>
> **æœ‰å¾ªç¯**ï¼ˆè½»æ¾ï¼‰ï¼š
> ```
> å¯¹äºç­ä¸Šçš„æ¯ä¸€ä¸ªå­¦ç”Ÿï¼š
>     ç»™è¿™ä¸ªå­¦ç”Ÿå‘ä½œä¸š
> ```
>
> Python çš„ for å¾ªç¯å°±æ˜¯è¿™ä¸ªæ„æ€ï¼š
>
> ```python
> students = ["å°æ˜", "å°çº¢", "å°åˆš"]
>
> for student in students:
>     print(f"ç»™ {student} å‘ä½œä¸š")
>
> # è¾“å‡ºï¼š
> # ç»™ å°æ˜ å‘ä½œä¸š
> # ç»™ å°çº¢ å‘ä½œä¸š
> # ç»™ å°åˆš å‘ä½œä¸š
> ```
>
> **for å¾ªç¯ä¼šè‡ªåŠ¨**ï¼š
> 1. ä»åˆ—è¡¨ä¸­å–å‡ºç¬¬1ä¸ªå…ƒç´ 
> 2. æ‰§è¡Œå¾ªç¯ä½“é‡Œçš„ä»£ç 
> 3. å–å‡ºç¬¬2ä¸ªå…ƒç´ 
> 4. æ‰§è¡Œå¾ªç¯ä½“é‡Œçš„ä»£ç 
> 5. ...ç›´åˆ°æ‰€æœ‰å…ƒç´ éƒ½å¤„ç†å®Œ

### éå†åˆ—è¡¨

```python
# Agent çš„æ¶ˆæ¯å†å²
messages: list[str] = [
    "ç”¨æˆ·: ä½ å¥½",
    "Agent: æ‚¨å¥½ï¼æœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©æ‚¨çš„ï¼Ÿ",
    "ç”¨æˆ·: å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ",
    "Agent: è®©æˆ‘ä¸ºæ‚¨æŸ¥è¯¢å¤©æ°”ä¿¡æ¯...",
]

# éå†å¹¶æ‰“å°æ‰€æœ‰æ¶ˆæ¯
for message in messages:
    print(message)

# å¸¦ç´¢å¼•éå†
for index, message in enumerate(messages):
    print(f"[{index}] {message}")
```

### éå†èŒƒå›´

```python
# æ‰¹é‡åˆ›å»º Agent å®ä¾‹
for agent_id in range(5):
    print(f"åˆå§‹åŒ– Agent #{agent_id}")

# è¾“å‡º:
# åˆå§‹åŒ– Agent #0
# åˆå§‹åŒ– Agent #1
# åˆå§‹åŒ– Agent #2
# åˆå§‹åŒ– Agent #3
# åˆå§‹åŒ– Agent #4

# æŒ‡å®šèµ·å§‹ã€ç»“æŸã€æ­¥é•¿
for i in range(0, 10, 2):  # 0, 2, 4, 6, 8
    print(f"å¶æ•°: {i}")
```

### éå†å­—å…¸

```python
# Agent é…ç½®
config: dict[str, str | float | int] = {
    "model": "gpt-4",
    "temperature": 0.7,
    "max_tokens": 2000,
}

# éå†é”®
for key in config.keys():
    print(f"é…ç½®é¡¹: {key}")

# éå†å€¼
for value in config.values():
    print(f"å€¼: {value}")

# åŒæ—¶éå†é”®å’Œå€¼ï¼ˆæœ€å¸¸ç”¨ï¼‰
for key, value in config.items():
    print(f"{key}: {value}")
```

### åˆ—è¡¨æ¨å¯¼å¼ï¼šé«˜æ•ˆåˆ›å»ºåˆ—è¡¨

```python
# ä¼ ç»Ÿæ–¹å¼ï¼šåˆ›å»º 1-10 çš„å¹³æ–¹åˆ—è¡¨
squares: list[int] = []
for i in range(1, 11):
    squares.append(i ** 2)

# åˆ—è¡¨æ¨å¯¼å¼ï¼ˆæ›´ Pythonicï¼‰
squares: list[int] = [i ** 2 for i in range(1, 11)]
print(squares)  # [1, 4, 9, 16, 25, 36, 49, 64, 81, 100]

# å¸¦æ¡ä»¶çš„åˆ—è¡¨æ¨å¯¼å¼
even_squares: list[int] = [i ** 2 for i in range(1, 11) if i % 2 == 0]
print(even_squares)  # [4, 16, 36, 64, 100]

# AI åº”ç”¨ï¼šæ‰¹é‡æ ¼å¼åŒ–æ¶ˆæ¯
raw_messages: list[str] = ["hello", "how are you", "goodbye"]
formatted: list[str] = [f"ç”¨æˆ·: {msg}" for msg in raw_messages]
print(formatted)
# ['ç”¨æˆ·: hello', 'ç”¨æˆ·: how are you', 'ç”¨æˆ·: goodbye']
```

---

## ç¬¬ä¸‰éƒ¨åˆ†ï¼šwhile å¾ªç¯â€”â€”Agent çš„é‡è¯•æœºåˆ¶

> **ğŸ¯ å°ç™½ç†è§£**ï¼šwhile å¾ªç¯å°±æ˜¯"åªè¦...å°±ä¸€ç›´..."
>
> **for å¾ªç¯** vs **while å¾ªç¯**ï¼š
>
> - **for å¾ªç¯**ï¼šæˆ‘çŸ¥é“è¦åšå‡ æ¬¡ï¼ˆæ¯”å¦‚éå†ä¸€ä¸ªåˆ—è¡¨ï¼‰
> - **while å¾ªç¯**ï¼šæˆ‘ä¸çŸ¥é“è¦åšå‡ æ¬¡ï¼ŒåªçŸ¥é“ä»€ä¹ˆæ—¶å€™åœï¼ˆæ¯”å¦‚æ¸¸æˆä¸»å¾ªç¯ã€ç­‰å¾…ç”¨æˆ·è¾“å…¥ï¼‰
>
> **ç”Ÿæ´»ä¾‹å­**ï¼š
>
> ```
> while è¿˜æ²¡åƒé¥±:
>     å†åƒä¸€å£é¥­
>
> while è¿˜æ²¡åˆ°ç›®çš„åœ°:
>     ç»§ç»­å¼€è½¦
>
> while ç”¨æˆ·è¿˜åœ¨çº¿:
>     ç­‰å¾…ç”¨æˆ·æ¶ˆæ¯
> ```
>
> **Python å†™æ³•**ï¼š
>
> ```python
> count = 0
> while count < 3:
>     print(f"ç¬¬ {count + 1} æ¬¡å°è¯•")
>     count = count + 1  # åˆ«å¿˜äº†æ›´æ–°æ¡ä»¶ï¼
>
> # è¾“å‡ºï¼š
> # ç¬¬ 1 æ¬¡å°è¯•
> # ç¬¬ 2 æ¬¡å°è¯•
> # ç¬¬ 3 æ¬¡å°è¯•
> ```
>
> **âš ï¸ å°å¿ƒæ— é™å¾ªç¯ï¼** å¦‚æœæ¡ä»¶æ°¸è¿œä¸º Trueï¼Œç¨‹åºä¼šä¸€ç›´è·‘ä¸‹å»ï¼š
>
> ```python
> # âŒ å±é™©ï¼æ— é™å¾ªç¯ï¼
> while True:
>     print("æˆ‘ä¼šä¸€ç›´æ‰“å°...")  # æŒ‰ Ctrl+C å¼ºåˆ¶åœæ­¢
> ```

### åŸºæœ¬ while å¾ªç¯

```python
# é‡è¯•æœºåˆ¶çš„ç®€å•å®ç°
max_retries: int = 3
attempt: int = 0

while attempt < max_retries:
    print(f"ç¬¬ {attempt + 1} æ¬¡å°è¯•è°ƒç”¨ API...")
    attempt += 1
    # å‡è®¾ API è°ƒç”¨æˆåŠŸ
    success: bool = True
    if success:
        print("API è°ƒç”¨æˆåŠŸï¼")
        break
```

### å®æˆ˜ï¼šAgent é‡è¯•é€»è¾‘

```python
import time
from typing import Optional

def call_llm_with_retry(
    prompt: str,
    max_retries: int = 3,
    retry_delay: float = 1.0
) -> Optional[str]:
    """
    è°ƒç”¨ LLM APIï¼Œå¤±è´¥æ—¶è‡ªåŠ¨é‡è¯•
    
    Args:
        prompt: æç¤ºè¯
        max_retries: æœ€å¤§é‡è¯•æ¬¡æ•°
        retry_delay: é‡è¯•é—´éš”ï¼ˆç§’ï¼‰
    
    Returns:
        LLM å“åº”ï¼Œå¤±è´¥è¿”å› None
    """
    attempt: int = 0
    
    while attempt < max_retries:
        try:
            print(f"å°è¯• #{attempt + 1}...")
            # æ¨¡æ‹Ÿ API è°ƒç”¨ï¼ˆå®é™…ä¸­ä¼šè°ƒç”¨ OpenAI/Anthropic APIï¼‰
            response: str = f"å“åº”: {prompt}"
            return response
            
        except Exception as e:
            attempt += 1
            if attempt < max_retries:
                print(f"é”™è¯¯: {e}. {retry_delay}ç§’åé‡è¯•...")
                time.sleep(retry_delay)
            else:
                print(f"è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•° ({max_retries})ï¼Œæ”¾å¼ƒ")
                return None
    
    return None

# æµ‹è¯•
result = call_llm_with_retry("What is AI?")
print(result)
```

### break å’Œ continue

```python
# break: ç«‹å³é€€å‡ºå¾ªç¯
for i in range(10):
    if i == 5:
        print("æ‰¾åˆ°ç›®æ ‡ï¼Œåœæ­¢æœç´¢")
        break
    print(f"æ£€æŸ¥ç¬¬ {i} é¡¹")

# continue: è·³è¿‡æœ¬æ¬¡è¿­ä»£ï¼Œç»§ç»­ä¸‹ä¸€æ¬¡
messages: list[str] = ["Hello", "", "World", "", "!"]
for msg in messages:
    if not msg:  # è·³è¿‡ç©ºæ¶ˆæ¯
        continue
    print(f"å¤„ç†æ¶ˆæ¯: {msg}")
```

---

## ç¬¬å››éƒ¨åˆ†ï¼šå®æˆ˜æ¡ˆä¾‹â€”â€”æ„å»ºç®€å•çš„å¯¹è¯ Agent

è®©æˆ‘ä»¬ç»¼åˆè¿ç”¨æ‰€å­¦çŸ¥è¯†ï¼Œæ„å»ºä¸€ä¸ªå…·æœ‰å†³ç­–èƒ½åŠ›çš„å¯¹è¯ Agentï¼š

```python
"""
ç®€å•å¯¹è¯ Agent
æ¼”ç¤ºæ§åˆ¶æµåœ¨ AI Agent ä¸­çš„åº”ç”¨
"""

from typing import Optional


class SimpleAgent:
    """ç®€å•çš„å¯¹è¯ Agent"""
    
    def __init__(self, name: str, max_turns: int = 10) -> None:
        """
        åˆå§‹åŒ– Agent
        
        Args:
            name: Agent åç§°
            max_turns: æœ€å¤§å¯¹è¯è½®æ¬¡
        """
        self.name: str = name
        self.max_turns: int = max_turns
        self.conversation_history: list[str] = []
        self.current_turn: int = 0
    
    def process_input(self, user_input: str) -> Optional[str]:
        """
        å¤„ç†ç”¨æˆ·è¾“å…¥ï¼Œè¿”å› Agent å“åº”
        
        Args:
            user_input: ç”¨æˆ·è¾“å…¥
        
        Returns:
            Agent å“åº”
        """
        # æ£€æŸ¥å¯¹è¯è½®æ¬¡é™åˆ¶
        if self.current_turn >= self.max_turns:
            return "å·²è¾¾å¯¹è¯è½®æ¬¡ä¸Šé™ï¼Œä¼šè¯ç»“æŸã€‚"
        
        # è®°å½•ç”¨æˆ·è¾“å…¥
        self.conversation_history.append(f"ç”¨æˆ·: {user_input}")
        self.current_turn += 1
        
        # æ„å›¾è¯†åˆ«ï¼ˆç®€åŒ–ç‰ˆï¼‰
        intent: str = self._classify_intent(user_input)
        
        # æ ¹æ®æ„å›¾ç”Ÿæˆå“åº”
        response: str = self._generate_response(intent, user_input)
        
        # è®°å½• Agent å“åº”
        self.conversation_history.append(f"Agent: {response}")
        
        return response
    
    def _classify_intent(self, text: str) -> str:
        """
        åˆ†ç±»ç”¨æˆ·æ„å›¾ï¼ˆç®€åŒ–å®ç°ï¼‰
        
        å®é™…åº”ç”¨ä¸­ä¼šä½¿ç”¨ LLM æˆ–åˆ†ç±»æ¨¡å‹
        """
        text_lower: str = text.lower()
        
        if any(word in text_lower for word in ["ä½ å¥½", "hello", "hi"]):
            return "greeting"
        elif any(word in text_lower for word in ["å†è§", "bye", "goodbye"]):
            return "goodbye"
        elif "å¤©æ°”" in text_lower:
            return "weather_query"
        elif "?" in text or "ï¼Ÿ" in text or "ä»€ä¹ˆ" in text_lower:
            return "question"
        else:
            return "general"
    
    def _generate_response(self, intent: str, user_input: str) -> str:
        """
        æ ¹æ®æ„å›¾ç”Ÿæˆå“åº”
        
        è¿™æ¨¡æ‹Ÿäº† LangGraph çš„æ¡ä»¶è·¯ç”±
        """
        if intent == "greeting":
            return f"æ‚¨å¥½ï¼æˆ‘æ˜¯ {self.name}ï¼Œå¾ˆé«˜å…´ä¸ºæ‚¨æœåŠ¡ã€‚"
        
        elif intent == "goodbye":
            return "å†è§ï¼æœŸå¾…ä¸‹æ¬¡ä¸ºæ‚¨æœåŠ¡ã€‚"
        
        elif intent == "weather_query":
            return "æ­£åœ¨ä¸ºæ‚¨æŸ¥è¯¢å¤©æ°”ä¿¡æ¯...ï¼ˆè¿™é‡Œä¼šè°ƒç”¨å¤©æ°” APIï¼‰"
        
        elif intent == "question":
            return f"æ‚¨é—®: '{user_input}'ã€‚è®©æˆ‘æ€è€ƒä¸€ä¸‹...ï¼ˆè¿™é‡Œä¼šè°ƒç”¨ LLMï¼‰"
        
        else:
            return "æˆ‘ç†è§£äº†ã€‚è¿˜æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®åŠ©æ‚¨çš„å—ï¼Ÿ"
    
    def get_conversation_summary(self) -> str:
        """è·å–å¯¹è¯æ‘˜è¦"""
        return "\n".join(self.conversation_history)


def main() -> None:
    """ä¸»å‡½æ•°ï¼šæ¼”ç¤º Agent å¯¹è¯æµç¨‹"""
    agent = SimpleAgent(name="åŠ©æ‰‹å°A", max_turns=5)
    
    # æ¨¡æ‹Ÿå¯¹è¯
    test_inputs: list[str] = [
        "ä½ å¥½",
        "ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ",
        "ä»€ä¹ˆæ˜¯äººå·¥æ™ºèƒ½ï¼Ÿ",
        "è°¢è°¢",
        "å†è§",
    ]
    
    print(f"=== å¼€å§‹å¯¹è¯ (æœ€å¤š {agent.max_turns} è½®) ===\n")
    
    for user_input in test_inputs:
        print(f"ç”¨æˆ·: {user_input}")
        response = agent.process_input(user_input)
        
        if response:
            print(f"{agent.name}: {response}\n")
        
        # å¦‚æœæ˜¯å‘Šåˆ«ï¼Œç»“æŸå¯¹è¯
        if "å†è§" in response or "goodbye" in response.lower():
            break
    
    print("=== å¯¹è¯å†å² ===")
    print(agent.get_conversation_summary())


if __name__ == "__main__":
    main()
```

**è¿è¡Œç»“æœ**ï¼š
```
=== å¼€å§‹å¯¹è¯ (æœ€å¤š 5 è½®) ===

ç”¨æˆ·: ä½ å¥½
åŠ©æ‰‹å°A: æ‚¨å¥½ï¼æˆ‘æ˜¯ åŠ©æ‰‹å°Aï¼Œå¾ˆé«˜å…´ä¸ºæ‚¨æœåŠ¡ã€‚

ç”¨æˆ·: ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ
åŠ©æ‰‹å°A: æ­£åœ¨ä¸ºæ‚¨æŸ¥è¯¢å¤©æ°”ä¿¡æ¯...ï¼ˆè¿™é‡Œä¼šè°ƒç”¨å¤©æ°” APIï¼‰

ç”¨æˆ·: ä»€ä¹ˆæ˜¯äººå·¥æ™ºèƒ½ï¼Ÿ
åŠ©æ‰‹å°A: æ‚¨é—®: 'ä»€ä¹ˆæ˜¯äººå·¥æ™ºèƒ½ï¼Ÿ'ã€‚è®©æˆ‘æ€è€ƒä¸€ä¸‹...ï¼ˆè¿™é‡Œä¼šè°ƒç”¨ LLMï¼‰

ç”¨æˆ·: è°¢è°¢
åŠ©æ‰‹å°A: æˆ‘ç†è§£äº†ã€‚è¿˜æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®åŠ©æ‚¨çš„å—ï¼Ÿ

ç”¨æˆ·: å†è§
åŠ©æ‰‹å°A: å†è§ï¼æœŸå¾…ä¸‹æ¬¡ä¸ºæ‚¨æœåŠ¡ã€‚

=== å¯¹è¯å†å² ===
ç”¨æˆ·: ä½ å¥½
Agent: æ‚¨å¥½ï¼æˆ‘æ˜¯ åŠ©æ‰‹å°Aï¼Œå¾ˆé«˜å…´ä¸ºæ‚¨æœåŠ¡ã€‚
ç”¨æˆ·: ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ
Agent: æ­£åœ¨ä¸ºæ‚¨æŸ¥è¯¢å¤©æ°”ä¿¡æ¯...ï¼ˆè¿™é‡Œä¼šè°ƒç”¨å¤©æ°” APIï¼‰
ç”¨æˆ·: ä»€ä¹ˆæ˜¯äººå·¥æ™ºèƒ½ï¼Ÿ
Agent: æ‚¨é—®: 'ä»€ä¹ˆæ˜¯äººå·¥æ™ºèƒ½ï¼Ÿ'ã€‚è®©æˆ‘æ€è€ƒä¸€ä¸‹...ï¼ˆè¿™é‡Œä¼šè°ƒç”¨ LLMï¼‰
ç”¨æˆ·: è°¢è°¢
Agent: æˆ‘ç†è§£äº†ã€‚è¿˜æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®åŠ©æ‚¨çš„å—ï¼Ÿ
ç”¨æˆ·: å†è§
Agent: å†è§ï¼æœŸå¾…ä¸‹æ¬¡ä¸ºæ‚¨æœåŠ¡ã€‚
```

---

## æ§åˆ¶æµä¸ LangGraph çš„è”ç³»

åœ¨ LangGraph ä¸­ï¼Œæ§åˆ¶æµä½“ç°åœ¨ï¼š

### 1. æ¡ä»¶è·¯ç”±ï¼ˆConditional Routingï¼‰

```python
# LangGraph ä¸­çš„æ¡ä»¶è¾¹
workflow.add_conditional_edges(
    "agent",
    lambda x: "tools" if x["needs_tool"] else "end",
    {
        "tools": "call_tools",
        "end": END
    }
)

# ç­‰ä»·äº
if state["needs_tool"]:
    next_node = "call_tools"
else:
    next_node = END
```

### 2. å¾ªç¯æ‰§è¡Œï¼ˆLoopingï¼‰

```python
# LangGraph çš„å¾ªç¯
workflow.add_edge("tools", "agent")  # å·¥å…·è°ƒç”¨åè¿”å› agent

# ç­‰ä»·äº
while not task_completed:
    agent_output = call_agent()
    if needs_tool(agent_output):
        tool_result = call_tools()
    else:
        break
```

---

## æœ¬èŠ‚æ€»ç»“

### æ ¸å¿ƒæ¦‚å¿µ

1. **if/elif/else**: Agent çš„å†³ç­–åˆ†æ”¯
2. **for å¾ªç¯**: æ‰¹é‡å¤„ç†æ¶ˆæ¯ã€å·¥å…·è°ƒç”¨
3. **while å¾ªç¯**: é‡è¯•æœºåˆ¶ã€æŒç»­ç›‘å¬
4. **break/continue**: ç²¾ç¡®æ§åˆ¶å¾ªç¯æµç¨‹
5. **æ§åˆ¶æµ = Agent çš„"å¤§è„‘"**

### æœ€ä½³å®è·µ

- âœ… ä½¿ç”¨æ˜ç¡®çš„æ¡ä»¶åˆ¤æ–­ï¼Œé¿å…å¤æ‚åµŒå¥—
- âœ… å¾ªç¯ä¸­å§‹ç»ˆè€ƒè™‘é€€å‡ºæ¡ä»¶ï¼Œé˜²æ­¢æ— é™å¾ªç¯
- âœ… ä½¿ç”¨åˆ—è¡¨æ¨å¯¼å¼è®©ä»£ç æ›´ç®€æ´
- âœ… åœ¨ while å¾ªç¯ä¸­è®¾ç½®æœ€å¤§è¿­ä»£æ¬¡æ•°

---

**ä¸‹ä¸€èŠ‚ï¼š[0.4 å°ç»“å’Œå¤ä¹ ](0.4-å°ç»“å’Œå¤ä¹ .md)**

# 4.3 å®æˆ˜ï¼šé…ç½®ç®¡ç†ç³»ç»Ÿ

> **ğŸ¯ å°ç™½ç†è§£**ï¼šä¸ºä»€ä¹ˆéœ€è¦"é…ç½®ç®¡ç†ç³»ç»Ÿ"ï¼Ÿ
>
> æƒ³è±¡ä½ å¼€äº†ä¸€å®¶è¿é”å¥¶èŒ¶åº—ï¼š
>
> - **æ²¡æœ‰é…ç½®ç³»ç»Ÿ**ï¼šæ¯å®¶åº—çš„é…æ–¹ã€ä»·æ ¼ã€åŸæ–™éƒ½æ‰‹åŠ¨ç®¡ç†ï¼Œä¹±æˆä¸€å›¢
> - **æœ‰é…ç½®ç³»ç»Ÿ**ï¼šç»Ÿä¸€ç®¡ç†æ‰€æœ‰åº—çš„è®¾ç½®ï¼Œæ”¹ä¸€å¤„å…¨éƒ¨ç”Ÿæ•ˆ
>
> **AI Agent ä¹Ÿæ˜¯è¿™æ ·**ï¼š
>
> ```
> Agent é…ç½®åŒ…æ‹¬ï¼š
> â”œâ”€â”€ ç”¨å“ªä¸ªæ¨¡å‹ï¼Ÿï¼ˆGPT-4ã€Claude...ï¼‰
> â”œâ”€â”€ æ¸©åº¦æ˜¯å¤šå°‘ï¼Ÿï¼ˆ0.7ã€0.9...ï¼‰
> â”œâ”€â”€ å¼€å¯å“ªäº›å·¥å…·ï¼Ÿï¼ˆæœç´¢ã€è®¡ç®—å™¨...ï¼‰
> â””â”€â”€ ç³»ç»Ÿæç¤ºè¯æ˜¯ä»€ä¹ˆï¼Ÿ
> ```
>
> é…ç½®ç®¡ç†ç³»ç»Ÿå¸®ä½ ï¼š
>
> 1. **ç»Ÿä¸€å­˜å‚¨**ï¼šæ‰€æœ‰é…ç½®æ”¾åœ¨ä¸€èµ·
> 2. **æ ¼å¼è§„èŒƒ**ï¼šä½¿ç”¨ YAML/JSONï¼Œä¸ä¼šä¹±å†™
> 3. **ç‰ˆæœ¬æ§åˆ¶**ï¼šæ”¹é”™äº†å¯ä»¥å›æ»š
> 4. **ç¯å¢ƒåˆ‡æ¢**ï¼šå¼€å‘/æµ‹è¯•/ç”Ÿäº§ç”¨ä¸åŒé…ç½®

## Agent é…ç½®ç®¡ç†ç³»ç»Ÿ

> **ğŸ¯ å°ç™½ç†è§£**ï¼šä»€ä¹ˆæ˜¯ `@dataclass`ï¼Ÿ
>
> Python çš„ `@dataclass` æ˜¯ä¸€ä¸ª"å¿«æ·æ–¹å¼"ï¼Œå¸®ä½ è‡ªåŠ¨ç”Ÿæˆç±»çš„å¸¸ç”¨æ–¹æ³•ã€‚
>
> **ä¸ç”¨ dataclass**ï¼ˆéº»çƒ¦ï¼‰ï¼š
>
> ```python
> class Person:
>     def __init__(self, name, age):
>         self.name = name
>         self.age = age
>
>     def __repr__(self):
>         return f"Person(name={self.name}, age={self.age})"
> ```
>
> **ç”¨ dataclass**ï¼ˆç®€æ´ï¼‰ï¼š
>
> ```python
> @dataclass
> class Person:
>     name: str
>     age: int
>     # __init__ å’Œ __repr__ è‡ªåŠ¨ç”Ÿæˆï¼
> ```
>
> **ç±»æ¯”**ï¼š`@dataclass` å°±åƒä¸€ä¸ª"æ™ºèƒ½æ¨¡æ¿"ï¼Œä½ åªéœ€è¦å£°æ˜æ•°æ®å­—æ®µï¼Œå®ƒå¸®ä½ æŠŠæ‚æ´»éƒ½å¹²äº†ï¼

```python
from pathlib import Path
from typing import Dict, Any, Optional, List
import json
import yaml
from dataclasses import dataclass, field, asdict
from datetime import datetime

@dataclass
class ToolConfig:
    """å·¥å…·é…ç½®"""
    name: str
    enabled: bool = True
    timeout: float = 30.0
    max_retries: int = 3
    settings: Dict[str, Any] = field(default_factory=dict)

@dataclass
class ModelConfig:
    """æ¨¡å‹é…ç½®"""
    provider: str  # openai, anthropic, etc.
    model_name: str
    temperature: float = 0.7
    max_tokens: int = 2000
    top_p: float = 1.0
    frequency_penalty: float = 0.0
    presence_penalty: float = 0.0

@dataclass
class AgentConfig:
    """å®Œæ•´ Agent é…ç½®"""
    name: str
    description: str
    version: str
    
    # æ¨¡å‹é…ç½®
    model: ModelConfig
    
    # å·¥å…·é…ç½®
    tools: List[ToolConfig] = field(default_factory=list)
    
    # ç³»ç»Ÿæç¤ºè¯
    system_prompt: str = "ä½ æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„AIåŠ©æ‰‹ã€‚"
    
    # è¿è¡Œæ—¶é…ç½®
    max_iterations: int = 10
    verbose: bool = False
    
    # å…ƒæ•°æ®
    created_at: str = field(default_factory=lambda: datetime.now().isoformat())
    updated_at: str = field(default_factory=lambda: datetime.now().isoformat())

class ConfigManager:
    """é…ç½®ç®¡ç†å™¨"""
    
    def __init__(self, config_dir: str = "configs"):
        self.config_dir = Path(config_dir)
        self.config_dir.mkdir(exist_ok=True)
        self.cache: Dict[str, AgentConfig] = {}
    
    def save_config(self, config: AgentConfig, format: str = "yaml") -> Path:
        """ä¿å­˜é…ç½®åˆ°æ–‡ä»¶"""
        config.updated_at = datetime.now().isoformat()
        
        file_name = f"{config.name}.{format}"
        file_path = self.config_dir / file_name
        
        config_dict = asdict(config)
        
        if format == "json":
            with file_path.open("w", encoding="utf-8") as f:
                json.dump(config_dict, f, indent=2, ensure_ascii=False)
        
        elif format == "yaml":
            with file_path.open("w", encoding="utf-8") as f:
                yaml.dump(config_dict, f, allow_unicode=True, sort_keys=False)
        
        else:
            raise ValueError(f"ä¸æ”¯æŒçš„æ ¼å¼: {format}")
        
        # æ›´æ–°ç¼“å­˜
        self.cache[config.name] = config
        
        return file_path
    
    def load_config(self, name: str, format: str = "yaml") -> AgentConfig:
        """ä»æ–‡ä»¶åŠ è½½é…ç½®"""
        # æ£€æŸ¥ç¼“å­˜
        if name in self.cache:
            return self.cache[name]
        
        file_name = f"{name}.{format}"
        file_path = self.config_dir / file_name
        
        if not file_path.exists():
            raise FileNotFoundError(f"é…ç½®æ–‡ä»¶ä¸å­˜åœ¨: {file_path}")
        
        with file_path.open("r", encoding="utf-8") as f:
            if format == "json":
                data = json.load(f)
            elif format == "yaml":
                data = yaml.safe_load(f)
            else:
                raise ValueError(f"ä¸æ”¯æŒçš„æ ¼å¼: {format}")
        
        # è½¬æ¢ä¸ºé…ç½®å¯¹è±¡
        config = self._dict_to_config(data)
        
        # ç¼“å­˜
        self.cache[name] = config
        
        return config
    
    def _dict_to_config(self, data: Dict[str, Any]) -> AgentConfig:
        """å­—å…¸è½¬é…ç½®å¯¹è±¡"""
        # è½¬æ¢ ModelConfig
        model_data = data.pop("model")
        model = ModelConfig(**model_data)
        
        # è½¬æ¢ ToolConfig åˆ—è¡¨
        tools_data = data.pop("tools", [])
        tools = [ToolConfig(**tool) for tool in tools_data]
        
        return AgentConfig(
            model=model,
            tools=tools,
            **data
        )
    
    def list_configs(self) -> List[str]:
        """åˆ—å‡ºæ‰€æœ‰é…ç½®"""
        configs = []
        for file_path in self.config_dir.glob("*"):
            if file_path.suffix in [".json", ".yaml", ".yml"]:
                configs.append(file_path.stem)
        return configs
    
    def delete_config(self, name: str):
        """åˆ é™¤é…ç½®"""
        # åˆ é™¤ç¼“å­˜
        self.cache.pop(name, None)
        
        # åˆ é™¤æ–‡ä»¶
        for ext in [".json", ".yaml", ".yml"]:
            file_path = self.config_dir / f"{name}{ext}"
            if file_path.exists():
                file_path.unlink()
    
    def update_config(
        self,
        name: str,
        updates: Dict[str, Any],
        format: str = "yaml"
    ) -> AgentConfig:
        """æ›´æ–°é…ç½®"""
        config = self.load_config(name, format)
        
        # åº”ç”¨æ›´æ–°
        for key, value in updates.items():
            if hasattr(config, key):
                setattr(config, key, value)
        
        # ä¿å­˜
        self.save_config(config, format)
        
        return config
    
    def validate_config(self, config: AgentConfig) -> List[str]:
        """éªŒè¯é…ç½®"""
        errors = []
        
        # éªŒè¯æ¨¡å‹é…ç½®
        if not config.model.provider:
            errors.append("æ¨¡å‹æä¾›å•†ä¸èƒ½ä¸ºç©º")
        
        if not config.model.model_name:
            errors.append("æ¨¡å‹åç§°ä¸èƒ½ä¸ºç©º")
        
        if not 0 <= config.model.temperature <= 2:
            errors.append("temperature å¿…é¡»åœ¨ 0-2 ä¹‹é—´")
        
        if config.model.max_tokens <= 0:
            errors.append("max_tokens å¿…é¡»å¤§äº 0")
        
        # éªŒè¯å·¥å…·é…ç½®
        for tool in config.tools:
            if not tool.name:
                errors.append("å·¥å…·åç§°ä¸èƒ½ä¸ºç©º")
            
            if tool.timeout <= 0:
                errors.append(f"å·¥å…· {tool.name} çš„è¶…æ—¶æ—¶é—´å¿…é¡»å¤§äº 0")
        
        # éªŒè¯è¿è¡Œæ—¶é…ç½®
        if config.max_iterations <= 0:
            errors.append("max_iterations å¿…é¡»å¤§äº 0")
        
        return errors

# ä½¿ç”¨ç¤ºä¾‹
manager = ConfigManager()

# åˆ›å»ºé…ç½®
research_config = AgentConfig(
    name="research_agent",
    description="ä¸“ä¸šçš„ç ”ç©¶åŠ©æ‰‹",
    version="1.0.0",
    model=ModelConfig(
        provider="openai",
        model_name="gpt-4",
        temperature=0.7,
        max_tokens=2000
    ),
    tools=[
        ToolConfig(
            name="search",
            enabled=True,
            timeout=10.0,
            settings={"max_results": 5}
        ),
        ToolConfig(
            name="calculator",
            enabled=True,
            timeout=5.0
        )
    ],
    system_prompt="ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ç ”ç©¶åŠ©æ‰‹ï¼Œæ“…é•¿æŸ¥æ‰¾å’Œåˆ†æä¿¡æ¯ã€‚",
    max_iterations=10,
    verbose=True
)

# éªŒè¯é…ç½®
errors = manager.validate_config(research_config)
if errors:
    print("é…ç½®é”™è¯¯:")
    for error in errors:
        print(f"  - {error}")
else:
    # ä¿å­˜é…ç½®
    config_path = manager.save_config(research_config, format="yaml")
    print(f"é…ç½®å·²ä¿å­˜åˆ°: {config_path}")

# åŠ è½½é…ç½®
loaded_config = manager.load_config("research_agent", format="yaml")
print(f"\nåŠ è½½çš„é…ç½®: {loaded_config.name}")
print(f"æ¨¡å‹: {loaded_config.model.model_name}")
print(f"å·¥å…·æ•°é‡: {len(loaded_config.tools)}")

# æ›´æ–°é…ç½®
manager.update_config(
    "research_agent",
    updates={
        "temperature": 0.8,
        "verbose": False
    }
)

# åˆ—å‡ºæ‰€æœ‰é…ç½®
configs = manager.list_configs()
print(f"\næ‰€æœ‰é…ç½®: {configs}")
```

## é…ç½®æ¨¡æ¿ç³»ç»Ÿ

> **ğŸ¯ å°ç™½ç†è§£**ï¼šä»€ä¹ˆæ˜¯"é…ç½®æ¨¡æ¿"ï¼Ÿ
>
> æƒ³è±¡ä½ æ˜¯ä¸€ä¸ªå¥¶èŒ¶åº—è€æ¿ï¼š
>
> - **æ²¡æœ‰æ¨¡æ¿**ï¼šæ¯æ¬¡å¼€æ–°åº—éƒ½è¦ä»é›¶å¼€å§‹å†™é…æ–¹
> - **æœ‰æ¨¡æ¿**ï¼šæœ‰"å¥¶èŒ¶æ¨¡æ¿"ã€"æœèŒ¶æ¨¡æ¿"ï¼Œæ–°åº—ç›´æ¥å¥—ç”¨ï¼Œç¨å¾®è°ƒæ•´å°±è¡Œ
>
> **é…ç½®æ¨¡æ¿å°±æ˜¯è¿™ä¸ªé“ç†**ï¼š
>
> | æ¨¡æ¿å | é¢„è®¾é…ç½® | é€‚ç”¨åœºæ™¯ |
> |--------|---------|---------|
> | `research` | GPT-4 + æœç´¢å·¥å…· + æ¸©åº¦ 0.7 | ç ”ç©¶åŠ©æ‰‹ |
> | `writer` | Claude + æ— å·¥å…· + æ¸©åº¦ 0.9 | åˆ›æ„å†™ä½œ |
> | `coder` | GPT-4 + ä»£ç è§£é‡Šå™¨ + æ¸©åº¦ 0.3 | ç¼–ç¨‹åŠ©æ‰‹ |
>
> æ–°å»º Agent æ—¶ï¼Œé€‰ä¸ªæ¨¡æ¿ï¼Œæ”¹æ”¹å‚æ•°å°±å¥½äº†ï¼

```python
from typing import Dict, Any
import re

class ConfigTemplate:
    """é…ç½®æ¨¡æ¿ç³»ç»Ÿ"""
    
    def __init__(self):
        self.templates: Dict[str, Dict[str, Any]] = {}
        self._load_default_templates()
    
    def _load_default_templates(self):
        """åŠ è½½é»˜è®¤æ¨¡æ¿"""
        self.templates = {
            "research": {
                "description": "ç ”ç©¶åŠ©æ‰‹æ¨¡æ¿",
                "model": {
                    "provider": "openai",
                    "model_name": "gpt-4",
                    "temperature": 0.7
                },
                "tools": [
                    {"name": "search", "enabled": True},
                    {"name": "calculator", "enabled": True},
                    {"name": "wikipedia", "enabled": True}
                ],
                "system_prompt": "ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ç ”ç©¶åŠ©æ‰‹ã€‚",
                "max_iterations": 10
            },
            
            "writer": {
                "description": "å†™ä½œåŠ©æ‰‹æ¨¡æ¿",
                "model": {
                    "provider": "anthropic",
                    "model_name": "claude-3-5-sonnet-20241022",
                    "temperature": 0.9
                },
                "tools": [],
                "system_prompt": "ä½ æ˜¯ä¸€ä¸ªåˆ›æ„å†™ä½œåŠ©æ‰‹ï¼Œé£æ ¼ä¼˜ç¾ç®€æ´ã€‚",
                "max_iterations": 5
            },
            
            "coder": {
                "description": "ç¼–ç¨‹åŠ©æ‰‹æ¨¡æ¿",
                "model": {
                    "provider": "openai",
                    "model_name": "gpt-4",
                    "temperature": 0.3
                },
                "tools": [
                    {"name": "code_interpreter", "enabled": True},
                    {"name": "file_search", "enabled": True}
                ],
                "system_prompt": "ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ç¼–ç¨‹åŠ©æ‰‹ã€‚",
                "max_iterations": 15
            }
        }
    
    def create_from_template(
        self,
        template_name: str,
        agent_name: str,
        overrides: Optional[Dict[str, Any]] = None
    ) -> AgentConfig:
        """ä»æ¨¡æ¿åˆ›å»ºé…ç½®"""
        if template_name not in self.templates:
            raise ValueError(f"æ¨¡æ¿ä¸å­˜åœ¨: {template_name}")
        
        # æ·±æ‹·è´æ¨¡æ¿
        template = self.templates[template_name].copy()
        
        # åº”ç”¨è¦†ç›–
        if overrides:
            self._apply_overrides(template, overrides)
        
        # åˆ›å»ºé…ç½®
        model = ModelConfig(**template.pop("model"))
        tools_data = template.pop("tools")
        tools = [ToolConfig(**tool) for tool in tools_data]
        
        return AgentConfig(
            name=agent_name,
            model=model,
            tools=tools,
            version="1.0.0",
            **template
        )
    
    def _apply_overrides(self, template: Dict[str, Any], overrides: Dict[str, Any]):
        """åº”ç”¨é…ç½®è¦†ç›–"""
        for key, value in overrides.items():
            if isinstance(value, dict) and key in template:
                # é€’å½’æ›´æ–°åµŒå¥—å­—å…¸
                template[key].update(value)
            else:
                template[key] = value
    
    def list_templates(self) -> List[str]:
        """åˆ—å‡ºæ‰€æœ‰æ¨¡æ¿"""
        return list(self.templates.keys())
    
    def add_template(self, name: str, template: Dict[str, Any]):
        """æ·»åŠ è‡ªå®šä¹‰æ¨¡æ¿"""
        self.templates[name] = template

# ä½¿ç”¨ç¤ºä¾‹
template_manager = ConfigTemplate()

# åˆ—å‡ºæ¨¡æ¿
print("å¯ç”¨æ¨¡æ¿:")
for name in template_manager.list_templates():
    template = template_manager.templates[name]
    print(f"  - {name}: {template['description']}")

# ä»æ¨¡æ¿åˆ›å»ºé…ç½®
config = template_manager.create_from_template(
    template_name="research",
    agent_name="my_research_bot",
    overrides={
        "model": {
            "temperature": 0.5
        },
        "system_prompt": "ä½ æ˜¯ä¸€ä¸ªå­¦æœ¯ç ”ç©¶åŠ©æ‰‹ã€‚"
    }
)

print(f"\nåˆ›å»ºçš„é…ç½®: {config.name}")
print(f"æ¨¡å‹: {config.model.model_name}")
print(f"æ¸©åº¦: {config.model.temperature}")
print(f"å·¥å…·: {[tool.name for tool in config.tools]}")
```

## ç¯å¢ƒæ„ŸçŸ¥é…ç½®

> **ğŸ¯ å°ç™½ç†è§£**ï¼šä¸ºä»€ä¹ˆéœ€è¦"ç¯å¢ƒæ„ŸçŸ¥"ï¼Ÿ
>
> è½¯ä»¶å¼€å‘é€šå¸¸æœ‰ 3 ä¸ªç¯å¢ƒï¼š
>
> | ç¯å¢ƒ | ç”¨é€” | é…ç½®ç‰¹ç‚¹ |
> |------|------|---------|
> | **å¼€å‘ (dev)** | ç¨‹åºå‘˜æœ¬åœ°è°ƒè¯• | è¯¦ç»†æ—¥å¿—ã€æµ‹è¯• API Key |
> | **æµ‹è¯• (staging)** | ä¸Šçº¿å‰æµ‹è¯• | æ¨¡æ‹Ÿç”Ÿäº§ã€å¯èƒ½å‡ºé”™ |
> | **ç”Ÿäº§ (production)** | ç”¨æˆ·ä½¿ç”¨ | ç¨³å®šã€æ­£å¼ API Key |
>
> **åŒä¸€ä¸ª Agentï¼Œä¸åŒç¯å¢ƒç”¨ä¸åŒé…ç½®**ï¼š
>
> ```
> configs/
> â”œâ”€â”€ development/
> â”‚   â””â”€â”€ research_agent.yaml  # å¼€å‘ç¯å¢ƒï¼šè¯¦ç»†æ—¥å¿—
> â”œâ”€â”€ staging/
> â”‚   â””â”€â”€ research_agent.yaml  # æµ‹è¯•ç¯å¢ƒï¼šæµ‹è¯• API
> â””â”€â”€ production/
>     â””â”€â”€ research_agent.yaml  # ç”Ÿäº§ç¯å¢ƒï¼šæ­£å¼ API
> ```
>
> ç¨‹åºè‡ªåŠ¨æ£€æµ‹å½“å‰ç¯å¢ƒï¼ˆé€šè¿‡ `ENV` ç¯å¢ƒå˜é‡ï¼‰ï¼ŒåŠ è½½å¯¹åº”é…ç½®ï¼

```python
import os
from enum import Enum

class Environment(Enum):
    """ç¯å¢ƒç±»å‹"""
    DEVELOPMENT = "development"
    STAGING = "staging"
    PRODUCTION = "production"

class EnvironmentAwareConfig:
    """ç¯å¢ƒæ„ŸçŸ¥é…ç½®ç®¡ç†"""
    
    def __init__(self, base_config_dir: str = "configs"):
        self.base_dir = Path(base_config_dir)
        self.env = self._detect_environment()
        self.manager = ConfigManager(str(self.base_dir / self.env.value))
    
    def _detect_environment(self) -> Environment:
        """æ£€æµ‹å½“å‰ç¯å¢ƒ"""
        env_name = os.getenv("ENV", "development").lower()
        
        if env_name in ["prod", "production"]:
            return Environment.PRODUCTION
        elif env_name in ["stage", "staging"]:
            return Environment.STAGING
        else:
            return Environment.DEVELOPMENT
    
    def load_config(self, name: str) -> AgentConfig:
        """åŠ è½½ç¯å¢ƒç‰¹å®šçš„é…ç½®"""
        return self.manager.load_config(name)
    
    def get_environment(self) -> Environment:
        """è·å–å½“å‰ç¯å¢ƒ"""
        return self.env

# ä½¿ç”¨ç¤ºä¾‹
# ç›®å½•ç»“æ„:
# configs/
#   development/
#     research_agent.yaml
#   staging/
#     research_agent.yaml
#   production/
#     research_agent.yaml

env_manager = EnvironmentAwareConfig()
print(f"å½“å‰ç¯å¢ƒ: {env_manager.get_environment().value}")

config = env_manager.load_config("research_agent")
print(f"åŠ è½½é…ç½®: {config.name}")
```

## é…ç½®ç‰ˆæœ¬æ§åˆ¶

> **ğŸ¯ å°ç™½ç†è§£**ï¼šä¸ºä»€ä¹ˆéœ€è¦"ç‰ˆæœ¬æ§åˆ¶"ï¼Ÿ
>
> æƒ³è±¡ä½ åœ¨å†™è®ºæ–‡ï¼š
>
> - **æ²¡æœ‰ç‰ˆæœ¬æ§åˆ¶**ï¼šæ”¹é”™äº†ï¼Ÿå®Œäº†ï¼ŒåŸæ¥çš„ç‰ˆæœ¬æ²¡äº†
> - **æœ‰ç‰ˆæœ¬æ§åˆ¶**ï¼šæ¯æ¬¡ä¿®æ”¹éƒ½ä¿å­˜ä¸€ä¸ªç‰ˆæœ¬ï¼Œæ”¹é”™äº†å¯ä»¥"åæ‚”"
>
> **é…ç½®ç‰ˆæœ¬æ§åˆ¶çš„ä½œç”¨**ï¼š
>
> ```
> config_versions/
> â””â”€â”€ research_agent/
>     â”œâ”€â”€ 1.0.0.json  â† åˆå§‹ç‰ˆæœ¬ï¼ˆAlice åˆ›å»ºï¼‰
>     â”œâ”€â”€ 1.0.1.json  â† è°ƒæ•´æ¸©åº¦ï¼ˆBob ä¿®æ”¹ï¼‰
>     â””â”€â”€ 1.0.2.json  â† æ·»åŠ æ–°å·¥å…·ï¼ˆAlice ä¿®æ”¹ï¼‰
> ```
>
> **å¥½å¤„**ï¼š
>
> 1. **å¯è¿½æº¯**ï¼šè°æ”¹äº†ä»€ä¹ˆï¼Ÿä»€ä¹ˆæ—¶å€™æ”¹çš„ï¼Ÿ
> 2. **å¯å›æ»š**ï¼šæ–°ç‰ˆæœ¬æœ‰ bugï¼Ÿåˆ‡å›æ—§ç‰ˆæœ¬
> 3. **å¯å¯¹æ¯”**ï¼šä¸¤ä¸ªç‰ˆæœ¬æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ
>
> ç±»ä¼¼ Git å¯¹ä»£ç çš„ç®¡ç†ï¼Œè¿™æ˜¯å¯¹é…ç½®çš„ç®¡ç†ï¼

```python
from dataclasses import dataclass
from datetime import datetime
from typing import List, Optional

@dataclass
class ConfigVersion:
    """é…ç½®ç‰ˆæœ¬"""
    version: str
    config: AgentConfig
    created_at: datetime
    author: str
    comment: str

class ConfigVersionControl:
    """é…ç½®ç‰ˆæœ¬æ§åˆ¶"""
    
    def __init__(self, storage_dir: str = "config_versions"):
        self.storage_dir = Path(storage_dir)
        self.storage_dir.mkdir(exist_ok=True)
    
    def save_version(
        self,
        config: AgentConfig,
        author: str,
        comment: str = ""
    ) -> str:
        """ä¿å­˜é…ç½®ç‰ˆæœ¬"""
        # ç”Ÿæˆç‰ˆæœ¬å·
        version = self._generate_version(config.name)
        
        # åˆ›å»ºç‰ˆæœ¬å¯¹è±¡
        config_version = ConfigVersion(
            version=version,
            config=config,
            created_at=datetime.now(),
            author=author,
            comment=comment
        )
        
        # ä¿å­˜
        version_dir = self.storage_dir / config.name
        version_dir.mkdir(exist_ok=True)
        
        file_path = version_dir / f"{version}.json"
        
        with file_path.open("w", encoding="utf-8") as f:
            data = {
                "version": version,
                "created_at": config_version.created_at.isoformat(),
                "author": author,
                "comment": comment,
                "config": asdict(config)
            }
            json.dump(data, f, indent=2, ensure_ascii=False)
        
        return version
    
    def _generate_version(self, config_name: str) -> str:
        """ç”Ÿæˆç‰ˆæœ¬å·"""
        version_dir = self.storage_dir / config_name
        
        if not version_dir.exists():
            return "1.0.0"
        
        # è·å–æœ€æ–°ç‰ˆæœ¬
        versions = [f.stem for f in version_dir.glob("*.json")]
        
        if not versions:
            return "1.0.0"
        
        # è§£æç‰ˆæœ¬å·å¹¶é€’å¢
        latest = sorted(versions, key=lambda v: list(map(int, v.split("."))))[-1]
        major, minor, patch = map(int, latest.split("."))
        
        return f"{major}.{minor}.{patch + 1}"
    
    def load_version(self, config_name: str, version: str) -> AgentConfig:
        """åŠ è½½æŒ‡å®šç‰ˆæœ¬"""
        file_path = self.storage_dir / config_name / f"{version}.json"
        
        if not file_path.exists():
            raise FileNotFoundError(f"ç‰ˆæœ¬ä¸å­˜åœ¨: {version}")
        
        with file_path.open("r", encoding="utf-8") as f:
            data = json.load(f)
        
        # è½¬æ¢é…ç½®
        config_data = data["config"]
        model = ModelConfig(**config_data.pop("model"))
        tools = [ToolConfig(**t) for t in config_data.pop("tools")]
        
        return AgentConfig(model=model, tools=tools, **config_data)
    
    def list_versions(self, config_name: str) -> List[Dict[str, Any]]:
        """åˆ—å‡ºæ‰€æœ‰ç‰ˆæœ¬"""
        version_dir = self.storage_dir / config_name
        
        if not version_dir.exists():
            return []
        
        versions = []
        for file_path in sorted(version_dir.glob("*.json")):
            with file_path.open("r", encoding="utf-8") as f:
                data = json.load(f)
                versions.append({
                    "version": data["version"],
                    "created_at": data["created_at"],
                    "author": data["author"],
                    "comment": data["comment"]
                })
        
        return versions

# ä½¿ç”¨ç¤ºä¾‹
vc = ConfigVersionControl()

# ä¿å­˜ç‰ˆæœ¬
version = vc.save_version(
    config=research_config,
    author="Alice",
    comment="åˆå§‹ç‰ˆæœ¬"
)
print(f"ä¿å­˜ç‰ˆæœ¬: {version}")

# åˆ—å‡ºç‰ˆæœ¬
versions = vc.list_versions("research_agent")
print("\nç‰ˆæœ¬å†å²:")
for v in versions:
    print(f"  {v['version']} - {v['author']} - {v['comment']}")

# åŠ è½½ç‰ˆæœ¬
loaded = vc.load_version("research_agent", "1.0.0")
print(f"\nåŠ è½½ç‰ˆæœ¬: {loaded.name}")
```

## å…³é”®è¦ç‚¹

1. **ç»“æ„åŒ–é…ç½®**ï¼šä½¿ç”¨ dataclass å®šä¹‰æ¸…æ™°çš„é…ç½®ç»“æ„
2. **å¤šæ ¼å¼æ”¯æŒ**ï¼šæ”¯æŒ JSON å’Œ YAML ä¸¤ç§æ ¼å¼
3. **é…ç½®éªŒè¯**ï¼šåœ¨ä¿å­˜å’ŒåŠ è½½æ—¶éªŒè¯é…ç½®
4. **æ¨¡æ¿ç³»ç»Ÿ**ï¼šä½¿ç”¨æ¨¡æ¿å¿«é€Ÿåˆ›å»ºæ ‡å‡†é…ç½®
5. **ç‰ˆæœ¬æ§åˆ¶**ï¼šè·Ÿè¸ªé…ç½®å˜æ›´å†å²

---

**ä¸‹ä¸€èŠ‚ï¼š[4.4 å°ç»“å’Œå¤ä¹ ](4.4-å°ç»“å’Œå¤ä¹ .md)**
